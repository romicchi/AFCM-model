{"text":"1. RADIO PHYSICS 1\n1. RADIO PHYSICS\nWireless communications make use of electromagnetic waves to send\nsignals across long distances. From a user\u2019s perspective, wireless\nconnections are not particularly different from any other network\nconnection: your web browser, email, and other applications all work as\nyou would expect. But radio waves have some unexpected properties\ncompared to Ethernet cable. For example, it\u2019s very easy to see the path\nthat an Ethernet cable takes: locate the plug sticking out of your\ncomputer, follow the cable to the other end, and you\u2019ve found it! You can\nalso be confident that running many Ethernet cables alongside each other\nwon\u2019t cause problems, since the cables effectively keep their signals\ncontained within the wire itself.\nBut how do you know where the waves emanating from your wireless\ndevice are going? What happens when these waves bounce off objects in\nthe room or other buildings in an outdoor link? How can several wireless\ncards be used in the same area without interfering with each other?\nIn order to build stable high-speed wireless links, it is important to\nunderstand how radio waves behave in the real world.\nWhat is a wave?\nWe are all familiar with vibrations or oscillations in various forms: a\npendulum, a tree swaying in the wind, the string of a guitar - these are all\nexamples of oscillations.\nWhat they have in common is that something, some medium or object, is\nswinging in a periodic manner, with a certain number of cycles per unit of\ntime. This kind of wave is sometimes called a mechanical wave, since it is\ndefined by the motion of an object or its propagating medium.\nWhen such oscillations travel (that is, when the swinging does not stay\nbound to one place) then we speak of waves propagating in space. For\nexample, a singer singing creates periodic oscillations in his or her vocal\ncords. These oscillations periodically compress and decompress the air, and\nthis periodic change of air pressure then leaves the singers mouth and\ntravels, at the speed of sound.\nA stone plunging into a lake causes a disturbance, which then travels\nacross the lake as a wave. 2 PHYSICS\nA wave has a certain speed, frequency, and wavelength.\nThese are connected by a simple relation:\nSpeed = Frequency * Wavelength\nThe wavelength (sometimes referred to as lambda, \u03bb) is the distance\nmeasured from a point on one wave to the equivalent part of the next (or,\nin a more technical way, to the next point that is in the same phase), for\nexample from the top of one peak to the next.\nThe frequency is the number of whole waves that pass a fixed point in a\nperiod of time. Speed is measured in metres\/second, frequency is measured\nin cycles per second (or Hertz, represented by the symbol Hz), and\nwavelength is measured in metres. For example, if a wave on water travels\nat one metre per second, and it oscillates five times per second, then each\nwave will be twenty centimetres long:\n1 metre\/second = 5 cycles\/second *W\nW = 1 \/ 5 metres\nW = 0.2 metres = 20 cm\nWaves also have a property called amplitude. This is the distance from\nthe centre of the wave to the extreme of one of its peaks, and can be\nthought of as the \u201cheight\u201d of a water wave. Frequency, wavelength, and\namplitude are shown in Figure RP 1.\nFigure RP 1: Wavelength, amplitude, and frequency. For this wave, the\nfrequency is 2 cycles per second, or 2 Hz, while the speed is 1 m\/s. 1. RADIO PHYSICS 3\nWaves in water are easy to visualize.\nSimply drop a stone into the lake and you can see the waves as they move\nacross the water over time. In the case of electromagnetic waves, the part\nthat might be hardest to understand is: \u201cWhat is it that is oscillating?\u201d\nIn order to understand that, you need to understand electromagnetic\nforces.\nElectromagnetic forces\nElectromagnetic forces are the forces between electrical charges and\ncurrents. Our most direct access to those is when our hand touches a door\nhandle after walking on synthetic carpet, or brushing up against an\nelectrical fence.\nA more powerful example of electromagnetic forces is the lightning we see\nduring thunderstorms.\nThe electrical force is the force between electrical charges.\nThe magnetic force is the force between electrical currents.\nElectrons are particles that carry a negative electrical charge. There are\nother charged particles too, but it is the electrons that are responsible for\nmost of what we need to know about how radio behaves.\nLet us look at what is happening in a piece of straight vertical wire, in\nwhich we push the electrons from one end to the other and back,\nperiodically. At one moment, the top of the wire is negatively charged - all\nthe negative electrons are gathered there. This creates an electric field from\nthe positively charged end to the negatively charged one along the wire.\nThe next moment, the electrons have all been driven to the other side, and\nthe electric field points the other way. As this happens again and again,\nthe electric field vectors (represented by arrows from plus to minus) are\nleaving the wire, so to speak, and are radiated out into the space around\nthe wire.\nWhat we have just described is known as a dipole (because of the two\ndifferently charged poles, plus and minus, that are created in the straight\nvertical wire), or more commonly a dipole antenna.\nThis is the simplest form of an omnidirectional antenna. The moving\nelectric field is commonly referred to as an electromagnetic wave because\nthere is also an associated magnetic field. A moving electric field, such as a\nwave, always comes together with a magnetic field - you will not find one\nwith out the other. Why is this the case?\nAn electric field is caused by electrically charged objects. 4 PHYSICS\nA moving electric field is produced by moving electrically charged objects,\nsuch as we have just described above in a dipole antenna.\nWherever electrical charges are moving, they induce a magnetic field.\nMathematically, this is formulated in Maxwell's equations:\nhttps:\/\/en.wikipedia.org\/wiki\/Electromagnetic_field#Mathematical_description\nSince the electrical and magnetic components are tied together in this\nway, we speak of an electromagnetic field.\nIn practical wireless networking, we focus in the electrical component but\nthere be always a magnetic component as well.\nLet us come back to the relation:\nSpeed = Frequency * Wavelength\nIn the case of electromagnetic waves, the speed is c, the speed of light.\nc = 300,000 km\/s = 300,000,000 m\/s = 3*108 m\/s\nc = f * \u03bb\nElectromagnetic waves differ from mechanical waves in that they require\nno medium in which to propagate. Electromagnetic waves will even\npropagate through perfect vacuum.\nThe light from the stars is a good example: it reaches us through the\nvacuum of space.\nSymbols of the international system of units\nIn physics, maths, and engineering, we often express numbers by powers\nof ten.\nWe will meet these terms again, and the symbols used to represent them,\ne.g. gigahertz (GHz), centimetres (cm), microseconds (\u00b5s), and so on.\nThese symbols are part of the international system of measurement SI\n(http:\/\/www.bipm.org\/utils\/common\/pdf\/si_brochure_8_en.pdf), they are\nnot abbreviations and should not be changed.\nThe case is significant and should not be altered. 1. RADIO PHYSICS 5\nSI symbols\natto 10\u221218 1\/1000000000000000000 a\nfemto 10\u221215 1\/1000000000000000 f\npico 10\u221212 1\/1000000000000 p\nnano 10\u22129 1\/1000000000 n\nmicro 10\u22126 1\/1000000 \u00b5\nmilli 10\u22123 1\/1000 m\ncenti 10\u22122 1\/100 c\nkilo 103 1000 k\nmega 106 1000000 M\ngiga 109 1000000000 G\ntera 1012 1000000000000 T\npeta 1015 1000000000000000 P\nexa 1018 1000000000000000000 E\nKnowing the speed of light, we can calculate the wavelength for a given\nfrequency. Let us take the example of the frequency of 802.11b wireless\nnetworking, which is:\nf = 2.4 GHz = 2,400,000,000 cycles \/ second\nwavelength (\u03bb) = c \/ f = 3*108 \/ 2.4*109 = 1.25*10-1 m = 12.5 cm\nFrequency and therefore wavelength determine most of an electromagnetic\nwave\u2019s behaviour. It governs the dimensions of the antennas that we build\nas well as the effect of the interactions with objects that are in the\npropagation path, including the biological effects in living beings.\nWireless standards of course are distinguished by more than just the\nfrequency they are working at - for example, 802.11b, 802.11g, 802.11n\nand 802.16 can all work at 2.4 GHz -, yet they are very different from\none another. 6 PHYSICS\nThe chapter called Telecommunications Basics will discuss modulation\ntechniques, media access techniques, and other relevant features of wireless\ncommunications standards. However, the basic capabilities of\nelectromagnetic waves to penetrate objects, to go long distances, and so\nforth - these are determined by physics alone. The electromagnetic wave\n\"does not know or care\" what modulation or standard or technique you\nput on top of it. So, while different standards may implement advanced\ntechniques to deal with NLOS (Non Line of Sight), multipath and so\nforth - they still cannot make a wave go through a wall, if that wall is\nabsorbing the respective frequency. Therefore, an understanding of the basic\nideas of frequency and wavelength helps a lot in practical wireless work.\nPhase\nLater in this chapter, we will talk about concepts like interference,\nmultipath and Fresnel zones. In order to understand these, we will need to\nknow about the phase of a wave, or rather, phase differences between waves.\nLook at the sine wave shown in Fig RP 1 - now imagine we have two such\nwaves moving. These can be in exactly the same position: Where the one\nhas its peak, the other one also has a peak. Then, we would say, they are\nin phase, or, their phase difference is zero. But one wave could also be\ndisplaced from the other, for example it could have its peak where the\nother wave is at zero. In this case, we have a phase difference. This phase\ndifference can be expressed in fractions of the wavelength, e.g. \u03bb\/\/4, or in\ndegrees, e.g. 90 degrees - with one full cycle of the wave being 360\ndegrees. A phase difference of 360 degrees is the same as that of 0 degrees:\nno phase difference.\nFigure RP 2: Phase Difference between Two Waves 1. RADIO PHYSICS 7\nPolarization\nAnother important quality of electromagnetic waves is polarization.\nPolarization describes the direction of the electrical field vector.\nIf you imagine a vertically aligned dipole antenna (the straight piece of\nwire), electrons can only move up and down, not sideways (because there\nis no room to move) and thus electrical fields only ever point up or down,\nvertically. The field leaving the wire and travelling as a wave has a strict\nlinear (and in this case, vertical) polarization. If we put the antenna flat on\nthe ground, we would find horizontal linear polarization.\nLinear polarization is just one special case, and is never quite so perfect: in\ngeneral, we will always have some component of the field pointing in\nother directions too. If we combine two equal dipoles fed with the same\nsignal, we can generate a circularly polarized wave, in which the electric\nfield vector keeps rotating perpendicularly to the wave's trajectory. 8 PHYSICS\nThe most general case is elliptical polarization, in which the electric field\nvector maximum value is not the same in the vertical and horizontal\ndirection. As one can imagine, polarization becomes important when\naligning antennas. If you ignore polarization, you might have very little\nsignal even though you have the best antennas. We call this polarization\nmismatch.\nMuch in the same way, polarization may also be used in a smart way, to\nkeep two wireless links independent and without interference, even\nthough they might use the same end points (or even share a common\nreflector) and therefore the same trajectory: if one link is polarized\nvertically and the other horizontally, they will not \"see\" each other. This is\na convenient way to double data rates over one link using a single\nfrequency.\nThe antennas used in this kind of application must be carefully built in\norder to reject the \"unwanted\" polarization, i.e. an antenna meant for\nvertical polarization must not receive or transmit any horizontally\npolarized signal, and vice versa. We say they must have a high \"cross\npolarization\" rejection.\nThe electromagnetic spectrum\nElectromagnetic waves span a wide range of frequencies (and, accordingly,\nwavelengths). This range of frequencies or wavelengths is called the\nelectromagnetic spectrum. The part of the spectrum most familiar to\nhumans is probably light, the visible portion of the electromagnetic\nspectrum. Light lies roughly between the frequencies of 7.5*1014 Hz and\n3.8*1014 Hz, corresponding to wavelengths from circa 400 nm\n(violet\/blue) to 800 nm (red).\nWe are also regularly exposed to other regions of the electromagnetic\nspectrum, including Alternating Current (AC) or grid electricity at 50\/60\nHz, AM and FM radio, Ultraviolet (at frequencies higher than those of\nvisible light), Infrared (at frequencies lower than those of visible light),\nX-Ray radiation, and many others.\nRadio is the term used for the portion of the electromagnetic spectrum in\nwhich waves can be transmitted by applying alternating current to an\nantenna. This is true for the range from 30 kHz to 300 GHz, but in the\nmore narrow sense of the term, the upper frequency limit would be about\n1 GHz, above which we talk of microwaves and millimetric waves. 1. RADIO PHYSICS 9\nWhen talking about radio, many people think of FM radio, which uses a\nfrequency around 100 MHz. In between radio and infrared we find the\nregion of microwaves - with frequencies from about 1 GHz to 300 GHz,\nand wavelengths from 30 cm to 1 mm.\nThe most popular use of microwaves might be the microwave oven, which\nin fact works in exactly the same region as the wireless standards we are\ndealing with. These regions lie within the bands that are being kept open\nfor general unlicensed use. This region is called the ISM band, which\nstands for Industrial, Scientific, and Medical.\nMost other parts of the electromagnetic spectrum are tightly controlled by\nlicensing legislation, with license values being a huge economic factor. In\nmany countries the right to use portions of the spectrum have been sold\nto communications companies for millions of dollars. In most countries,\nthe ISM bands have been reserved for unlicensed use and therefore do not\nhave to be paid for when used.\nFigure RP 4: The electromagnetic spectrum.\nThe frequencies most interesting to us are 2.400 - 2.495 GHz, which is\nused by the 802.11b and 802.11g standards (corresponding to wavelengths\nof about 12.5 cm), and 5.150 - 5.850 GHz (corresponding to wavelengths\nof about 5 to 6 cm), used by 802.11a. The 802.11n standard can work in\neither of these bands.\nSee the Chapter called WiFi Family for an overview of standards and\nfrequencies. In addition you can find out more about the Radio portion of\nthe electromagnetic spectrum in the Chapter called Radio Spectrum. 10 PHYSICS\nBandwidth\nA term you will meet often in radio physics is bandwidth. Bandwidth is\nsimply a measure of frequency range. If a range of 2.40 GHz to 2.48 GHz\nis used by a device, then the bandwidth would be 0.08 GHz (or more\ncommonly stated as 80 MHz).\nIt is easy to see that the bandwidth we define here is closely related to the\namount of data you can transmit within it - the more room in frequency\nspace, the more data you can fit in at a given moment. The term\nbandwidth is often used for something we should rather call data rate, as\nin \u201cmy Internet connection has 1 Mbps of bandwidth\u201d, meaning it can\ntransmit data at 1 megabit per second. How much exactly you can fit into\na physical signal will depend on the modulation, encoding and other\ntechniques. For example, 802.11g uses the same bandwidth as 802.11b,\nhowever it fits more data into those same frequency ranges transmitting up\nto 5 times more bits per second.\nAnother example we have mentioned: you may double your data rate by\nadding a second link at perpendicular polarization to an existing\nradio link. Here, frequency and bandwidth have not changed, however the\ndata rate is doubled.\nFrequencies and channels\nLet us look a bit closer at how the 2.4 GHz band is used in 802.11b. The\nspectrum is divided into evenly sized pieces distributed over the band as\nindividual channels. Note that channels are 22 MHz wide, but are only\nseparated by 5 MHz.\nThis means that adjacent channels overlap, and can interfere with each\nother. This is represented visually in Figure RP 5.\nFigure RP 5: Channels and centre frequencies for 802.11b.\nNote that channels 1, 6, and 11 do not overlap. 1. RADIO PHYSICS 11\nBehaviour of radio waves\nThere are a few simple rules of thumb that can prove extremely useful\nwhen making first plans for a wireless network:\n\u2022 the longer the wavelength, the further it goes;\n\u2022 the longer the wavelength, the better it travels through and around things;\n\u2022 the shorter the wavelength, the more data it can transport.\nAll of these rules, simplified as they may be, are rather easy to understand\nby example.\nLonger waves travel further\nWaves with longer wavelengths tend to travel further than waves with\nshorter wavelengths. As an example, AM radio stations have a much\ngreater range than FM stations, which use a frequency 100 times higher.\nLower frequency transmitters tend to reach much greater distances than\nhigh frequency transmitters at the same power.\nLonger waves pass around obstacles\nA wave on water which is 5 metres long will not be affected by a 5 mm\npiece of wood floating on the water. If instead the piece of wood were 50\nmetres big (e.g. a ship), it would modify the behavior of the wave.\nThe distance a wave can travel depends on the relationship between the\nwavelength of the wave and the size of obstacles in its path of\npropagation. It is harder to visualize waves moving \u201cthrough\u201d solid objects,\nbut this is the case with electromagnetic waves. Longer wavelength (and\ntherefore lower frequency) waves tend to penetrate objects better than\nshorter wavelength (and therefore higher frequency) waves.\nFor example, FM radio (88-108 MHz) can travel through buildings and\nother obstacles easily, while shorter waves (such as GSM phones operating\nat 900 MHz or 1800 MHz) have a harder time penetrating buildings.\nThis effect is partly due to the difference in power levels used for FM\nradio and GSM, but is also partly due to the shorter wavelength of GSM\nsignals. At much higher frequencies, visible light does not go through a\nwall or even 1 mm of wood - as we all know, from practical experience.\nBut metal will stop any kind of electromagnetic wave. 12 PHYSICS\nShorter waves can carry more data\nThe faster the wave swings or beats, the more information it can carry - every\nbeat or cycle could for example be used to transport a digital bit, a '0' or a\n'1', a 'yes' or a 'no'.\nSo the data rate scales with bandwidth, and can be further enhanced by\nadvanced modulation and media access techniques such as OFDM, and\nMIMO (Multiple Input, Multiple Output).\nThe Huygens Principle\nThere is another principle that can be applied to all kinds of waves, and\nwhich is extremely useful for understanding radio wave propagation.\nThis principle is known as the Huygens Principle, named after Christiaan\nHuygens, Dutch mathematician, physicist and astronomer, 1629 - 1695.\nImagine you are taking a little stick and dipping it vertically into a still\nlake's surface, causing the water to swing and dance. Waves will leave the\ncentre of the stick - the place where you dip in - in circles. Now, wherever\nwater particles are swinging and dancing, they will cause their neighbor\nparticles to do the same: from every point of disturbance, a new circular\nwave will start. This is, in simple form, the Huygens principle. In the\nwords of wikipedia.org:\n\u201cThe Huygens' principle is a method of analysis applied to problems of wave\npropagation in the far field limit. It recognizes that each point of an\nadvancing wave front is in fact the centre of a fresh disturbance and the source\nof a new train of waves; and that the advancing wave as a whole may be\nregarded as the sum of all the secondary waves arising from points in the\nmedium already traversed\u201d.\nThis view of wave propagation helps better understand a variety of wave\nphenomena, such as diffraction.\u201d This principle holds true for radio waves\nas well as waves on water, for sound as well as light, but for light the\nwavelength is far too short for human beings to actually see the effects\ndirectly.\nThis principle will help us to understand diffraction as well as Fresnel\nzones, and the fact that sometimes we seem to be able to transmit around\ncorners, with no line of sight.\nLet us now look into what happens to electromagnetic waves as they\ntravel. 1. RADIO PHYSICS 13\nAbsorption\nWhen electromagnetic waves go through 'something' (some material),\nthey generally get weakened or dampened.\nHow much they lose in power will depend on their frequency and of\ncourse the material.\nClear window glass is obviously transparent for light, while the glass used\nin sunglasses filters out quite a share of the light intensity and most of the\nultraviolet radiation.\nOften, an absorption coefficient is used to describe a material\u2019s impact on\nradiation.\nFor microwaves, the two main absorbent materials are:\nMetal. Electrons can move freely in metals, and are readily able to swing\nand thus absorb the energy of a passing wave.\nWater. Microwaves cause water molecules to jostle around, thus taking\naway some of the wave\u2019s energy.\nFor the purpose of practical wireless networking, we may well consider\nmetal and water perfect absorbers: we will not be able to go through them\n(although thin layers of water will let some power pass). They are to\nmicrowave what a brick wall is to light.\nWhen talking about water, we have to remember that it comes in different\nforms: rain, fog and mist, low clouds and so forth, all will be in the way of\nradio links. They have a strong influence, and in many circumstances a\nchange in weather can bring a radio link down.\nWhen talking about metal, keep in mind that it may be found in\nunexpected places: it may be hidden in walls (for example, as metal grids\nin concrete) or be a thin coat on modern types of glass (tinted glass,\ncolored glass).\nHowever thin the layer of metal, it might be enough to significantly\nabsorb a radio wave.\nThere are other materials that have a more complex effect on radio\nabsorption. For trees and wood, the amount of absorption depends on\nhow much water they contain. 14 PHYSICS\nOld dead dry wood is more or less transparent, wet fresh wood will absorb\na lot. Plastics and similar materials generally do not absorb a lot of radio\nenergy, but this varies depending on the frequency and type of material.\nLastly, let us talk about ourselves: humans (as well as other animals) are\nlargely made out of water.\nAs far as radio networking is concerned, we may well be described as big\nbags of water, with the same strong absorption.\nOrienting an office access point in such a way that its signal must pass\nthrough many people is a key mistake when building office networks.\nThe same goes for hotspots, cafe installations, libraries, and outdoor\ninstallations.\nReflection\nJust like visible light, radio waves are reflected when they come in contact\nwith materials that are suited for that: for radio waves, the main sources of\nreflection are metal and water surfaces.\nThe rules for reflection are quite simple: the angle at which a wave hits a\nsurface is the same angle at which it gets deflected.\nNote that in the eyes of a radio wave, a dense grid of bars acts just the\nsame as a solid surface, as long as the distance between bars is small\ncompared to the wavelength.\nAt 2.4 GHz, a one cm metal grid will act much the same as a metal plate.\nAlthough the rules of reflection are quite simple, things can become very\ncomplicated when you imagine an office interior with many many small\nmetal objects of various complicated shapes.\nThe same goes for urban situations: look around you in city environment\nand try to spot all of the metal objects.\nThis explains why multipath effects (i.e. signal reaching their target along\ndifferent paths, and therefore at different times) play such an important\nrole in wireless networking.\nWater surfaces, with waves and ripples changing all the time, effectively\nmake for a very complicated reflection object which is more or less\nimpossible to calculate and predict precisely. 1. RADIO PHYSICS 15\nFigure RP 6: Reflection of radio waves. The angle of incidence is always equal to\nthe angle of reflection. A metal parabolic surface uses this effect to concentrate\nradio waves spread out over it in a common direction.\nWe should also add that polarization has an impact: waves of different\npolarization in general will be reflected differently.\nWe use reflection to our advantage in antenna building: e.g. we put huge\nparabolas behind our radio transmitter\/receiver to collect and bundle the\nradio signal into a single point, the focal point.\nDiffraction\nDiffraction is the apparent bending of waves when hitting an object.\nIt is the effect of \u201cwaves going around corners\u201d. Imagine a wave on water\ntraveling in a straight wave front, just like a wave that we see rolling onto\nan ocean beach.\nNow we put a solid barrier, say a wooden solid fence, in its way to block\nit. We cut a narrow slit opening into that wall, like a small door.\nFrom this opening, a circular wave will start, and it will of course reach\npoints that are not in a direct line behind this opening, but also on either\nside of it. If you look at this wavefront - and it might just as well be an\nelectromagnetic wave - as a beam (a straight line), it would be hard to\nexplain how it can reach points that should be hidden by a barrier.\nWhen modelled as a wavefront, the phenomenon makes sense. 16 PHYSICS\nFigure RP 7: Diffraction through a narrow slit.\nThe Huygens Principle provides one model for understanding this behavior.\nImagine that at any given instant, every point on a wavefront can be\nconsidered the starting point for a spherical \u201cwavelet\u201d.\nThis idea was later extended by Fresnel, and whether it adequately\ndescribes the phenomenon is still a matter of debate. But for our purposes,\nthe Huygens model describes the effect quite well.\nFigure RP 8: The Huygens Principle.\nThrough means of the effect of diffraction, waves will \u201cbend\u201d around\ncorners or spread through an opening in a barrier. 1. RADIO PHYSICS 17\nThe wavelengths of visible light are far too small for humans to observe\nthis effect directly.\nMicrowaves, with a wavelength of several centimeters, will show the\neffects of diffraction when waves hit walls, mountain peaks, and other\nobstacles. It seems as if the obstruction causes the wave to change its\ndirection and go around corners.\nFigure RP 9: Diffraction over a mountain top.\nNote that diffraction comes at the cost of power: the energy of the\ndiffracted wave is significantly less than that of the wavefront that caused\nit. But in some very specific applications, you can take advantage of the\ndiffraction effect to circumvent obstacles.\nInterference\nInterference is one of the most misunderstood terms and phenonema in\nwireless networking.\nInterference often gets the blame when we are too lazy to find the real\nproblem, or when a regulator wants to shut down someone else's network\nfor business reasons. So, why all the misunderstandings?\nIt is mostly because different people mean different things though they are\nusing the same word.\nA physicist and a telecommunications engineer will use the word\n\"Interference\" in very different ways. The physicists' view will be\nconcerned with the \"behaviour of waves\". The telecommunications\nengineer will talk about \u201c... any noise that gets in the way\u201d. 18 PHYSICS\nBoth views are relevant in wireless, and it is important to be able to know\nthem both and know the difference. Let us start with the physicists' view:\nWhen working with waves, one plus one does not necessarily equal two. It\ncan also result in zero.\nFigure RP 10: Constructive and destructive interference.\nThis is easy to understand when you draw two sine waves and add up the\namplitudes. When the phase difference is zero, peak hits peak, and you\nwill have maximum results (1 + 1 = 2).\nThis is called constructive interference.\nWhen the phase difference is 180 degrees, or \u03bb\/2, peak hits valley, and\nyou will have complete annihilation ((1 + (-)1 = 0) - destructive\ninterference.\nYou can actually try this with waves on water and two little sticks to create\ncircular waves - you will see that where two waves cross, there will be areas\nof higher wave peaks and others that remain almost flat and calm. In\norder for whole trains of waves to add up or cancel each other out\nperfectly, they have to have the exact same wavelength and a fixed phase\nrelation.\nYou can see obvious examples of interference in action when you look at\nthe way that antennas are arranged in what are called beamforming arrays,\nin order to give maximum constructive interference in the directions\nwhere you want the signal, and destructive interference (no signal) where\nyou want no signal.\nTechnically, this is achieved by a combination of physical dimensioning\nand control of phase shifts. 1. RADIO PHYSICS 19\nSimplified, imagine that you have three antennas - and you don't want\nantenna 3 to pick up signal from antenna 1 and 2. You would then place\nantenna 3 at a position where the signals from antennas 1 and 2 cancel\neach other out.\nNow let us have a look at the way the word interference is typically used:\nin a wider sense, for any disturbance through other RF sources, any noise\nthat might get in our way, e.g. from neighboring channels or competing\nproviders. So, when wireless networkers talk about interference they\ntypically talk about all these kinds of disturbance by other networks, and\nany other sources of microwave, whether it has exactly the same frequency\nand a fixed phase relation or not. Interference of this kind is one of the\nmain sources of difficulty in building wireless links, especially in urban\nenvironments or closed spaces (such as a conference space) where many\nnetworks may compete for use of the spectrum.\nBut, interference of this kind is also often overrated: for example, imagine\nyou had to build a point to point link that has to cross a crowded inner city\narea, before reaching its target on the other side of the city. Such a highly\ndirectional beam will cross the \"electric smog\" of the urban centre without\nany problem. You may imagine this like a green and a red light beam crossing\neach other in a 90 degrees angle: while both beams will overlap in a certain\narea, the one will not have any impact on the other at all.\nGenerally, managing spectrum and coexistence has become a main issue\nespecially in dense indoor environments and urban areas.\nLine of sight\nThe term line of sight, often abbreviated as LOS, is quite easy to\nunderstand when talking about visible light: if we can see a point B from\npoint A where we are, we have line of sight. Simply draw a line from A to\nB, and if nothing is in the way, we have line of sight.\nThings get a bit more complicated when we are dealing with microwaves.\nRemember that most propagation characteristics of electromagnetic waves\nscale with their wavelength.\nThis is also the case for the widening of waves as they travel.\nLight has a wavelength of about 0.5 micrometres, microwaves as used in\nwireless networking have a wavelength of a few centimetres.\nConsequently, their beams are a lot wider - they need more space, so to\nspeak. 20 PHYSICS\nNote that visible light beams widen just the same, and if you let them\ntravel long enough, you can see the results despite their short wavelength.\nWhen pointing a well focussed laser at the moon, its beam will widen to\nwell over 100 metres in radius by the time it reaches the surface. You can\nsee this effect for yourself using an inexpensive laser pointer and a pair of\nbinoculars on a clear night. Rather than pointing at the moon, point at a\ndistant mountain or unoccupied structure (such as a water tower). The\nradius of your beam will increase as the distance increases. This is due to\nthe diffraction.\nThe line of sight that we need in order to have an optimal wireless\nconnection from A to B is more than just a thin line - its shape is more\nlike that of a cigar, an ellipsoid. Its width can be described by the concept\nof Fresnel zones - see next section for an explanation. You will also find\nthe abbreviation NLOS, for \"non line of sight\", which is mostly used to\ndescribe and advertise technologies that allow for dealing with waves that\nreach the receiver through multiple trajectories (multipath) or diffraction.\nIt does not indicate that the single electromagnetic beam goes \"around\ncorners\" (other than through diffraction) or \"through obstacles\" any better\nthan that of other technologies. For example, you might call White Space\ntechnology NLOS, as its lower frequencies (longer wavelengths) allow it to\npermeate objects and utilize diffraction much better than comparable 2.4\nGHz or 5 GHz transmissions.\nUnderstanding the Fresnel zone\nThe exact theory of Fresnel (pronounced \u201cFray-nell\u201d) zones is quite\ncomplicated. However, the concept is quite easy to understand: we know\nfrom the Huygens principle that at each point of a wavefront new circular\nwaves start, we know that microwave beams widen as they leave the\nantenna, we know that waves of one frequency can interfere with each\nother. Fresnel zone theory simply looks at a line from A to B, and then at\nthe space around that line that contributes to what is arriving at point B.\nSome waves travel directly from A to B, while others travel on paths off axis\nand reach the receiver by reflection.\nConsequently, their path is longer, introducing a phase shift between the\ndirect and indirect beam.\nWhenever the phase shift is one half wavelength, you get destructive\ninterference: the signals cancel. 1. RADIO PHYSICS 21\nTaking this approach you find that when the reflected path is less than half\na wavelength longer than the direct path, the reflections will add to the\nreceived signal. Conversely, when the reflected path length exceeds the\ndirect path by more than one half wavelength, its contribution will\ndecrease the received power.\nFigure RP 11: The Fresnel zone is partially blocked on this link, although the\nvisual line of sight appears clear.\nNote that there are many possible Fresnel zones, but we are chiefly\nconcerned with the first zone, because the contributions from the second\nzone are negative. The contributions from the third zone are positive\nagain, but there is no practical way to take advantage of those without the\npenalty incurred in going through the second Fresnel Zone.\nIf the first Fresnel zone is partially blocked by an obstruction, e.g. a tree or\na building, the signal arriving at the far end would be diminished. When\nbuilding wireless links, we therefore need to be sure that the first zone is\nkept free of obstructions. In practice, it is not strictly necessary that the\nwhole of this zone is clear, in wireless networking we aim to clear about\n60 percent of the radius of the first Fresnel zone.\nHere is one formula for calculating the radius of the first Fresnel zone:\n\u221a (d \u2217d )\nr=17.31 ( 1 2 )\n( f\u2217d)\n...where r is the radius of the zone in metres, d and d are distances from\n1 2\nthe obstacle to the link end points in metres, d is the total link distance in\nmetres, and f is the frequency in MHz. 22 PHYSICS\nThe first Fresnel zone radius can also be calculated directly from the\nwavelength as:\n\u221a \u03bb\u2217d \u2217d\nr= ( 1 2 )\nd\nwith all the variables in metres\nIt is apparent that the maximum value of the first Fresnel zone happens\nexactly in the middle of the trajectory and its value can be found setting\nd =d =d\/2 in the preceding formulas.Note that the formulae give you the\n1 2\nradius of the zone, not the height above ground.\nTo calculate the height above ground, you need to subtract the result from\na line drawn directly between the tops of the two towers.\nFor example, let\u2019s calculate the size of the first Fresnel zone in the middle\nof a 2 km link, transmitting at 2.437 GHz (802.11b channel 6):\n\u221a (1000\u22171000)\nr=17.31 [ ]\n(2437\u22172000)\n\u221a 1000000\nr=17.31 ( )\n4874000\nr = 7.84 metres\nAssuming both of our towers were ten metres tall, the first Fresnel zone\nwould pass just 2.16 metres above ground level in the middle of the link.\nBut how tall could a structure at that point be to block no more than 60% of\nthe first zone?\nr = 0.6 * 7.84 metres\nr = 4.70 metres\nSubtracting the result from 10 metres, we can see that a structure 5.3\nmetres tall at the centre of the link would block up to 40% of the first\nFresnel zone.\nThis is normally acceptable, but to improve the situation we would need\nto position our antennas higher up, or change the direction of the link to\navoid the obstacle. 1. RADIO PHYSICS 23\nPower\nAny electromagnetic wave carries energy - we can feel that when we enjoy\n(or suffer from) the warmth of the sun.\nThe amount of energy divided by the time during which we measure it is\ncalled power. The power P is measured in W (watts) and is of key\nimportance for a wireless links to work: you need a certain minimum\npower in order for a receiver to make sense of the signal.\nWe will come back to details of transmission power, losses, gains and\nradio sensitivity in the chapter called Antennas\/Transmission Lines.\nHere we will briefly discuss how the power P is defined and measured.\nThe electric field is measured in V\/m (potential difference per metre), the\npower contained within it is proportional to the square of the electric field:\nP ~ E2\nPractically, we measure the power in watts by means of some form of\nreceiver, e.g. an antenna and a voltmetre, power metre, oscilloscope,\nspectrum analyser or even a radio card and laptop.\nLooking at the signal\u2019s power directly means looking at the square of the\nsignal in volts and dividing by the electrical resistance.\nCalculating with dB\nBy far the most important technique when calculating power is calculating\nwith decibels (dB). There is no new physics hidden in this - it is just a\nconvenient method which makes calculations a lot simpler.\nThe decibel is a dimensionless unit, that is, it defines a relationship\nbetween two measurements of power. It is defined by:\ndB = 10 * Log (P \/ P )\n1 0\nwhere P and P can be whatever two values you want to compare.\n1 0\nTypically, in our case, this will be some amount of power.\nWhy are decibels so handy to use? Many phenomena in nature happen to\nbehave in a way we call exponential. 24 PHYSICS\nFor example, the human ear senses a sound to be twice as loud as another\none if it has ten times the physical signal power.\nAnother example, quite close to our field of interest, is absorption.\nSuppose a wall is in the path of our wireless link, and each metre of wall\ntakes away half of the available signal. The result would be:\n0 metres = 1 (full signal)\n1 metre = 1\/2\n2 metres = 1\/4\n3 metres = 1\/8\n4 metres = 1\/16\nn metres = 1\/2n = 2-n\nThis is exponential behaviour.\nBut once we have used the trick of applying the logarithm (log), things\nbecome a lot easier: instead of taking a value to the n-th power, we just\nmultiply by n. Instead of multiplying values, we just add.\nHere are some commonly used values that are important to remember:\n+3 dB = double power\n-3 dB = half the power\n+10 dB = order of magnitude (10 times power)\n-10 dB = one tenth power\nIn addition to dimensionless dB, there are a number of definitions that are\nbased on a certain base value P . The most relevant ones for us are:\n0\ndBm relative to P = 1 mW\n0\ndBi relative to an ideal isotropic antenna\nAn isotropic antenna is a hypothetical antenna that evenly distributes\npower in all directions.\nIt is approximated by a dipole, but a perfect isotropic antenna cannot be\nbuilt in reality. The isotropic model is useful for describing the relative\npower gain of a real world antenna. 1. RADIO PHYSICS 25\nAnother common (although less convenient) convention for expressing\npower is in milliwatts. Here are equivalent power levels expressed in\nmilliwatts and dBm:\n1 mW = 0 dBm\n2 mW = 3 dBm\n100 mW = 20 dBm\n1 W = 30 dBm\nFor more details on dB refer to the dB math lecture of the Wireless\nTraining kit:\nhttp:\/\/wtkit.org\/sandbox\/groups\/wtkit\/wiki\/820cb\/attachments\/ebdac\/02\n-dB_Math-v1.12_with-notes.pdf\nPhysics in the real world\nDon\u2019t worry if the concepts in this chapter seem challenging.\nUnderstanding how radio waves propagate and interact with the\nenvironment is a complex field of study in itself.\nMost people find it difficult to understand phenomenon that they can\u2019t\neven see with their own eyes.\nBy now you should understand that radio waves don\u2019t travel only in a\nstraight, predictable path.\nTo make reliable communication networks, you will need to be able to\ncalculate how much power is needed to cross a given distance, and predict\nhow the waves will travel along the way. 26 PHYSICS\n2. TELECOMMUNICATIONS BASICS\nThe purpose of any telecommunications system is to transfer information\nfrom the sender to the receiver by a means of a communication channel.\nThe information is carried by a signal, which is certain physical quantity\nthat changes with time.\nThe signal can be a voltage proportional to the amplitude of the voice,\nlike in a simple telephone, a sequence of pulses of light in an optical fibre,\nor a radio-electric wave irradiated by an antenna.\nFor analog signals, these variations are directly proportional to some\nphysical variable like sound, light, temperature, wind speed, etc. The\ninformation can also be transmitted by digital binary signals, that will have\nonly two values, a digital one and a digital zero. Any analog signal can be\nconverted into a digital signal by appropriately sampling and then coding\nit. The sampling frequency must be at least twice the maximum frequency\npresent in the signal in order to carry all the information contained\ntherein. Random signals are the ones that are unpredictable and can be\ndescribed only by statistical means.\nNoise is a typical random signal, described by its mean power and\nfrequency distribution. A signal can be characterised by its behaviour over\ntime or by its frequency components, which constitute its spectrum. Some\nexamples of signals are shown in Figure TB 1.\nFigure TB 1: Examples of signals\nAny periodic signal is composed of many sinusoidal components, all of them\nmultiples of the fundamental frequency, which is the inverse of the period of\nthe signal. So a signal can be characterised either by a graph of its amplitude\nover time, called a waveform, or a graph of of the amplitudes of its frequency\ncomponents, called a spectrum. 2. TELECOMMUNICATIONS BASICS 27\nFigure TB 2: Waveforms, Spectrum and filters\nFigure TB 2 shows how the same signal can be seen from two different\nperspectives. The waveform can be displayed by an instrument called an\noscilloscope, while the spectrum can be displayed by what is called a\nSpectrum Analyzer. The spectrum distribution relays very important\ninformation about the signal and allows for the intuitive understanding of\nthe concept of filtering of electrical signals. In the example shown, the\nsignal is formed by the superposition of three sinusoidal components of\nfrequency f , f and f . If we pass this signal through a device that will\n1 2 3\nremove f and f , the output is a pure sinusoidal at frequency f .\n2 3 1\nWe call this operation \u201cLow Pass filtering\u201d because it removes the\nhigher frequencies. Conversely, we can apply the signal to a \u201cHigh\nPass Filter\u201d, a device that will remove f and f leaving only a\n1 2\nsinusoidal signal at the f frequency. Other combinations are\n3\npossible, giving rise to a variety of filters. No physical device can\ntransmit all the infinite frequencies of the radio-electric spectrum,\nso every device will always perform some extent of filtering to the\nsignal that goes through it. The bandwidth of a signal is the\ndifference between the highest and the lowest frequency that it\ncontains and is expressed in Hz (number of cycles per second).\nWhile travelling through the communication channel, the signal is subject\nto interference caused by other signals and is also affected by the electrical\nnoise always present in any electrical or optical component. Intra-channel\ninterference originates in the same channel as our signal. Co-channel\ninterference is due to the imperfection of the filters that will let in signals\nfrom adjacent channels. 28 PHYSICS\nConsequently, the received signal will always be a distorted replica of the\ntransmitted signal, from which the original information must be retrieved\nby appropriate means to combat the effect of interference and noise.\nFurthermore, the received signal will be subject to attenuation and delay\nthat increase with the distance between the transmitter and the receiver.\nFigure TB 3: Attenuation and delay\nAlthough it is relatively simple to restore the amplitude of signal by means\nof an electrical amplifier, the components of the amplifier will add\nadditional noise to the signal, so at very long distances where the received\nsignal is feeble, the amplifier will produce a signal so garbled with noise\nthat the information originally transmitted will no longer be retrievable.\nOne way to address this problem consists in converting the continuous\nquantity carrying the information into a sequence of very simple symbols\nwhich can be easier to recognise even at great distance. For instance, the\nflag of a ship is a convenient way to distinguish the nationality of the ship\neven at distances at which the letters on the hull cannot be read.\nThis technique has been extended to carry generalised messages by\nassigning different position of flags to every letter of the alphabet, in an\nearly form of long distance telecommunications by means of digital or\nnumeric signals. 2. TELECOMMUNICATIONS BASICS 29\nThe limitation of this method is obvious; to be able to distinguish among,\nsay, 26 symbols corresponding to each letters of the alphabet, one must be\nquite close to the communicating ship.\nOn the other hand, if we code each letter of the alphabet in a sequence of\nonly two symbols, these symbols can be distinguished at much longer\ndistance, for example the dot and dashes of the telegraph system.\nThe process of transforming a continuous analog signal into a\ndiscontinuous digital one is called Analog to Digital Conversion (ADC),\nand conversely we must have a Digital to Analog Converter (DAC) at the\nreceiving end to retrieve the original information.\nThis is the reason why most modern telecommunication systems use\ndigital binary signals to convey all sorts of information in a more robust\nway. The receiver must only distinguish between two possible symbols, or\nin other words between two possible values of the received bit (binary\ndigit). For instance, the CD has replaced the vinyl record, and analogue\ntelevision is being replaced by digital television. Digital signals can use less\nbandwidth, as exemplified by the \u201cdigital dividend\u201d currently being\nharnessed in many countries which consists in bandwidth that has become\navailable thanks to the transition from analog to digital transmission in\nTV broadcasting.\nAlthough in the process of converting from an analog to a digital\ninformation system there is always some loss of information, we can\nengineer the system so as to make this loss negligible.\nFigure TB 4: Undersampled Image\nFor example, in a digital camera we can choose the number of bits used to\nrecord the image. 30 PHYSICS\nThe greater the number of bits (proportional to the amount of megapixels),\nthe better the rendering, but more memory will be used and longer time to\ntransmit the image will be needed.\nSo most modern communication systems deal with digital signals, although\nthe original variable that we want to transmit might be analog, like the voice.\nIt can be shown that any analog signal can be reconstructed from discrete\nsamples if the sampling rate is at least twice as high as the highest frequency\ncontent of the signal.\nFigure TB 5: detection of a noisy signal 2. TELECOMMUNICATIONS BASICS 31\nThen each sample is coded in as many bits as necessary to achieve the desired\namount of precision.\nThese bits can now be efficiently stored or transmitted, since for the recovery\nof the information one needs to distinguish among only two states, and not\namong the infinite nuances of an analog signal.\nThis is shown in Figure TB 5, where the original data consists of the 0 1 0\n1 1 1 0 sequence. The 0's are represented as zero volts and the 1's as 1 V.\nAs the signal moves towards the receiver, its amplitude will diminish. This\neffect is called \"attenuation\" and is shown in the figure. Likewise, there\nwill also be a delay as the signal moves from the transmitter to the\nreceiver, the variability in the delay of the received signal is called jitter.\nAttenuation, noise or jitter (or their combination) if severe enough, can\ncause a detection error. An amplifier can be used to overcome the\nattenuation, but the electrical noise always present in the system will add\nto the received signal.\nThe noisy received signal is therefore quite different from the original\nsignal, but in a digital system we can still recover the information\ncontained by sampling the received signal at the correct time and\ncomparing the value at the sampling time with a suitable threshold\nvoltage. In this example the noise received signal has a peak of 1.8 V, so\nwe might choose e threshold voltage of 1.1 V. If the received signal is\nabove the threshold, the detector will output a digital 1, otherwise, it will\noutput a 0. In this case we can see that because of the effect of the noise\nthe fifth bit was erroneously detected as a zero.\nTransmission errors can also occur if the sampling signal period is different\nfrom that of the original data (difference in the clock rates), or if the\nreceiver clock is not stable enough (jitter).\nAny physical system will have an upper limit in the frequencies that will\ntransmit faithfully (the bandwidth of the system), higher frequencies will\nbe blocked, so the abrupt rise and fall of the voltage will be smoothed out\nas the signal goes through the channel.\nTherefore, we must make sure that each of the elements of the system has\nenough bandwidth to handle the signal. On the other hand, the greater\nthe bandwidth of the receiver system, the greater the amount of the noise\nthat will affect the received signal. 32 PHYSICS\nModulation\nThe robustness of the digital signal is also exemplified by the fact that it\nwas chosen for the first trials of radio transmission. Marconi showed the\nfeasibility of long distance transmission, but pretty soon realised that there\nwas a need to share the medium among different users.\nThis was achieved by assigning different carrier frequencies which were\nmodulated by each user\u2019s message. Modulation is a scheme to modify the\namplitude, frequency or phase of the carrier according with the information\none wants to transmit. The original information is retrieved at destination\nby the corresponding demodulation of the received signal.\nFigure TB 6: Sinusoidal Carrier Signal\nFigure TB 6 shows a carrier signal with Amplitude A, phase \u03b8, and\nfrequency f which is the reciprocal of the period T.\no\nThe combination of different modulation schemes has resulted in a\nplethora of modulation techniques depending on which aspect one wants\nto optimise: robustness against noise, amount of information transmitted\nper second (capacity of the link in bits\/second) or spectral efficiency\n(number of bits\/s per Hertz).\nFor instance, BPSK -Binary Phase Shift Keying- is a very robust\nmodulation technique but transmits only one bit per symbol, while 256 2. TELECOMMUNICATIONS BASICS 33\nQAM -Quaternary Amplitude Modulation- will carry 8 bits per symbol,\nthus multiplying by a factor of eight the amount of information\ntransmitted per second, but to correctly distinguish amongst the 256\nsymbols transmitted, the received signal must be very strong as compared\nwith the noise (a very high S\/N -Signal\/Noise ratio- is required).\nThe ultimate measure of quality in digital transmission is the BER -Bit\nError Rate- which corresponds to the fraction of erroneously decoded bits.\nTypical values of BER range between 10-3 and 10-9.\nThe modulation also allows us to choose which range of frequency we\nwant to use for a given transmission. All frequencies are not created equal\nand the choice of the carrier frequency is determined by legal, commercial\nand technical constraints.\nMultiplexing and duplexing\nIn general, the sharing of a channel among different users is called\nmultiplexing.\nThis is shown in Figure TB 7.\nAssigning different carrier frequencies to different users is called FDMA\n-Frequency Division Multiple Access-.\nAn alternative technique consists in assigning different time slots to\ndifferent users, in what is known as TDMA -Time Division Multiple\nAccess-, or even different codes in CDMA -Code Division Multiple 34 PHYSICS\nAccess- where the different users are recognised at the receiver by the\nparticular mathematical code assigned to them. See Figure TB 8.\nBy using two or more antennas simultaneously, one can take advantage of\nthe different amount of fading introduced in the different paths to the\nreceiver establishing a difference among users in what is known as SDMA\n- Space Division Multiple Access-, a technique employed in the MIMO\n-Multiple Input,Multiple Output- systems that have gained popularity\nrecently.\nFigure TB 8: Medium Sharing techniques\nMost communication systems transmit information in both directions, for\ninstance from the Base Station to the subscriber in what is called the\ndownlink, and from the subscriber to the base station in the uplink. 2. TELECOMMUNICATIONS BASICS 35\nTo accomplish this, the channel must be shared between the two\ndirections giving rise respectively to FDD -Frequency Division Duplexing-\nand TDD -Time Division Duplexing-.\nConclusions\nThe communication system must overcome the noise and interference to\ndeliver a suitable replica of the signal to the receiver.\nThe capacity of the communication channel in bits\/second is proportional\nto the bandwidth in Hz and to the logarithm of the S\/N ratio.\nModulation is used to adapt the signal to the channel and to allow several\nsignals to share the same channel. Higher order modulation schemes allow\nfor a higher transmission rate, but require higher S\/N ratio.\nThe channel can be shared by several users that occupy different\nfrequencies, different time slots, different codes or by taking advantage of\ndifferent propagation characteristics in what is called spatial multiplexing.\nFor more information and slides covering this topic please visit\nhttp:\/\/wtkit.org\/groups\/wtkit\/wiki\/820cb\/download_page.html 36 PHYSICS\n3. LICENSING AND REGULATION\nThere are a number of areas where national and international laws and\nregulations can influence your ability to set up wireless networks.\nSince these rules vary from country to country it is impossible to give an\noverview of which regulations may apply in your region.\nIt is also worth noting that there may be a huge difference in which laws\nexist, and how they are regulated in practice. In other words there may be\ncountries where using the 2.4 GHz \/ 5 GHz spectrum for outdoor wireless\nis technically illegal, but where everyone does it anyway.\nAs a rule of thumb, if other people are building similar networks to what\nyou intend, contact them and find out what legal issues they may have\nrun into. If such networks are very widely deployed in your country, then\nyou probably don't need to worry too much. On the other hand, it is\nalways advisable to seek local advice, from hardware vendors, wireless\nexperts or others who have come before you, before committing time and\nresources to building a wireless network. Whatever you do, it is important\nyou take local laws and regulations into consideration.\nExamples of relevant types of regulation\nEach country may have different rules, and each scenario may come across\ndifferent types of regulations. The areas where regulations may be relevant\ninclude licenses for using specific radio frequencies, rules regarding the\nright to install towers for antennas, the maximum power allowed and\ntelecom licensing rules limiting your ability to provide Internet access to\nothers.\nThe types of legal issues that may (or may not) be worth considering when\nplanning a wireless network include:\n\u2022 Spectrum Licensing\n\u2022 ISP\/Telecommunications Licenses\n\u2022 Tower permits for antennas\n\u2022 Transmission power and antenna gain limits\n\u2022 Certification of equipment\n\u2022 ISP Terms of Use 3. LICENSING AND REGULATION 37\nSpectrum Licensing\nMost countries consider RF spectrum as an exclusive property of the state.\nThe RF spectrum is a national resource, much like water, land, gas and\nminerals. Unlike these, however, RF is reusable. The purpose of spectrum\nmanagement is to mitigate radio spectrum pollution and maximize the\nbenefit of usable radio spectrum.\nThe first sentence of the International Telecommunications Union (ITU)\nconstitution fully recognises \u201cthe sovereign right of each State to regulate\nits telecommunication\u201d. Effective spectrum management requires\nregulation at national, regional and global levels.\nLicensing is an orderly way to manage who, when, where and how\nspectrum resource is used. The unlicensed wireless spectrum was set\naround the 2.4 GHz band.\nIn June 2003, the ITU made available the 5 GHz band for license-exempt\ntechnology deployment. The 900 MHz band, unlicensed in the United\nStates, is presently used in Western Europe and in many developing\ncountries for GSM phones. Each country has the sovereign right to\nregulate its telecommunication and to interpret the international Radio\nRegulations. Governments define the rules and conditions of the\nfrequency use.\n(From: Wikipedia \"Spectrum Management\")\nThe technologies described in this book (mostly) use a license-exempt\nslice of the spectrum referred to as the ISM (Industrial, Scientific and\nMedical radio bands). Radio frequencies in the ISM bands have been used\nfor communication purposes, although such devices may experience\ninterference from non-communication sources.\nThe ISM bands are defined by the ITU-R (ITU's Radiocommunication\nSector) at 2.4 and 5 GHz. Individual countries' use of the bands\ndesignated in these sections may differ due to variations in national radio\nregulations. Because communication devices using the ISM bands must\ntolerate any interference from ISM equipment, unlicensed operations are\ntypically permitted to use these bands, since unlicensed operation typically\nneeds to be tolerant of interference from other devices anyway.\nIn the US, the FCC (Federal Communications Commission) first made\nunlicensed spread spectrum available in the ISM bands in rules adopted\non May 9, 1985. Many other countries later adopted these FCC\nregulations, enabling use of this technology in many countries.\n(From: Wikipedia \"ISM Band\") 38 PHYSICS\nISP\/Telecommunications Licenses\nIn some countries an ISP license would be required before deploying any\nnetwork infrastructure for sharing networks over public spaces. In other\ncountries this would only be required to run commercial networks.\nTower permits for antennas\nWhen deploying long-range outdoor networks, it is often necessary to\nbuild a tower for the antenna. Many countries have regulations regarding\nthe building of such antenna-towers if they are more than 5 or 10 metres\nabove the roof or ground.\nTransmission Power limits\nWhen setting transmission power limits, regulatory agencies generally use\nthe Equivalent Isotropically Radiated Power (EIRP), as this is the power\nactually radiated by the antenna element. Power limits can be imposed on\noutput power of devices as well.\nAs an example, the FCC enforces certain rules regarding the power\nradiated by the antenna element, depending on whether the\nimplementation is point-to-multipoint (PtMp) or point-to-point (PtP). It\nalso enforces certain rules regarding the maximum power transmitted by\nthe radio.\nWhen an omnidirectional antenna is used, the FCC automatically\nconsiders the link a PtMP link. In the setup of a 2.4 GHz PtMP link, the\nFCC limits the EIRP to 4 Watts and the power limit set for the\nintentional radiator is 1 Watt.\nThings are more complicated in the 5 Ghz band. The Unlicensed National\nInformation Infrastructure (U-NII) radio band is part of the radio\nfrequency spectrum used by IEEE-802.11a devices and by many wireless\nISPs. It operates over three ranges:\nU-NII Low (U-NII-1): 5.15-5.25 GHz. Regulations require use\nof an integrated antenna. Power limited to 50 mW.\nU-NII Mid (U-NII-2): 5.25-5.35 GHz. Regulations allow for a\nuser-installable antenna, subject to Dynamic Frequency Selection (DFS, or\nradar avoidance). Power limited to 250 mW.\nU-NII Worldwide: 5.47-5.725 GHz. Both outdoor and indoor\nuse, subject to Dynamic Frequency Selection (DFS, or radar avoidance).\nPower limited to 250 mW. 3. LICENSING AND REGULATION 39\nThis spectrum was added by the FCC in 2003 to \"align the frequency\nbands used by U-NII devices in the United States with bands in other\nparts of the world\".\nThe FCC currently has an interim limitation on operations on channels\nwhich overlap the 5600 - 5650 MHz band.\nU-NII Upper (U-NII-3): 5.725 to 5.825 GHz.\nSometimes referred to as U-NII \/ ISM due to overlap with the ISM band.\nRegulations allow for a user-installable antenna. Power limited to 1W.\nWireless ISPs generally use 5.725-5.825 GHz.\n(From: Wikipedia \"U-NII\")\nFor PtP in the 5 GHz band the maximum EIRP allowed is considerable\nhigher, since a high gain antenna produces a very narrow beam and\ntherefore the interference caused to other users is considerably less than in\nPtMPt topology.\nCertification of equipment\nGovernments may require a formal certification that a given radio\nequipment comply with specific technical standards and local regulations.\nThis is often referred to as homologation, and the process must be done by\nan independent laboratory authorised by the government of the country.\nCertified equipment is allowed to operate without an individual license. It\nis worth noting that certification may only apply to the original factory\nstate for radio equipment.\nFor example, changing the antenna on a wireless access point in the\nUnited States invalidates the FCC Certification.\nISP Terms of Use\nMany ISP's include in their \"Terms of Use\" a clause that prohibits users\nfrom sharing an internet connection with other users.\nThere may also be commercial grade connections that do not have these\nlimitations.\nIt is important to note that this is NOT a legal issue, but a clause of the\ncontract with the ISP, and the repercussions for breaching these is usually\na disconnection of the Internet connection. 40 PHYSICS\n4. RADIO SPECTRUM\nWhat is the electromagnetic spectrum?\nThere is not a simple definition of the spectrum. From the technical\nviewpoint the spectrum is simply the range of electromagnetic waves that\ncan be used to transmit information, but from the practical viewpoint the\neconomic and political aspects, as well as the technology actually used to\nconvey the information by means of these waves, play pivotal roles.\nAs an example, when Marconi in 1902 first spanned the Atlantic with his\n\u201cwireless telegraph message\u201d, he used the whole spectrum available at the\ntime to send a few bits\/s over an area of thousands of square kilometres.\nWith the spark transmitter used for this achievement that occupied all the\nfrequencies that the existing receivers were able to understand, nobody else\ncould use radio for communications on a radius of some 3500 km from\nthe transmitting station in England. So, if other users wanted to send\nmessages in the same area, they would need to coordinate their\ntransmissions in different \u201ctime slots\u201d in order to share the medium. This\ntechnique is called \u201cTDMA\u201d, Time Division Multiple Access.\nUsers located at distances much greater than 3500 km from Marconi\u2019s\ntransmitter could use the spectrum again, since the power of the radio\nwaves decreases as we move farther away from the transmitter. Reusing the\nspectrum in different geographical areas is called \u201cSDMA\u201d, Space Division\nMultiple Access. Marconi was later able to build a transmitter that could\nrestrict emissions to just a range of frequencies, and a receiver that could\nbe \u201ctuned\u201d to a particular frequency range. Now, many users could\ntransmit simultaneously in the same area (space) and at the same time.\n\u201cFDMA\u201d, Frequency Division Multiple Access was borne. Radio then\nbecame a practical means of communications, and the only one that was\navailable to reach a ship in the open seas. The coordination of the\nfrequencies allocated to different users was done by national agencies\ncreated to this effect, but since radio waves are not stopped by national\nborders, international agreements were needed. The international\norganization that had been created to regulate the transmission of\ntelegrams among different countries was commissioned to allocate the use\nof the electromagnetic spectrum. 4. RADIO SPECTRUM 41\nNowadays, ITU, International Telecommunications Union, is the oldest\nInternational Organization, tasked with issuing recommendations\nabout which frequencies to use for which services to its 193 nation\nmembers.\nThe use of the spectrum for military applications raised a new issue;\n\u201cjamming\u201d, the intentional interference introduced by the enemy to\nimpede communication. To avoid jamming, a new technique was\ndeveloped in which the information to be transmitted was combined with\na special mathematical code; only receivers with the knowledge of that\nparticular code could interpret the information. The coded signal was\ntransmitted at low power but using a very wide interval of frequencies to\nmake jamming more difficult.\nThis technique was later adapted to civilian applications in what is called\n\u201cCDMA\u201d, Code Division Multiple Access, one of the flavours of spread\nspectrum communication, extensively used in modern communications\nsystems. In summary, the spectrum can be shared among many users by\nassigning different time slots, different frequency intervals, different regions\nof space, or different codes. A combination of these methods is used in the\nlatest cellular systems. Besides issues of sovereignty and its defence, very\nstrong economic and political interests play a determinant role in the\nmanagement of the spectrum, which also needs to be constantly updated\nto take advantage of the advances in the communications technology.\nTelecommunications engineers keep finding more efficient ways to\ntransmit information using time, frequency and space diversity by means\nof ever advancing modulation and coding techniques. The goal is to\nincrease the \u201cspectrum efficiency\u201d, defined as the amount of bits per\nsecond (bit\/s) that can be transmitted in each Hz of bandwidth per square\nkilometre of area. For example, the first attempts to provide mobile\ntelephone services were done by using a powerful transmitter,\nconveniently located to give coverage to a whole city.\nThis transmitter (called a Base Station in this context), divided the\nallocated frequency band into say, 30 channels. So only 30 conversations\ncould be held simultaneously in the whole city.\nAs a consequence, the service was very expensive and only the extremely\nwealthy could afford it. This situation prevailed for many years, until the\nadvances in electronic technology allowed the implementation of a scheme\nto take advantage of \u201cSpace Diversity\u201d. 42 PHYSICS\nInstead of using a single powerful transmitter to cover the whole city, the\narea to be serviced was divided into many \u201ccells\u201d, each one served by a low\npower transmitter. Now cells that are sufficiently apart can utilize the same\nchannels without interference, in what is known as \u201cfrequency reuse\u201d.\nWith the cellular scheme, the first 10 channels are to use frequency band\n1, the second 10 channels frequency band 2 and the remaining 10\nchannels frequency band 3. This is shown in Figure RS 1, in which the\ncolours correspond to different frequency bands. Notice that the colours\nrepeat only at distances far enough to avoid interference. If we divide the\ncity in say, 50 cells, we can now have 10X50 = 500 simultaneous users in\nthe same city instead of 30. Therefore, by adding cells of smaller\ndimensions (specified by lower transmission power) we can increase the\nnumber of available channels until we reach a limit imposed by the\ninterference.\nFigure RS 1: Cellular sharing of spectrum\nThis example shows that a clever use of existing resources can dramatically\nincrease its usefulness. Although the main use of the spectrum is for\ncommunication purposes, there are also other uses, like cooking food in\nmicrowave ovens, medical applications, garage door openers and so on. 4. RADIO SPECTRUM 43\nSo some frequency bands are allocated for these purposes in what is\nknown as the ISM (Industrial, Scientific and Medical) bands.\nThis spectrum usage is normally for short distance applications.\nA breakthrough occurred in 1985 when the FCC (Federal Commission of\nCommunications), the agency that oversees the spectrum in the U.S.,\nallowed the use of this spectrum for communications applications as well,\nprovided that the transmission power was kept to a very low level to\nminimize interference.\nPeople could freely use these \u201cUnlicensed\u201d bands without previously\napplying for a permit, provided that the equipment used had been\ncertified by an authorized laboratory that ensured compliance with\ninterference mitigation measures.\nSeveral manufacturers began taking advantage of this opportunity by\noffering equipment that could be used to communicate between\ncomputers without the need for cables, and some wireless data networks\ncovering significant geographic areas were built with them, but the turning\npoint happened after the 1997 approval of the IEEE (Institute of\nElectrical and Electronics Engineers) 802.11 Standard, the basis of what is\nknown as WiFi.\nThe existence of a standard that guaranteed the interoperability of\nequipment produced by different manufacturers fuelled an impressive\ngrowth of the market, which in turn drove the competition that fostered a\ndramatic decrease in the cost of the devices.\nIn particular, the portion of the ISM band between 2400 and 2483 MHz\nis nowadays available in most of the world without the need for previously\napplying for a license and is widely used by laptops, tablets, smart phones\nand even photographic cameras.\nIt is important to stress the role of the unlicensed spectrum in the\nenormous success of WiFi high speed Internet access.\nMany airports, hotels and cafes all over the world offer free WiFi Internet\naccess on their premises, and low cost wireless community networks have\nbeen built both in rural area and in cities covering considerable geographic\nareas, thanks to the availability of free spectrum.\nMobile phone operators, who have to pay dearly for frequency licenses to\nuse the spectrum, were quite hostile to this apparently unfair competition.\nBut when they started offering smart phones, which make very intensive\nuse of the Internet, they pretty soon realized that off-loading the traffic to\nWiFi was in their best interest, because it relieved the traffic in their\ndistribution network (known as the backhaul). 44 PHYSICS\nSo now they encourage their customers to use WiFi wherever it is available\nand use the more expensive cellular service only when out of range of any\nWiFi Access Point.\nThis is a remarkable example of the usefulness of the unlicensed spectrum\neven to traditional telecommunications operators who often have lobbied\nagainst it.\nHow is the spectrum adjudicated?\nCurrently the main methods to gain access to a given spectrum band are\nauctions and the so called \u201cbeauty contest\u201d.\nThe auction method is straightforward; interested parties bid for a given\nspectrum chunk; whoever commits the higher sum gets the right to use\nthe frequencies.\nIn theory this method guarantees that the adjudication will be transparent,\nin practice this has often been circumvented and there have been instances\nof powerful commercial interests that acquire frequencies only to avoid\ntheir use by the competition, with the result of highly valuable spectrum\nnot being used.\nAlso there is the temptation on the part of governments to use this\nmethod as a means to generate revenues and not necessarily in the best\npublic interest.\nAs an example, in the year 2000 there were auctions in several countries of\nEurope to adjudicate spectrum for mobile phones, which resulted in a\ntotal income of 100 billion (100 000 000 000) euros to the government\ncoffers.\nThe \u201cbeauty contest\u201d method is for the interested parties to submit\nproposals about how they intend to use the spectrum.\nA committee of the spectrum regulating agency then decides which of the\nproposals better serves the public goals.\nThis method relies on the objectivity, technical proficiency and honesty of\nthe members of the deciding committee, which is not always guaranteed.\nIn many countries there are rules for spectrum adjudication that call for\nthe relinquishing of spectrum bands that have been acquired but are not\nbeing used; however their enforcement is often lacking due to the strong\neconomic interests affected. 4. RADIO SPECTRUM 45\nFigure RS 2: A special vehicle for spectrum monitoring in Montevideo, Uruguay.\nFigure RS 2 shows a photograph of a spectrum monitoring vehicle in\nMontevideo, Uruguay and Figure RS 3 that of the same kind of equipment\nbeing used in Jakarta, Indonesia.\nFigure RS 3: The \u201cspectrum Police\u201d at work in Jakarta 46 PHYSICS\nNote that the open spectrum used in the unlicensed bands cannot prevent\ninterference issues, especially in very crowded areas, but nevertheless it has\nproved a fantastic success for short distance applications in cities and also\nfor long distance applications in rural areas.\nIt is therefore advisable to investigate new forms of spectrum allocation,\ntaking into consideration the needs of many stakeholders and striking a\nbalance among them.\nA dynamic spectrum allocation mechanism seems to be the best choice\ngiven the advances in technology that make this viable nowadays.\nAs an example, the current method of spectrum allocation is similar to the\nrailway system, the railroads can be idle a considerable amount of time,\nwhereas the dynamic spectrum allocation is akin to the freeway system\nthat can be used at all times by different users.\nPolitical issues\nThe importance of the spectrum as a communications enabler cannot be\noverstated. Television and radio broadcasting have a strong influence in\nshaping public perception of any issue, and have been used overtly for\npolitical propaganda (It has been said that the election of Kennedy as\npresident of the U.S. was due mainly to his television campaign).\nDuring the cold war, The Voice of America, Moscow Radio and Radio\nHavana Cuba were very effective ways to sway a global audience.\nMore recent examples include the influence of CNN and Al Jazeera in the\npublic interpretation of the Arab Spring. Spectrum used for two way\ncommunications has also been subject to government interventions,\nespecially in cases of political unrest. On the other hand, economic\ninterests also play a vital role in broadcasting; the consumer society relies\nheavily on radio and television to create artificial needs or to veer the\nconsumer towards a particular brand. We can conclude that the\nelectromagnetic spectrum is a natural resource whose usefulness is heavily\nconditioned by technological, economic and political factors.\nExplosion in spectrum demand\nAs the number of tablets and smart phones grows, telecom operators are\ntrying to get access to new frequency bands, but the traditional way of\nadjudicating the spectrum is facing a dead end. 4. RADIO SPECTRUM 47\nKeep in mind that the spectrum is used for radio and television\nbroadcasts, for satellite communications, for airplane traffic control, for\ngeolocalisation (Global Postioning Systems-GPS), as well as for military,\npolice and other governmental purposes. Traditionally, the demand for\nadditional spectrum has been met thanks to the advances of electronics\nthat have permitted the use of higher frequencies at an affordable cost.\nHigher frequencies are well suited for high speed transmissions, but they\nhave a limited range and are highly attenuated by walls and other obstacles\nas well as by rain.\nThis is exemplified by comparing the coverage of an AM radio\nbroadcasting station to that of an FM one: the greatest range of the AM\nstation is due to its use of lower frequencies. On the other hand, FM\nstations can make use of higher bandwidths and as consequence can offer\ngreater audio quality at the expense of a more limited range.\nCurrent cellular operators use even higher frequencies, usually above 800\nMHz. Accordingly, the TV broadcasting frequencies are coveted by the\ncellular telephone providers, because by using lower frequencies they will\nneed less base stations, with huge savings in deployment, operation and\nmaintenance costs. This is why these frequencies are commonly referred to\nas \u201cbeach front property\u201d.\nTechniques for more efficient spectrum usage by means of advanced\nmodulation and coding methods have had the greatest impact in allowing\nmore bits\/s per Hz of bandwidth availability. This, in turn, was made\npossible by the great strides in electronics (fabrication of ever advanced\nintegrated circuits) that now make it economically feasible to implement\nthe required sophisticated modulation and coding techniques.\nAccording to the calculations performed in 1948 by Claude Shannon - the\nfather of modern telecommunications, a typical telephone line could carry\nup to 30 kbit\/s. But this was only achieved in the 90's when integrated\ncircuits implementing the required techniques were actually built. In\nparticular, the transition to digital terrestrial television broadcasting, which\nis more efficient in spectrum usage compared with analogue transmission,\nhas freed some spectrum in the so called \u201cWhite Spaces\u201d, the frequencies\nthat had to be left fallow in between analogue television channels to\nprevent interference. 48 PHYSICS\nclose enough that transmissions from one can reach the other. White spaces are\nkept fallow to minimize interference.\nIn traditional analogue TV broadcasting, adjacent channels cannot be used\nat the same time, because the signal from one channel will \u201cspill\u201d over to\nthe two adjacent channels and would cause interference. This is similar to\nthe central reservation used in freeways to separate the two directions of\ntraffic in order to prevent collisions. So a \u201cWhite Space\u201d must be left\nbetween two contiguous analogue TV channels to prevent interference.\nDigital TV broadcasting is much more efficient in spectrum utilization,\nand several digital TV channels can be accommodated in the same\nfrequency band formerly used by a single analogue channel without\n\u201cspillover\u201d into adjacent channels. So, in places where Analog TV is\nreplaced by Digital TV a \u201cdigital dividend\u201d is being harvested.\nIn conclusion, the concept of white spaces can be applied to three\ndifferent frequency chunks:\n\u2022 The spectrum that has been assigned to TV broadcasting but it is\nnot currently being used. This applies particularly to developing\ncountries, in which there has been no economic incentive for\nbroadcaster to use every available TV channel.\n\u2022 The spectrum that must be left free in between two analogous TV\nchannels to prevent interference.\n\u2022 The spectrum that has been reclaimed as a consequence of the\ntransition to digital terrestrial TV, which is more spectrum\nefficient. This currently applies to developed countries, but will\nsoon apply to developing countries as well. 4. RADIO SPECTRUM 49\nIn the last 20 years there has been a tremendous growth in the demand\nfor more spectrum for mobile communication services, in which data\nservices are consuming much more bandwidth than voice and the growing\nuse of video is presenting an additional challenge.\nNot surprisingly, telecom operators everywhere are trying to get a portion\nof these \u201cWhite Spaces\u201d allocated to them to fulfill their needs.\nBroadcasters, on the other hand, are very reluctant to concede any\nspectrum at all to what are now their direct competitors.\nSpectrum scarcity or spectrum hoarding?\nAlthough the available spectrum is currently totally adjudicated in\ndeveloped countries, many independent studies have found that the actual\nsimultaneous usage of the spectrum is a tiny fraction of the total. This is\ncaused by the way spectrum was originally adjudicated and also because\noften spectrum is used intermittently; for instance some TV broadcasting\nstations do not transmit 24 hours a day.\nAs a consequence, a radically new way to use the spectrum has been\nsuggested; instead of leasing spectrum to a given organization in an\nexclusive basis, the new dynamic spectrum management paradigm\nproposes to use whatever spectrum is available in a certain place at a\ncertain time and switch to another frequency whenever interference is\ndetected in a given band.\nAn analogy can be made to explain this concept: the current way to\nallocate the spectrum is similar to a railroad system; the railroads are never\nused 100% of the time, a more efficient use of the same amount of terrain\ncan be done with a highway in which many different users can share the\nsame path according to their current needs.\nOf course to implement dynamic spectrum access requires new\ntechnologies and new legislation; many vested interests are fighting it\nalleging the possibility of interference. The key issue is how to determine\nwhen a particular chunk of spectrum is really being used in a particular\nplace and how to move quickly to a new frequency band when an existing\nuser with higher priority is detected. The technology to accomplish this\nfeat has already being demonstrated and implemented in the new IEEE\n802.22 standard recently approved, as well as in others currently being\nconsidered. 50 PHYSICS\nIEE 802.22\nStimulated by the impressive success of WiFi (due mostly to the use of\nunlicensed, open spectrum), the IEEE created a working group to address\nthe requirements of a Wireless Regional Area Network. The challenge was\nto develop a technology suitable for long distance transmission that could\nbe deployed in different countries (with quite different spectrum\nallocations), so they focused on the spectrum currently allocated to TV\nbroadcasting which spans approximately from 50 to 800 MHz. Nowhere\nis this spectrum being used in its entirety all the time, so there are \u201cWhite\nSpaces\u201d, fallow regions that could be \u201cre-farmed\u201d and put to use for\nbidirectional communications. In rural areas all over the world, but\nspecially in developing countries there are large portions of spectrum\ncurrently under utilised. It is expected that IEEE 802.22 will enable\ndynamic spectrum access in a similar way to IEEE 802.11 (WiFi),\nallowing access to open spectrum. Of course not all the spectrum can be\nliberated at once, a gradual process is required as the many technical, legal,\neconomic and political hurdles are solved, but there is no doubt that this\nis the trend and that IEE 802.22 paves the way to the future of spectrum\nallocation. In order to assess the availability of a given frequency channel\nat a given time two methods are being considered: channel sensing and a\ndatabase of primary users in a given geographic location at a given time.\nChannel sensing means that prior to an attempt to use a channel, the base\nstations will listen to the channel; if it is being used it will try another one,\nrepeating the procedure until a free channel is found. This procedure is\nrepeated at regular intervals to account for the possibility of stations\ncoming alive at any time. This method should suffice, nevertheless current\nspectrum holders have successfully lobbied the regulators to enforce the\nimplementation of the second method, which is much more complicated\nand imposes additional complexity and costs in the consumer equipment.\nThe second method consists in the building of a database of all the\nexisting incumbent transmission stations, with their position and\nrespective coverage area in order to establish an \u201coff limit\u201d zone in a given\nchannel.\nA new station wishing to transmit must first determine its exact position\n(so it must have a GPS receiver or other means to determine its\ngeographic location) and then interrogate the database to ascertain that its\npresent location is not in the forbidden zone of the channel it is\nattempting to use. 4. RADIO SPECTRUM 51\nTo interrogate the database, it must have Internet access by some other\nmeans (ADSL-Asymmetrical Digital Subscriber Loop, Cable, Satellite, or\nCellular), besides the 802.22 radio (which cannot be used until the\nchannel is confirmed as usable), so this adds a considerable additional\nburden to the station hardware which translates into additional cost,\nbeside the cost of building and maintaining the database.\nIn the US the FCC (Federal Communications Commission, the spectrum\nregulatory agency) has been promoting the building of the database of\nregistered users and have authorised 10 different private enterprises to\nbuild, operate and maintain such repositories.\nFurthermore, field trials of the standard are been conducted. In the UK,\nOFCOM (the spectrum regulator) is also conducting IEE 802.22 trials\nand concentrating on the database method having ruled out the spectrum\nsensing method for interference mitigation. Although IEEE 802.22 is the\nformally approved standard that has received the most publicity, there are\nseveral competing candidates that are being explored to leverage the TV\nWhite Spaces to provide two-way communication services, among them:\nIEEE 802.11af\nThis amendment takes advantage of the enormous success of IEEE 802.11\nby adapting the same technology to work in the frequency bands allocated\nto TV transmission, thus relieving the spectrum crowding of the 2.4 GHz\nband and offering greater range due to the use of lower transmission\nfrequencies. Its details are still being discussed by the corresponding IEEE\n802.11 working group.\nIEEE 802.16h\nThis amendment of the 802.16 standard was ratified in 2010 and\ndescribes the mechanism for implementing the protocol in uncoordinated\noperation, licensed or license exempt applications. Although most\ndeployments have been in the 5 GHz band, it can also be applied to the\nTV band frequencies and can profit from the significant deployments of\nWiMAX (Wireless Microwave Access) systems in many countries.\nDeveloping countries advantage\nIt is noteworthy that in developing countries the spectrum allocated to\nbroadcast television is only partially used. This presents a magnificent\nopportunity to introduce wireless data networking services in the channels 52 PHYSICS\nthat are not currently allocated, and to start reaping the benefits of 802.22\nin a more benign environment, where the spectrum sensing and agile\nfrequency changing required to share the crowded spectrum in developed\ncountries can be dispensed with. The usefulness of the lower frequencies\nfor two-way data communications has been proved by the the successful\ndeployment of CDMA (Code Division Modulation Access) cellular\nsystems in the 450 MHz band, right in the middle of the TV allocated\nfrequencies, in rural areas like the Argentinian Patagonian, currently served\nby \u201cCooperativa Telefonica de Calafate-COTECAL\u201d. COTECAL offer\nvoice and data services to customers at distances up to 50 km from the\nBase Station, in the beautiful area shown in the figure below:\nFigure RS 5: Region served with voice and data services by COTECAL, in\nCalafate and El Chalten, Argentina.\nSo there is an opportunity for stakeholders to lobby for the introduction\nof TV Band Device based solutions at an early stage, while the issues of\nthe digital transition are being considered. This will help ensure that\ncommercial interests of a few do not prevail over the interests of society at\nlarge. Activists\/lobbyists should emphasize the need for transparency in the 4. RADIO SPECTRUM 53\nfrequency allocation process and for accountability of the administration\nof spectrum in their country or region.\nAlso it is important that those who wish to deploy networks gain an\nunderstanding of the real spectrum usage by spectrum holders in each\nregion of their country. The monitoring of the spectrum requires expensive\ninstruments with a steep learning curve to use them, but recently an\naffordable and easy to use device has become available that permits analysis\nof the frequency band between 240 MHz and 960 MHz, which\nencompasses the higher part of the TV band. Details of this open hardware\nbased RF Explorer Spectrum Analyzer for the upper TV band are at:\nhttp:\/\/www.seeedstudio.com\/depot\/rf-explorer-model-wsub1g-p-922.html\nFigure RS 6 shows the RF Explorer for the 2.4 GHz band being used to\ntest an antenna built by participants of the 2012 ICTP Wireless training\nworkshop in Trieste, Italy.\nFigure RS 6: Participants from Albania, Nepal, Malawi and Italy testing an\nantenna with the RF Explorer Spectrum Analyzer in Trieste, February 2012.\nThis low cost instrument paves the way for a wide involvement of people\nin the measurement of the real spectrum usage on their own country\nwhich hopefully can lead to a better spectrum management.\nFor additional information see:\nhttp:\/\/www.apc.org\/en\/faq\/citizens -guide-airwaves 54 PHYSICS\n5. ANTENNAS \/ TRANSMISSION LINES\nThe transmitter that generates the RF power to drive the antenna is\nusually located at some distance from the antenna terminals. The\nconnecting link between the two is the RF transmission line. Its purpose is\nto carry RF power from one place to another, and to do this as efficiently\nas possible. From the receiver side, the antenna is responsible for picking\nup any radio signals in the air and passing them to the receiver with the\nminimum amount of distortion and maximum efficiency, so that the radio\nhas its best chance to decode the signal. For these reasons, the RF cable\nhas a very important role in radio systems: it must maintain the integrity\nof the signals in both directions.\nFigure ATL 1: Radio, transmission line and antenna\nThe simplest transmission line one can envisage is the bifilar or twin lead,\nconsisting of two conductors separated by a dielectric or insulator. The\ndielectric can be air or a plastic like the one used for flat transmission lines\nused in TV antennas. A bifilar transmission line open at one end will not\nradiate because the current in each wire has the same value but opposite\ndirection, so that the fields created on a given point at some distance from\nthe line cancel. 5. ANTENNAS \/ TRANSMISSION LINES 55\nIf we bend the open ends of the transmission line in opposite directions,\nthe currents will now generate electric fields that are in phase and reinforce\neach other and will therefore radiate and propagate at a distance. We now\nhave an antenna at the end of the transmission line.\nThe length of the bent portion of the transmission line will determine the\nantenna feature. If this length corresponds to a quarter of a wavelength we\nwill have a half wave dipole antenna with a gain of 2.15 dBi.\nThe functioning of the bifilar transmission line just described is strongly\naffected by any metal in its proximity, so a better solution is to confine the\nelectrical fields by means of an external conductor that shields the internal\none. This constitutes a coaxial cable. Alternatively, a hollow metallic pipe of\nthe proper dimensions will also effectively carry RF energy in what is known\nas a waveguide. 56 PHYSICS\nCables\nFor frequencies higher than HF the coaxial cables (or coax for short,\nderived from the words \u201cof common axis\u201d) are used almost exclusively.\nCoax cables have a core conductor wire surrounded by a non-conductive\nmaterial called dielectric, or simply insulation.\nThe dielectric is then surrounded by an encompassing shielding which is\noften made of braided wires. The dielectric prevents an electrical\nconnection between the core and the shielding. Finally, the coax is\nprotected by an outer casing which is generally made from a PVC\nmaterial.\nThe inner conductor carries the RF signal, and the outer shield prevents\nthe RF signal from radiating to the atmosphere, and also prevents outside\nsignals from interfering with the signal carried by the core. Another\ninteresting fact is that high frequency electrical signal travels only along\nthe outer layer of a conductor, the inside material does not contribute to\nthe conduction, hence the larger the central conductor, the better the\nsignal will flow. This is called the \u201cskin effect\u201d.\nFigure ATL 4: Coaxial cable with jacket, shield, dielectric, and core conductor.\nEven though the coaxial construction is good at transporting the signal,\nthere is always resistance to the electrical flow: as the signal travels along,\nit will fade away.\nThis fading is known as attenuation, and for transmission lines it is\nmeasured in decibels per metre (dB\/m).\nThe rate of attenuation is a function of the signal frequency and the\nphysical construction of the cable itself. As the signal frequency increases,\nso does its attenuation. 5. ANTENNAS \/ TRANSMISSION LINES 57\nObviously, we need to minimise the cable attenuation as much as possible\nby keeping the cable very short and using high quality cables.\nHere are some points to consider when choosing a cable for use with\nmicrowave devices:\n1. \u201cThe shorter the better!\u201d The first rule when you install a piece of\ncable is to try to keep it as short as possible. The power loss is not\nlinear, so doubling the cable length means that you are going to lose\nmuch more than twice the power. In the same way, reducing the cable\nlength by half gives you more than twice the power at the antenna.\nThe best solution is to place the transmitter as close as possible to the\nantenna, even when this means placing it on a tower.\n2. \u201cThe cheaper the worse!\u201d The second golden rule is that any money\nyou invest in buying a good quality cable is a bargain. Cheap cables\ncan be used at low frequencies, such as VHF. Microwaves require the\nhighest quality cables available.\n3. Avoid RG-58. It is intended for thin Ethernet networking, CB or\nVHF radio, not for microwave.\n4. Avoid RG-213 or RG-8. They are intended for CB and HF radio. In\nthis case even if the diameter is large the attenuation is significant due\nto the cheap insulator used.\n5. Whenever possible, use the best rated LMR cable or equivalent you\ncan find. LMR is a brand of coax cable available in various diameters\nthat works well at microwave frequencies. The most commonly used\nare LMR-400 and LMR-600. Heliax cables are also very good, but\nexpensive and difficult to use.\n6. Whenever possible, use cables that are pre-crimped and tested in a\nproper lab. Installing connectors to cable is a tricky business, and is\ndifficult to do properly even with the specific tools. Never step over a\ncable, bend it too much, or try to unplug a connector by pulling the\ncable directly. All of these behaviours may change the mechanical\ncharacteristic of the cable and therefore its impedance, short the inner\nconductor to the shield, or even break the line.\n7. Those problems are difficult to track and recognise and can lead to\nunpredictable behaviour on the radio link.\n8. For very short distances, a thin cable of good quality maybe adequate\nsince it will not introduce too much attenuation. 58 PHYSICS\nWaveguides\nAbove 2 GHz, the wavelength is short enough to allow practical, efficient\nenergy transfer by different means. A waveguide is a conducting tube\nthrough which energy is transmitted in the form of electromagnetic waves.\nThe tube acts as a boundary that confines the waves in the enclosed space.\nThe Faraday cage phenomenon prevents electromagnetic effects from\nbeing evident outside the guide. The electromagnetic fields are propagated\nthrough the waveguide by means of reflections against its inner walls,\nwhich are considered perfect conductors. The intensity of the fields is\ngreatest at the center along the X dimension, and must diminish to zero at\nthe end walls because the existence of any field parallel to the walls at the\nsurface would cause an infinite current to flow in a perfect conductor.\nThe X, Y and Z axis of a rectangular waveguide can be seen in the\nfollowing figure:\nFigure ATL 5: The X, Y, and Z axis of a rectangular waveguide.\nThere are an infinite number of ways in which the electric and magnetic\nfields can arrange themselves in a waveguide for frequencies above the low\ncutoff. Each of these field configurations is called a mode. The modes may\nbe separated into two general groups. One group, designated TM\n(Transverse Magnetic), has the magnetic field entirely transverse to the\ndirection of propagation, but has a component of the electric field in the\ndirection of propagation. The other type, designated TE (Transverse\nElectric) has the electric field entirely transverse, but has a component of\nmagnetic field in the direction of propagation.\nThe mode of propagation is identified by the group letters followed by two\nsubscript numerals. For example, TE 10, TM 11, etc. 5. ANTENNAS \/ TRANSMISSION LINES 59\nThe number of possible modes increases with the frequency for a given\nsize of guide, and there is only one possible mode, called the dominant\nmode, for the lowest frequency that can be transmitted. In a rectangular\nguide, the critical dimension is X. This dimension must be more than 0.5\n\u03bb at the lowest frequency to be transmitted. In practice, the Y dimension\nis usually about 0.5 X to avoid the possibility of operation in other than\nthe dominant mode. Cross-sectional shapes other than the rectangle can\nbe used, the most important being the circular pipe. Much the same\nconsiderations apply as in the rectangular case. Wavelength dimensions for\nrectangular and circular guides are given in the following table, where X is\nthe width of a rectangular guide and r is the radius of a circular guide. All\nfigures apply to the dominant mode.\nType of guide Rectangular Circular\nCutoff wavelength 2X 3.41r\nLongest wavelength transmitted 1.6X 3.2r\nwith little attenuation\nShortest wavelength before next 1.1X 2.8r\nmode becomes possible\nEnergy may be introduced into or extracted from a waveguide by means\nof either the electric or magnetic field. The energy transfer typically\nhappens through a coaxial line. Two possible methods for coupling to a\ncoaxial line are using the inner conductor of the coaxial line, or through a\nloop. A probe which is simply a short extension of the inner conductor of\nthe coaxial line can be oriented so that it is parallel to the electric lines of\nforce. A loop can be arranged so that it encloses some of the magnetic\nlines of force. The point at which maximum coupling is obtained depends\nupon the mode of propagation in the guide or cavity. Coupling is\nmaximum when the coupling device is in the most intense field.\nIf a waveguide is left open at one end, it will radiate energy (that is, it can\nbe used as an antenna rather than a transmission line).\nThis radiation can be enhanced by flaring the waveguide to form a\npyramidal horn antenna.\nT\nhere are examples of practical waveguide antennas for WiFi shown in\nAppendix A called Antenna Construction. 60 PHYSICS\nConnectors and adapters\nConnectors allow a cable to be connected to another cable or to a\ncomponent in the RF chain. There are a wide variety of fittings and\nconnectors designed to go with various sizes and types of coaxial lines.\nWe will describe some of the most popular ones.\nBNC connectors were developed in the late 40s. BNC stands for Bayonet\nNeill Concelman, named after the men who invented it: Paul Neill and\nCarl Concelman. The BNC product line is a miniature quick\nconnect\/disconnect connector. It features two bayonet lugs on the female\nconnector, and mating is achieved with only a quarter turn of the\ncoupling nut. BNCs are ideally suited for cable termination for miniature\nto subminiature coaxial cable (RG-58 to RG-179, RG-316, etc.). They are\nmost commonly found on test equipment and 10base2 coaxial Ethernet\ncables.\nTNC connectors were also invented by Neill and Concelman, and are a\nthreaded variation of the BNC. Due to the better interconnect provided\nby the threaded connector, TNC connectors work well through about 12\nGHz. TNC stands for Threaded Neill Concelman.\nType N (again for Neill, although sometimes attributed to \u201cNavy\u201d)\nconnectors were originally developed during the Second World War. They\nare usable up to 18 GHz, and very commonly used for microwave\napplications. They are available for almost all types of cable. Both the plug\n\/ cable and plug \/ socket joints are supposedly waterproof, providing an\neffective cable clamp. Nevertheless for outdoor use they should be\nwrapped in self agglomerating tape to prevent water from seeping in.\nSMA is an acronym for Sub Miniature version A, and was developed in\nthe 60s. SMA connectors are precision, subminiature units that provide\nexcellent electrical performance up to 18 GHz. These threaded high-\nperformance connectors are compact in size and mechanically have\noutstanding durability.\nThe SMB name derives from Sub Miniature B, and it is the second\nsubminiature design. The SMB is a smaller version of the SMA with snap-\non coupling. It provides broadband capability through 4 GHz with a\nsnap-on connector design. 5. ANTENNAS \/ TRANSMISSION LINES 61\nMCX connectors were introduced in the 80s.\nWhile the MCX uses identical inner contact and insulator dimensions as\nthe SMB, the outer diameter of the plug is 30% smaller than the SMB.\nThis series provides designers with options where weight and physical\nspace are limited. MCX provides broadband capability though 6 GHz\nwith a snap-on connector design.\nIn addition to these standard connectors, most WiFi devices use a variety\nof proprietary connectors. Often, these are simply standard microwave\nconnectors with the centre conductor parts reversed, or the thread cut in\nthe opposite direction. These parts are often integrated into a microwave\nsystem using a short, flexible jumper called a pigtail that converts the non-\nstandard connector into something more robust and commonly available.\nSome of these connectors include:\nRP-TNC. This is a TNC connector with the genders reversed.\nU.FL (also known as MHF). This is possibly the smallest microwave\nconnector currently in wide use. The U.FL\/MHF is typically used to\nconnect a mini-PCI radio card to an antenna or larger connector (such as\nan N or TNC) using a thin cable in waht is known as a pigtail.\nThe MMCX series, which is also called a MicroMate, is one of the smallest\nRF connector line and was developed in the 90s. MMCX is a micro-\nminiature connector series with a lock-snap mechanism allowing for 360\ndegrees rotation enabling flexibility.\nMC-Card connectors are even smaller and more fragile than MMCX.\nThey have a split outer connector that breaks easily after just a few\ninterconnects.\nAdapters are short, two-sided devices which are used to join two cables or\ncomponents which cannot be connected directly. For example, an adapter can\nbe used to connect an SMA connector to a BNC.\nAdapters may also be used to fit together connectors of the same type, but of\ndifferent gender.\nFigure ATL 6: An N female barrel adapter. 62 PHYSICS\nFor example a very useful adapter is the one which enables to join two Type\nN connectors, having socket (female) connectors on both sides.\nChoosing the proper connector\n\u201cThe gender question.\u201d Most connectors have a well defined gender. Male\nconnectors have an external housing or sleeve (frequently with an inner\nthread) that is meant to surround the body of the female connector. They\nnormally have a pin that inserts in the corresponding socket of the female\nconnector, which has a housing threaded on the outer surface or two\nbayonet struds protruding from a cylinder. Beware of reverse polarity\nconnectors, in which the male has an inner socket and the female an\ninner pin. Usually cables have male connectors on both ends, while RF\ndevices (i.e. transmitters and antennas) have female connectors. Lightning\narrestors, directional couplers and line-through measuring devices may\nhave both male and female connectors. Be sure that every male connector\nin your system mates with a female connector.\n\u201cLess is best!\u201d Try to minimise the number of connectors and adapters in\nthe RF chain. Each connector introduces some additional loss (up to a dB\nfor each connection, depending on the connector!)\n\u201cBuy, don\u2019t build!\u201d As mentioned earlier, buy cables that are already\nterminated with the connectors you need whenever possible. Soldering\nconnectors is not an easy task, and to do this job properly is almost\nimpossible for small connectors as U.FL and MMCX. Even terminating\n\u201cFoam\u201d cables is not an easy task. Don\u2019t use BNC for 2.4 GHz or higher.\nUse N type connectors (or SMA, SMB, TNC, etc.)\nMicrowave connectors are precision-made parts, and can be easily\ndamaged by mistreatment. As a general rule, you should rotate the outer\nsleeve to tighten the connector, leaving the rest of the connector (and\ncable) stationary. If other parts of the connector are twisted while\ntightening or loosening, damage can easily occur.\nNever step over connectors, or drop connectors on the floor when\ndisconnecting cables (this happens more often than you may imagine,\nespecially when working on a mast over a roof).\nNever use tools like pliers to tighten connectors. Always use your hands.\nWhen working outside, remember that metals expand at high\ntemperatures and contract at low temperatures: connector too tight in the\nsummer can bind or even break in winter. 5. ANTENNAS \/ TRANSMISSION LINES 63\nAntennas radiation patterns\nAntennas are a very important component of communication systems. By\ndefinition, an antenna is a device used to transform an RF signal traveling\non a transmission line into an electromagnetic wave in free space.\nAntennas have a property known as reciprocity, which means that an\nantenna will maintain the same characteristics regardless if whether it is\ntransmitting or receiving. All antennas operate efficiently over a relatively\nnarrow frequency band. An antenna must be tuned to the same frequency\nband of the radio system to which it is connected, otherwise the reception\nand the transmission will be impaired. In broadcasting, we can make do\nwith inefficient receiving antennas, because the transmitters are very\npowerful, but in two-way communications we must have properly sized\nantennas. When a signal is fed into an antenna, the antenna will emit\nradiation distributed in space in a certain way. A graphical representation\nof the relative distribution of the radiated power in space is called a\nradiation pattern.\nAntenna term glossary\nBefore we talk about specific antennas, there are a few common terms that\nmust be defined and explained:\nInput Impedance\nFor an efficient transfer of energy, the impedance of the radio, antenna,\nand transmission cable connecting them must be the same. Transceivers\nand their transmission lines are typically designed for 50 \u2126 impedance. If\nthe antenna has an impedance different from 50 \u2126 there will be a\nmismatch and reflections will occur unless an impedance matching circuit\nis inserted. When any of these components are mismatched, transmission\nefficiency suffers.\nReturn loss\nReturn loss is another way of expressing mismatch. It is a logarithmic ratio\nmeasured in dB that compares the power reflected by the antenna Pr to the\npower that is fed into the antenna from the transmission line Pi:\nReturn Loss (in dB) = 20 log Pi\/Pr\n10 64 PHYSICS\nWhile some energy will always be reflected back into the system, a high\nreturn loss will yield unacceptable antenna performance.\nThe interaction between the wave travelling from the transmitter to the\nantenna and the wave reflected by the antenna towards the transmitter\ncreates what is known as a stationary wave, therefore an alternative way to\nmeasure the impedance mismatch is by means of the Voltage Standing\nWave Ratio (VSWR):\nReturn Loss (in dB) = 20 log (VSWR+1 \/ VSWR-1)\n10\nIn a perfectly matched transmission line, VSWR = 1.\nIn practice, we strive to maintain a VSWR below 2.\nBandwidth\nThe bandwidth of an antenna refers to the range of frequencies F - F\nH L\nover which the antenna can operate correctly. The antenna's bandwidth is\nthe number of Hz for which the antenna meets certain requirements, like\nexhibiting a gain within 3 dB of the maximum gain or a VSWR less than 1.5.\nThe bandwidth can also be described in terms of percentage of the centre\nfrequency of the band.\nBandwidth = 100 (F \u2013 F )\/F\nH L C\n...where F is the highest frequency in the band, F is the lowest\nH L\nfrequency in the band, and F is the centre frequency in the band.\nC\nIn this way, bandwidth is constant relative to frequency. If bandwidth was\nexpressed in absolute units of frequency, it would be different depending\nupon the center frequency.\nDifferent types of antennas have different bandwidth limitations.\nDirectivity and Gain\nDirectivity is the ability of an antenna to focus energy in a particular\ndirection when transmitting, or to receive energy from a particular\ndirection when receiving.\nIf a wireless link uses fixed locations for both ends, it is possible to use\nantenna directivity to concentrate the radiation beam in the wanted\ndirection. 5. ANTENNAS \/ TRANSMISSION LINES 65\nIn a mobile application where the transceiver is not fixed, it may be\nimpossible to predict where the transceiver will be, and so the antenna\nshould ideally radiate as well as possible in all directions. An\nomnidirectional antenna is used in these applications. Gain cannot be\ndefined in terms of a physical quantity such as the watt or the ohm, but it\nis a dimensionless ratio. Gain is given in reference to a standard antenna.\nThe two most common reference antennas are the isotropic antenna and\nthe half-wave dipole antenna.\nDirectivity and Gain\nDirectivity is the ability of an antenna to focus energy in a particular\ndirection when transmitting, or to receive energy from a particular\ndirection when receiving. If a wireless link uses fixed locations for both\nends, it is possible to use antenna directivity to concentrate the radiation\nbeam in the wanted direction. In a mobile application where the\ntransceiver is not fixed, it may be impossible to predict where the\ntransceiver will be, and so the antenna should ideally radiate as well as\npossible in all directions. An omnidirectional antenna is used in these\napplications. Gain cannot be defined in terms of a physical quantity such\nas the watt or the ohm, but it is a dimensionless ratio. Gain is given in\nreference to a standard antenna.\nThe two most common reference antennas are the isotropic antenna and\nthe half-wave dipole antenna.\nThe isotropic antenna radiates equally well in all directions. Real isotropic\nantennas do not exist, but they provide useful and simple theoretical\nantenna patterns with which to compare real antennas. Any real antenna\nwill radiate more energy in some directions than in others. Since antennas\ncannot create energy, the total power radiated is the same as an isotropic\nantenna. Any additional energy radiated in the direction it favours is offset\nby equally less energy radiated in some other direction.The gain of an\nantenna in a given direction is the amount of energy radiated in that\ndirection compared to the energy an isotropic antenna would radiate in\nthe same direction when driven with the same input power. Usually we are\nonly interested in the maximum gain, which is the gain in the direction in\nwhich the antenna is radiating most of the power, the so called boresight.\nAn antenna gain of 3 dB compared to an isotropic antenna would be\nwritten as 3 dBi.\nThe half-wave dipole can be a useful standard for comparing to other\nantennas at one frequency or over a very narrow band of frequencies. 66 PHYSICS\nUnlike the isotropic, is very easy to build and sometimes manufacturers\nwill express the gain with reference to the half-wave dipole instead of the\nisotropic. An antenna gain of 3 dB compared to a dipole antenna would\nbe written as 3 dBd. Since a half-wave dipole has a gain of 2.15 dBi, we\ncan find the dBi gain of any antenna by adding 2.15 to its dBd gain.\nThe method of measuring gain by comparing the antenna under test\nagainst a known standard antenna, which has a calibrated gain, is\ntechnically known as a gain transfer technique.\nRadiation Pattern\nThe radiation pattern or antenna pattern describes the relative strength of\nthe radiated field in various directions from the antenna, at a constant\ndistance. The radiation pattern is a reception pattern as well, since it also\ndescribes the receiving properties of the antenna, as a consequence of\nreciprocity. The radiation pattern is three-dimensional, but usually the\npublished radiation patterns are a two-dimensional slice of the three-\ndimensional pattern, in the horizontal and vertical planes.\nThese pattern measurements are presented in either a rectangular or a\npolar format.\nThe following figure shows a rectangular plot presentation of a typical\nten-element Yagi antenna radiation pattern.\nThe detail is good but it is difficult to visualize the antenna behaviour in\ndifferent directions.\nFigure ATL 7: A rectangular plot of the radiation pattern of a Yagi antenna. 5. ANTENNAS \/ TRANSMISSION LINES 67\nPolar coordinate systems are used almost universally.\nIn the polar-coordinate graph, points are located by projection along a\nrotating axis (radius) to an intersection with one of several concentric\ncircles that represent the correspong gain in dB, referenced to 0 dB at the\nouter edge of the plot.\nThis representation makes it easier to grasp the radial distribution of the\nantenna power.\nFigure ATL 8 is a polar plot of the same 10 element Yagi antenna.\nFigure ATL 8: The polar radiation pattern plot of the same antenna\nThe field pattern that exists close to the antenna is different from the one\nat a distance, which is the one of interest.\nThe far-field is also called the radiation field.\nFor radiation pattern measurement it is important to choose a distance\nsufficiently large. 68 PHYSICS\nThe minimum permissible distance depends on the dimensions of the\nantenna in relation to the wavelength.\nThe accepted formula for this distance is:\nr = 2d2 \/\u03bb\nmin\nwhere r is the minimum distance from the antenna, d is the largest\nmin\ndimension of the antenna, and \u03bb is the wavelength.\nBeamwidth\nAn antenna's beamwidth is usually understood to mean the half-power\nbeamwidth. The peak radiation intensity is found, and then the points on\neither side of the peak at which the power has reduced by half are located.\nThe angular distance between the half power points is defined as the\nbeamwidth. Half the power expressed in decibels is -3 dB, so the half\npower beamwidth is sometimes referred to as the 3 dB beamwidth. Both\nhorizontal and vertical beamwidth are usually considered.\nAssuming that most of the radiated power is not divided into sidelobes,\nthe directive and hence the gain is inversely proportional to the\nbeamwidth: as the beamwidth decreases, the gain increases. A very high\ngain antenna can have a beamwidth of a few degrees and will have to be\npointed very carefully in order not to miss the target. The beamwidth is\ndefined by the half power points and in turn determines the coverage area.\nCoverage area refers to geographical space \u201cilluminated\u201d by the antenna\nand it is roughly defined by the intersection of the beamwidth with the\nearth surface. On a base station, it is normally desired to maximise the\ncoverage area, but sometimes one must resort to \u201cdowntilting\u201d the\nantenna, either mechanically or electrically, in order to provide services to\ncustomers very close to the base station and therefore below the\nbeamwidth of a non tilted antenna. This down tilting could be achieved\nby mechanically inclining the antenna, but often the beam can be steered\nby changing the phase of the signal applied to the different elements of\nthe antenna in what is known as electrically downtilting.\nSidelobes\nNo antenna is able to radiate all the energy in one preferred direction.\nSome is inevitably radiated in other directions. These smaller peaks are\nreferred to as sidelobes, commonly specified in dB down from the main lobe. 5. ANTENNAS \/ TRANSMISSION LINES 69\nIn antenna design, a balance must be struck between gain and sidelobes.\nNulls\nIn an antenna radiation pattern, a null is a zone in which the effective\nradiated power is at a minimum. A null often has a narrow directivity angle\ncompared to that of the main beam. Thus, the null is useful for several\npurposes, such as suppression of interfering signals in a given direction\nPolarization\nPolarization is defined as the orientation of the electric field of an\nelectromagnetic wave. The initial polarization of a radio wave is determined\nby the antenna. Most antennas are either vertically or horizontally\npolarized.\nFigure ATL 9: The electric field is perpendicular to magnetic field,\nboth of which are perpendicular to the direction of propagation. 70 PHYSICS\nThe polarization of the transmitting and the receiving antenna must\nmatch, or a very big loss will be incurred.\nSome modern systems take advantage of polarization by sending two\nindependent signals at the same frequency, separated by the polarization.\nPolarization is in general described by an ellipse. Two special cases of\nelliptical polarization are linear polarization and circular polarization.\nWith linear polarization, the electric field vector stays in the same plane all\nthe time.\nThe electric field may leave the antenna in a vertical orientation, a\nhorizontal orientation, or at some angle between the two.\nVertically polarized radiation is somewhat less affected by reflections over\nthe transmission path.\nOmnidirectional antennas normally have vertical polarization.\nHorizontal antennas are less likely to pick up man- made interference,\nwhich ordinarily is vertically polarized.\nIn circular polarization the electric field vector appears to be rotating with\ncircular motion about the direction of propagation, making one full turn\nfor each RF cycle. This rotation may be right-hand or left-hand.\nChoice of polarization is one of the design choices available to the RF\nsystem designer.\nPolarization Mismatch\nIn order to transfer maximum power between a transmit and a receive\nantenna, both antennas must have the same spatial orientation, and the\nsame polarization sense.\nWhen the antennas are not aligned or do not have the same polarization,\nthere will be a reduction in power transfer between the two antennas. This\nreduction in power transfer will reduce the overall system efficiency and\nperformance.\nWhen the transmit and receive antennas are both linearly polarized,\nphysical antenna misalignment will result in a polarization mismatch loss,\nwhich can be determined using the following formula:\nLoss (dB) = 20 log (cos \u03b8)\n10\n...where \u03b8 is the difference in the polarization angle between the two\nantennas. 5. ANTENNAS \/ TRANSMISSION LINES 71\nFor 15\u00b0 the loss is approximately 0.3 dB, for 30\u00b0 we lose 1.25 dB, for 45\u00b0\nwe lose 3 dB and for 90\u00b0 we have an infinite loss.\nIn short, the greater the mismatch in polarization between a transmitting\nand receiving antenna, the greater the loss.\nIn the real world, a 90\u00b0 mismatch in polarization is quite large but not\ninfinite. Some antennas, such as Yagis or can antennas, can be simply\nrotated 90\u00b0 to match the polarization of the other end of the link.\nYou can use the polarization effect to your advantage on a point-to-point\nlink.\nUse a monitoring tool to observe interference from adjacent networks, and\nrotate one antenna until you see the lowest received signal. Then bring\nyour link online and orientate the other end to match polarization.\nThis technique can sometimes be used to build stable links, even in noisy\nradio environments.\nPolarization mismatch can be exploited to send two different signals on\nthe same frequency at the same time, thus doubling the throughput of the\nlink. Special antennas that have dual feeds can be used for this purpose.\nThey have two RF connectors that attach to two independent radios. The\nreal life throughput is somewhat lower than twice the single antenna\nthroughput because of the inevitable cross polarization interference.\nFront-to-back ratio\nIt is often useful to compare the front-to-back ratio of directional\nantennas. This is the ratio of the maximum directivity of an antenna to its\ndirectivity in the opposite direction.\nFor example, when the radiation pattern is plotted on a relative dB scale,\nthe front-to-back ratio is the difference in dB between the level of the\nmaximum radiation in the forward direction and the level of radiation at\n180 degrees from it.\nThis number is meaningless for an omnidirectional antenna, but it is quite\nrelevant when building a system with repeaters, in which the signal sent\nbackward will interfere with the useful signal and must be minimised.\nAntenna Aperture\nThe electrical \u201caperture\u201d of a receiving antenna is defined as the cross\nsection of a parabolic antenna that would deliver the same power to a\nmatched load. 72 PHYSICS\nIt is easy to see that a parabolic grid has an aperture very similar to a solid\nparaboloid.\nThe aperture of an antenna is proportional to the gain.\nBy reciprocity, the aperture is the same for a transmitting antenna.\nNotice that the concept of aperture is not easily visualised in the case of a\nwire antenna in which the physical area is negligible. In this case the\nantenna aperture must be derived from the formula of the gain.\nTypes of antennas\nA classification of antennas can be based on:\nFrequency and size.\nAntennas used for HF are different from antennas used for VHF, which in\nturn are different from antennas for microwave. The wavelength is different at\ndifferent frequencies, so the antennas must be different in size to radiate\nsignals at the correct wavelength.\nWe are particularly interested in antennas working in the microwave range,\nespecially in the 2.4 GHz and 5 GHz frequencies.\nAt 2.4 GHz the wavelength is 12.5 cm, while at 5 GHz it is 6 cm.\nDirectivity.\nAntennas can be omnidirectional, sectorial or directive. Omnidirectional\nantennas radiate roughly the same signal all around the antenna in a\ncomplete 360\u00b0 pattern.\nThe most popular types of omnidirectional antennas are the dipole and\nthe ground plane. Sectorial antennas radiate primarily in a specific area.\nThe beam can be as wide as 180 degrees, or as narrow as 60 degrees.\nDirectional or directive antennas are antennas in which the beamwidth is\nmuch narrower than in sectorial antennas. They have the highest gain and\nare therefore used for long distance links.\nTypes of directive antennas are the Yagi, the biquad, the horn, the\nhelicoidal, the patch antenna, the parabolic dish, and many others. 5. ANTENNAS \/ TRANSMISSION LINES 73\nFigure ATL 10: Antenna types\nPhysical construction.\nAntennas can be constructed in many different ways, ranging from simple\nwires, to parabolic dishes, to coffee cans.\nWhen considering antennas suitable for 2.4 GHz WLAN use, another\nclassification can be used:\nApplication.\nAccess points tend to make point-to-multipoint networks, while remote\nlinks or backbones are point-to-point. Each of these suggest different\ntypes of antennas for their purpose. Nodes that are used for multipoint\naccess will likely use omni antennas which radiate equally in all directions,\nor several sectorial antennas each focusing into a small area. In the point-\nto-point case, antennas are used to connect two single locations together.\nDirective antennas are the primary choice for this application.\nA brief list of common type of antennas for the 2.4 GHz frequency is\npresented now, with a short description and basic information about their\ncharacteristics. 74 PHYSICS\n1\/4 wavelength ground plane.\nThe 1\u20444 wavelength ground plane antenna is very simple in its\nconstruction and is useful for communications when size, cost and ease of\nconstruction are important. This antenna is designed to transmit a\nvertically polarized signal. It consists of a 1\u20444 wavelength element as active\nelement and three or four 1\u20444 wavelength ground elements bent 30 to 45\ndegrees down. This set of elements, called radials, is known as a ground\nplane.\nFigure ATL 11: Quarter wavelength ground plane antenna.\nThis is a simple and effective antenna that can capture a signal equally\nfrom all directions. The gain of this antenna is in the order of 2 - 4 dBi.\nYagi-Uda antenna\nA basic Yagi or more properly Yagi-Uda antenna consists of a certain\nnumber of straight elements, each measuring approximately half\nwavelength. The driven or active element of a Yagi is the equivalent of a\ncentre-fed, half-wave dipole antenna.\nParallel to the driven element, and approximately 0.2 to 0.5 wavelength on\neither side of it, are straight rods or wires called reflectors and directors, or\nsimply passive elements. 5. ANTENNAS \/ TRANSMISSION LINES 75\nA reflector is placed behind the driven element and is slightly longer than\nhalf wavelength; directors are placed in front of the driven element and are\nslightly shorter than half wavelength. A typical Yagi has one reflector and\none or more directors.\nThe antenna propagates electromagnetic field energy in the direction\nrunning from the driven element toward the directors, and is most\nsensitive to incoming electromagnetic field energy in this same direction.\nThe more directors a Yagi has, the greater the gain.\nFollowing is the photo of a Yagi antenna with 5 directors and one\nreflector. Yagi antennas are often enclosed in a cylindrical radome to afford\nprotection from the weather.\nFigure ATL 12: Yagi-Uda\nYagi antennas are used primarily for Point-to-Point links, have a gain\nfrom 10 to 20 dBi and a horizontal beamwidth of 10 to 20 degrees.\nHorn\nThe horn antenna derives its name from the characteristic flared\nappearance.\nThe flared portion can be square, rectangular, cylindrical or conical.\nThe direction of maximum radiation corresponds with the axis of the\nhorn.\nIt is easily fed with a waveguide, but can be fed with a coaxial cable and a\nproper transition.\nWhile it is cumbersome to make a horn antenna at home, a cylindrical\ncan with proper dimensions will have similar characteristics. 76 PHYSICS\nFigure ATL 13: Feed horn made from a food can.\nHorn antennas are commonly used as the active element in a dish\nantenna. The horn is pointed toward the centre of the dish reflector.\nThe use of a horn, rather than a dipole antenna or any other type of\nantenna, at the focal point of the dish minimizes loss of energy around the\nedges of the dish reflector.\nAt 2.4 GHz, a simple horn antenna made with a tin can has a gain in the\norder of 10 dBi.\nParabolic Dish\nAntennas based on parabolic reflectors are the most common type of\ndirective antennas when a high gain is required.\nThe main advantage is that they can be made to have gain and directivity\nas large as required. The main disadvantage is that big dishes are difficult\nto mount and are likely to have a large wind load.\nRandomes can be used to reduce the wind load or windage, as well as for\nweather protection. 5. ANTENNAS \/ TRANSMISSION LINES 77\nFigure ATL 14: A solid dish antenna.\nDishes up to one metre are usually made from solid material.\nAluminum is frequently used for its weight advantage, its durability and\ngood electrical characteristics.\nWindage increases rapidly with dish size and soon becomes a severe\nproblem. Dishes which have a reflecting surface that uses an open mesh\nare frequently used.\nThese have a poorer front-to-back ratio, but are safer to use and easier to\nbuild.\nCopper, aluminum, brass, galvanized steel and steel are suitable mesh\nmaterials. 78 PHYSICS\nBiQuad\nThe BiQuad antenna is simple to build and offers good directivity and\ngain for Point-to-Point communications. It consists of a two squares of the\nsame size of 1\u20444 wavelength as a radiating element and of a metallic plate\nor grid as reflector. This antenna has a beamwidth of about 70 degrees and\na gain in the order of 10-12 dBi. It can be used as stand-alone antenna or\nas feeder for a Parabolic Dish.\nThe polarization is such that looking at the antenna from the front, if the\nsquares are placed side by side the polarization is vertical.\nFigure ATL 15: The BiQuad.\nLog Periodic Antennas\nLog periodic antennas have moderate gain over a wide frequency band,\nThey are often used in spectrum analysers for testing purposes and are also\npopular as TV receiving antennas since they can efficiently cover from\nchannel 2 up to channel 14. These antennas are used in White space\ndevices that require the ability to work in widely different channels. 5. ANTENNAS \/ TRANSMISSION LINES 79\nFigure ATL 16: Log periodic antenna\nOther Antennas\nMany other types of antennas exist and new ones are created following\nadvances in technology.\nSector or Sectorial antennas: they are widely used in cellular telephony\ninfrastructure and are usually built adding a reflective plate to one or\nmore phased dipoles.\nTheir horizontal beamwidth can be as wide as 180 degrees, or as narrow as\n60 degrees, while the vertical is usually much narrower.\nComposite antennas can be built with many Sectors to cover a wider\nhorizontal range (multisectorial antenna).\nPanel or Patch antennas: they are solid flat panels used for indoor\ncoverage, with a gain up to 23 dBi. 80 PHYSICS\nReflector theory\nThe basic property of a perfect parabolic reflector is that it converts a\nspherical wave irradiating from a point source placed at the focus into a\nplane wave. Conversely, all the energy received by the dish from a distant\nsource is reflected to a single point at the focus of the dish. The position of\nthe focus, or focal length, is given by:\nf = D2 \/16 c\n...where D is the dish diameter and c is the depth of the parabola at its\ncentre.\nThe size of the dish is the most important factor since it determines the\nmaximum gain that can be achieved at the given frequency and the\nresulting beamwidth. The gain and beamwidth obtained are given by:\nGain = ((3.14 D)2 \/ \u03bb2) \u03b7\nBeamwidth = 70 \u03bb \/ D\n...where D is the dish diameter and \u03b7 is the efficiency. The efficiency is\ndetermined mainly by the effectiveness of illumination of the dish by the\nfeed, but also by other factors. Each time the diameter of a dish is\ndoubled, the gain is four times or 6 dB greater. If both stations double the\nsize of their dishes, signal strength can be increased by 12 dB, a very\nsubstantial gain. An efficiency of 50% can be assumed when hand-\nbuilding antennas.\nThe ratio f \/ D (focal length\/diameter of the dish) is the fundamental\nfactor governing the design of the feed for a dish. The ratio is directly\nrelated to the beamwidth of the feed necessary to illuminate the dish\neffectively. Two dishes of the same diameter but different focal lengths\nrequire different design of feed if both are to be illuminated efficiently.\nThe value of 0.25 corresponds to the common focal-plane dish in which\nthe focus is in the same plane as the rim of the dish.\nThe optimum illumination of a dish is a compromise between maximising\nthe gain and minimising the sidelobes. 5. ANTENNAS \/ TRANSMISSION LINES 81\nAmplifiers\nAs mentioned earlier, antennas do not actually create power. They simply\ndirect all available power into a particular pattern. By using a power\namplifier, you can use DC power to augment your available signal. An\namplifier connects between the radio transmitter and the antenna, and has\nan additional cable that connects to a power source.\nAmplifiers are available that work at 2.4 GHz, and can add several Watts\nof power to your transmission. These devices sense when an attached radio\nis transmitting, and quickly power up and amplify the signal. They then\nswitch off again when transmission ends. When receiving, they also add\namplification to the signal before sending it to the radio.\nUnfortunately, simply adding amplifiers will not magically solve all of your\nnetworking problems.\nWe do not discuss power amplifiers at length in this book because there\nare a number of significant drawbacks to using them:\n\u2022 They are expensive. Amplifiers must work at relatively\nwide bandwidths at 2.4 GHz, and must switch quickly\nenough to work for Wi- Fi applications.\n\u2022 They provide no additional directionality. High gain\nantennas not only improve the available amount of signal,\nbut tend to reject noise from other directions. Amplifiers\nblindly amplify both desired and interfering signals, and\ncan make interference problems worse.\n\u2022 Amplifiers generate noise for other users of the band. By\nincreasing your output power, you are creating a louder\nsource of noise for other users of the unlicensed band.\nConversely, adding antenna gain will improve your link\nand can actually decrease the noise level for your\nneighbours.\n\u2022 Using amplifiers is often illegal. Every country imposes\npower limits on use of unlicensed spectrum. Adding an\nantenna to a highly amplified signal will likely cause the\nlink to exceed legal limits.\nAntennas cost far less than amps, and can improve a link simply by\nchanging the antenna on one end. 82 PHYSICS\nUsing more sensitive radios and good quality cable also helps significantly\non long distance wireless links.\nThese techniques are unlikely to cause problems for other users of the\nband, and so we recommend pursuing them before adding amplifiers.\nMany manufacturers offer high power versions of their WiFi radios at\nboth 2 and 5 GHz, which have a built in amplifiers.\nThese are better than external amplifiers, but do not assume that it is\nalways smart to use the high power version, for many application the\nstandard power coupled with a high gain antenna is actually better.\nPractical antenna designs\nThe cost of 2.4 GHz antennas has fallen dramatically with the increased\npopularity of WiFi. Innovative designs use simpler parts and fewer\nmaterials to achieve impressive gain with relatively little machining.\nUnfortunately, availability of good antennas is still limited in some areas of\nthe world, and importing them can be expensive.\nWhile actually designing an antenna can be a complex and error-prone\nprocess, constructing antennas from locally available components is very\nstraightforward, and can be a lot of fun.\nIn Appendix A called Antenna Construction we present some practical\nantenna designs that can be built for very little money.\nAntenna measurements\nPrecise antenna instruments require expensive instruments and\ninstallations. It is therefore advisable to obtain the antenna parameters\nvalues directly from a reputable manufacturer.\nAn anechoic chamber is needed to perform accurate antenna\nmeasurements, otherwise the reflections will cause false readings.\nIce affects the performance of all antennas to some degree and the\nproblem gets more serious at higher frequencies. The impedance of free\nspace is 377 ohms. If the air immediately surrounding the dipole elements\nis replaced by ice which has a lower impedance than air, then the\nimpedance match and radiation patterns of the antenna will change.\nThese changes become progressively worse as the ice loading increases. 5. ANTENNAS \/ TRANSMISSION LINES 83\nAntenna elements are usually encased in a plastic protective housing\n(radome). This provides an air space between the elements and ice casing\nso that the lower impedance of the ice layer has only a small effect on the\nradiators.\nDetuning is greatly reduced but radiation pattern distortion may still be\nencountered (detuning reduces usable antenna bandwidth). For a given ice\nthickness, deviation from nominal performance values become worse as\nfrequency increases.\nIn areas where severe icing and wet snow are common, it is prudent to\ninstall a full radome over solid parabolic antennas, to use panel antennas\ninstead of corner reflectors, and to stay away from grid parabolics.\nFigure ATL 17: Effect of ice on a parabolic grid antenna NETWORKING 6. NETWORKING 85\n6. NETWORKING\nBefore purchasing equipment or deciding on a hardware platform, you\nshould have a clear idea of the nature of your communications problem.\nMost likely, you are reading this book because you need to connect\ncomputer networks together in order to share resources and ultimately\nreach the larger global Internet.\nThe network design you choose to implement should fit the\ncommunications problem you are trying to solve.\nDo you need to connect a remote site to an Internet connection in the\ncentre of your campus? Will your network likely grow to include several\nremote sites? Will most of your network components be installed in fixed\nlocations, or will your network expand to include hundreds of roaming\nlaptops and other devices?\nIn this chapter, we will review the networking concepts that define\nTCP\/IP, the primary family of networking protocols currently used on the\nInternet.\nWe will also look at the hardware options that are likely to form the\nunderlying physical layer of your TCP\/IP network and end with some\nexamples of wireless configurations. This will prepare you very well for the\nchapter called Deployment Planning later in this book.\nTCP\/IP refers to the suite of protocols that allow conversations to happen\non the global Internet.\nBy understanding TCP\/IP, you can build networks that will scale to\nvirtually any size, and will ultimately become part of the global Internet.\nThis edition of the book now includes an introduction to IPv6 which is\nthe new numbering system of the Internet.\nAs it is very likely you will be deploying networks using IPv6, it is highly\nrecommended you become familiar with how this works and also how it\ncan work alongside the older IPv4 networks that will continue to operate\non the Internet for some while yet. 86 NETWORKING\nIntroduction\nVenice, Italy is a fantastic city to get lost in. The roads are mere foot paths\nthat cross water in hundreds of places, and never go in a simple straight\nline. Postal carriers in Venice are some of the most highly trained in the\nworld, specialising in delivery to only one or two of the six sestieri\n(districts) of Venice. This is necessary due to the intricate layout of that\nancient city. Many people find that knowing the location of the water and\nthe sun is far more useful than trying to find a street name on a map.\nImagine a tourist who happens to find papier-m\u00e2ch\u00e9 mask as a souvenir,\nand wants to have it shipped from the studio in S. Polo, Venezia to their\nhome in London, United Kingdom. This may sound like an ordinary (or\neven trivial) task, but let's look at what actually happens.\nFigure NG 1: Another kind of network mask. 6. NETWORKING 87\nThe artist first packs the mask into a shipping box and addresses it to the\nhome of the tourist.\nThey then hand this to a postal employee in Venice, who attaches some\nofficial forms and sends it to a central package processing hub for\ninternational destinations.\nAfter several days, the package clears Italian customs and finds its way\nonto a flight to the UK, arriving at a central import processing depot at\nHeathrow airport. Once it clears through customs, the package is sent to a\ndistribution point in the city of London, then on to the local district\npostal processing centre of Camden where the tourist lives.\nThe package eventually makes its way onto a delivery van which has a\nroute that brings it to the correct house on the correct street in Camden.\nA member of the family accepts and signs for the package from the\ndelivery van driver and then leaves it in the home studio of the tourist\nwho enjoys unpacking it some time later.\nThe sorting clerk at the office in Camden neither knows nor cares about\nhow to get to the sestiere of S. Polo, Venezia.\nHis job is simply to accept packages as they arrive, and deliver them to the\ncorrect person in Camden.\nSimilarly, the postal employee in Venice has no need to worry about how\nto get to the correct address in London. His job is to accept packages from\nhis local neighborhood and forward them to the next closest hub in the\ndelivery chain.\nThis is very similar to how Internet routing works. A message is split up\ninto many individual packets, and are labelled with their source and\ndestination.\nThe computer then sends these packets to a router, which decides where\nto send them next.\nThe router needs only to keep track of a handful of routes (for example,\nhow to get to the local network, the best route to a few other local\nnetworks, and one route to a gateway to the rest of the Internet). This list\nof possible routes is called the routing table.\nAs packets arrive at the router, the destination address is examined and\ncompared against its internal routing table. 88 NETWORKING\nIf the router has no explicit route to the destination in question, it sends\nthe packet to the closest match it can find, which is often its own Internet\ngateway (via the default route).\nAnd the next router does the same, and so forth, until the packet\neventually arrives at its destination.\nPackages can only make their way through the international postal system\nbecause we have established a standardised addressing scheme for\npackages.\nFor example, the destination address must be written legibly on the front\nof the package, and include all critical information (such as the recipient's\nname, street address, city, country, and postal code). Without this\ninformation, packages are either returned to the sender or are lost in the\nsystem. Packets can only flow through the global Internet because we have\nagreed on a common addressing scheme and protocol for forwarding\npackets.\nThese standard communication protocols make it possible to exchange\ninformation on a global scale.\nuntil they reach their ultimate destination. 6. NETWORKING 89\nCooperative communications\nCommunication is only possible when the participants speak a common\nlanguage. But once the communication becomes more complex than a\nsimple conversation between two people, protocol becomes just as\nimportant as language.\nAll of the people in an auditorium may speak English, but without a set\nof rules in place to establish who has the right to use the microphone, the\ncommunication of an individual\u2019s ideas to the entire room is nearly\nimpossible. Now imagine an auditorium as big as the world, full of all of\nthe computers that exist.\nWithout a common set of communication protocols to regulate when and\nhow each computer can speak, the Internet would be a chaotic mess\nwhere every machine tries to speak at once. People have developed a\nnumber of communications frameworks to address this problem. The\nmost well-known of these is the OSI model.\nThe OSI model\nThe international standard for Open Systems Interconnection (OSI) is\ndefined by the document ISO\/IEC 7498-1, as outlined by the International\nStandards Organization and the International Electrotechnical Commission.\nThe full standard is available as publication \"ISO\/IEC 7498-1:1994,\"\navailable from http:\/\/standards.iso.org\/ittf\/PubliclyAvailableStandards\/.\nThe OSI model divides network traffic into a number of layers. Each layer\nis independent of the layers around it, and each builds on the services\nprovided by the layer below while providing new services to the layer above.\nThe abstraction between layers makes it easy to design elaborate and highly\nreliable protocol stacks, such as the ubiquitous TCP\/IP stack. A protocol\nstack is an actual implementation of a layered communications framework.\nThe OSI model doesn't define the protocols to be used in a particular\nnetwork, but simply delegates each communications \"job\" to a single layer\nwithin a well-defined hierarchy.\nWhile the ISO\/IEC 7498-1 specification details how layers should interact\nwith each other, it leaves the actual implementation details up to the\nmanufacturer. Each layer can be implemented in hardware (more common for\nlower layers) or software.\nAs long as the interface between layers adheres to the standard, implementers\nare free to use whatever means are available to build their protocol stack. 90 NETWORKING\nThis means that any given layer from manufacturer A can operate with the\nsame layer from manufacturer B (assuming the relevant specifications are\nimplemented and interpreted correctly).\nHere is a brief outline of the seven-layer OSI networking model:\nLayer Name Description\n7 Application The Application Layer is the layer that most network users are\nexposed to; it is the level at which human communication happens.\nHTTP, FTP, and SMTP are all application layer protocols.\nThe human sits above this layer, interacting with the application.\n6 Presentation The Presentation Layer deals with data representation, before it\nreaches the application. This would include HTML, MIME encoding, data\ncompression, formatting checks, byte ordering, etc.\n5 Session The Session Layer manages the logical communications session\nbetween applications. RPC is an example of a layer five protocol.\n4 Transport The Transport Layer provides a method of reaching a particular\nservice on a given network node. Examples of protocols that operate\nat this layer are TCP, UDP and SCTP. Some protocols at the transport\nlayer (such as TCP) ensure that all of the data has arrived at the destination,\nand is reassembled and delivered to the next layer in the proper order. UDP is\na \"connectionless\" protocol commonly used for video and audio streaming and\ndoesnt check arrival of data packets.\n3 Network IP (the Internet Protocol) is the most common Network Layer protocol.\nThis is the layer where routing occurs. Packets can leave the link local\nnetwork and be retransmitted on other networks. Routers perform this\nfunction on a network by having at least two network interfaces, one\non each of the networks to be interconnected. Nodes on the Internet\nare reached by their globally unique IP address. Another critical Network\nLayer protocol is ICMP, which is a special protocol which provides various\nmanagement messages needed for correct operation of IP. This layer is also\nsometimes referred to as the Internet Layer.\n2 Data Link Whenever two or more nodes share the same physical medium (for\nexample, several computers plugged into a hub, or a room full of\nwireless devices all using the same radio channel) they use the Data\nLink Layer to communicate. Common examples of data link protocols\nare Ethernet, Token Ring, ATM, and the wireless networking protocols\n(IEEE 802.11A\/B\/G). Communication on this layer is said to be link-local,\nsince all nodes connected at this layer communicate with each other directly.\nThis layer is sometimes known as the Media Access Control (MAC) layer. On\nEthernet networks, nodes are referred to by their MAC address. This is a\nunique 48-bit number assigned to every networking device when it is\nmanufactured.\n1 Physical The Physical Layer is the lowest layer in the OSI model, and refers to\nthe actual physical medium over which communicationstake place.\nThis can be a copper CAT5 cable, a fibre optic bundle, radio waves, or\njust about any other medium capable of transmitting signals. Cut wires,\nbroken fibre, and RF interference are all physical layer problems. 6. NETWORKING 91\nThe layers in this model are numbered one through seven, with seven at\nthe top. This is meant to reinforce the idea that each layer builds upon,\nand depends upon, the layers below. Imagine the OSI model as a\nbuilding, with the foundation at layer one, the next layers as successive\nfloors, and the roof at layer seven. If you remove any single layer, the\nbuilding will not stand. Similarly, if the fourth floor is on fire, then\nnobody can pass through it in either direction.\nThe first three layers (Physical, Data Link, and Network) all happen \"on\nthe network.\" That is, activity at these layers is determined by the\nconfiguration of cables, switches, routers, and similar devices. A network\nswitch can only distribute packets by using MAC addresses, so it need\nonly implement layers one and two. A simple router can route packets\nusing only their IP addresses, so it needs to implement only layers one\nthrough three. A web server or a laptop computer runs applications, so it\nmust implement all seven layers. Some advanced routers may implement\nlayer four and above, to allow them to make decisions based on the\nhigher-level information content in a packet, such as the name of a\nwebsite, or the attachments of an email.\nThe OSI model is internationally recognised, and is widely regarded as the\ncomplete and definitive network model. It provides a framework for\nmanufacturers and network protocol implementers that can be used to\nbuild networking devices which interoperate in just about any part of the\nworld. From the perspective of a network engineer or troubleshooter, the\nOSI model can seem needlessly complex. In particular, people who build\nand troubleshoot TCP\/IP networks rarely need to deal with problems at\nthe Session or Presentation layers. For the majority of Internet network\nimplementations, the OSI model can be simplified into a smaller\ncollection of five layers.\nThe TCP\/IP model\nUnlike the OSI model, the TCP\/IP model is not an international standard\nand its definitions vary. Nevertheless, it is often used as a pragmatic model\nfor understanding and troubleshooting Internet networks.\nThe vast majority of the Internet uses TCP\/IP, and so we can make some\nassumptions about networks that make them easier to understand. 92 NETWORKING\nThe TCP\/IP model of networking describes the following five layers:\nLayer Name\n5 Application\n4 Transport\n3 Internet\n2 Data Link\n1 Physical\nIn terms of the OSI model, layers five through seven are rolled into the\ntopmost layer (the Application layer). The first four layers in both models\nare identical.\nMany network engineers think of everything above layer four as \"just\ndata\" that varies from application to application.\nSince the first three layers are interoperable between virtually all\nmanufacturers' equipment, and layer four works between all hosts using\nTCP\/IP, and everything above layer four tends to apply to specific\napplications, this simplified model works well when building and\ntroubleshooting TCP\/IP networks.\nWe will use the TCP\/IP model when discussing networks in this book.\nThe TCP\/IP model can be compared to a person delivering a letter to a\ncity office building.\nThe person first needs to interact with the road itself (the Physical layer),\npay attention to other traffic on the road (the Data Link layer), turn at the\ncorrect junction to join another road and arrive at the correct address (the\nInternet layer), go to the correct floor and room number (the Transport\nlayer), and finally give it to a receptionist who can take the letter from\nthere (the Application layer).\nOnce they have delivered the message to the receptionist, the delivery\nperson is free to go on their way. The five layers can be easily remembered\nby using the mnemonic \u201cPlease Don\u2019t Look In The Attic,\u201d which of course\nstands for \u201cPhysical \/ Data Link \/ Internet \/ Transport \/ Application.\u201d 6. NETWORKING 93\nThe Internet Protocols\nTCP\/IP is the protocol stack most commonly used on the global Internet.\nThe acronym stands for Transmission Control Protocol (TCP) and\nInternet Protocol (IP), but actually refers to a whole family of related\ncommunications protocols. TCP\/IP is also called the Internet protocol\nsuite, and it operates at layers three and four of the TCP\/IP model.\nIn this discussion, we will focus on version six of the IP protocol (IPv6) as\nsince 2012 this is the version to deploy in parallel with the previous\nversion four (IPv4). In 2012, about half of the Internet content is\navailable with a better user experience by using IPv6.\nThe previous version is explained in this chapter too because some old\ncontent or old applications (Skype in 2012) still require IPv4. And indeed\nmany networks that you might have to interconnect to will still have the\nlegacy IPv4 technology deployed for some years to come.\nBesides the length of the address, IPv4 and IPv6 are quite similar: they are\nconnectionless network protocols running on the same data-link layer\n(WiFi, Ethernet...) and serving the same transport protocols (TCP, SCTP,\nUDP...) In this book, when IP is written without any version, then it\nmeans that it applies to both versions. A dual-stack network is a network\nthat runs IPv6 and IPv4 and the same time. It is expected that dual-\nnetworks will be the norm at least until 2020 when IPv6-only will\nbecome the norm.\nIPv6 Addressing\nThe IPv6 address is a 128-bit number usually written as multiple\nhexadecimal numbers. In order to make this address human-readable, it is\nwritten in chunks of 32 bits or 4 hexadecimal numbers separated by a\ncolon ':'. The hexadecimal number should be written in lowercase but can\nalso be written in uppercase. An example of an IPv6 address is:\n2001:0db8:1234:babe:0000:0000:0000:0001\nThis address corresponds to:\n2001 0db8 1234 babe 0 0 0 1 94 NETWORKING\nAs these addresses are quite long, it is common to remove the leading 0 in\neach chunk, so, the same address can also be written as:\n2001:db8:1234:babe:0:0:0:1\nThis address can further be simplified by grouping one block of\nconsecutive chunks of '0' into the abbreviated form of '::', the same\naddress becomes then:\n2001:db8:1234:babe::1\nThere are some specific IPv6 addresses:\n\u2022 ::1 (or 0000:00000:0000:0000:0000:0000:0000:0001) represents\nthe loopback address, this is the node itself when the node wants\nto send packets to itself;\n\u2022 :: (all zero) is the undetermined address, to be used by a node\nwhen it does not know its global address, for instance when it\nboots.\nIPv6 Prefixes\nIPv6 nodes on the same link or network share the same IPv6 prefix, which\nis defined as the most-significant part of the IPv6 address. The prefix\nlength is usually 64 bit on a LAN. So, our usual address of\n2001:db8:babe::1 can be written as 2001:db8:1234:babe::1\/64 (the prefix\nlength is added at the end of the address after a '\/'). Defining a prefix\nlength on an address actually splits the address in two parts: the prefix\nitself and the interface identifier (IID).\n2001 0DB8 1234 babe 0 0 0 0\nPrefix Interface Identifier\nOn a LAN or WLAN, the prefix length must be 64 bits else some\nprotocols will not work correctly. All nodes on the same LAN or WLAN\nusually share the same prefix but their IID must be unique to avoid\nconfusion.\nThe analogy with a postal address in big cities is that the street name is the 6. NETWORKING 95\nprefix and the house number is the IID.\nThe prefix length can be different on links that are neither LAN or\nWLAN. The network itself is identified by the prefix without any IID but\nwith the prefix length, for example: 2001:db8:1234:babe::\/64\nIPv4 Addressing\nIn an IPv4 network, the address is a 32-bit number, normally written as\nfour 8-bit numbers expressed in decimal form and separated by periods.\nExamples of IPv4 addresses are 10.0.17.1, 192.168.1.1, or 172.16.5.23.\nIf you enumerated every possible IPv4 address, they would range from\n0.0.0.0 to 255.255.255.255.\nThis yields a total of more than four billion possible IPv4 addresses (255 x\n255 x 255 x 255 = 4,228,250,625); although many of these are reserved\nfor special purposes and should not be assigned to hosts.\nSome IPv4 addresses that are special:\n\u2022 127.0.0.1 represents the loopback address (similar to ::1 for IPv6);\n\u2022 0.0.0.0 represents the unspecified address (similar to :: for IPv6).\nIPv4 Subnets\nBy applying a subnet mask (also called a network mask, or simply\nnetmask or even prefix) to an IPv4 address, you can logically define both a\nhost and the network to which it belongs.\nTraditionally, subnet masks are expressed using dotted decimal form,\nmuch like an IPv4 address. For example, 255.255.255.0 is one common\nnetmask. You will find this notation used when configuring network\ninterfaces, creating routes, etc. However, subnet masks are more succinctly\nexpressed using CIDR notation, which simply enumerates the number of\nbits in the mask after a forward slash (\/).\nThus, 255.255.255.0 can be simplified as \/24. CIDR is short for Classless\nInter-Domain Routing, and is defined in RFC1518. A subnet mask\ndetermines the size of a given network. Using a \/24 netmask, 8 bits are\nreserved for hosts (32 bits total - 24 bits of netmask = 8 bits for hosts).\nThis yields up to 256 possible host addresses (28 = 256). By convention,\nthe first value is taken as the network address (.0 or 00000000), and the 96 NETWORKING\nlast value is taken as the broadcast address (.255 or 11111111).\nThis leaves 254 addresses available for hosts on this network.\nSubnet masks work by applying AND logic to the 32 bit IPv4 number.\nIn binary notation, the \"1\" bits in the mask indicate the network address\nportion, and \"0\" bits indicate the host address portion. A logical AND is\nperformed by comparing two bits. The result is \"1\" if both of the bits\nbeing compared are also \"1\". Otherwise the result is \"0\".\nHere are all of the possible outcomes of a binary AND comparison\nbetween two bits.\nBit 1 Bit 2 Result\n0 0 0\n0 1 0\n1 0 0\n1 1 1\nTo understand how a netmask is applied to an IPv4 address, first convert\neverything to binary. The netmask 255.255.255.0 in binary contains\ntwenty-four \"1\" bits:\n255 255 255 0\n11111111.11111111.11111111.00000000\nWhen this netmask is combined with the IPv4 address 10.10.10.10, we\ncan apply a logical AND to each of the bits to determine the network\naddress.\n10.10.10.10: 00001010.00001010.00001010.00001010\n255.255.255.0: 11111111.11111111.11111111.00000000\n--------------------------------------------------------------------------------------\n10.10.10.0: 00001010.00001010.00001010.00000000\nThis results in the network 10.10.10.0\/24.\nThis network consists of the hosts 10.10.10.1 through 10.10.10.254, with\n10.10.10.0 as the network address and 10.10.10.255 as the broadcast\naddress.\nSubnet masks are not limited to entire octets. One can also specify subnet\nmasks like 255.254.0.0 (or \/15 CIDR). This is a large block, containing 6. NETWORKING 97\n131,072 addresses, from 10.0.0.0 to 10.1.255.255.\nIt could be further subdivided, for example into 512 subnets of 256\naddresses each. The first one would be 10.0.0.0-10.0.0.255, then 10.0.1.0-\n10.0.1.255, and so on up to 10.1.255.0-10.1.255.255. Alternatively, it\ncould be subdivided into 2 blocks of 65,536 addresses, or 8192 blocks of\n16 addresses, or in many other ways. It could even be subdivided into a\nmixture of different block sizes, as long as none of them overlap, and each\nis a valid subnet whose size is a power of two.\nWhile many netmasks are possible, common netmasks include:\nCIDR Decimal # of Hosts\n\/30 255.255.255.252 4\n\/29 255.255.255.248 8\n\/28 255.255.255.240 16\n\/27 255.255.255.224 32\n\/26 255.255.255.192 64\n\/25 255.255.255.128 128\n\/24 255.255.255.0 256\n\/16 255.255.0.0 65 536\n\/8 255.0.0.0 16 777 216\nWith each reduction in the CIDR value the IPv4 space is doubled.\nRemember that two IPv4 addresses within each network are always\nreserved for the network and broadcast addresses.\nThere are three common netmasks that have special names. A \/8 network\n(with a netmask of 255.0.0.0) defines a Class A network. A \/16\n(255.255.0.0) is a Class B, and a \/24 (255.255.255.0) is called a Class C.\nThese names were around long before CIDR notation, but are still often\nused for historical reasons.\nIn many ways as you can already see IPv6 is easier to plan for than IPv4.\nGlobal IP Addresses\nInterconnected networks must agree on an IP addressing plan for IPv6\nand IPv4 addresses. 98 NETWORKING\nIP addresses must be unique and generally cannot be used in different\nplaces on the Internet at the same time; otherwise, routers would not\nknow how best to route packets to them.\nFigure NG 3: With unique IP addresses, ambiguous global routing is\nimpossible. If the PC requests a web page from 2001:db8:1::2, it will reach\nthe correct server.\nIn order to keep IP addresses unique and globally routable, they are\nallocated by a central numbering authority that provides a consistent and\ncoherent numbering method. This ensures that duplicate addresses are not\nused by different networks.\nThe authority assigns large blocks of consecutive addresses to smaller\nauthorities, who in turn assign smaller consecutive blocks within these\nranges to other authorities, or to their customers. The groups of addresses\nare called subnets or prefixes as we have already mentioned.\nA group of related addresses is referred to as an address space.\nBoth IPv4 and IPv6 addresses are administered by the Internet Assigned\nNumbers Authority (IANA, http:\/\/www.iana.org\/).\nIANA has divided these address spaces into large subnets, and these\nsubnets are delegated to one of the five regional Internet registries (RIRs), 6. NETWORKING 99\nwho have been given authority over large geographic areas.\nIP addresses are assigned and distributed by Regional Internet Registrars\n(RIRs) to ISPs. The ISP then allocates smaller IP blocks to their clients as\nrequired. Virtually all Internet users obtain their IP addresses from an ISP.\nfive Regional Internet Registrars.\nThe five RIRs are:\n1) African Network Information Centre\n(AfriNIC, http:\/\/www.afrinic.net)\n2) Asia Pacific Network Information Centre\n(APNIC, http:\/\/www.apnic.net)\n3) American Registry for Internet Numbers\n(ARIN, http:\/\/www.arin.net)\n4) Regional Latin-American and Caribbean IP Address Registry\n(LACNIC, http:\/\/www.lacnic.net)\n5) R\u00e9seaux IP Europ\u00e9ens\n(RIPE NCC, http:\/\/www.ripe.net)\nYour ISP will assign globally routable IP address space to you from the\npool allocated to it by your RIR. 100 NETWORKING\nThe registry system assures that IP addresses are not reused in any part of the\nnetwork anywhere in the world.\nOnce IP address assignments have been agreed upon, it is possible to pass\npackets between networks and participate in the global Internet.\nThe process of moving packets between networks is called routing.\nStatic IP Addresses\nA static IP address is an address assignment that never changes.\nStatic IP addresses are important because servers using these addresses may\nhave DNS mappings pointing towards them, and typically serve\ninformation to other machines (such as email services, web servers, etc.).\nBlocks of static IP addresses may be assigned by your ISP, either by\nrequest or automatically depending on your means of connection to the\nInternet.\nDynamic IP Addresses\nDynamic IP addresses are assigned by an ISP for non-permanent nodes\nconnecting to the Internet, such as a home computer which is on a dial-\nup connection or a laptop connecting to a wireless hotspot.\nDynamic IP addresses can be assigned automatically using the Dynamic\nHost Configuration Protocol (DHCP), or the Point-to-Point Protocol\n(PPP), depending on the type of Internet connection.\nA node using DHCP first requests an IP address assignment from the\nnetwork, and automatically configures its network interface. IP addresses\ncan be assigned randomly from a pool by your ISP, or might be assigned\naccording to a policy. IP addresses assigned by DHCP are valid for a\nspecified time (called the lease time).\nThe node must renew the DHCP lease before the lease time expires. Upon\nrenewal, the node may receive the same IP address or a different one from\nthe pool of available addresses.\nWhile DHCP works for IPv6 and IPv4, IPv6 has another primary\nmechanism which is more commonly used for address assignment - it is\ncalled Stateless Address Auto-Configuration (SLAAC) which is the default\non routers and hosts running IPv6. 6. NETWORKING 101\nIt does not require a DHCP server; the router sends periodically Router\nAdvertisement (RA) messages on all connected (W)LAN's which contain\nthe 64-bit prefix to be used on that (W)LAN; hosts then generate their\n64-bit interface identifier (usually a random number or a number based\non their MAC address \u2013 see further) and build their 128-bit address by\nconcatenating the 64-bit prefix from the RA and the newly created 64-bit\nIID.\nDynamic addresses are popular with Internet Service Providers, because it\nenables them to use fewer IP addresses than their total number of\ncustomers.\nThey only need an address for each customer who is active at any one\ntime.\nGlobally routable IP addresses cost money, and there is now a shortage of\nIPv4 addresses.\nAssigning addresses dynamically allows ISPs to save money, and they will\noften charge extra to provide a static IP address to their customers.\nPrivate IPv4 addresses\nAround 2000, it became clear that there would not be enough IPv4\naddresses for everyone; this is the reason that IPv6 was specified and\ndeveloped.\nBut there was also a temporary trick as most private networks do not\nrequire the allocation of globally routable, public IPv4 addresses for every\ncomputer in the organisation.\nIn particular, computers which are not public servers do not need to be\naddressable from the public Internet.\nOrganisations typically use IPv4 addresses from the private address space\nfor machines on the internal network.\nThere are currently three blocks of private address space reserved by\nIANA: 10.0.0.0\/8, 172.16.0.0\/12, and 192.168.0.0\/16.\nThese are defined in RFC1918. These addresses are not intended to be\nrouted on the Internet, and are typically unique only within an\norganisation or group of organisations that choose to follow the same\nnumbering scheme.\nThis means that several distinct organisations can use the same addresses\nas long as they never interconnect their networks directly. 102 NETWORKING\nFigure NG 5: RFC1918 private addresses may be used within an\norganisation, and are not routed on the global Internet.\nIf you ever intend to link together private networks that use RFC1918\naddress space, be sure to use unique addresses throughout all of the\nnetworks.\nFor example, you might break the 10.0.0.0\/8 address space into multiple\nClass B networks (10.1.0.0\/16, 10.2.0.0\/16, etc.).\nOne block could be assigned to each network according to its physical\nlocation (the campus main branch, field office one, field office two,\ndormitories, and so forth).\nThe network administrators at each location can then break the network\ndown further into multiple Class C networks (10.1.1.0\/24, 10.1.2.0\/24,\netc.) or into blocks of any other logical size. 6. NETWORKING 103\nIn the future, should the networks ever be linked (either by a physical\nconnection, wireless link, or VPN), then all of the machines will be\nreachable from any point in the network without having to renumber\nnetwork devices.\nSome Internet providers may allocate private addresses like these instead of\npublic addresses to their customers, although this has serious\ndisadvantages.\nSince these addresses cannot be routed over the Internet, computers which\nuse them are not really \"part\" of the Internet, and are not directly\nreachable from it. In order to allow them to communicate with the\nInternet, their private addresses must be translated to public addresses.\nThis translation process is known as Network Address Translation (NAT),\nand is normally performed at the gateway between the private network\nand the Internet.\nWe will look at NAT in more detail later on in this chapter.\nAs there are huge numbers of IPv6 addresses, there is no need for private\nIPv6 addresses, although there are Unique Local Addresses (ULA) that are\nsuitable for non connected networks such as labs.\nDiscovering Neighbours\nImagine a network with three hosts: H , H , and H . They use the\nA B C\ncorresponding IP addresses A, B and C.\nThese hosts are part of the same subnet\/prefix.\nFor two hosts to communicate on a local network, they must determine\neach others' MAC addresses. It is possible to manually configure each host\nwith a mapping table from IP address to MAC address, but it is easier to\ndynamically discover the neighbour's MAC address through Neighbor\nDiscovery Protocol (NDP) in IPv6 and Address Resolution Protocol\n(ARP) in IPv4. NDP and ARP work in a very similar way. 104 NETWORKING\nFigure NG 6: IPv6 node A, 2001:db8::1 needs to send data to 2001:db8::3\nin the same network (2001:db8::\/64 prefix). But it must first ask for the\nMAC address that corresponds to 2001:db8::3.\nWhen using NDP, node A multicasts to some hosts the question,\n\"Who has the MAC address for the IPv6 2001:db8::3?\"\nWhen node C sees a Neighbor Solicitation (NS) for an IPv6 address of its\nown, it replies with its MAC address with a Neighbor Advertisement\n(NA) message. 6. NETWORKING 105\nFigure NG 7: IPv4 node A, 192.168.1.1, needs to send data to 192.168.1.3\nin the same subnet (192.168.1.0\/24). But it must first ask the whole network\nfor the MAC address that corresponds to 192.168.1.3.\nWhen using ARP, node A broadcasts to all hosts the question,\n\"Who has the MAC address for the IPv4 192.168.1.3?\"\nWhen node C sees an ARP request for its own IPv4 address, it replies\nwith its MAC address. Node B will also see the ARP request but will not\nreply as 192.168.1.3 is not an address of it. This is very similar to NDP\nfor IPv6 except that an IPv4 node has only a single IPv4 address.\nAlso ARP broadcasts the request, this means that it is received by all IPv4\nnodes in the network causing more host CPU utilisation than IPv6 NDP\nwhich only multicasts to some hosts. 106 NETWORKING\nIP Routing to non-Neighbours\nFigure NG 8: Two separate IPv6 networks.\nConsider now another network with 3 nodes, D, E, and F, with the\ncorresponding IPv6 addresses 2001:db8:2::1, 2001:db8:2::2, and\n2001:db8:2::3.\nThis is another \/64 network, but it is not in the same range as the network\non the left hand side.\nAll three hosts can reach each other directly (first using NDP to resolve\nthe IPv6 address into a MAC address, and then sending packets to that\nMAC address).\nNow we will add node G. This node has two network cards (also called\ninterfaces), with one plugged into each network. The first network card\nuses the IPv6 address 2001:db8:1::4, on interface eth0 and the other, eth1,\nuses 2001:db8:2::4.\nNode G is now link-local to both networks, and can forward packets\nbetween them: node G can route packets between the two networks, it is\ntherefore called a router or sometimes a gateway.\nBut what if hosts A, B, and C want to reach hosts D, E, and F? They need\nto know that they should use node G and so they will need to add a route\nto the other network via host G. For example, hosts A-C would add a\nstatic route via 2001:db8:1::4.\nIn Linux, this can be accomplished with the following command:\n# ip -6 route add 2001:db8:2::\/64 via 2001:db8:1::4 6. NETWORKING 107\n...and hosts D-F would add the following:\n# ip -6 route add 2001:db8:1::\/64 via 2001:db8:2::4\nFigure NG 9: Node G acts as a router between the two networks, other hosts\nuse static routes.\nThe result for node A is shown in Figure NG 9.\nNotice that the route is added via the IPv6 address on host G that is link-\nlocal to the respective network.\nHost A could not add a route via 2001:db8:2::4, even though it is the\nsame physical machine as 2001:db8:1::4 (node G), since that IPv6 is not\nlink-local.\nThe address of the next hop can be entered either as a global address\n(2001:db8:2::4) or as a link-local address (fe80::...); it is usually easier to\nconfigure a static route with a global address.\nIn IPv6, the router G also sends a solicitation and periodically router\nadvertisements that contain its own link-local address, hence, all nodes\nusing stateless auto-configuration or DHCP automatically add a default\nroute via the router link-local address as shown in Figure NG 10. 108 NETWORKING\nFigure NG 10: Node G acts as a router between the two networks, hosts use\nstateless address autoconfiguration.\nThis is a very simple routing example, where the destination is only a\nsingle hop away from the source. As networks get more complex, many\nhops may need to be traversed to reach the ultimate destination. Since it\nisn't practical for every machine on the Internet to know the route to\nevery other, we make use of a routing entry known as the default route\n(also known as the default gateway).\nWhen a router receives a packet destined for a network for which it has\nno explicit route, the packet is forwarded to its default gateway.\nThe default gateway is typically the best route out of your network, usually\nin the direction of your ISP.\nAn example of a router that uses a default gateway is shown in Figure NG\n11. Figure NG 11 shows the routing table (which is the set of all routes)\non the internal router G which includes the two directly connected\nnetworks 2001:db8:1::\/64 and 2001:db8:2::\/64 as well as a route to all\nother hosts on the Internet ::\/0. 6. NETWORKING 109\nA node always uses the most specific route; that is the route with the\nlongest match to the destination, in Figure NG 11 eth0 will be used for\ndestination 2001:db8:1::1 (match length \/64) rather than the less specific\n::\/0 (match length of 0).\nFigure NG 11: Node G is the internal router and uses the Internet router.\nA route tells the OS that the desired network doesn't lie on the immediate\nlink-local network, and it must forward the traffic through the specified\nrouter.\nIf host A wants to send a packet to host F, it would first send it to node\nG. Node G would then look up host F in its routing table, and see that it\nhas a direct connection to host F's network.\nFinally, host G would resolve the hardware (MAC) address of host F and\nforward the packet to it.\nRoutes can be updated manually, or can dynamically react to network\noutages and other events.\nSome examples of popular dynamic routing protocols are RIP, OSPF, BGP. 110 NETWORKING\nConfiguring dynamic routing is beyond the scope of this book, but for\nfurther reading on the subject, see the resources in Appendix F.\nIPv4 behaves exactly the same way as depicted in figure NG 12.\nFigure NG 12: Node G is the Internet router on this IPv4 network.\nAs noted before, most networks and the Internet are dual-stack and all\nhosts and routers have both IPv4 and IPv6 addresses, this also means that\nthe nodes will have routes for IPv4 and routes for IPv6. For instance, the\nset of all routes on node G of the previous figures will be:\n# netstat -rn -A inet6\nDestination Next Hop If\n2001:db8:1:\/64 :: eth0\n2001:db8:2:\/64 :: eth1\n::\/0 2001:db8:2::1 eth1\n# netstat -rn -A inet4\nDestination Gateway Genmask Iface\n192.168.1.0 0.0.0.0 255.255.255.0 eth0\n192.168.2.0 0.0.0.0 255.255.255.0 eth1\n0.0.0.0 192.168.2.1 0.0.0.0 eth1 6. NETWORKING 111\nNetwork Address Translation (NAT) for IPv4\nIn order to reach hosts on the Internet, private addresses must be\nconverted to global, publicly routable IPv4 addresses.\nThis is achieved using a technique known as Network Address Translation,\nor NAT.\nA NAT device is a router that manipulates the addresses of packets instead\nof simply forwarding them.\nOn a NAT router, the Internet connection uses one (or more) globally\nrouted IPv4 addresses, while the private network uses an IPv4 address\nfrom the RFC1918 private address range.\nThe NAT router allows the global address(es) to be shared with all of the\ninside users, who all use private addresses.\nIt converts the packets from one form of addressing to the other as the\npackets pass through it. As far as the network users can tell, they are\ndirectly connected to the Internet and require no special software or\ndrivers.\nThey simply use the NAT router as their default gateway, and address\npackets as they normally would.\nThe NAT router translates outbound packets to use the global IPv4\naddress as they leave the network, and translates them back again as they\nare received from the Internet.\nThe major consequence of using NAT is that machines from the Internet\ncannot easily reach servers within the organisation without setting up\nexplicit forwarding rules on the router.\nConnections initiated from within the private address space generally have\nno trouble, although some applications (such as Voice over IPv4 and some\nVPN software) can have difficulty dealing with NAT. 112 NETWORKING\naddress with many internal hosts, but can make it difficult for some services to\nwork properly.\nDepending on your point of view, this can be considered a bug (since it\nmakes it harder to set up two-way communication) or a feature. RFC1918\naddresses should be filtered on the edge of your network to prevent\naccidental or malicious RFC1918 traffic entering or leaving your network.\nWhile NAT performs some firewall-like functions, it is not a replacement for\na real firewall as most of the attacks happen now when an internal user visits\nsome web sites with hostile content (called malware for malevolent software).\nInternet Protocol Suite\nMachines on the Internet use the Internet Protocol (IP) to reach each other,\neven when separated by many intermediary machines.\nThere are a number of protocols that are run in conjunction with IP that\nprovide features which are as critical to normal operations as IP itself. Every\npacket specifies a protocol number that identifies the packet as one of these\nprotocols. 6. NETWORKING 113\nThe most commonly used protocols are the Transmission Control Protocol\n(TCP, number 6), User Datagram Protocol (UDP, number 17), and the\nInternet Control Message Protocol (ICMP, number 1 for IPv4 and\nnumber 58 for IPv6). Taken as a group, these protocols (and others) are\nknown as the Internet Protocol Suite, or simply TCP\/IP for short.\nThe TCP and UDP protocols introduce the concept of port numbers.\nPort numbers allow multiple services to be run on the same IP address,\nand still be distinguished from each other. Every packet has a source and\ndestination port number. Some port numbers are well-defined standards,\nused to reach well-known services such as email and web servers. For\nexample, web servers normally listen on TCP port 80 for insecure traffic\nand on TCP port 443 for encrypted\/secure traffic, NTP time servers listen\non UDP port 123, DNS domain name servers listen on UDP port 53,\nand SMTP email servers listen on TCP port 25.\nWhen we say that a service \"listens\" on a port (such as port 80), we mean\nthat it will accept packets that use its IP as the destination IP address, and\n80 as the destination port.\nServers usually do not care about the source IP or source port, although\nsometimes they will use them to establish the identity of the other side.\nWhen sending a response to such packets, the server will use its own IP as\nthe source IP, and 80 as the source port.\nWhen a client connects to a service, it may use any source port number\non its side that is not already in use, but it must connect to the proper\nport on the server (e.g. 80 for web, 25 for email).\nTCP is a session-oriented protocol with guaranteed and ordered delivery\nand transmission control features (such as detection and mitigation of\nnetwork congestion, retries, packet reordering and reassembly, etc.).\nUDP is designed for connectionless streams of information, and does not\nguarantee delivery at all, or in any particular order but can be faster so it\nis often used for real-time protocols such as for timing, voice or video.\nThe ICMP protocol is designed for debugging and maintenance on the\nInternet.\nRather than port numbers, it has message types, which are also numbers.\nDifferent message types are used to request a simple response from 114 NETWORKING\nanother computer (echo request), notify the sender of another packet of a\npossible routing loop (time exceeded), or inform the sender that a packet\nthat could not be delivered due to firewall rules or other problems\n(destination unreachable).\nBy now you should have a solid understanding of how computers on the\nnetwork are addressed, and how information flows on the network\nbetween them.\nNow let's take a brief look at the physical hardware that implements these\nnetwork protocols.\nPhysical hardware\nEthernet\nEthernet is the name of the most popular standard for connecting\ntogether computers on a Local Area Network (LAN). It is sometimes used\nto connect individual computers to the Internet, via a router, ADSL modem,\nor wireless device.\nHowever, if you connect a single computer to the Internet, you may not use\nEthernet at all.\nThe name comes from the physical concept of the ether, the medium\nwhich was once supposed to carry light waves through free space. The\nofficial standard is called IEEE 802.3.\nOne widely deployed Ethernet standard is called 100baseT also known as\nFast Ethernet.\nThis defines a data rate of 100 Megabits per second (hence the 100),\nrunning over twisted (hence the T) pair wires, with modular RJ-45\nconnectors on the end.\nThe network topology is a star, with switches or hubs at the centre of each\nstar, and end nodes (devices and additional switches) at the edges. Servers\nare also connected using Gigabit Ethernet with a rate of 1 Gigabit per\nsecond.\nIncreasingly Gigabit Ethernet is replacing Fast Ethernet in many networks\nthese days as demand for high volume video and other high data rate\napplications become more prevalent. 6. NETWORKING 115\nMedium Access Control (MAC) addresses\nEvery device connected to an Ethernet or WiFi network has a unique\nMAC address, assigned by the manufacturer of the network card. It serves\nas a unique identifier that enables devices to talk to each other. However,\nthe scope of a MAC address is limited to a broadcast domain, which is\ndefined as all the computers connected together by wires, hubs, switches,\nand bridges, but not crossing routers or Internet gateways.\nMAC addresses are never used directly on the Internet, and are not\ntransmitted across routers.\nMAC addresses for Ethernet and IEEE 802.11 WiFi networks are 48 bits\nlong and look like this - 00:1c:c0:17:78:8c or 40:6c:8f:52:59:41; for the\nlatter MAC address, the first 24 bits 40:6c:8f indicates that Apple assigned\nthis address.\nHubs\nEthernet hubs connect multiple twisted-pair Ethernet devices together.\nThey work at the physical layer (the lowest or first layer). They repeat the\nsignals received by each port out to all of the other ports. Hubs can\ntherefore be considered to be simple repeaters.\nDue to this design, only one port can successfully transmit at a time. If\ntwo devices transmit at the same time, they corrupt each other's\ntransmissions, and both must back off and retransmit their packets later.\nThis is known as a collision, and each host remains responsible for\ndetecting and avoiding collisions before transmitting, and retransmitting\nits own packets when needed.\nWhen problems such as excessive collisions are detected on a port, some\nhubs can disconnect (partition) that port for a while to limit its impact on\nthe rest of the network.\nWhile a port is partitioned, devices attached to it cannot communicate\nwith the rest of the network.\nHubs are limited in their usefulness, since they can easily become points\nof congestion on busy networks so they are no longer normally deployed\nin networks nowadays. Its only important to note that a WiFi access point\nacts as a hub on the radio side. 116 NETWORKING\nSwitches\nA switch is a device which operates much like a hub, but provides a\ndedicated (or switched) connection between ports.\nRather than repeating all traffic on every port, the switch determines\nwhich ports are communicating directly and temporarily connects them\ntogether. There can be several such temporary port connections at the\nsame time.\nSwitches generally provide much better performance than hubs, especially\non busy networks with many computers. They are not much more\nexpensive than hubs, and are replacing them in most situations.\nSwitches work at the data link layer (the second layer), since they interpret\nand act upon the MAC address in the packets they receive. When a packet\narrives at a port on a switch, it makes a note of the source MAC address,\nwhich it associates with that port. It stores this information in an internal\nMAC table often known as Content Addressable Memory (CAM) table. The\nswitch then looks up the destination MAC address in its MAC table, and\ntransmits the packet only on the matching port. If the destination MAC\naddress is not found in the MAC table, the packet is then sent to all of the\nconnected interfaces hoping to reach the right MAC.\nHubs vs. Switches\nHubs are considered to be fairly unsophisticated devices, since they\ninefficiently rebroadcast all traffic on every port. This simplicity introduces\nboth a performance penalty and a security issue. Overall performance is\nslower, since the available bandwidth must be shared between all ports.\nSince all traffic is seen by all ports, any host on the network can easily\nmonitor all of the network traffic.\nSwitches create temporary virtual connections between receiving and\ntransmitting ports. This yields better performance because many virtual\nconnections can be made simultaneously. More expensive switches can\nswitch traffic by inspecting packets at higher levels (at the transport or\napplication layer), allowing the creation of VLANs, and implementing\nother advanced features.\nA hub can be used when repetition of traffic on all ports is desirable; for\nexample, when you want to explicitly allow a monitoring machine to see\nall of the traffic on the network. Most switches provide monitor port\nfunctionality that enables repeating on an assigned port specifically for this\npurpose. 6. NETWORKING 117\nHubs were once cheaper than switches. However, the price of switches has\nreduced dramatically over the years. Therefore, old network hubs should\nbe replaced whenever possible with new switches.\nFigure NG 14: A hub simply repeats all traffic on every port, while a switch\nmakes a temporary, dedicated connection between the ports that need to\ncommunicate.\nBoth hubs and switches may offer managed services.\nSome of these services include the ability to set the link speed (10baseT,\n100baseT, 1000baseT, full or half-duplex) per port, enable triggers to\nwatch for network events (such as changes in MAC address or malformed\npackets), and usually include port counters for easy bandwidth\naccounting.\nA managed switch that provides upload and download byte counts for\nevery physical port can greatly simplify network monitoring.\nThese services are typically available via SNMP, or they may be accessed\nvia telnet, ssh, a web interface, or a custom configuration tool.\nRouters and Firewalls\nWhile hubs and switches provide connectivity on a local network\nsegment, a router's job is to forward packets between different network\nsegments.\nA router typically has two or more physical network interfaces. 118 NETWORKING\nIt may include support for different types of network media, such as\nEthernet, WiFi, optical fibre, DSL, or dial-up.\nRouters can be dedicated hardware devices or they can be made from a\nstandard PC with multiple network cards and appropriate software.\nRouters sit at the edge of two or more networks. By definition, they have\none connection to each network, and as border machines they may take\non other responsibilities as well as routing. Many routers have firewall\ncapabilities that provide a mechanism to filter or redirect packets that do\nnot fit security or access policy requirements.\nThey may also provide Network Address Translation (NAT) services for\nIPv4.\nRouters vary widely in cost and capabilities.\nThe lowest cost and least flexible are simple, dedicated hardware devices,\noften with NAT functionality, used to share an Internet connection\nbetween a few computers; well known brands include Linksys, D-Link,\nNetgear.\nThe next step up is a software router, which consists of an operating\nsystem running on a standard PC with multiple network interfaces.\nStandard operating systems such as Microsoft Windows, Linux, and BSD\nare all capable of routing, and are much more flexible than the low-cost\nhardware devices; it is often called Internet Connection Sharing.\nHowever, they suffer from the same problems as conventional PCs, with\nhigh power consumption, a large number of complex and potentially\nunreliable parts, and more involved configuration.\nThe most expensive devices are high-end dedicated hardware routers,\nmade by companies like Cisco and Juniper.\nThey tend to have much better performance, more features, and higher\nreliability than software routers on PCs.\nIt is also possible to purchase technical support and maintenance contracts\nfor them.\nMost modern routers offer mechanisms to monitor and record\nperformance remotely, usually via the Simple Network Management\nProtocol (SNMP), although the least expensive devices often omit this\nfeature. 6. NETWORKING 119\nOther equipment\nFigure NG 15: Many DSL modems, cable modems, wireless access points, and\nVSAT terminals terminate at an Ethernet jack.\nEach physical network has an associated piece of terminal equipment. For\nexample, VSAT connections consist of a satellite dish connected to a\nterminal that either plugs into a card inside a PC, or ends at a standard\nEthernet connection. DSL lines use a DSL modem that bridges the\ntelephone line to a local device, either an Ethernet network or a single\ncomputer via USB. Cable modems bridge the television cable to Ethernet,\nor to an internal PC card bus.\nStandard dialup lines use modems to connect a computer to the\ntelephone, usually via a plug-in card or serial port. And there are many\ndifferent kinds of wireless networking equipment that connect to a variety\nof radios and antennas, but nearly always end at an Ethernet jack. The\nfunctionality of these devices can vary significantly between\nmanufacturers. Some provide mechanisms for monitoring performance,\nwhile others may not. 120 NETWORKING\nSince your Internet connection ultimately comes from your ISP, you\nshould follow their recommendations when choosing equipment that\nbridges their network to your Ethernet network.\nPutting it all together\nFigure NG 16: Internet networking. Each network segment has a router with\ntwo IP addresses, making it \u201clink local\u201d to two different networks. Packets are\nforwarded between routers until they reach their ultimate destination.\nOnce all network nodes have an IP address, they can send data packets to\nthe IP address of any other node. Through the use of routing and\nforwarding, these packets can reach nodes on networks that are not\nphysically connected to the originating node. This process describes much\nof what \u201chappens\u201d on the Internet.\nIn this example, you can see the path that the packets take as Alice chats\nwith Bob using an instant messaging service.\nEach dotted line represents an Ethernet cable, a wireless link, or any other\nkind of physical network.\nThe cloud symbol is commonly used to stand in for \u201cThe Internet\u201d, and\nrepresents any number of intervening IP networks. 6. NETWORKING 121\nNeither Alice nor Bob need to be concerned with how those networks\noperate, as long as the routers forward IP traffic towards the ultimate\ndestination.\nIf it weren\u2019t for Internet protocols and the cooperation of everyone on the\nnet, this kind of communication would be impossible.\nIn Figure NG 16, Alice is dual-stack and has IPv4 and IPv6 addresses,\nand as Bob has only IPv6 addresses, they will communicate by using IPv6\nwhich is the common IP version between them.\nDesigning the physical network\nIt may seem odd to talk about the \u201cphysical\u201d network when building\nwireless networks.\nAfter all, where is the physical part of the network? In wireless networks,\nthe physical medium we use for communication is obviously\nelectromagnetic energy.\nBut in the context of this chapter, the physical network refers to the\nmundane topic of where to put things. How do you arrange the\nequipment so that you can reach your wireless clients?\nWhether they fill an office building or stretch across many miles, wireless\nnetworks are naturally arranged in these three logical configurations:\npoint-to-point links, point-to-multipoint links, and multipoint-to-\nmultipoint clouds. While different parts of your network can take\nadvantage of all three of these configurations, any individual link will fall\ninto one of these topologies.\nPoint-to-point\nPoint-to-point links typically provide an Internet connection where such\naccess isn\u2019t otherwise available. One side of a point-to-point link will have\nan Internet connection, while the other uses the link to reach the Internet.\nFor example, a university may have a fast frame relay or VSAT connection\nin the middle of campus, but cannot afford such a connection for an\nimportant building just off campus. If the main building has an\nunobstructed view of the remote site, a point-to-point connection can be\nused to link the two together. This can augment or even replace existing\ndial-up links. With proper antennas and clear line of sight, reliable point-\nto-point links in excess of thirty kilometres are possible. 122 NETWORKING\nFigure NG 17: A point-to-point link allows a remote site to share a central\nInternet connection.\nOf course, once a single point-to-point connection has been made, more\ncan be used to extend the network even further. If the remote building in\nour example is at the top of a tall hill, it may be able to see other\nimportant locations that can\u2019t be seen directly from the central campus. By\ninstalling another point-to-point link at the remote site, another node can\njoin the network and make use of the central Internet connection.\nPoint-to-point links don\u2019t necessarily have to involve Internet access.\nSuppose you have to physically drive to a remote weather monitoring\nstation, high in the hills, in order to collect the data which it records over\ntime. You could connect the site with a point-to-point link, allowing data\ncollection and monitoring to happen in realtime, without the need to\nactually travel to the site.\nWireless networks can provide enough bandwidth to carry large amounts\nof data (including audio and video) between any two points that have a\nconnection to each other, even if there is no direct connection to the\nInternet.\nPoint-to-multipoint\nThe next most commonly encountered network layout is point-to-\nmultipoint. Whenever several nodes are talking to a central point of\naccess, this is a point-to-multipoint application. The typical example of a\npoint-to-multipoint layout is the use of a wireless access point that\nprovides a connection to several laptops. The laptops do not communicate\nwith each other directly, but must be in range of the access point in order\nto use the network. 6. NETWORKING 123\nFigure NG 18: The central VSAT is now shared by multiple remote sites. All\nthree sites can also communicate directly at speeds much faster than VSAT.\nPoint-to-multipoint networking can also apply to our earlier example at\nthe university. Suppose the remote building on top of the hill is connected\nto the central campus with a point-to-point link.\nRather than setting up several point-to-point links to distribute the\nInternet connection, a single antenna could be used that is visible from\nseveral remote buildings. This is a classic example of a wide area point\n(remote site on the hill) to multipoint (many buildings in the valley\nbelow) connection.\nNote that there are a number of performance issues with using point-to-\nmultipoint over very long distance, which will be addressed in the chapter\ncalled Deployment Planning. Such links are possible and useful in many\ncircumstances, but don\u2019t make the classic mistake of installing a single\nhigh powered radio tower in the middle of town and expecting to be able\nto serve thousands of clients, as you would with an FM radio station. As\nwe will see, two-way data networks behave very differently than broadcast\nradio.\nMultipoint-to-multipoint\nThe third type of network layout is multipoint-to-multipoint, which is\nalso referred to as an ad-hoc or mesh network. In a multipoint-to-\nmultipoint network, there is no central authority. Every node on the\nnetwork carries the traffic of every other as needed, and all nodes\ncommunicate with each other directly. 124 NETWORKING\nother at very high speed, or any of them can use the central access point for a\nVSAT connection to the Internet.\nThe benefit of this network layout is that even if none of the nodes are in\nrange of a central access point, they can still communicate with each\nother.\nGood mesh network implementations are self-healing, which means that\nthey automatically detect routing problems and fix them as needed.\nExtending a mesh network is as simple as adding more nodes.\nIf one of the nodes in the \"cloud\" happens to be an Internet gateway,\nthen that connection can be shared among all of the clients.\nSeveral disadvantages of this topology include increased complexity and\nlower performance.\nSecurity in such a network is also a concern, since every participant\npotentially carries the traffic of every other.\nMultipoint-to-multipoint networks tend to be difficult to troubleshoot,\ndue to the large number of changing variables as nodes join and leave the\nnetwork.\nMultipoint-to-multipoint clouds typically have reduced capacity compared\nto point-to-point or point-to-multipoint networks, due to the additional\noverhead of managing the network routing and increased contention in\nthe radio spectrum.\nNevertheless, mesh networks are useful in many circumstances.\nFor more information about them please read the chapter called Mesh\nNetworking. 6. NETWORKING 125\nUse the technology that fits\nAll of these network designs can be used to complement each other in a\nlarge network, and additionally they can make use of traditional wired\nnetworking techniques whenever possible. Wired networks still often have\nhigher bandwidth capacity than wireless so should be used whenever\nappropriate or affordable.\nBut looking at the wireless, it is a common practice, for example, to use a\nlong distance wireless link to provide Internet access to a remote location,\nand then set up an access point on the remote side to provide local\nwireless access. One of the clients of this access point may also act as a\nmesh node, allowing the network to spread organically between laptop\nusers who all ultimately use the original point-to-point link to access the\nInternet.\nThis is just one common scenario for wireless deployments, there are\nmany others.\nNow that we have a clear idea of how wireless networks are typically\narranged, we can begin to understand how communication is possible over\nsuch networks. 126 NETWORKING\n7. WIFI FAMILY\nIEEE 802: What is it, and why should I care?\nThe early days of networking only saw wireline networks (if you don't\ncount the old AT&T Long lines microwave backbone that at one time\ncrossed the United States) Now many networks are built using both\nwireline and wireless solutions. Typically networks based on wires or more\nusually these days, fibres have greater capacity than wireless.\nBut laying fibre is much more expensive and takes time. So often networks\nbegin as wireless networks and as they grow in use, fibre based networks\nstart to be deployed. In access networks (those near the consumers) or in\ndense urban environments, often wireless is more practical too. So very\nimportantly as you begin to think about deploying wireless networks in\nyour local area or community, your network could form the basis of the\nfuture growth of networking in your region.\nAn aspect of wired and wireless networks important to understand is the\nvarious standards that exist today as well as those new standards that are\nbeing developed. Wireless standards are the basis for many wireless\nproducts, ensuring interoperability and useability by those who design,\ndeploy and manage wireless networks. We touched on this subject already\nin the chapter called Radio Spectrum. The Standards used in the vast\nmajority of the networks come from the IEEE Standard Association's\nIEEE 802 Working Group. IEEE 802 refers to a family of IEEE standards\ndealing with local area networks and metropolitan area networks.\nMore specifically, the IEEE 802 standards are restricted to networks\ncarrying variable-size packets. (By contrast, in cell relay networks data is\ntransmitted in short, uniformly sized units called cells). The number 802\nwas simply the next free number IEEE could assign, though \u201c802\u201d is\nsometimes associated with the date the first meeting was held \u2014 February\n1980. The services and protocols specified in IEEE 802 map to the lower\ntwo layers (Data Link and Physical) of the seven-layer OSI networking\nreference model. In fact, IEEE 802 splits the OSI Data Link Layer into\ntwo sub-layers named Logical Link Control (LLC) and Media Access\nControl (MAC). 7. WIFI FAMILY 127\nThe IEEE 802 family of standards is maintained by the IEEE 802\nLAN\/MAN Standards Committee (LMSC).\nThe most widely used standards are for the Ethernet family, Token\nRing, Wireless LAN, Bridging and Virtual Bridged LANs.\nAn individual Working group provides the focus for each area and they are\nlisted in the table below.\nName Description\nIEEE 802.1 Bridging and Network Management\nIEEE 802.3 Ethernet\nIEEE 802.11 a\/b\/g\/n Wireless LAN (WLAN)\nIEEE 802.15 Wireless PAN\nIEEE 802.15.1 Bluetooth certification\nIEEE 802.15.2 IEEE 802.15 and IEEE 802.11 coexistence\nIEEE 802.15.3 High-Rate wireless PAN\nIEEE 802.15.4 Low-Rate wireless PAN eg. Zigbee\nIEEE 802.15.5 Mesh networking for WPAN\nIEEE 802.15.6 Body Area Network\nIEEE 802.16 Broadband Wireless Access (basis of WiMAX )\nIEEE 802.16.1 Local Multipoint Distribution Service\nIEEE 802.18 Radio Regulatory TAG\nIEEE 802.19 Coexistence TAG\nIEEE 802.20 Mobile Broadband Wireless Access\nIEEE 802.21 Media Independent Handoff\nIEEE 802.22 Wireless Regional Area Network\nIEEE 802.23 Emergency Services Working Group\nIEEE 802.24 Smart Grid TAG\nIEEE 802.25 Omni-Range Area Network 128 NETWORKING\nThe 802.11 standard\nThe standard we are most interested in is 802.11 as it defines the protocol\nfor Wireless LAN.\nThe 802.11 Amendments are so numerous they have in the last few years\nstarted using 2 letters instead of 1. (802.11z - the DLS amendment -\ngave way to 802.11aa, ab, ac..., etc)\nBelow is a table of the variants of 802.11, their frequencies and\napproximate ranges.\n802.11 Release Freq. Bandwi Data Rate per Approximate Approximate\nprotocol dth stream indoor range outdoor range\n(GHz) (MHz) (Mbit\/s) (m) (ft) (m) (ft)\n- Jun 1997 2.4 20 1, 2 20 66 100 330\na Sep 1999 5 20 6,9,12, 18, 24, 35 115 120 390\n36, 48, 54\nb Sep 1999 2.4 20 1, 2, 5.5, 11 35 115 140 460\ng Jun 2003 2.4 20 6,9,12, 18, 24, 38 125 140 460\n36, 48, 54\nn 20 7.2, 14.4, 21.7, 70 230 250 820\nOct 2009 2.4\/5 28.9, 43.3, 57.8,\n65, 72.2\n40 15, 30, 45, 60 ,\n90, 120, 135, 150\nac Nov.2011 5 20 Up to 87.6\n40 Up to 200\n80 Up to 433.3\n160 Up to 866.7\nIn 2012 IEEE issued the 802.11-2012 Standard that consolidates all the\nprevious amendments.\nThe document is freely downloadable from:\nhttp:\/\/standards.ieee.org\/findstds\/standard\/802.11-2012.html 7. WIFI FAMILY 129\nDeployment planning for 802.11 wireless networks\nBefore packets can be forwarded and routed to the Internet, layers one\n(the physical) and two (the data link) need to be connected. Without link\nlocal connectivity, network nodes cannot talk to each other and route\npackets.\nTo provide physical connectivity, wireless network devices must operate in\nthe same part of the radio spectrum.\nThis means that 802.11a radios will talk to 802.11a radios at around 5\nGHz, and 802.11b\/g radios will talk to other 802.11b\/g radios at around\n2.4 GHz.\nBut an 802.11a device cannot interoperate with an 802.11b\/g device,\nsince they use completely different parts of the electromagnetic spectrum.\nMore specifically, wireless interfaces must agree on a common channel. If\none 802.11b radio card is set to channel 2 while another is set to channel\n11, then the radios cannot communicate with each other.\nThe centre frequencies of each channel for 802.11a and 802b\/g are given\nin Appendix B: Channel Allocations.\nWhen two wireless interfaces are configured to use the same protocol on\nthe same radio channel, then they are ready to negotiate data link layer\nconnectivity. Each 802.11a\/b\/g device can operate in one of four possible\nmodes:\n1. Master mode (also called AP or infrastructure mode) is used to\ncreate a service that looks like a traditional access point. The wireless\ninterface creates a network with a specified name (called the SSID)\nand channel, and offers network services on it. While in master\nmode, wireless interfaces manage all communications related to the\nnetwork (authenticating wireless clients, handling channel\ncontention, repeating packets, etc.) Wireless interfaces in master\nmode can only communicate with interfaces that are associated with\nthem in managed mode.\n2. Managed mode is sometimes also referred to as client mode.\nWireless interfaces in managed mode will join a network created by\na master, and will automatically change their channel to match it.\nThey then present any necessary credentials to the master, and if\nthose credentials are accepted, they are said to be associated with the\nmaster. Managed mode interfaces do not communicate with each\nother directly, and will only communicate with an associated master. 130 NETWORKING\n3. Ad-hoc mode creates a multipoint-to-multipoint network where\nthere is no single master node or AP. In ad-hoc mode, each wireless\ninterface communicates directly with its neighbours.\nNodes must be in range of each other to communicate, and must\nagree on a network name and channel. Ad-hoc mode is often also\ncalled Mesh Networking and you can find details of this type of\nnetworking in the chapter called Mesh Networking.\n4. Monitor mode is used by some tools (such as Kismet) to passively\nlisten to all radio traffic on a given channel. When in monitor mode,\nwireless interfaces transmit no data. This is useful for analysing\nproblems on a wireless link or observing spectrum usage in the local\narea. Monitor mode is not used for normal communications.\nFigure WF 1: APs, Clients, and Ad-Hoc nodes.\nWhen implementing a point-to-point or point-to-multipoint link, one\nradio will typically operate in master mode, while the other(s) operate in\nmanaged mode. In a multipoint-to-multipoint mesh, the radios all\noperate in ad-hoc mode so that they can communicate with each other\ndirectly.\nIt is important to keep these modes in mind when designing your\nnetwork layout. 7. WIFI FAMILY 131\nRemember that managed mode clients cannot communicate with each\nother directly, so it is likely that you will want to run a high repeater site\nin master or ad-hoc mode.\nAd-hoc is more flexible but has a number of performance issues as\ncompared to using the master \/ managed modes.\nThe 802.22 Standard\nDid you ever wonder why one of the biggest users of wireless spectrum in\nalmost any country on earth, never got into the 2 way communications\nbusiness? No? Well, you ask, why did the Television Broadcast Industry\nnever want to do two-way communications.\nThe simple answer is that this was not the business they were in.\nWhat they did instead was get access to and use of the best \"beach front\"\nspectrum between DC and day light.. and almost for free to boot.\nAs analogue TV gets replaced by digital TV, some of that beach front\nspectrum is being made available for wireless networking. And in parts of\nthe world where TV has been deployed less extensively, these same parts\nof the radio spectrum are available for wireless networking as well.\nThe new wireless technology is commonly called TVWS (TV White\nSpaces) and although relatively new at the time of writing, this technology\nis in many trials for rural broadband wireless.\nFrom wikipedia -\nIEEE 802.22, known informally as Super Wi-Fi, is a standard for Wireless\nRegional Area Networks (WRAN) using white spaces in the TV frequency\nspectrum.\nThe development of the IEEE 802.22 WRAN standard is aimed at using\ncognitive radio (CR) techniques to allow sharing of geographically unused\nspectrum allocated to the Television Broadcast Service, on a non-\ninterfering basis, to bring broadband access to hard-to-reach, low\npopulation density areas, typical of rural environments, and is therefore\ntimely and has the potential for a wide applicability worldwide.\nIEEE 802.22 WRANs are designed to operate in the TV broadcast bands\nwhile assuring that no harmful interference is caused to the incumbent\noperation, i.e., digital TV and analog TV broadcasting, and low power\nlicensed devices such as wireless microphones. The standard was finally\npublished in July 2011. 132 NETWORKING\nTechnology of 802.22 or TVWS\nThe initial drafts of the 802.22 standard specify that the network should\noperate in a point to multipoint topology (p2m). The system will be\nformed by Base Stations (BS) and Customer Premise Equipment (CPE).\nThe CPEs will be attached to a BS via a wireless link.\nOne key feature of the 802.22 WRAN Base Stations is that they will be\ncapable of performing sensing of available spectrum.\nThe Institute of Electrical and Electronic Engineers (IEEE), together with\nthe FCC, in the US, pursued a centralised approach for available spectrum\ndiscovery.\nSpecifically each Base Station (BS) would be armed with a GPS receiver\nwhich would allow its position to be reported.\nThis information would be sent back to centralised servers which would\nrespond with the information about available free TV channels and guard\nbands in the area of the Base Station.\nOther proposals would allow local spectrum sensing only, where the BS\nwould decide by itself which channels are available for communication.\nThis is called distributed sensing.\nThe CPEs will be sensing the spectrum and sending periodic reports to\nthe BS informing it about what they sense. The BS, with the information\ngathered, will evaluate whether a change is necessary in the channel used,\nor on the contrary, if it should stay transmitting and receiving in the same\none. A combination of these two approaches is also envisioned.\nThese sensing mechanisms are primarily used to identify if there is an\nincumbent transmitting, and if there is a need to avoid interfering with it.\nThis means that the physical layer must be able to adapt to different\nconditions and be flexible in jumping from channel to channel without\nerrors in transmission or losing clients (CPEs).\nThis flexibility is also required for dynamically adjusting the bandwidth,\nmodulation and coding schemes. OFDMA (Orthogonal Frequency-Division\nMultiple Access) is the modulation scheme for transmission in up and\ndownlinks. With OFDMA it will be possible to achieve this fast\nadaptation needed for the BSs and CPEs. 7. WIFI FAMILY 133\nBy using just one TV channel (a TV channel has a bandwidth of 6 MHz,\nin some countries they can be 7 or 8 MHz) the approximate maximum bit\nrate is 19 Mbit\/s at a 30 km distance.\nThe speed and distance achieved is not enough to fulfill the requirements\nof the standard.\nThere is a feature called Channel Bonding which deals with this problem.\nChannel Bonding uses more than one channel for transmit\/receive. This\nallows the system to have higher bandwidth which will be reflected in a\nbetter system performance.\nSummary\nAs we can see the standards for wireline and wireless are mostly\nincorporated into the IEEE 802 Working Group.\nAt the moment the 802.11 family of WiFi standards and equipment are\nby far and away the most widely manufactured and deployed in indoor\nand outdoor wireless links.\nThe chapter called Hardware Selection and Configuration looks at\nequipment in much more detail.\nThe new 802.22 Standard is expected to play an increasing role in many\nrural (and urban) wireless networks. The free-ing up of unlicensed\nspectrum currently used by broadcast TV will enable this to happen. As\nyet the standards and the various groups involved in this standard are in\ntheir infancy, as are the bodies around the world involved in spectrum re-\nallocation. Available equipment is still very new and deployments are few\nand far between. In the next 2-3 years it is anticipated that this will\nchange significantly and the next revision of this book may well have case\nstudies and deployment information to share with respect to 802.22 based\nnetworks. Meanwhile there is an interesting project underway in Scotland,\nUnited Kingdom which is deploying TVWS 802.22 networks.\nYou can read more about the project here:\nhttp:\/\/www.wirelesswhitespace.org\/projects.aspx 134 NETWORKING\n8. MESH NETWORKING\nIntroduction\nMesh networks are based on multipoint-to-multipoint (m2m) networking.\nIn the nomenclature of IEEE 802.11, m2m networking is referred to as\n'ad-hoc' or 'IBSS' mode.\nMost wireless networks today are based on point-to-point (p2p) or point-\nto-multipoint (p2m) communication.\nFigure MN 1: A metropolitan area mesh network, providing local connectivity\nand Internet access via multiple Internet gateways\nA typical wireless hotspot operates in p2m infrastructure mode - it\nconsists of an access point (with a radio operating in master mode),\nattached to a DSL line or other large scale wired network.\nIn a hotspot the access point acts as a master station that is distributing\nInternet access to its clients. 8. MESH NETWORKING 135\nThis hub-and-spoke topology is also typically used for the mobile phone\n(2G or 3G) service.\nMobile phones connect to a base station p2m - without the presence of a\nbase station mobiles can't communicate with each other.\nIf you make a joke call to a friend that is sitting on the other side of the\ntable, your phone sends data to the base station of your provider that may\nbe a mile away - the base station then sends data back to the phone of\nyour friend.\nIn a remote area without base stations a GSM phone is useless as a\ncommunication device, simply because GSM radios are designed in such a\nway that they can not communicate directly with each other.\nThis is unlike analog radio sets that can communicate m2m with each\nother as long as they are within range.\nWireless radio is by default a broadcast medium, and any station which\ncan transmit and receive could communicate m2m.\nWith regards to the technological challenge, implementing m2m\nnetworking is much more demanding then p2m and p2p.\nStrategies to implement channel access coordination are more complex, for\nexample, there is no central authority to assign transmit time slots.\nBecause there is no central management, m2m stations need to mutally\nagree on cell coordination parameters such as the MAC like cell-id of the\nwireless cell.\nThe fact that 802.11 names the m2m mode of WiFi \"ad-hoc\" suggests that\nthe IEEE board thought of a m2m network as a spontaneous, provisional,\nsub-optimal solution.\nMultipoint-to-multipoint communication is actually more versatile and\ncan be much more efficient than point-to-point or point-to-multipoint\ncommunication: m2m communication includes the ability to\ncommunicate p2p and p2m, because p2p and p2m are just subsets of\nm2m. 136 NETWORKING\nA network consisting of just two multipoint-to-multipoint capable devices\nsimply communicates p2p:\nA--B\nA network of three mesh-capable devices A, B, C can form a topology like\nthis, for example:\nA--B--C\nHere A can communicate only with B. C can only communicate with B,\nwhile B can communicate with A and C. B actually does communicate\np2m. Without routing, A and C can not communicate with each other in\n802.11 ad-hoc mode.\nBy adding a routing protocol A can automatically learn that behind B\nthere is C and vice versa, and that B can be utilised as a communication\nrelay so all nodes can communicate with each other. In this case B will act\nsimilarly to an access point in 802.11 infrastructure mode. WiFi cards\nconfigured as infrastructure clients can't communicate directly, so they\nwould always need the access point B as a relay.\nIf the three devices move around, the topology might become a full mesh,\nwhere every node can communicate with every other node directly:\nA\n\/ \\\nB----C\nIn this case relaying traffic is not necessary, given that the links are all\ngood enough. In infrastructure mode, communicating directly is not\npossible. All the traffic between clients has to be relayed by the access\npoint. If we now add D to the little chain topology example, all devices\ncan communicate with each other if this is a mesh.\nA--B--C--D\nOn the other hand, this would not be possible if the network is an\ninfrastructure mode network and B is an access point. C and D would\nboth be infrastructure clients, and as already mentioned before,\ninfrastructure clients can not communicate directly with each other. 8. MESH NETWORKING 137\nSo client D could not join the infrastructure network because it is out of\nrange of the access point B, while it would be still in the radio range of\nclient C.\nBandwidth impact of multi-hop relaying routes\nMesh networks consisting of devices that feature only one radio are a low\ncost way to establish a ubiquitous wireless network, but this comes at a\ntradeoff. With only one wireless interface in each device, the radios have\nto operate on the same channel. Simply sending data through a routing\npath going from node A through B to C halves the available bandwidth.\nWhile A is sending data to B, B and C have to remain silent.\nWhile B is forwarding data to C, A has to remain silent as well - and so\non. Note that the same is true if two clients connected to an access point\nin infrastructure want to communicate with each other.\nIf we assume that all wireless links in the A-B-C-D mesh chain operate at\nthe same speed, the communication between A and D would be roughly\n1\/3 of the speed of a single link, given that A and D can use the network\ncapacity exclusively. The bandwidth impact can be mitigated or avoided by\nusing devices with multiple radios, given that they are operating on\ndifferent frequencies that don't interfere with each other.\nDespite the bandwidth tradeoff, single radio mesh devices still have their\nmerits. They are cheaper, less complex and consume less power than multi-\nradio devices. This can be important if the systems are solar or wind powered\nor require a battery backup. If the wireless links in a three hop network (a\nchain with 4 nodes like above) operate at 12 Mbit each, the total end-to-end\nbandwidth would still offer plenty bandwidth to saturate a 2 Mbit Internet\nuplink.\nSummary\nMesh networking extends the range of wireless devices by multi-hop\nrelaying traffic. By means of dynamic routing, meshes can be self- healing\nin case of node failure and grow organically if more nodes are added. If\nthe mesh nodes have only one radio, the benefit in coverage comes at the\ntradeoff of reduced bandwidth. Here is an example of a currently deployed\nmesh network. You can find more information about this deployment at\nthe url http:\/\/code.google.com\/p\/afrimesh\/ 138 NETWORKING\nFigure MN 2: Screenshot of the Villagetelco mesh at Bo-Kaap in Capetown,\nSouth Africa\nRouting protocols for mesh networks\nRouting protocols for wireless mesh networks have to be designed with\nthe challenges of radio communication in mind.\nWireless links and the topology of a mesh network are inherently unstable,\ndevices can go up and down, the available bandwidth varies, and links are\noften flawed with packet loss.\nA mesh routing protocol should be resilient against routing errors even if\nrouting protocol messages are delayed or lost.\nAt the same time the available communication bandwidth and computing\nperformance of mesh nodes is limited and shouldn't be wasted on\nprotocol decisions and traffic overhead.\nIn 2005, when the first edition of the WNDW book was written, there\nwere only few practically usable routing protocols for mesh networks. In\nprevious editions, this chapter has been focused on OLSR. Back then, the\nOLSR daemon wasn't shipped with a working default configuration, so it\nwas necessary to wade into the depths of the olsrd.conf configuration file\nto find out what the best configuration of the routing algorithm was. 8. MESH NETWORKING 139\nThe situation has changed quite a bit since 2005.\nThere are now a number of mesh protocols and implementations, and all\nthe implementations which are mentioned in this chapter are readily\navailable as installation packages for OpenWRT.\nMesh protocol developers are competing in a challenge to deliver the best\nmesh routing protocol. There is now a annual competition event for mesh\nprotocol developers, taking place once a year. It is called \"Battlemesh\",\nwww.battlemesh.org\nMost mesh routing protocols (BABEL, BATMAN, OLSR, BMX, BMX6)\ntake care of maintaining the IPv4 and IPv6 routing tables in a mesh node\nby adding, updating and deleting routes. These mesh protocols are using\nIP-based routing. They are layer 3 mesh protocols, since IP represents the\nthird layer of the OSI networking layer model.\nBatman-adv(anced) is a relatively new protocol that operates on the\nsecond layer of the networking model, hence it is a layer 2 mesh protocol.\nTo the higher layers (including IP), Batman-adv makes the whole mesh\nappear as a switch, where all connections are link-local. A Batman-adv\nmesh is transparent for the higher layers of the networking model.\nThis simplifies the setup of a mesh network a great deal, since it is possible\nto use DHCP, mDNS or MAC bridging with Batman-adv. Batman-adv is\na Linux kernel module, which is shipped with the official Linux kernel\nsources. Mesh routing protocols should also manage the announcement\nand selection of gateways to external networks like the Internet. A\ncommon problem with gateway selection mechanisms is that the routing\nprotocol might decide to switch between gateways too often - for example,\nbecause one routing path to one gateway just got slightly better than the\nother. This is annoying because it can cause gateway flapping and results in\nstateful connection sessions breaking down frequently. If there is more\nthan one Internet gateway in the mesh, using an advanced method for\ngateway selection is strongly recommended.\nHow about 802.11s?\nThe roadmap of 802.11s is to scale up to 32 nodes. According to\nWikipedia it uses HWMP (Hybrid wireless mesh protocol) as the default\nrouting protocol, with the option to use other routing protocols. Quote:\n\"HWMP is inspired by a combination of AODV (RFC 3561[2]) and\ntree-based routing\". Since 802.11s is relatively new there is not much\npractical experience so far. 140 NETWORKING\nDevices and firmware for embedded devices\nNot all WiFi devices on the market are suitable for mesh networking.\nIn 2005, when the first edition of this book was written, one of the clear\nhardware recommendations for mesh networking was the Linksys\nWRT54G router in combination with the Freifunk firmware.\nWhile the WRT54G(L) is still on the market, it is no longer worth a\nrecommendation.1\nOpenWRT is a very versatile firmware development environment for\ndevelopers and a firmware for advanced Linux users.\nThe old Freifunk firmware is based on the outdated OpenWRT version\n\"White Russian\". \"White Russian\" supported only devices with Broadcom\nchipsets with a proprietary binary wireless driver and is based on Linux\n2.4. It has been ousted by the OpenWRT releases 'Kamikaze' and\n'Backfire' (latest release). With 'Kamikaze' and 'Backfire' OpenWRT has\ngained support for many different wireless chipsets, CPU architectures and\ndevices. The next stable release of OpenWRT will be named 'Attitude\nAdjustment', which, at the time of writing, is at 'release candidate'\nstage. The 'AR7xxx' and 'Atheros' platform ports of 'Attitude\nAdjustment' can be considered stable.\nThe mesh routing protocols mentioned before are all available as\ninstallation packages for OpenWRT.\nA few open networking communities have developed their own\ncustomised firmware images with OpenWRT Kamikaze and Backfire.\nHowever they are mostly geared to meet their local preferences and\nrequirements and support a limited number of devices. Since they are\noften localised they might be of limited use for the general public.\nOpenWRT has a package management system, which comes to the\nrescue. It is typical for OpenWRT to install software packages into the\nrouter after it has been flashed. There is now a meta package named 'luci-\nfreifunk-community', which will automatically convert a stock OpenWRT\nimage into a community mesh networking firmware.\n1. While the WRT54GL is still available on the market, at prices of 60 US-$ it is\noverpriced. The WRT54G revision 4.0 was sold as WRT54GL revision 1.0 by Linksys in\n2005, after Linksys had introduced the WRT54G revision 5.0, which wasn't Linux\ncompatible anymore. The WRT54G revision 5.0 has only half the flash storage and RAM\ncapacity. The WRT54G model is the WiFi router with the longest production lifetime. For\nthe money you need to spend on a Linksys WRT54GL in 2011 you can buy two or three\nsimilar devices from other brands that are faster in terms of CPU and data rate. 8. MESH NETWORKING 141\nThe number of devices that can be converted to a mesh router has\nincreased dramatically. On the other hand the process of converting a\nstock OpenWRT firmware into a mesh firmware via the package\nmanagement system is often more error-prone unfortunately.\nSome manufacturers of WiFi routers are shipping devices that come with\nOpenWRT as their factory firmware: Mesh-Potato, Dragino MS- 12,\nAllnet 0305.\nFigure MN 3: Mesh-Potato outdoor mesh WiFi router with VoIP (with one\nFXS port to connect analog telephone handsets). www.villagetelco.org\nThe Mesh-Potato is a low-power outdoor device designed for mesh\nnetworking with an FXS (analog telephone) port, so you can plug an\nanalog telephone handset in and make telephone calls via the mesh.\nThe Mesh-Potato is shipped with a mesh firmware that uses the BATMAN\nLayer 3 mesh protocol. 142 NETWORKING\nA second firmware named SECN (Small enterprise\/campus network) is\nalso available for the Mesh- Potato, which uses the BATMAN-ADV Layer\n2 mesh.\nBut these are not the only devices that should be considered for purchase.\nOpenWRT supports a very broad selection of wireless routers.\nReplacing the factory firmware with OpenWRT is often quite easy.\nAgain, the selection of available devices is so diverse that there isn't a\nsingle update method that works for the whole variety of hardware, which\ncould be described here.\nThe OpenWRT table of supported hardware is huge and it keeps\nexpanding:\nhttp:\/\/wiki.openwrt.org\/toh\/start\nThis site should be the place to start before you go and buy devices.\nAt the moment, if you are looking for a router based on a chipset that\nsupports 802.11n in ad-hoc mode, my recommendation are devices that\nare supported by the AR7XXX port of OpenWRT.\nNote that hardware manufacturers may change the chipsets of the devices\nwithout explicitly stating it. Newer hardware revisions are not guaranteed\nto work unless someone has tested and reported it in the OpenWRT wiki.\nNotable devices which can be flashed with OpenWRT are the outdoor\nunits made by Ubiquiti and the SOHO devices made by TP-Link.\nTP- Link produces several low-cost SOHO devices with Atheros ar71xx\nchipsets (802.11n).\nThe TP-Link MR3220 (802.11n single stream) and MR3420 (802.11n\ndual stream) feature a 400 MHz Mips 24kc CPU, one USB 2.0 port, a 4\nport 100 Mbit switch, WAN port, 4MB flash and 32MB RAM.\nPrices start at around 30US $.\nSince the TP-Link devices have a USB 2.0 port it is possible to add\nanother WiFi interface via USB WiFi dongle.\nActually USB 2.0 adds many opportunities, like adding additional storage\nspace, audio support, webcams and so on. 8. MESH NETWORKING 143\nFigure MN 4:DIY outdoor routers based on PCBs taken from SOHO routers\n(Picture showing two devices based on TP-Link WR741 and WR941 and one\nbased on a Fonera router)\nAnother firmware distribution which initially orginated as an alternative\nfirmware of the WRT54G is DD-WRT. DD-WRT is a firmware\ndistribution designed for end-users. It only supports the OLSR routing\nprotocol.\nFrequently observed problems\nThe typical problems of multipoint-to-multipoint communication are\neither on the physical radio or the MAC layer. The IEEE 802.11\nsuggestions about multipoint-to-multipoint mode were not up to the task. 144 NETWORKING\nThe main challenges are:\nChannel access coordination, namely the hidden node and exposed node\nproblem\nGoing back to our little mesh with the topology A B C it can happen that\nA and C start to send data to B at the same time because they don't\nreceive each other, resulting in a collision at the location of B. 802.11 has\na mechanism to mitigate this: RTS\/CTS (request to send, clear to send)\nBefore a m2m node sends data it requests airtime by sending a short RTS\npacket, in order to reserve the channel. It waits until it receives a CTS\nsignal. So A will send a short RTS packet, and B sends a short CTS\npacket. This way C will detect that there will be a transmission of a hidden\nnode that it shouldn't interfere with.\nHowever the current RTS\/CTS mechanism of 802.11 works well only for\n2 hop routes. On longer routes it can happen that multiple stations send\nRTS signals, which results in all the nodes stopping their transmissions\nand waiting for a CTS signal. This is called a RTS broadcast storm. For\nmesh networks of considerable size it is not recommended to use the\nRTS\/CTS mechanism.\nTimer synchronisation\nThe people designing the 802.11 ad-hoc protocol thought it would be\nsmart if the WiFi devices would synchronise their MAC timer clocks by\nsending time stamps in beacons.\nHowever bogus time stamps can occur due to bugs, and they often trigger\nrace conditions in the hardware, drivers and the 802.11 ad-hoc protocol,\nwhich has not been designed to cope with such issues.\nFailed attempts to synchronise time stamps often results in cell splitting\n(see below). There are some hacks which have been introduced to\novercome the problem.\nThe best solution is to disable timer synchronisation entirely. However\ntimer synchronisation is often done in the wireless interface hardware or\nfirmware of a interface. 8. MESH NETWORKING 145\nOpenWRT has a hack to disable timer synchronisation when using\nAtheros 802.11abg cards that work with the Madwifi driver. If you are\nusing a recent Linux kernel, certain wireless drivers (namely ath9k) which\nare often used for mesh devices are quite robust against timer issues in ad-\nhoc mode.\nHowever this doesn't help if the WiFi device comes with a closed source\nbinary firmware which is not prepared to deal gracefully with timer issues.\nThere is not much we can do about it, other than using\ndrivers\/firmwares\/chipsets which are known to work reliably.\nIBSS cell splitting\nThis is a typical problem of the way 802.11 suggests implementation of\nthe m2m mode. Ad-hoc devices may fail to agree on a certain cell-id\n(IBSS-ID). If they don't manage to agree on using one certain cell-id,\nthey are logically separated wireless cells.\nThis is a real show stopper, because wireless devices will not be able to\ncommunicate with each other. The problem is related to issues with timer\nsynchronisation. Since Linux 2.6.31 it is possible to manually fix the\nIBSS-ID. This feature is also available in OpenWRT. 146 NETWORKING\n9. SECURITY FOR WIRELESS NETWORKS\nIntroduction\nWhile unlicensed spectrum provides a huge cost savings to the user, it has\nthe unfortunate side effect that Denial of Service (DoS) attacks are trivially\nsimple. By simply turning on a high powered access point, cordless phone,\nvideo transmitter, or other 2.4GHz device, a malicious person could cause\nsignifi cant problems on the network. Many network devices are vulnerable\nto other forms of denial of service attacks as well, such as disassociation fl\nooding and ARP table overfl ows.\nThere are several categories of individuals who may cause problems on a\nwireless network:\nUnintentional users.\nDensely populated areas such as city centres and university campuses can\nlead to a density of wireless access points. In these populated areas, it is\ncommon for laptop users to accidentally associate to the wrong network.\nMost wireless clients will simply choose any available wireless network,\noften the one with the strongest signal, when their preferred network is\nunavailable.\nThe user may then make use of this network as usual, completely unaware\nthat they may be transmitting sensitive data on someone elses network.\nMalicious people may even take advantage of this by setting up access\npoints in strategic locations, to try to attract unwitting users and capture\ntheir data.\nThe first step in avoiding this problem is educating your users, and\nstressing the importance of connecting only to known and trusted\nnetworks.\nMany wireless clients can be configured to only connect to trusted\nnetworks, or to ask permission before joining a new network.\nAs we will see later in this chapter, users can safely connect to open public\nnetworks by using strong encryption.\nWar drivers.\nThe \u201cwar driving\u201d phenomenon draws its name from the popular 1983\nhacker film, \u201cWar Games\u201d. 9. SECURITY FOR WIRELESS NETWORKS 147\nWar drivers are interested in finding the physical location of wireless\nnetworks.\nThey typically drive around with a laptop, GPS, and omnidirectional\nantenna, logging the name and location of any networks they find. These\nlogs are then combined with logs from other war drivers, and are turned\ninto graphical maps depicting the wireless \u201cfootprint\u201d of a particular city.\nThe vast majority of war drivers likely pose no direct threat to networks,\nbut the data they collect might be of interest to a network cracker. For\nexample, it might be obvious that an unprotected access point detected by\na war driver is located inside a sensitive building, such as a government or\ncorporate office.\nA malicious person could use this information to illegally access the\nnetwork there. Arguably, such an AP should never have been set up in the\nfirst place, but war driving makes the problem all the more urgent. As we\nwill see later in this chapter, war drivers who use the popular program\nNetStumbler can be detected with programs such as Kismet.\nFor more information about war driving, see sites such as:\nhttp:\/\/wigle.net\/,\nhttp:\/\/www.nodedb.com\/, or http:\/\/www.stumbler.net\/.\nRogue access points.\nThere are two general classes of rogue access points:\nThose incorrectly installed by legitimate users, and those installed by\nmalicious people who intend to collect data or do harm to the network. In\nthe simplest case, a legitimate network user may want better wireless\ncoverage in their office, or they might find security restrictions on the\ncorporate wireless network too difficult to comply with.\nBy installing an inexpensive consumer access point without permission,\nthe user opens the entire network up to potential attacks from the inside.\nWhile it is possible to scan for unauthorised access points on your wired\nnetwork, setting a clear policy that prohibits them is a very important first\nstep.\nThe second class of rogue access point can be very difficult to deal with.\nBy installing a high powered AP that uses the same ESSID as an existing\nnetwork, a malicious person can trick people into using their equipment,\nand log or even manipulate all data that passes through it. 148 NETWORKING\nAgain, if your users are trained to use strong encryption, this problem is\nsignificantly reduced.\nEavesdroppers.\nAs mentioned earlier, eavesdropping is a very difficult problem to deal\nwith on wireless networks. By using a passive monitoring tool (such as\nKismet), an eavesdropper can log all network data from a great distance\naway, without ever making their presence known.\nPoorly encrypted data can simply be logged and cracked later, while\nunencrypted data can be easily read in real time.\nIf you have difficulty convincing others of this problem, you might want\nto demonstrate tools such as\nDriftnet (http:\/\/www.ex-parrot.com\/~chris\/driftnet\/).\nDriftnet watches a wireless network for graphical data, such as GIF and\nJPEG files. While other users are browsing the Internet, these tools simply\ndisplay all graphics found in a graphical collage. While you can tell a user\nthat their email is vulnerable without encryption, nothing drives the\nmessage home like showing them the pictures they are looking at in their\nweb browser. Again, while it cannot be completely prevented, proper\napplication of strong encryption will discourage eavesdropping.\nProtecting the wireless network\nIn a traditional wired network, access control is relatively straightforward:\nIf a person has physical access to a computer or network hub, they can use\n(or abuse) the network resources. While software mechanisms are an\nimportant component of network security, limiting physical access to the\nnetwork devices is the ultimate access control mechanism. Simply put, if\nall terminals and network components are physically only accessible to\ntrusted individuals, the network can likely be trusted. The rules change\nsignificantly with wireless networks. While the apparent range of your\naccess point may seem to be just a few hundred metres, a user with a high\ngain antenna may be able to make use of the network from several blocks\naway.\nShould an unauthorised user be detected, is impossible to simply \u201ctrace\nthe cable\u201d back to the users location.\nWithout transmitting a single packet, a sufficiently talented nefarious user\ncan capture and log traffic on a wireless network to disk. 9. SECURITY FOR WIRELESS NETWORKS 149\nThis data can later be used to launch a more sophisticated attack against\nthe network. Never assume that radio waves simply \u201cstop\u201d at the edge of\nyour property line, or inside your building. Physical security in wireless\nnetworks is limited to preventing compromise of the active components,\ncables and power supply.\nWhere physical access to the network cannot be prevented we have to rely\non electronic means for controlling access to the wireless infrastructure in\norder to only allow authorised persons and systems to use the wireless\nnetwork. But remember, while a certain amount of access control and\nauthentication is necessary in any network, you have failed in your job if\nlegitimate users find it difficult to use the network to communicate. Lastly,\nit is usually unreasonable to completely trust all users of the network, also\non wired networks. Disgruntled employees, uneducated network users, and\nsimple mistakes on the part of honest users can cause significant harm to\nnetwork operations. As the network architect, your goal is to facilitate\nprivate communication between legitimate users of the network and\nbetween legitimate users and services.\nThere's an old saying that the only way to completely secure a computer is\nto unplug it, lock it in a safe, destroy the key, and bury the whole thing in\nconcrete. While such a system might be completely \u201csecure\u201d, it is useless\nfor communication. When you make security decisions for your network,\nremember that above all else, the network exists so that its users can\ncommunicate with each other. Security considerations are important, but\nshould not get in the way of the network's users.\nA simple rule-of-thumb as to whether or not the network is getting in the\nway of its users is to look at how much time you or other staff spend on\nhelping people get on the network.\nIf regular users are repeatedly having problems simply gaining access to the\nnetwork, even after they have been provided instruction and training on\nhow to do so, it's possible that the access procedures are too cumbersome\nand a review of them is in order.\nTaking all of this into account, our goal is to provide adequate physical\nsecurity, control access protect the communication without sacrificing ease\nof use. 150 NETWORKING\nPhysical security for wireless networks\nWhen installing a network, you are building an infrastructure that people\ndepend on. Security measures exist to ensure that the network is reliable.\nWireless networks have physical components, such as wires and boxes,\nwhich are easily disturbed. In many installations, people will not\nunderstand the purpose of the installed equipment, or curiosity may lead\nthem to experiment.\nThey may not realise the importance of a cable connected to a port.\nSomeone may unplug an Ethernet cable so that they can connect their\nlaptop for 5 minutes, or move a switch because it is in their way. A plug\nmight be removed from a power bar because someone needs that\nreceptacle. Assuring the physical security of an installation is paramount.\nSigns and labels will only be useful to those who can read your language.\nPutting things out of the way and limiting access is the best means to\nassure that accidents and tinkering do not occur. In your locality, proper\nfasteners, ties, or boxes may not be easy to find.\nYou should be able to find electrical supplies that will work just as well.\nCustom enclosures are also easy to manufacture and should be considered\nessential to any installation. It is often economical to pay a mason to\nmake holes and install conduit. PVC can be embedded in cement walls for\npassing cable from room to room. This avoids the need to smash new\nholes every time a cable needs to be passed. Plastic bags can be stuffed\ninto the conduit around the cables for insulation. Small equipment should\nbe mounted on the wall and larger equipment should be put in a closet or\nin a cabinet.\nSwitches\nSwitches, hubs or interior access points can be screwed directly onto a wall\nwith a wall plug. It is best to put this equipment as high as possible to\nreduce the chance that someone will be able to touch the device or its\ncables without significant effort.\nCables\nAt the very least, cables should be hidden and fastened. It is possible to\nfind plastic cable conduit that can be used in buildings. If you cannot find\nit, simple cable attachments can be nailed into the wall to secure the cable.\nThis will make sure that the cable doesn't hang where it can be snagged,\npinched or cut. 9. SECURITY FOR WIRELESS NETWORKS 151\nWhen fastening cable to the wall, it is important to not nail or screw into\nthe cable itself. The cable contains many tiny wires that the network data\ntravels over. Nailing through the cable will damage it and make it useless\nfor transmitting data. Take care also to not overly bend or twist the cable\nas this will damage it as well.\nIt is preferable to bury cables, rather than to leave them hanging across a\nyard. Hanging wires might be used for drying clothes, or be snagged by a\nladder, etc. To avoid vermin and insects, use plastic electrical conduit. The\nmarginal expense will be well worth the trouble. The conduit should be\nburied about 30 cm deep, or below the frost level in cold climates. It is\nworth the extra investment of buying larger conduit than is presently\nrequired, so that future cables can be run through the same tubing.\nConsider labeling buried cable with a \"call before you dig\" sign to avoid\nfuture accidental outages.\nPower\nIt is best to have power bars locked in a cabinet. If that is not possible,\nmount the power bar under a desk, or on the wall and use duct tape (or\ngaffer tape, a strong adhesive tape) to secure the plug into the receptacle.\nOn the UPS and power bar, do not leave any empty receptacles. Tape\nthem if necessary. People will have the tendency to use the easiest\nreceptacle, so make these critical ones difficult to use. If you do not, you\nmight find a fan or light plugged into your UPS; though it is nice to have\nlight, it is nicer to keep your server running!\nWater\nProtect your equipment from water and moisture. In all cases make sure\nthat your equipment, including your UPS is at least 30 cm from the\nground, to avoid damage from fl ooding. Also try to have a roof over your\nequipment, so that water and moisture will not fall onto it. In moist\nclimates, it is important that the equipment has proper ventilation to\nassure that moisture can be exhausted. Small closets need to have\nventilation, or moisture and heat can degrade or destroy your gear.\nMasts\nEquipment installed on a mast is often safe from thieves. Nevertheless, to\ndeter thieves and to keep your equipment safe from winds, it is good to\nover-engineer mounts. 152 NETWORKING\nPainting equipment a dull white or grey colour reflects the sun and makes\nit look plain and uninteresting. Panel antennas are often preferred because\nthey are much more subtle and less interesting than dishes. Any\ninstallation on walls should be high enough to require a ladder to reach.\nTry choosing well-lit but not prominent places to put equipment. Also\navoid antennae that resemble television antennae, as those are items that\nwill attract interest by thieves, whereas a wifi antenna will be useless to the\naverage thief.\nAuthentication and access control\nTalking about authentication a number of related terms like (digital)\nidentity, authorisation, privacy etc. pop up. So before we get into\nauthentication proper we need to introduce some terminology, without\ntrying to be exhaustive.\nDigital identity is the electronic entity that is a representation of a\nphysical entity, like a person or a device. Authentication is the process of\nverifying the claim that an (electronic) entity is allowed to act on behalf of\na given known (physical) entity. In other words, authentication is the\nprocess of proving that the physical entity corresponds to a certain\nelectronic one. Authorisation in turn is the process of establishing the\nrights of the identity to access certain resources or to perform certain\ntasks. Privacy, finally, is a complex issue but has to do with the right of a\nperson not to have their personal data and behaviour be known to parties\nthat do not strictly need it to provide the service the users request. So for\nexample, it is reasonable for a liquor shop to know that a customer is\nabove a certain age before selling alocholic drinks, but not to know the\nname of the customer, and third parties should not have any knowledge of\nthe transaction at all. Privacy is of particular concern in a world in which\nusers increasingly use networks and services outside their home\nenvironment. Without proper attention to privacy aspects it is too easy to\ntrace a users behaviour and movement.\nIt is worth mentioning that there is a trade-off between authentication and\nprivacy. Verifying the identity of a user in itself invades the user's privacy,\nthe authenticating party knows who is using what resource at a particular\ntime and location, but the challenge is to minimise the amount of\ninformation about a user and the number of parties that are privvy to that\ninformation. 9. SECURITY FOR WIRELESS NETWORKS 153\nIn the context of this book we are mainly interested in techniques for\ncontrolling access to the network. In other words, we want to be able to\ndecide who (authenticated identity) gets to access what (authorisation)\nwithout sacrificing privacy.\nAuthentication is typically done by proof of knowledge of a secret (a\npassword, a signature), possession of a token or characteristic (a certificate,\na fingerprint) or both. Access control is often needed to make sure that\nonly authorised users can use the network, to prevent exhaustion of scarce\nresources and\/or compliance with rules and regulations. In addition to\naccess controlled networks there may also be open networks with limited\naccess or for a limited time, but due to the need for organisations to\ncontrol access to their scarce resources and also anti-terrorist laws they\nbecome less ubiquitous. Over the years a number of techniques have been\nemployed to control access to wireless networks. Subsequently they have\nbeen mostly abandoned due to security or scalability issues as WiFi\nbecame increasingly popular.\nMac filtering\nAccess to a WiFi network can be based on the MAC address. This is the\n48-bit number assigned by the manufacturer to every wireless and\nEthernet device, and that is supposed to be unique and persistent. By\nemploying mac filtering on our access points, we can authenticate users\nbased on their MAC address.\nWith this feature, the access point keeps an internal table of approved\nMAC addresses.\nWhen a wireless user tries to associate to the access point, the MAC\naddress of the client must be on the approved list, or the association will\nbe denied. Alternatively, the AP may keep a table of known \u201cbad\u201d MAC\naddresses, and permit all devices that are not on the list. Unfortunately,\nthis is not an ideal security mechanism. Maintaining MAC tables on every\ndevice can be cumbersome, requiring all client devices to have their MAC\naddresses recorded and uploaded to the APs. Even worse, MAC addresses\ncan often be changed in software. By observing MAC addresses in use on\na wireless network, a determined attacker can spoof (impersonate) an\napproved MAC address and successfully associate to the AP.\nWhile MAC filtering will prevent unintentional users and even most\ncurious individuals from accessing the network, MAC filtering alone\ncannot prevent attacks from determined attackers. 154 NETWORKING\nMAC filters are useful for temporarily limiting access from misbehaving\nclients. For example, if a laptop has a virus that sends large amounts of\nspam or other traffic, its MAC address can be added to the filter table to\nstop the traffic immediately. This will buy you time to track down the user\nand fix the problem.\nClosed networks\nAnother at one time popular \"authentication feature\" of WiFi networks is\nthe so-called closed network mode. In a typical network, APs will\nbroadcast their ESSID many times per second, allowing wireless clients (as\nwell as tools such as NetStumbler) to find the network and display its\npresence to the user. In a closed network, the AP does not beacon the\nESSID (\"hidden ESSID\"), and users must know the full name of the\nnetwork before the AP will allow association. This prevents casual users\nfrom discovering the network and selecting it in their wireless client. There\nare a number of drawbacks to this feature. Forcing users to type in the full\nESSID before connecting to the network is error prone and often leads to\nsupport calls and complaints. Since the network isn\u2019t obviously present in\nsite survey tools like NetStumbler, this can prevent your networks from\nshowing up on war driving maps. But it also means that other network\nbuilders cannot easily find your network either, and specifically won\u2019t\nknow that you are already using a given channel.\nA conscientious neighbour may perform a site survey, see no nearby\nnetworks, and install their own network on the same channel you are\nusing. This will cause interference problems for both you and your\nneighbour.\nFinally, using closed networks ultimately adds little to your overall\nnetwork security. By using passive monitoring tools (such as Kismet), a\nmalicious user can detect frames sent from your legitimate clients to the\nAP. These frames necessarily contain the network name. The malicious\nuser can then use this name to associate to the access point, just like a\nnormal user would. Encryption is probably the best tool we have for\nauthenticating wireless users. Through strong encryption, we can uniquely\nidentify a user in a manner that is very difficult to spoof, and use that\nidentity to determine further network access. Encryption also has the\nbenefit of adding a layer of privacy by preventing eavesdroppers from\neasily watching network traffic. Encryption is the technique that is used\nfor authenticating users in most current deployments. 9. SECURITY FOR WIRELESS NETWORKS 155\nWEP\nThe first widely employed encryption method on WiFi networks was WEP\nencryption. WEP stands for Wired Equivalent Privacy, and is supported\nby virtually all 802.11a\/b\/g equipment. Incidentally, this is a complete\nmisnomer as the privacy that WEP provides is in no way equivalent to\nthat of wired connections. WEP uses a shared 40-bit key to encrypt data\nbetween the access point and client. The key must be entered on the APs\nas well as on each of the clients.\nWith WEP enabled, wireless clients cannot associate with the AP until\nthey use the correct key. An eavesdropper listening to a WEP-enabled\nnetwork will still see traffic and MAC addresses, but the data payload of\neach packet is encrypted.\nThis provided an authentication mechanism while also adding a bit of\nprivacy to the network. WEP is definitely not the strongest encryption\nsolution available.\nFor one thing, the WEP key is shared between all users. If the key is\ncompromised (say, if one user tells a friend what the password is, or if an\nemployee is let go) then changing the password can be prohibitively\ndifficult, since all APs and client devices need to be changed.\nThis also means that legitimate users of the network can still eavesdrop on\neach others\u2019 traffic, since they all know the shared key.\nThe key itself is often poorly chosen, making offline cracking attempts\nfeasible. But most importantly, WEP itself is broken, making it very easy\nto gain illegal access the network.\nSo WEP should not be used anymore.\nFor more details about the state of WEP encryption, see these papers:\nhttp:\/\/www.isaac.cs.berkeley.edu\/isaac\/wep-faq.html\nhttp:\/\/www.cs.umd.edu\/~waa\/wireless.pdf\n\"Switched\" wireless networks\nOne critical difference between modern switched Ethernet networks and\nwireless is that wireless networks are built on a shared medium.\nThey more closely resemble the old network hubs than modern switches,\nin that every computer connected to the network can \u201csee\u201d the traffic of\nevery other user. 156 NETWORKING\nTo monitor all network traffic on an access point, one can simply tune to\nthe channel being used, put the network card into monitor mode, and log\nevery frame.\nThis data might be directly valuable to an eavesdropper (including data\nsuch as email, voice data, or online chat logs). It may also provide\npasswords and other sensitive data, making it possible to compromise the\nnetwork even further. WPA and 802.1X are designed to make the wireless\nnetwork behave like a switched rather than a shared network.\nWPA\nAnother data-link layer authentication protocol is Wi-Fi Protected Access,\nor WPA. WPA was created specifically to deal with the known problems\nwith WEP mentioned earlier. WPA was intended to be a backwards\ncompatible interim solution while the full standard 802.11i (WPA2) was\ndeveloped.\nWPA and WPA2 can operate in combination with the 802.1X umbrella\nstandard for wireless authentication (see below) but also much in the same\nmode as WEP, with a shared secret between all clients and the AP, the so-\ncalled Pre Shared Key (PSK) mode (the WiFi Alliance calls WPA-PSK\n\"WPA Personal\", as opposed to \"WPA Enterprise\" that is used in\ncombination with 802.1X).\nOverall, WPA provides significantly better authentication and privacy than\nstandard WEP, mainly by leveraging the Temporary Key Integrity Protocol\n(TKIP) that continuously and automatically changes the keying material\nbetween clients and access points.\nUnfortunately precisely the backwards compatibility of TKIP has given\nrise to some attack vectors against TKIP that allow for decrypting certain\nencrypted packets, that in turn can be manipulated for further attacks.\nMore information can be found in the following articles:\nhttp:\/\/dl.aircrack-ng.org\/breakingwepandwpa.pdf\nhttp:\/\/download.aircrack-ng.org\/wiki-files\/doc\/enhanced_tkip_michael.pdf\nThe consequence of these discoveries is that it is wise to move to the next\ngeneration of secure WiFi access protocols: WPA2. 9. SECURITY FOR WIRELESS NETWORKS 157\nWPA2-PSK\nWPA2 is the full IEEE 802.11i standard.\nThe main difference with WPA is the use of the Advanced Encryption\nSystem (AES) instead of TKIP a (so far) not broken encryption standard.\nSo the use of WPA2 with AES can be considered secure for now!\nSummary\nThe major downside of any of these last three authentication methods is\nthat, regardless of the strength of the encryption, they are still built upon\nthe notion of a common shared secret between all clients and the access\npoint.\nThey don't allow for identifying individual users and frankly, a secret\nshared by potentially tens of thousands of users can hardly be called a\nsecret.\nAnother serious problem with wireless networks to which access is\ncontrolled by any of the methods mentioned, is that its users are relatively\nanonymous.\nWhile it is true that every wireless device includes a unique MAC address\nthat is supplied by the manufacturer, as mentioned these addresses can\noften be changed with software.\nAnd even when the MAC address is known, it can be very difficult to\njudge where a wireless user is physically located.\nMulti-path effects, high-gain antennas, and widely varying radio\ntransmitter characteristics can make it impossible to determine if a wireless\nuser is sitting in the next room or is in an apartment building a mile away.\nThe concerns about security, accountability and scalability have led to the\nrise of what is commonly called identity-based networking.\nIdentity-based networking\nIn identity based networking individual users are being authenticated 158 NETWORKING\nrather than secrets shared between many users.\nTypically the authentication system verifies user credentials against some\nsort of enterprise database or directory.\nCommonly by using the RADIUS protocol, a protocol originally designed\nfor controlling access to dial-in modem pools but sufficiently versatile to\nserve as generic access control protocol for network access.\nCaptive portals\nOne common authentication tool used on wireless networks is the captive\nportal. A captive portal uses a standard web browser to give a wireless user\nthe opportunity to present login credentials.\nIt can also be used to present information (such as an Acceptable Use\nPolicy) to the user before granting further access.\nBy using a web browser instead of a custom program for authentication,\ncaptive portals work with virtually all laptops and operating systems.\nCaptive portals are typically used on open networks with no other\nauthentication methods (such as WEP or MAC filters).\nTo begin, a wireless user opens their laptop browser and is directed to the\nportal.\nThey will then be asked to accept the use policy or answer other questions\nsuch as entering a user name and password, and click on a \u201clogin\u201d button,\nor perhaps type in numbers from a pre-paid ticket.\nThe user enters their credentials, which are checked by the access point or\nanother server on the network.\nAll other network access is blocked until these credentials are verified.\nAfter verification their computer will receive a DHCP lease.\nThey can then use their web browser to go to any site on the Internet. 9. SECURITY FOR WIRELESS NETWORKS 159\nFigure SWN 1: The user requests a web page and is redirected.\nFigure SWN 2: The user\u2019s credentials are verified before further network access\nis granted. The authentication server can be the access point itself,another\nmachine on the local network, or a server anywhere on the Internet. 160 NETWORKING\nFigure SWN 3: After authenticating, the user is permitted to access the rest of\nthe network and is typically redirected to the original site\nrequested - in this case Google.\nCaptive portals provide no encryption for the wireless users, instead\nrelying on the MAC and IP address of the client as a unique identifier,\nwhich can be spoofed easily, many implementations will therefore require\nthe user to keep a connection window open. Since they, just like MAC-\nor WEP-based, do not provide protection against eavesdropping (they use\na shared medium) and are vulnerable to session hijacking, captive portals\nare not a very good choice for networks that need to be locked down to\nonly allow access from trusted users.\nThey are much more suited to cafes, hotels, and other public access\nlocations where casual network users are expected. Another downside of\ncaptive portals is that they rely on the use of a browser for authentication,\nwhich can be very counterintuitive for users that just try to check their e-\nmail or send an instant message, not to mention the fact that many\nwireless devices like sensors, printers and cameras don't have a builtin\nbrowser.\nIn public or semi-public network settings, encryption techniques such as\nWEP and WPA are effectively useless. There is simply no way to distribute\npublic or shared keys to members of the general public without\ncompromising the security of those keys. 9. SECURITY FOR WIRELESS NETWORKS 161\nIn these settings, a simple application such as a captive portal provides a\nlevel of service somewhere between completely open and completely\nclosed. Many vendors and open source projects exist that provide captive\nportal capability, to name a few:\n\u2022 CoovaChilli, CoovaAP (http:\/\/coova.org\/CoovaChilli\/), Coova is\nthe successor of the no longer actively maintained Chillispot\nproject. Coova allows for the use of a RADIUS authentication\nbackend.\n\u2022 WiFidog (http:\/\/www.wifidog.org\/), WiFi Dog provides a very\ncomplete captive portal authentication package in very little space\n(typically under 30kb). From a user\u2019s perspective, it requires no\npop-up or javascript support, allowing it to work on a wider\nvariety of wireless devices.\n\u2022 M0n0wall, pfSense (http:\/\/m0n0.ch\/wall\/), m0n0wall is a\ncomplete embedded operating system based on FreeBSD. It\nincludes a captive portal with RADIUS support, as well as a PHP\nweb server.\nMany general networking vendors offer some form of integrated captive\nportals, e.g. Microtik, Cisco, Aruba, Aptilo.\n802.1X\nIn enterprise and campus deployments, the most common wireless\nnetwork authentication framework is that based on IEEE 802.1X. 802.1X\nis a layer 2 protocol that can be used both for wired and wireless network\nauthentication and in fact comprises a number of technologies. 802.1X\ndescribes the interaction between the client device (supplicant in 802.1X)\nand the Access Point or Switch (Authenticator) as well as that between the\nAccess Point or Switch and a backend RADIUS server (Authentication\nServer) that in turn verifies user credentials against an enterprise directory\n(or flat file for that matter). Finally, 802.1X describes how to transport\nuser credentials from the supplicant to the authentication server\ntransparently to the authenticator or any other device in the path by\nleveraging the Extensible Authentication Protocol (EAP).\nThe encryption between the supplicant and the authenticator can be done\nusing rotating WEP-keys, WPA with TKIP or WPA2 with AES. For the\nreasons mentioned in the paragraph on WEP, WPA-PSK and WPA2-PSK,\nWPA2 with AES is highly recommended. 162 NETWORKING\nProbably the most interesting feature of the 802.1X is the use of EAP.\nEAP defines a generic way of encapsulating credentials and transporting\nthem from a supplicant (client software) to an authentication server\n(RADIUS server). So-called EAP-methods define how specific\nauthentication methods can be encapsulated into EAP. There are EAP-\nmethods for all common types of authentication methods like certificates,\nSIM-cards, username\/password, one-time passwords and hardware tokens.\nDue to key or token distribution problems with handing out tokens or\ncertificates and revocation the vast majority of large scale deployments use\nwhat are called tunnelled EAP- methods: username\/password based\nauthentication using a TLS tunnel to the authentication server through\nwhich the actual username and password are transmitted. The user\nidentity used for the TLS-envelope is typically of the form\nanonymous@domain (this is called the outer identity) whereas the inner\nidentity (inside the TLS tunnel) is of the form username@domain. This\ndistinction is particularly interesting for roaming to other organisations\nnetworks. It is possible to transport the authentication credentials of a user\nover the Internet while only revealing the home organisation of the user\n(the domain part), but that is the topic of the next paragraph. So what\nhappens in a typical 802.1X authentication with a tunnelled EAP-method\nis the following:\nFigure SWN 4: The use of 802.1X with tunnelled EAP for network access\n(courtesy SURFnet) 9. SECURITY FOR WIRELESS NETWORKS 163\nThe client associates with the Access Point (authenticator).\nThe Access Point requests the client (supplicant) to authenticate.\nThe client sends an EAP message containing a TLS packet with an outer\nidentity anonymous@domain and inside the TLS packet\nusername@domain and the password to the access point over the 802.11\nlink (EAP over LAN or EAPoL).\nThe Access point receives the EAP-message, encapsulates it in RADIUS\nand sends it to the organisational RADIUS server (authentication server).\nThe RADIUS server decapsulates the EAP-message and verifies the user\ncredntials against some sort of backend like a flat file, an LDAP directory,\nActive Directory or something else.\nIf the credentials are valid the RADIUS server sends back a RADIUS\nAccess Accept message to the Access Point. The Access Point gives the\nclient access to the wireless LAN.\nThe client performs a DHCP request, gets an IP-address and is connected\nto the network.\nThere are a number of tunnelled EAP-methods that essentially work the\nsame, the differences are in the support in common operating systems, the\nvulnarability to dictionary and man-in-the-middle attacks and whether\nthey require storage of clear-text passwords in the backend.\nThe most widely deployed tunnelled EAP-methods nowadays are EAP-\nTTLS (EAP Tunnelled Transport Layer Security) and PEAP (Protected\nEAP).\nThere have been incompatible implementations of PEAP due to\ndisagreements between the proponents of PEAP (Apple, Cisco and\nMicrosoft) resulting in a large uptake of TTLS. The fact that these\nincompatibilities are largely solved and the lack of native support for\nTTLS in a number of common OSes (Apple iOS and MS Windows\nvariants) have resulted in an increase in uptake of PEAP. A newer EAP-\nmethod that is gaining traction is EAP-FAST due to its security\nproperties. EAP-FAST has also been chosen as the basis for the new to be\ndeveloped tunnelled EAP-method (TEAP) that the IETF expects to be the\nsingle endorsed one.\nInter-organisational roaming\nRADIUS has the interesting property that RADIUS messages can be\nproxied to other RADIUS servers. 164 NETWORKING\nThat means it is possible for an organisation to allow for each others users\nto gain access to the network by authenticating to their home\norganisation's RADIUS server.\nWhen the RADIUS server of organisation A receives an authentication\nrequest from anonymous@organisationB.org it can forward the request to\norganisation B's RADIUS-server instead of verifying the credentials\nlocally. Organisation B's RADIUS server in turn can verify the credentials\nand send the access accept back to organisation A's RADIUS server, that\nthen tells the Access Point to allow the user access. This so-called federated\naccess allows for the creation of very scalable and large deployments while\nat the same time allowing the individual organisations to apply their own\nauthentication policies to their users.\nWhile RADIUS proxying is certainly possible in captive portal\ndeployments it definitely shines in an 802.1X\/EAP environment.\nBy using EAP the user credentials can be protected so that only the home\norganisation of the user is able to see them.\nThis way large deployments can be created without the leakage of\ncredentials and without teaching users to enter their secret credentials in\nevery website that is thrown up in front of them. As an example,\neduroam, the roaming wireless access federation in education, that extends\nthe above concept slightly by instead of having direct RADIUS\nconnections between organisations, it builds a hierarchical system of\nnational and international RADIUS servers, allowing millions of students\nto gain access to over 5000 campus networks in many countries in all\ncontinents with the exception of Antarctica.\nFigure SWN 5: The eduroam infrastructure for world-wide roaming in\nacademia 9. SECURITY FOR WIRELESS NETWORKS 165\nEnd to end encryption\nIt should be noted that whereas WEP, WPA-PSK and WPA2-PSK are\nusing encryption techniques to provide access control and protect against\neavesdropping, they only protect the wireless traffic between client and\naccess point, not on the wired part of the communication path. In order\nto protect the communication against unauthorised tampering or\neavesdropping end to end encryption is needed.\nMost users are blissfully unaware that their private email, chat\nconversations, and even passwords are often sent \u201cin the clear\u201d over dozens\nof untrusted networks before arriving at their ultimate destination on the\nInternet. However mistaken they may be, users still typically have some\nexpectation of privacy when using computer networks. Privacy can be\nachieved, even on untrusted networks such as public access points and the\nInternet. The only proven effective method for protecting privacy is the\nuse of strong end-to-end encryption. These techniques work well even on\nuntrusted public networks, where eavesdroppers are listening and possibly\neven manipulating data coming from an access point.\nTo ensure data privacy, good end-to-end encryption should provide the\nfollowing features:\nVerified authentication of the remote end.\nThe user should be able to know without a doubt that the remote end is\nwho it claims to be. Without authentication, a user could give sensitive\ndata to anyone claiming to be the legitimate service.\nStrong encryption methods.\nThe encryption algorithm should stand up to public scrutiny, and not be\neasily decrypted by a third party. There is no security in obscurity, and\nstrong encryption is even stronger when the algorithm is widely known\nand subject to peer review.\nA good algorithm with a suitably large and protected key can provide\nencryption that is unlikely to be broken by any effort in our lifetimes\nusing current technology. Beware of product vendors who assure you that\ntheir proprietary encryption using trade-secret algorithms are better than\nopen, peer-reviewed ones. 166 NETWORKING\nPublic key cryptography.\nWhile not an absolute requirement for end-to-end encryption, the use of\npublic key cryptography instead of a shared key can ensure that an\nindividual's data remains private, even if the key of another user of the\nservice is compromised. It also solves certain problems with distributing\nkeys to users over untrusted networks.\nData encapsulation.\nA good end-to-end encryption mechanism protects as much data as\npossible. This can range from encrypting a single email transaction to\nencapsulation of all IP traffic, including DNS lookups and other\nsupporting protocols. Some encryption tools simply provide a secure\nchannel that other applications can use. This allows users to run any\nprogram they like and still have the protection of strong encryption, even\nif the programs themselves dont support it.\nBe aware that laws regarding the use of encryption vary widely from place\nto place.\nSome countries treat encryption as munitions, and may require a permit,\nescrow of private keys, or even prohibit its use altogether.\nBefore implementing any solution that involves encryption, be sure to\nverify that use of this technology is permitted in your local area.\nIn the following sections, we'll take a look at some specific tools that can\nprovide good protection for your user's data.\nTLS\nThe most widely available end-to-end encryption technology is Transport\nLayer Security, known simply as TLS (or its predecessor SSL: Secure\nSockets Layer).\nBuilt into virtually all web browsers and many other applications, TLS\nuses public key cryptography and a trusted public key infrastructure (PKI)\nto secure data communications on the web.\nWhenever you visit a web URL that starts with https, you are using TLS.\nThe TLS implementation built into web browsers includes a collection of\ncertificates from organisations called Certificate Authorities (CA).\nA CA validates the identity of network users and\/or providers and ensures\nthat they are who they say they are and issues a certificate saying so. 9. SECURITY FOR WIRELESS NETWORKS 167\nRather than doing this by a signed fancy document suitable for framing,\nthis is done through the exchange of cryptographic keys.\nAs an example, someone wanting a certificate for their website submits a\nCertificate Request (CR), encoded (\"signed\") with a cryptographic key\ncreated specifically for signing the certificate request.\nThey submit this request to the CA, who then \"signs\" the request with\ntheir own key. These are encoded in the certificate along with the exact\nname of the website that the requester wants the certificate to be valid for.\nFor example, WWW.AIPOTU.GOV, from a certificate perspective, is not\nthe same as AIPOTU.GOV. Each site would require its own certificate to\npresent to a browser to do authenticated HTTPS transactions.\nIf the owner of AIPOTU.GOV domain only has their certificate issued for\nAIPOTU.GOV and not also WWW.AIPOTU.GOV, a user accessing the\n\"WWW\" address will see a warning for an invalid certificate for that site.\nThis can be confusing to some users and, over time, lead them to just\nexpect TLS Certificate warnings from their browser as normal when the\ntruth is completely the opposite case.\nWhen you browse to a website that uses TLS, the browser and the server\nfirst exchange certificates.\nThe browser then verifies that the hostname in the certificate provided by\nthe server matches the DNS hostname that the browser knows the server\nby, that the certificate has not expired or been revoked and that it has been\nsigned by a trusted certificate authority.\nThe server optionally verifies the validity of the browser's certificate. If the\ncertificates are approved, both sides then negotiate a master session key\nusing the previously exchanged certificates to protect the session that is\nbeing established.\nThat key is then used to encrypt all communications until the browser\ndisconnects.\nThis kind of data encapsulation is known as a tunnel. 168 NETWORKING\nover an encrypted tunnel. The conversation inside the tunnel is identical to\nany other unencrypted conversation.\nThe use of certificates with a PKI not only protects communication\nagainst eavesdroppers but is also used to prevent the so-called Man-in-\nthe-Middle (MitM) attack. In a MitM attack, a malicious user intercepts\nall communication between a client and a server. By presenting counterfeit\ncertificates to both the client and the server, a malicious user could carry\non two simultaneous encrypted sessions. Since this user knows the secret\non both connections, it is trivial to observe and manipulate the data being\npassed between the client and the server.\nFigure SWN 7: The man-in-the-middle effectively controls everything the user\nsees, and can record and manipulate all traffic. Without a public key\ninfrastructure to verify the authenticity of keys, strong encryption alone cannot\nprotect against this kind of attack. 9. SECURITY FOR WIRELESS NETWORKS 169\nUse of a good PKI can significantly reduce the chances of this kind of\nattack. In order to be successful, the malicious user would have to be in\npossession of a certificate signed by a trusted CA that it can present to the\nclient to accept as authentic.\nThis is only possible if they can trick the end-user into accepting it or if\nthe CA is compromised.\nCertificate Authorities bear a special burden to protect their systems and\nnetwork from unauthorised access and malicious users.\nIf a CA were to be compromised, the attacker who performed the\ncompromise could conduct MiTM attacks on any of the users trying to\nconnect to systems with a certificate issued by that CA.\nThey could also issue counterfeit certificates in response to legitimate\ncertificate requests, ensuring their ability to intercept or interfere with\nencrypted communications between browser users and servers.\nWhile CA compromise was once held to be very unlikely to happen, there\nhave been a number of incidents at the time of this writing proving this is\nno longer the case.\nCompanies whose primary activity was in acting as a commercial CA have\ngone out of business as a result of having their systems compromised and\ncounterfeit certificates issued under their name.\nIn September 2011, the certificate authority DigiNotar was found to have\nbeen subverted by crackers, forcing all its certificates to be revoked and\nsending it into bankruptcy.\nThese compromises were not the result of sophisticated computer\ncriminals employing exotic sophisticated attacks but simply lapses in the\nsecurity of their overall infrastructure and security policies and procedures.\nFinally, it is good to point out that TLS is not only used for web\nbrowsing. Insecure email protocols such as IMAP, POP, and SMTP can be\nsecured by wrapping them in an TLS tunnel.\nMost modern email clients support IMAPS and POPS (secure IMAP and\nPOP) as well as TLS protected SMTP. If your email server does not\nprovide TLS support, you can still secure it with TLS using a package like\nStunnel (http:\/\/www.stunnel.org\/). TLS can be used to effectively secure\njust about any service that runs over TCP. 170 NETWORKING\nSSH\nMost people think of SSH as a secure replacement for telnet, just as SCP\nand SFTP are the secure counterparts of RCP and FTP.\nBut SSH is much more than an encrypted remote shell. For example, it\ncan also act as a general purpose encrypting tunnel, or even an encrypting\nweb proxy.\nBy first establishing an SSH connection to a trusted location near (or even\non) a remote server, insecure protocols can be protected from\neavesdropping and attack.\nLike TLS, it uses strong public key cryptography to verify the remote\nserver and encrypt data. Instead of a PKI, it uses a key fingerprint cache\nthat is checked before a connection is permitted.\nIt can use passwords and public keys for user authentication, and, through\nits support for the Pluggable Authentication Modules (PAM) system, it\ncan also support other methods of authentication.\nWhile this technique may be a bit advanced for many users, network\narchitects can use SSH to encrypt traffic across untrusted links, such as\nwireless point-to-point links.\nSince the tools are freely available and run over standard TCP, any\neducated user can implement SSH connections for themselves, providing\ntheir own end-to-end encryption without administrator intervention.\nOpenSSH (http:\/\/openssh.org\/) is probably the most popular\nimplementation on Unix-like platforms.\nFree implementations such as Putty (http:\/\/www.putty.nl\/)and WinSCP\n(http:\/\/winscp.net\/) are available for Windows.\nOpenSSH will also run on Windows under the Cygwin package\n(http:\/\/www.cygwin.com\/) These examples will assume that you are using a\nrecent version of OpenSSH. 9. SECURITY FOR WIRELESS NETWORKS 171\nitself.\nTo establish an encrypted tunnel from a port on the local machine to a\nport on the remote side, use the -L switch. For example, suppose\nyou want to forward web proxy traffic over an encrypted link to the squid\nserver at squid.example.net. Forward port 3128 (the default proxy port)\nusing this command:\nssh -fN -g -L3128:squid.example.net:3128 squid.example.net\nThe -fN switches instruct ssh to fork into the background after\nconnecting.\nThe -g switch allows other users on your local segment to connect to the\nlocal machine and use it for encryption over the untrusted link.\nOpenSSH will use a public key for authentication if you have set one up,\nor it will prompt you for your password on the remote side. You can then\nconfigure your web browser to connect to localhost port 3128 as its web\nproxy service. 172 NETWORKING\nAll web traffic will then be encrypted before transmission to the remote\nside. SSH can also act as a dynamic SOCKS4 or SOCKS5 proxy. This\nallows you to create an encrypting web proxy, without the need to set up\nsquid. Note that this is not a caching proxy; it simply encrypts all traffic:\nssh -fN -D 8080 remote.example.net\nConfigure your web browser to use SOCKS4 or SOCKS5 on local port\n8080, and away you go.\nSSH can encrypt data on any TCP port, including ports used for email. It\ncan even compress the data along the way, which can decrease latency on\nlow capacity links:\nssh -fNCg -L110:localhost:110 -L25:localhost:25 mailhost.example.net\nThe -C switch turns on compression.\nYou can add as many port forwarding rules as you like by specifying the\n-L switch multiple times.\nNote that in order to bind to a local port less than 1024, you must have\nroot privileges on the local machine. These are just a few examples of the\nflexibility of SSH. By implementing public keys and using the ssh\nforwarding agent, you can automate the creation of encrypted tunnels\nthroughout your wireless network, and protect your communications with\nstrong encryption and authentication.\nOpenVPN\nOpenVPN is a VPN implementation built on SSL encryption with both\na commercially-licensed and an Open Source \"community\" edition.\nThere are OpenVPN client implementations for a wide range of operating\nsystems including Linux, Window 2000\/XP and higher, OpenBSD,\nFreeBSD, NetBSD, and Mac OS X. Many users find it easier to\nunderstand and configure than IPSEC VPNs. OpenVPN has some\ndisadvantages though, such as fairly high latency of traffic over the VPN\ntunnel. Some amount of latency is unavoidable since all\nencryption\/decryption is done in user space, but using relatively new\ncomputers on either end of the tunnel can minimise this. 9. SECURITY FOR WIRELESS NETWORKS 173\nWhile it can use traditional shared keys for authentication, OpenVPN\nreally shines when used with SSL certificates and a certificate authority.\nOpenVPN has many advantages that make it a good option for providing\nend-to-end security. Some of these reasons include:\n\u2022 it is based on proven, robust, encryption protocols (SSL and RSA)\n\u2022 it is relatively easy to configure. It functions across many different\nplatforms\n\u2022 it is well-documented. An Open-Source \"Community\" version is\nmaintained in addition to a for-pay commercial version.\nOpenVPN needs to connect to a single TCP or UDP port on the remote\nside. Once established, it can encapsulate all data down to the Networking\nlayer, or even down to the Data-Link layer, if your solution requires it.\nYou can use it to create robust VPN connections between individual\nmachines, or simply use it to connect network routers over untrusted\nwireless networks. VPN technology is a complex field, and is a bit beyond\nthe scope of this section to go into more detail. It is important to\nunderstand how VPNs fit into the structure of your network in order to\nprovide the best possible protection without opening up your organisation\nto unintentional problems.\nThere are many good online resources that deal with installing OpenVPN\non a server and client, we recommend this article from Linux Journal:\nhttp:\/\/www.linuxjournal.com\/article\/7949\nas well as the official HOWTO:\nhttp:\/\/openvpn.net\/howto.html\nTor & Anonymizers\nThe Internet is basically an open network based on trust.\nWhen you connect to a web server across the Internet, your traffic passes\nthrough many different routers, owned by a great variety of institutions,\ncorporations and individuals.\nIn principle, any one of these routers has the ability to look closely at your\ndata, seeing the source and destination addresses, and quite often also the\nactual content of the data.\nEven if your data is encrypted using a secure protocol, it is possible for\nyour Internet provider to monitor the amount of data transferred, as well\nas the source and destination of that data. 174 NETWORKING\nOften this is enough to piece together a fairly complete picture of your\nactivities on-line. Privacy and anonymity are important, and closely linked\nto each other. There are many valid reasons to consider protecting your\nprivacy by anonymizing your network traffic.\nSuppose you want to offer Internet connectivity to your local community\nby setting up a number of access points for people to connect to.\nWhether you charge them for their access or not, there is always the risk\nthat people use the network for something that is not legal in your\ncountry or region.\nYou could plead with the legal system that this particular illegal action was\nnot performed by yourself, but could have been performed by anyone\nconnecting to your network. The problem is neatly sidestepped if it were\ntechnically infeasible to determine where your traffic was actually headed.\nAnd what about on-line censorship?\nPublishing web pages anonymously may also be necessary to avoid\ngovernment censorship. There are tools that allow you to anonymize your\ntraffic in relatively easy ways.\nThe combination of Tor (http:\/\/www.torproject.org) and Privoxy\n(http:\/\/www.privoxy.org) is a powerful way to run a local proxy server that\nwill pass your Internet traffic through a number of servers all across the\nnet, making it very difficult to follow the trail of information.\nTor can be run on a local PC, under Microsoft Windows, Mac OSX,\nLinux and a variety of BSD's, where it anonymizes traffic from the\nbrowser on that particular machine.\nTor and Privoxy can also be installed on a gateway server, or even a small\nembedded access point (such as a Linksys WRT54G) where it provides\nanonymity to all network users automatically.\nTor works by repeatedly bouncing your TCP connections across a number\nof servers spread throughout the Internet, and by wrapping routing\ninformation in a number of encrypted layers (hence the term onion\nrouting), that get peeled off as the packet moves across the network.\nThis means that, at any given point in the network, the source and\ndestination addresses cannot be linked together.\nThis makes traffic analysis extremely difficult. 9. SECURITY FOR WIRELESS NETWORKS 175\nThe need for the Privoxy privacy proxy in connection with Tor is due to\nthe fact that name server queries (DNS queries) in most cases are not\npassed through the proxy server, and someone analysing your traffic would\neasily be able to see that you were trying to reach a specific site (say\ngoogle.com) by the fact that you sent a DNS query to translate\ngoogle.com to the appropriate IP address.\nPrivoxy connects to Tor as a SOCKS4a proxy, which uses hostnames (not\nIP addresses) to get your packets to the intended destination. In other\nwords, using Privoxy with Tor is a simple and effective way to prevent\ntraffic analysis from linking your IP address with the services you use\nonline.\nCombined with secure, encrypted protocols (such as those we have seen in\nthis chapter), Tor and Privoxy provide a high level of anonymity on the\nInternet. PLANNING AND DEPLOYMENT 10. DEPLOYMENT PLANNING 177\n10. DEPLOYMENT PLANNING\nEstimating capacity\nIn order to estimate capacity, it is important to understand that a wireless\ndevice\u2019s listed speed (the so called data rate) refers to the rate at which the\nradios can exchange symbols, not the useable throughput you will observe.\nThroughput is also referred to as channel capacity, or simply bandwidth\n(although this term is different from radio bandwidth!\nThe bandwidth-throughput is measured in Mbps, while the radio\nbandwidth is measures in MHz.). For example, a single 802.11g link may\nuse 54 Mbps radios, but it will only provide up to 22 Mbps of actual\nthroughput. The rest is overhead that the radios need in order to\ncoordinate their signals using the 802.11g protocol.\nNote that throughput is a measurement of bits over time. 22 Mbps means\nthat in any given second, up to 22 megabits can be sent from one end of\nthe link to the other. If users attempt to push more than 22 megabits\nthrough the link, it will take longer than one second.\nSince the data can\u2019t be sent immediately, it is put in a queue, and\ntransmitted as quickly as possible.\nThis backlog of data increases the time needed for the most recently\nqueued bits to the traverse the link.\nThe time that it takes for data to traverse a link is called latency, and high\nlatency is commonly referred to as lag.\nYour link will eventually send all of the queued traffic, but your users will\nlikely complain as the lag increases.\nHow much throughput will your users really need?\nIt depends on how many users you have, and how they use the wireless\nlink.\nVarious Internet applications require different amounts of throughput. 178 PLANNING AND DEPLOYMENT\nApplication Requirement\/ Notes\nUser\nText messaging \/ < 1 kbps As traffic is infrequent and asynchronous, IM will\nIM tolerate high latency.\nEmail 1 to 100 kbps As with IM, email is asynchronous and\nintermittent, so it will tolerate latency. Large\nattachments, viruses, and spam significantly add\nto bandwidth usage.\nNote that web email services (such as Yahoo or\nHotmail) should be considered as web browsing,\nnot as email.\nWeb browsing 50 - 100+ kbps Web browsers only use the network when data is\nrequested. Communication Is asynchronous, so a\nfair amount of lag can be tolerated.\nAs web browsers request more data (large\nimages, long downloads, etc.) bandwidth usage\nwill go up significantly.\nStreaming audio 96 - 160 kbps Each user of a streaming audio service will use a\nconstant amount of relatively large bandwidth for\nas long as it plays.\nIt can tolerate some transient latency by using\nlarge buffers on the client. But extended periods\nof lag will cause audio \u201cskips\u201d or outright session\nfailures.\nVoice over IP 24 - 100+ kbps As with streaming audio, VoIP commits a\n(VoIP) constant amount of bandwidth to each user for\nthe duration of the call. But with VoIP, the\nbandwidth is used roughly equally in both\ndirections. Latency on a VoIP connection is\nimmediate and annoying to users.\nLag greater than a few milliseconds is\nunacceptable for VoIP.\nStreaming video 64 - 200+ kbps As with streaming audio, some intermittent\nlatency is avoided by using buffers on the client.\nStreaming video requires high throughput and\nlow latency to work properly.\nPeer-to-peer file 0 - infinite While peer to peer applications will tolerate any\nsharing Mbps amount of latency, they tend to use up all\napplications available throughput by transmitting data to as\nmany clients as possible, as quickly as possible.\nUse of these applications will cause latency and\nthroughput problems for all other network users\nunless you use careful bandwidth shaping. 10. DEPLOYMENT PLANNING 179\nTo estimate the necessary throughput you will need for your network,\nmultiply the expected number of users by the requirements of applications\nthey will probably use.\nFor example, 50 users who are chiefly browsing the web will likely\nconsume 2.5 to 5 Mbps or more of throughput at peak times, and will\ntolerate some latency.\nOn the other hand, 50 simultaneous VoIP users would require 5 Mbps or\nmore of throughput in both directions with low latency. Since 802.11g\nwireless equipment is half duplex (that is, it only transmits or receives,\nnever both at once) you should accordingly double the required\nthroughput, for a total of 10 Mbps.\nYour wireless links must provide that capacity every second, or\nconversations will lag.\nSince all of your users are unlikely to use the connection at precisely the\nsame moment, it is common practice to oversubscribe available throughput\nby some factor (that is, allow more users than the maximum available\nbandwidth can support).\nOversubscribing by a factor of 5 to 10 is quite common. In all likelihood,\nyou will oversubscribe by some amount when building your network\ninfrastructure.\nBy carefully monitoring throughput throughout your network, you will be\nable to plan when to upgrade various parts of the network, and how\nmuch additional resources will be needed.\nCalculating the link budget\nDetermining if a link is feasible or not is a process called link budget\ncalculation and can be either performed manually or using specialised\ntools.\nA basic communication system consists of two radios, each with its\nassociated antenna, the two being separated by the path to be covered as\nshown in following Figure DP 1. 180 PLANNING AND DEPLOYMENT\nFigure DP 1: Components of a Basic Communication System.\nIn order to have a communication between the two, the radios require a\ncertain minimum signal to be collected by the antennas and presented at\ntheir input ports.\nWhether or not signals can be passed between the radios depends on the\ncharacteristics of the equipment and on the diminishment of the signal\ndue to distance, called path loss. In such a system, some of the parameters\ncan be modified (the equipment used) while others are fixed (the distance\nbetween the radios). Let\u2019s start by examining the parameters that can we\ncan modify.\n1. The characteristics of the equipment to be considered when calculating\nthe link budget are:\nTransmit (TX) Power. It is expressed in milliwatts or in dBm. TX power is\noften dependent on the transmission rate.\nThe TX power of a given device should be specified in the literature\nprovided by the manufacturer.\nAn example is shown here following, where you can see that using\n802.11g there is a difference of 5 dB in output power when using 6 Mbs\nor 54 Mbs. 10. DEPLOYMENT PLANNING 181\nFigure DP 2: Ubiquiti Bullet2 Datasheet\nAntenna Gain.\nAntennas are passive devices that create the effect of amplification by\nvirtue of their physical shape.\nAntennas have the same characteristics when receiving and transmitting.\nSo a 12 dBi antenna is simply a 12 dBi antenna, without specifying if it is\nin transmission or reception mode.\nTypical values are as follows: parabolic antennas have a gain of 19-24 dBi;\nomnidirectional antennas have 5- 12 dBi; sectorial antennas have roughly\na 12-15 dBi gain.\nMinimum Received Signal Level (RSL), or simply, the sensitivity of the\nreceiver.\nThe minimum RSL is always expressed as a negative dBm (-dBm) and is\nthe lowest signal level the radio can distinguish.\nThe minimum RSL is dependent upon rate, and as a general rule the\nlowest rate (1 Mbps) has the greatest sensitivity.\nThe minimum will be typically in the range of -75 to -95 dBm. 182 PLANNING AND DEPLOYMENT\nLike TX power, the RSL specifications should be provided by the\nmanufacturer of the equipment.\nIn the datasheet presented above you can see that there is a 20 dB\ndifference in receiver sensitivity, with -92 dBm at 6 Mbs and -72 dBm at\n54 Mbs. Don\u2019t forget that a difference of 20 dB means a ratio of 100 in\nterms of power!\nCable Losses. Some of the signal's energy is lost in the cables, the\nconnectors and other devices, going from the radios to the antennas. T\nhe loss depends on the type of cable used and on its length.\nSignal loss for short coaxial cables including connectors is quite low, in the\nrange of 2-3 dB. It is better to have cables as short as possible. Equipment\nnow tends to have embedded antennas and thus the cable length is very\nshort.\n2. When calculating the path loss, several effects must be considered. One\nhas to take into account the free space loss, attenuation and scattering.\nFree Space Loss.\nGeometric spreading of the wavefront, commonly known as free space\nloss, diminishes signal power. Ignoring everything else, the further away\nthe two radios, the smaller the received signal is due to free space loss.\nThis is independent of the environment, it depends only on the distance.\nThis loss happens because the radiated signal energy expands as a function\nof the distance from the transmitter.\nUsing decibels to express the loss and using a generic frequency f, the\nequation for the Free Space Loss is:\nL = 32.4+20*log (D)+20*log (f)\nfsl 10 10\nwhere L is expressed in dB and D is in kilometres and f is in MHz.\nfsl\nWhen plotting the free space loss vs the distance, one gets a figure like the\none below. What should be noted is that the difference between using\n2400 MHz and 5300 MHz is 6 dB in terms of free space loss.\nSo the higher frequency gives a higher free space loss, which is usually\nbalanced by a higher gain in the parabolic antennas.\nA parabolic antenna operating at 5 GHz is 6 dB more powerful than one\noperating at 2.4 GHz, for the same antenna dimensions. 10. DEPLOYMENT PLANNING 183\nHaving two antennas of 6 dB higher gain on each side, provides a net 6\ndB advantage when migrating from 2.4 to 5 GHz.\nFigure DP 3: Free Space Path Loss calculation graph.\nAttenuation\nThe second contribution to the path loss is attenuation.\nThis takes place as some of the power is absorbed when the wave passes\nthrough solid objects such as trees, walls, windows and floors of buildings.\nAttenuation can vary greatly depending upon the structure of the object\nthe signal is passing through, and it is very difficult to quantify.\nScattering\nAlong the link path, the RF energy leaves the transmitting antenna and\nenergy spreads out. Some of the RF energy reaches the receiving antenna\ndirectly, while some bounces off the ground. Part of the RF energy which\nbounces off the ground reaches the receiving antenna. Since the reflected\nsignal has a longer way to travel, it arrives at the receiving antenna later\nthan the direct signal. This effect is called multipath, or signal dispersion.\nIn some cases reflected signals add together and cause no problem.\nWhen they add together out of phase, the received signal is almost\nworthless. In some cases, the signal at the receiving antenna can be zeroed\nby the reflected signals.\nThis is known as extreme fading, or nulling. There is a simple technique\nthat is used to deal with multipath, called antenna diversity. 184 PLANNING AND DEPLOYMENT\nIt consists of adding a second antenna to the radio. Multipath is in fact a\nvery location-specific phenomenon.\nIf two signals add out of phase at one location, they will not add\ndestructively at a second, nearby location.\nIf there are two antennas, at least one of them should be able to receive a\nuseable signal, even if the other is receiving a faded one. In commercial\ndevices, antenna switching diversity is used: there are multiple antennas on\nmultiple inputs, with a single receiver.\nThe signal is received through only one antenna at a time.\nWhen transmitting, the radio uses the antenna last used for reception. The\ndistortion given by multipath degrades the ability of the receiver to recover\nthe signal in a manner much like signal loss.\nPutting all these parameters together leads to the link budget calculation.\nIf you are using different radios on the two sides of the link, you should\ncalculate the path loss twice, once for each direction (using the appropriate\nTX power, RX power, TX antenna gain, RX antenna gain for each\ncalculation).\nAdding up all the gains and subtracting all the losses gives:\nTX Power Radio 1\n+Antenna Gain Radio 1\n-Cable Losses Radio 1\n+Antenna Gain Radio 2\n-Cable Losses Radio 2\n=Total Gain\nSubtracting the Path Loss from the Total Gain:\nTotal Gain - Path Loss = Signal Level at receiving side of the link\nIf the resulting signal level is greater than the minimum received signal\nlevel of the receiving radio, then the link is feasible!\nThe received signal is powerful enough for the radio to use it.\nRemember that the minimum RSL is always expressed as a negative dBm,\nso -56 dBm is greater than -70 dBm. 10. DEPLOYMENT PLANNING 185\nOn a given path, the variation in path loss over a period of time can be\nlarge, so a certain margin should be considered.\nThis margin is the amount of signal above the sensitivity of radio that\nshould be received in order to ensure a stable, high quality radio link\nduring bad weather and other atmospheric disturbances.\nA margin of 10 to 15 dB is fine. To give some space for attenuation and\nmultipath in the received radio signal, a margin of 20dB should be safe\nenough.\nOnce you have calculated the link budget in one direction, repeat the\ncalculation for the other direction.\nSubstitute the transmit power for that of the second radio, and compare\nthe result against the minimum received signal level of the first radio.\nExample link budget calculation\nAs an example, we want to estimate the feasibility of a 5 km link, with\none access point and one client radio.\n\u2022 The access point is connected to an omni directional antenna with\na 10dBi gain, while the client is connected to a directional\nantenna with 14 dBi gain.\n\u2022 The transmitting power of the AP is 100 mW (or 20 dBm) and its\nsensitivity is -89 dBm.\n\u2022 The transmitting power of the client is 30 mW (or 15 dBm) and\nits sensitivity is -82 dBm.\n\u2022 The cables are short, so we can estimate a loss of 2 dB at each\nside.\nLet\u2019s start by calculating the link budget from the AP to the client, as\nshown in Figure DP 4. 186 PLANNING AND DEPLOYMENT\nFigure DP 4: Link Budget calculation from AP to client.\nAdding up all the gains and subtracting all the losses for the AP to client\nlink gives:\n20 dBm (TX Power Radio 1)\n+10 dBi (Antenna Gain Radio 1)\n-2 dB (Cable Losses Radio 1)\n+14 dBi (Antenna Gain Radio 2)\n-2 dB (Cable Losses Radio 2)\n40 dB= Total Gain\nThe path loss for a 5 km link, considering the free space loss is -114dB.\nSubtracting the path loss from the total gain:\n40 dB - 114 dB = -74 dB\nSince -74 dB is greater than the minimum receive sensitivity of the client\nradio (-82 dBm), the signal level is just enough for the client radio to be\nable to hear the access point. There is only 8 dB of margin (82 dB - 74\ndB) which will likely work fine in fair weather, but may not be enough to\nprotect against extreme weather conditions.\nNext we calculate the link from the client back to the access point, as\nshown on the next page. 10. DEPLOYMENT PLANNING 187\nFigure DP 5: Link Budget calculation from client to AP.\n15 dBm (TX Power Radio 2)\n+14 dBi (Antenna Gain Radio 2)\n-2 dB (Cable Losses Radio 2)\n+10 dBi (Antenna Gain Radio 1)\n-2 dB (Cable Losses Radio 1)\n35 dB = Total Gain\nObviously, the path loss is the same on the return trip. So our received\nsignal level on the access point side is:\n35 dB - 114 dB = -79 dB\nSince the receive sensitivity of the AP is -89dBm, this leaves us 10dB of\nmargin (89dB - 79dB). Overall, this link will probably work fine.\nBy using a 24dBi dish on the client side rather than a 14dBi antenna, we\nwill get an additional 10dBi of gain on both directions of the link\n(remember, antenna gain is reciprocal).\nA more expensive option would be to use higher power radios on both\nends of the link, but note that adding an amplifier or higher-powered card\nto one end generally does not help the overall quality of the link. 188 PLANNING AND DEPLOYMENT\nTables for calculating link budget\nTo calculate the link budget, simply approximate your link distance, and\nthen fill in the following tables:\nFree Space Path Loss at 2.4 GHz\nDistance\n(m) 100 500 1000 3000 5000 10000\nLoss (dB)\n80 94 100 110 114 120\nAntenna Gain:\nRadio 1 Antenna + Radio 2 Antenna = Total Antenna Gain\nLosses:\nRadio 1 + Cable Radio 2 + Cable Free Space Path\nLoss (dB) Loss (dB) Loss (dB) = Total Loss (dB)\nLink Budget for Radio 1Radio 2:\nRadio 1 TX + Antenna - Total Loss = Signal > Radio 2\nPower Gain Sensitivity\nLink Budget for Radio 2Radio 1:\nRadio 2 TX + Antenna - Total Loss = Signal > Radio 1\nPower Gain Sensitivity\nIf the received signal is greater than the minimum received signal strength\nin both directions of the link, as well as any noise received along the path,\nthen the link is possible. 10. DEPLOYMENT PLANNING 189\nLink planning software\nWhile calculating a link budget by hand is straightforward, there are a\nnumber of tools available that will help automate the process. In addition\nto calculating free space loss, these tools will take many other relevant\nfactors into account as well (such as tree absorption, terrain effects,\nclimate, and even estimating path loss in urban areas). Most commercial\ntools are very expensive and are often designed to be used with specific\nhardware. In this section we will discuss a free tool called RadioMobile.\nRadioMobile\nRadio Mobile is a tool for the design and simulation of wireless systems. It\npredicts the performance of a radio link by using information about the\nequipment and a digital map of the area. It is public domain software but\nit is not open source. Radio Mobile uses a digital terrain elevation model\nfor the calculation of coverage, indicating received signal strength at\nvarious points along the path. It automatically builds a profile between\ntwo points in the digital map showing the coverage area and first Fresnel\nzone. An example is shown in Figure DP 6 below.\nFigure DP 6: Radio Mobile simulation showing a digital terrain elevation\nand first Fresnel zone.\nDuring the simulation, it checks for line of sight and calculates the Path\nLoss, including losses due to obstacles.\nIt is possible to create networks of different topologies, including net\nmaster\/slave, point-to-point, and point-to-multipoint. The software\ncalculates the coverage area from the base station in a point-to-multipoint\nsystem. It works for systems having frequencies from 100 kHz to 200\nGHz. Digital elevation maps (DEM) are available for free from several\nsources, and are available for most of the world. 190 PLANNING AND DEPLOYMENT\nDEMs do not show coastlines or other readily identifiable landmarks, but\nthey can easily be combined with other kinds of data (such as aerial\nphotos or topographical charts) in several layers to obtain a more useful\nand readily recognisable representation. You can digitise your own maps\nand combine them with DEMs. The digital elevation maps can be merged\nwith scanned maps, satellite photos and Internet map services (such as\nGoogle Maps) to produce accurate prediction plots.\nThere are two versions of RadioMobile: a version running on Windows\nand a version running online via a web interface. Here are the main\ndifferences between the two.\nWeb version:\n\u2022 it can run on any machine (Linux, Mac, Windows, tablet, phone,\netc)\n\u2022 it does not require big downloads. As it runs online, data is stored\non the server and only the necessary data is downloaded.\n\u2022 it saves sessions. If you run a simulation and login after some\ntime, you will still find your simulation and the results.\n\u2022 it is easier to use, especially for beginners.\n\u2022 it requires connectivity. It is not possible to run a simulation if\nyou are offline.\n\u2022 as it has been developed for the community of radio amateurs, it\ncan work only for certain frequency bands. As an example, it is\nnot possible to simulate links at 5.8GHz but only at 5.3GHz.\nThis is good enough from a practical point of view, but one has\nto keep it in mind.\nWindows version:\n\u2022 it can run offline. Once the maps are downloaded, there is no\nneed to be online to run the simulation.\n\u2022 one can use an external GPS to get the exact position of the\nstation. While this is not often used, it could be useful\nsometimes.\n\u2022 it runs on Windows (it does run in Linux but not directly).\n\u2022 it requires big downloads. If your bandwidth is limited,\ndownloading many maps might be a problem. The online version\nrequires smaller downloads.\n\u2022 It is not user friendly, especially for beginners. 10. DEPLOYMENT PLANNING 191\nThe main RadioMobile webpage, with examples and tutorials, is available\nat: http:\/\/www.cplus.org\/rmw\/english1.html\nFollow the instructions to install the software on Windows.\nRadioMobile online\nTo use the online version of RadioMobile you must first create an\naccount. Go to: http:\/\/www.cplus.org\/rmw\/rmonline.html and create a\nnew account. You will receive a confirmation email in few minutes and\nwill be ready to go.\nSimulating a link requires some steps that require following the menu on\nthe left, from top to bottom as shown in Figure DP 7 below.\nFigure DP 7: Preparing to simulate a link using Radio Mobile.\nThe first step is to click on New Site. You will be presented a Map, similar\nto Google Maps. You can zoom into the map to find the location of your\nfirst site. Drag the Orange Placemark and place it in the desired position.\nOnce you are done, click on Submit.\nGive the location a meaningful name, and click on Add to My Sites. In\nthis way, you will be able to use this location for the simulation.\nRepeat the same process for the second site.\nOnce you have at least two sites, you can proceed with the next step. The\ninterface will not allow you to enter directly the coordinates of the site, so\nyou might want to enter an approximate position for the cursor and then\nafterward correct the value of the coordinates in the table. 192 PLANNING AND DEPLOYMENT\nThe second step involves entering information about the link: the\nequipment characteristics, the antennas, etc.\nClick on New Link in the menu on the left. Select the two sites from the\ndrop-down menus. Enter a meaningful name for the link and enter the\ninformation about the equipment use. The sensitivity of the receiver is\nexpressed in microVolts, while we usually use dBm.\nTo translate from microVolts to dBm, here are some examples:\n-90dBm is 7.07 microvolts\n-85dBm is 12.6 microvolts\n-80dBm is 22.4 microvolts\n-75dBm is 39.8 microvolts\n-70dBm is 70.7 microvolts\nIt is very important to choose a frequency that RadioMobile online can\nhandle.\nHere are the most important frequencies for WiFi links:\nUse 2300 MHz for 2.4 GHz links and 5825 MHz for 5.8 GHz links.\nOnce you have entered all the information, click on Submit. In a short\ntime, you will be presented a figure similar to the one below.\nFigure DP 8: Output of the simulation. 10. DEPLOYMENT PLANNING 193\nThis page has all the necessary information to understand if the link is\nfeasible or not.\nIt gives information on: the link length, the azimuth, elevation and tilt\nyou should give to antennas, the free space loss, the total space loss\nincluding the statistical loss and, most importantly, the received signal\nlevel.\nWith the receiver sensitivity you entered, you will be presented with the\nfade margin and you will be able to determine if the link is feasible or not.\nIf you are happy with the result, at the top of the page you should click\non Add to my sites and the link will be stored. If you are not satisfied and\nwant to simulate a different equipment setup, click on Modify this link.\nRadio Mobile for Windows in simple steps\nThis is an abridged guide to start using Radio Mobile after installation. Every\nparameter not specified here can be left at the default value and later modified\nif needed.\nStep 1: download the digital elevation maps (DEMs) of your area of\ninterest. choose SRTM format.\nStep 2: create a map. In \u201cFile\u201d \u2192\u201d Map properties\u201d, choose the midpoint\nof your area of interest as the coordinates for your map and a size in km\nlarge enough to encompass all your points. Use 514X514 pixels for now.\nYou can add another type of map (like one with roads) to the raw DEM if\nyou like.\nStep 3: Create systems. In \u201cFile\u201d \u2192\u201d Network properties\u201d \u2192\u201dSystems\u201d.\nEach one is a combination of TX power, RX sensitivity and antenna gain.\nSelect omni antenna even if your antenna is directional, but insert the real\ngain.\nStep 4: create units. Each unit has a name and a geographical position.You\ncan use degrees, minutes, seconds or degrees and fractions, but make sure\nto select the proper hemisphere (N or S, E or W).\nStep 5: Assign roles: select item \u201cNetworks properties\u201d from the menu\n\u201cFile\u201d. Then go to the tab \u201cMembership\u201d where you will be allowed to edit\nthe system and role for each unit. Enable each unit in the list with a\ncheckmark. Assign a name to your network and in the \u201dparameters\u201d tab\nset the minimum and maximum frequency of operation in MHz.\nStep 6: View your network on the map. Select \u201cView\u201d \u2192\u201dShow\nnetworks\u201d\u2192\u201dAll\u201d 194 PLANNING AND DEPLOYMENT\nStep 7: Obtain the profile and point to point link budget. \u201cTools\u201d\n\u2192\u201dRadio link\u201d. You can switch to the detailed view that gives you a\ntextual description of the output of the simulation.\nStep 8: View coverage: go to \u201cTools\u201d \u2192 \u201cRadio coverage\u201d \u2192 \u201cSingle\npolar\u201d to obtain the coverage of each station. Here the type of antenna\nbecomes relevant. If it is not an omni you should edit the antenna pattern\nand the orientation of the boresight (direction where the beam is pointing).\nUsing Google Earth to obtain an elevation profile\nGoogle Earth is a very popular mapping application. It can be used to\nobtain the elevation profile between two points and therefore determine\nthe existence (or not) of the optical line of sight. The radioelectric line of\nsight can be derived from the optical one by adding the effect of the earth\ncurvature (by using the modified radius of the earth) and the requirements\nfor clearing the first Fresnel zone.\nThe procedure is the following:\nInstall Google Earth in your device, launch the application and zoom into\nthe map so you can see the two points that you want to link.\n1. In the upper menu, click on \"Add path\"\n2. Click to set the first point and then for the second point\n3. Give the connection a name (\"Link\" for example) and click OK\nin the pop-up window\n4. The connection appears in the menu on the left\n5. Right click on the name of the connection (\"Link\" in our\nexample)\n6. Select \"Show elevation profile\"\n7. The elevation profile appears at the bottom on the screen\n8. If you move along the profile, you will see a red arrow showing\nwhere the point is in the map\nAvoiding noise\nThe unlicensed ISM and U-NII bands represent a very tiny piece of the\nknown electromagnetic spectrum. Since this region can be utilised without\npaying license fees, many consumer devices use it for a wide range of\napplications. 10. DEPLOYMENT PLANNING 195\nCordless phones, analog video senders, Bluetooth, baby monitors, and\neven microwave ovens compete with wireless data networks for use of the\nvery limited 2.4 GHz band.\nThese signals, as well as other local wireless networks, can cause significant\nproblems for long-range wireless links. Here are some steps you can use to\nreduce reception of unwanted signals.\nIncrease antenna gain on both sides of a point-to-point link. Antennas not\nonly add gain to a link, but their increased directionality tends to reject\nnoise from areas around the link.\nTwo high gain dishes that are pointed at each other will reject noise from\ndirections that are outside the path of the link. Using omnidirectional\nantennas will receive noise from all directions.\nFigure DP 9: A single omnidirectional antenna vs. multiple sectorials.\nUse sectorials instead of using an omnidirectional.\nBy making use of several sectorial antennas, you can reduce the overall\nnoise received at a distribution point.\nBy staggering the channels used on each sectorial, you can also increase\nthe available bandwidth to your clients. 196 PLANNING AND DEPLOYMENT\nDon\u2019t use an amplifier. Amplifiers can make interference issues worse by\nindiscriminately amplifying all received signals, including sources of\ninterference. Amplifiers also cause interference problems for other nearby\nusers of the band.\nUse the best available channel. Remember that 802.11b\/g channels are 22\nMHz wide, but are only separated by 5 MHz.\nPerform a site survey, and select a channel that is as far as possible from\nexisting sources of interference. Remember that the wireless landscape can\nchange at any time as people add new devices (cordless phones, other\nnetworks, etc.) If your link suddenly has trouble sending packets, you may\nneed to perform another site survey and pick a different channel.\nIf possible, use 5.8 GHz. While this is only a short-term solution, there is\ncurrently far more consumer equipment installed in the field that uses 2.4\nGHz. Using 802.11a you will avoid this congestion altogether.\nIf all else fails, use licensed spectrum. There are places where all available\nunlicensed spectrum is actually used. In these cases, it may make sense to\nspend the additional money for obtaining the respective license and deploy\nequipment that uses a less congested band. For long distance point-to-\npoint links that require very high throughput and maximum uptime, this\nis certainly an option. Of course, these features come at a much higher\nprice tag compared to unlicensed equipment.\nRecently equipment in the 17 GHz and 24 GHz bands have become\navailable.\nAlthough it is considerably more expensive, it also offers much greater\nbandwidth, and in many countries these frequencies are unlicensed.\nTo identify sources of noise, you need tools that will show you what is\nhappening in the air at 2.4 GHz. We will see some examples of these tools\nin the chapters called Network Monitoring and Maintenance and\nTroubleshooting. 10. DEPLOYMENT PLANNING 197\nRepeaters\nThe most critical component to building long distance network links is\nline of sight (often abbreviated as LOS).\nTerrestrial microwave systems simply cannot tolerate large hills, trees, or\nother obstacles in the path of a long distance link. You must have a clear\nidea of the lay of the land between two points before you can determine if\na link is even possible. But even if there is a mountain between two\npoints, remember that obstacles can sometimes be turned into assets.\nMountains may block your signal, but assuming power can be provided\nthey also make very good repeater sites.\nRepeaters are nodes that are configured to rebroadcast traffic that is not\ndestined for the node itself. In a mesh network, every node is a repeater.\nIn a traditional infrastructure network, repeater nodes must be configured\nto pass along traffic to other nodes. A repeater can use one or more\nwireless devices.\nWhen using a single radio (called a one-arm repeater), overall efficiency is\nslightly less than half of the available bandwidth, since the radio can either\nsend or receive data, but never both at once. These devices are cheaper,\nsimpler, and have lower power requirements.\nA repeater with two (or more) radio cards can operate all radios at full\ncapacity, as long as they are each configured to use non-overlapping\nchannels.\nOf course, repeaters can also supply an Ethernet connection to provide\nlocal connectivity.\nRepeaters can be purchased as a complete hardware solution, or easily\nassembled by connecting two or more wireless nodes together with\nEthernet cable.\nWhen planning to use a repeater built with 802.11 technology, remember\nthat nodes must be configured for master, managed, or ad-hoc mode.\nTypically, both radios in a repeater are configured for master mode, to\nallow multiple clients to connect to either side of the repeater. But\ndepending on your network layout, one or more devices may need to use\nad-hoc or even client mode. 198 PLANNING AND DEPLOYMENT\nhave no direct line of sight.\nTypically, repeaters are used to overcome obstacles in the path of a long\ndistance link. For example, there may be buildings in your path, but those\nbuildings contain people. Arrangements can often be worked out with\nbuilding owners to provide bandwidth in exchange for roof rights and\nelectricity. If the building owner isn\u2019t interested, tenants on high floors\nmay be able to be persuaded to install equipment in a window. If you\ncan\u2019t go over or through an obstacle, you can often go around it. Rather\nthan using a direct link, try a multi-hop approach to avoid the obstacle.\ncircumvented by using multiple repeater sites around the base.\nFinally, you may need to consider going backwards in order to go\nforwards. If there is a high site available in a different direction, and that\nsite can see beyond the obstacle, a stable link can be made via an indirect\nroute. 10. DEPLOYMENT PLANNING 199\nFigure DP 12: Site D could not make a clean link to site A or B, since site C is in the\nway and is not hosting a node. By installing a high repeater, nodes A, B, and D can\ncommunicate with each other. Note that traffic from node D actually travels further\naway from the rest of the network before the repeater forwards it along.\nDeployment planning for IPv6\nAs we mentioned in the chapter called Networking, most regions of the\nworld have either exhausted or nearly exhausted their IPv4 addresses.\nTherefore it is important that you build into your planning the\ndeployment of IPv6 based networks.\nIt is understood that at the time of writing there are still many sites and\nservices that are still only available by IPv4.\nSo in order to become a leader in deploying IPv6, you will need to be able\nto interconnect with legacy IPv4 networks as well as teach and guide your\nusers and developers how to handle IPv6 alongside IPv4.\nBy leading the way in deploying IPv6 in your network you will be at the\nforefront of the Internet and recognised as someone who is prepared to be\naware of and support the next generation of networking. 200 PLANNING AND DEPLOYMENT\nIn preparing for IPv6 here are some steps you can take to help move you\nin the right direction -\n1. Dont buy routers, firewalls and other IP equipment that process\nIPv4 packets in hardware at full speed and only process IPv6\npackets more slowly in software or worse still dont handle IPv6 at\nall. The vast majority of available network devices support IPv6.\nRIPE has prepared some requirements to be added into any call\nfor tender to ensure that IPv6 is included:\nhttp:\/\/www.ripe.net\/ripe\/docs\/current -ripe-documents\/ripe-554\nYou may also look for the IPv6-Ready logo on the data sheets of\nthe devices.\n2. When deploying new software, make sure it works over IPv6.\n3. When discussing your backhaul link with a local ISP, check that\nthey have deployed or have plans to deploy and offer IPv6\nservices. If not discuss with them how you might co-operate and\ninterconnect your IPv6 network with them. The cost of IPv6\nshould be included in the overall cost; this means that you will\nnot pay anything more to get IPv6. The Service Level Agreement\n(SLA) for IPv6 should be identical (throughput, latency, incident\nresponse time, ...) as for IPv4. There are several IPv4\/IPv6\ntransition techniques that can be deployed.\nHere are some urls that you can read that will give you up to date\ninformation about these -\nhttp:\/\/www.petri.co.il\/ipv6-transition.htm\nhttp:\/\/en.wikipedia.org\/wiki\/IPv6_transition_mechanisms\nhttp:\/\/www.6diss.org\/tutorials\/transitioning.pdf\nThere is more information about the growth of IPv6 and the lack of\navailable IPv4 adresses in this article published in late 2012.\nhttp:\/\/arstechnica.com\/business\/2013\/01\/ipv6-takes-one-step-forward-\nipv4-two-steps-back-in-2012\/\nThere is also an EC funded project called 6Deploy who offer training and\nhelpdesk services for network engineers starting their IPv6 deployments. It\nis highly recommended that you contact them to discuss your project.\nhttp:\/\/www.6deploy.eu\/index.php?page=home 11. HARDWARE SELECTION AND CONFIGURATION 201\n11. HARDWARE SELECTION AND\nCONFIGURATION\nIn the last few years, an unprecedented surge of interest in wireless\nnetworking hardware has brought a huge variety of inexpensive equipment\nto the market.\nSo much variety, in fact, that it would be impossible to catalog every\navailable component. In this chapter, we\u2019ll look at the sort of features and\nattributes that are desirable in a wireless component.\nWired wireless\nWith a name like \u201cwireless\u201d, you may be surprised at how many wires are\ninvolved in making a simple point-to-point link.\nA wireless node consists of many components, which must all be\nconnected to each other with appropriate cabling.\nYou obviously need at least one computer connected to an Ethernet\nnetwork, and a wireless router or bridge attached to the same network.\nRadio components need to be connected to antennas, but along the way\nthey may need to interface with a lightning arrestor or other device.\nMany components require power, either via an AC mains line or using a\nDC transformer.\nAll of these components use various sorts of connectors, not to mention a\nwide variety of cable types and thicknesses.\nNow multiply those cables and connectors by the number of nodes you\nwill bring online, and you may well be wondering why this stuff is referred\nto as \u201cwireless\u201d.\nThe diagram on the next page will give you some idea of the cabling\nrequired for a typical point-to-point link.\nNote that this diagram is not to scale, nor is it necessarily the best choice\nof network design. But it will introduce you to many common\ninterconnects and components that you will likely encounter in the real\nworld. 202 PLANNING AND DEPLOYMENT\nFigure HW 1: Common Interconnects and Components for a Wireless PtP\nlink.\nWhile the actual components used will vary from node to node, every\ninstallation will incorporate these parts:\n1. An existing computer or network connected to an Ethernet switch.\n2. A device that connects that network to a wireless device (a wireless\nrouter, bridge, or repeater).\n3. An antenna that is connected via feed line, or is integrated into the\nwireless device itself.\n4. Electrical components consisting of power supplies, conditioners,\nand lightning arrestors.\nThe actual selection of hardware should be determined by establishing the\nrequirements for the project, determining the available budget, and\nverifying that the project is feasible using the available resources (including\nproviding for spares and ongoing maintenance costs).\nAs discussed in other chapters of this book, establishing the scope of your\nproject is critical before any purchasing decisions are made. 11. HARDWARE SELECTION AND CONFIGURATION 203\nChoosing wireless components\nUnfortunately, in a world of competitive hardware manufacturers and\nlimited budgets, the price tag is the single factor that usually receives the\nmost attention.\nThe old saying that \u201cyou get what you pay for\u201d often holds true when\nbuying high tech equipment, but should not be considered an absolute\ntruth. While the price tag is an important part of any purchasing decision,\nit is vital to understand precisely what you get for your money so you can\nmake a choice that fits your needs.\nWhen comparing wireless equipment for use in your network, be sure to\nconsider these variables:\nInteroperability. Will the equipment you are considering work with\nequipment from other manufacturers? If not, is this an important factor\nfor this segment of your network? If the gear in question is standard (such\nas 802.11b\/g), then it will likely interoperate with equipment from other\nsources.\nRange. This is not something inherent in a particular piece of equipment.\nA device\u2019s range depends on the antenna connected to it, the surrounding\nterrain, the characteristics of the device at the other end of the link, and\nother factors.\nRather than relying on a semi- fictional \u201crange\u201d rating supplied by the\nmanufacturer, it is more useful to know the transmission power of the\nradio as well as the antenna gain (if an antenna is included).\nWith this information, you can calculate the theoretical range as done\nwhen looking at link budget calculations as we did in the chapter called\nDeployment Planning.\nRadio sensitivity. How sensitive is the radio device at a given bit rate? The\nmanufacturer should supply this information, at least at the fastest and\nslowest speeds.\nThis can be used as a measure of the quality of the hardware, as well as\nallow you to complete a link budget calculation.\nWhen considering radio sensitivity, a lower number is better. 204 PLANNING AND DEPLOYMENT\nThroughput. Manufacturers consistently list the highest possible bit rate as\nthe \u201cspeed\u201d of their equipment. Keep in mind that the radio symbol rate\n(eg. 54 Mbps) is never the actual throughput rating of the device (eg.\nabout 22 Mbps for 802.11g).\nIf throughput rate information is not available for the device you are\nevaluating, a good rule of thumb is to divide the device \u201cspeed\u201d by two,\nand subtract 20% or so. When in doubt, perform throughput testing on\nan evaluation unit before committing to purchasing a large amount of\nequipment that has no official throughput rating.\nRequired accessories. To keep the initial price tag low, vendors often leave\nout accessories that are required for normal use. Does the price tag include\nall power adapters? For example DC supplies are typically included; Power\nover Ethernet injectors typically are not. Double-check input voltages as\nwell, as equipment is sometimes provided with a US power supply.\nWhat about pigtails, adapters, cables, antennas, and radio cards? If you\nintend to use it outdoors, does the device include a weatherproof case?\nAvailability. Will you be able to easily replace failed components? Can you\norder the part in large quantity, should your project require it? What is the\nprojected life span of this particular product, both in terms of useful\nrunning time in-the-field and likely availability from the vendor?\nPower consumption. For remote installations, power consumption is the\nmost critical issue. If the devices are to be powered with solar panels, it is\nvery important to select the ones that require the lowest possible power.\nThe cost of solar panels and batteries can be much higher than the cost of\nwireless devices; so lower power consumption can result in a much lower\noverall budget.\nOther factors. Be sure that other features are provided to meet your\nparticular needs. For example, does the device include an external antenna\nconnector? If so, what type is it? Are there user or throughput limits\nimposed by software, and if so, what is the cost to increase these limits?\nWhat is the physical form factor of the device?\nDoes it support POE as a power source? Does the device provide\nencryption, NAT, bandwidth monitoring tools, or other features critical to\nthe intended network design? 11. HARDWARE SELECTION AND CONFIGURATION 205\nBy answering these questions first, you will be able to make intelligent\nbuying decisions when the time comes to choosing networking hardware.\nIt is unlikely that you will be able to answer every possible question before\nbuying gear, but if you prioritise the questions and press the vendor to\nanswer them before committing to a purchase, you will make the best use\nof your budget and build a network of components that are well suited to\nyour needs.\nCommercial vs. DIY solutions\nYour network project will almost certainly consist of components\npurchased from vendors as well as parts that are sourced or even fabricated\nlocally. This is a basic economic truth in most areas of the world. At this\nstage of human technology, global distribution of information is quite\ntrivial compared to global distribution of goods. In many regions,\nimporting every component needed to build a network is prohibitively\nexpensive for all but the largest budgets.\nYou can save considerable money in the short term by finding local\nsources for parts and labour, and only importing components that must\nbe purchased.\nOf course, there is a limit to how much work can be done by any\nindividual or group in a given amount of time. To put it another way, by\nimporting technology, you can exchange money for equipment that can\nsolve a particular problem in a comparatively short amount of time. The\nart of building local telecommunications infrastructure lies in finding the\nright balance of money to effort needed to be expended to solve the\nproblem at hand.\nSome components, such as radios and antenna feed line, are likely far too\ncomplex to consider having them fabricated locally. Other components,\nsuch as antennas and towers, are relatively simple and can be made locally\nfor a fraction of the cost of importing. Between these extremes lie the\ncommunication devices themselves.\nBy using off-the-shelf radio cards, motherboards, and other components,\nyou can build devices that provide features comparable (or even superior)\nto most commercial implementations. Combining open hardware\nplatforms with open source software can yield significant \u201cbang for the\nbuck\u201d by providing custom, robust solutions for very low cost. 206 PLANNING AND DEPLOYMENT\nThis is not to say that commercial equipment is inferior to a do-it-yourself\nsolution.\nBy providing so-called \u201cturn-key solutions\u201d, manufacturers not only save\ndevelopment time, but they can also allow relatively unskilled people to\ninstall and maintain equipment.\nThe chief strengths of commercial solutions are that they provide support\nand a (usually limited) equipment warranty. They also provide a consistent\nplatform that tends to lead to very stable, often interchangeable network\ninstallations.\nIf a piece of equipment simply doesn\u2019t work or is difficult to configure or\ntroubleshoot, a good manufacturer will assist you.\nShould the equipment fail in normal use (barring extreme damage, such as\na lightning strike) then the manufacturer will typically replace it.\nMost will provide these services for a limited time as part of the purchase\nprice, and many offer support and warranty for an extended period for a\nmonthly fee. By providing a consistent platform, it is simple to keep\nspares on hand and simply \u201cswap out\u201d equipment that fails in the field,\nwithout the need for a technician to configure equipment on-site.\nOf course, all of this comes at comparatively higher initial cost for the\nequipment compared to off-the-shelf components.\nFrom a network architect\u2019s point of view, the three greatest hidden risks\nwhen choosing commercial solutions are vendor lock-in, discontinued\nproduct lines, and ongoing licensing costs.\nIt can be costly to allow the lure of ill-defined new \u201cfeatures\u201d drive the\ndevelopment of your network.\nManufacturers will frequently provide features that are incompatible with\ntheir competition by design, and then issue marketing materials to\nconvince you that you simply cannot live without them (regardless of\nwhether the feature contributes to the solution of your communications\nproblem).\nAs you begin to rely on these features, you will likely decide to continue\npurchasing equipment from the same manufacturer in the future.\nThis is the essence of vendor lock-in.\nIf a large institution uses a significant amount of proprietary equipment, it\nis unlikely that they will simply abandon it to use a different vendor. 11. HARDWARE SELECTION AND CONFIGURATION 207\nSales teams know this (and indeed, some rely on it) and use vendor lock-\nin as a strategy for price negotiations.\nWhen combined with vendor lock-in, a manufacturer may eventually\ndecide to discontinue a product line, regardless of its popularity. This\nensures that customers, already reliant on the manufacturer\u2019s proprietary\nfeatures, will purchase the newest (and nearly always more expensive)\nmodel. The long term effects of vendor lock-in and discontinued products\nare difficult to estimate when planning a networking project, but should\nbe kept in mind.\nFinally, if a particular piece of equipment uses proprietary computer code,\nyou may need to license use of that code on an ongoing basis. The cost of\nthese licenses may vary depending on features provided, number of users,\nconnection speed, or other factors. If the license fee is unpaid, some\nequipment is designed to simply stop working until a valid, paid-up\nlicense is provided! Be sure that you understand the terms of use for any\nequipment you purchase, including ongoing licensing fees.\nBy using equipment that supports standards and open source software,\nyou can avoid some of these pitfalls.\nFor example, it is very difficult to become locked-in to a vendor that uses\nopen protocols (such as TCP\/IP over 802.11a\/b\/g). If you encounter a\nproblem with the equipment or the vendor, you can always purchase\nequipment from a different vendor that will interoperate with what you\nhave already purchased. It is for these reasons that we recommend using\nproprietary protocols and licensed spectrum only in cases where the open\nequivalent (such as 802.11a\/b\/g) is not technically feasible.\nLikewise, while individual products can always be discontinued at any\ntime, you can limit the impact this will have on your network by using\ngeneric components.\nFor example, a particular motherboard may become unavailable on the\nmarket, but you may have a number of PC motherboards on hand that\nwill perform effectively the same task.\nObviously, there should be no ongoing licensing costs involved with open\nsource software (with the exception of a vendor providing extended\nsupport or some other service, without charging for the use of the software\nitself). 208 PLANNING AND DEPLOYMENT\nThere have occasionally been vendors who capitalise on the gift that open\nsource programmers have given to the world by offering the code for sale\non an ongoing licensed basis, thereby violating the terms of distribution\nset forth by the original authors.\nIt would be wise to avoid such vendors, and to be suspicious of claims of\n\u201cfree software\u201d that come with an ongoing license fee.\nThe disadvantage of using open source software and generic hardware is\nclearly the question of support.\nAs problems with the network arise, you will need to solve those problems\nfor yourself. This is often accomplished by consulting free online resources\nand search engines, and applying code patches directly.\nIf you do not have team members who are competent and dedicated to\ndesigning a solution to your communications problem, then it can take a\nconsiderable amount of time to get a network project off the ground.\nOf course, there is never a guarantee that simply \u201cthrowing money at the\nproblem\u201d will solve it either.\nWhile we provide many examples of how to do much of the work\nyourself, you may find this work very challenging. You will need to find\nthe balance of commercial solutions and the do-it-yourself approach that\nworks for your project.\nIn short, always define the scope of your network first, identify the\nresources you can bring to bear on the problem, and allow the selection of\nequipment to naturally emerge from the results.\nConsider commercial solutions as well as open components, while keeping\nin mind the long- term costs of both.\nWhen considering which equipment to use, always remember to compare\nthe expected useful distance, reliability, and throughput, in addition to the\nprice.\nAnd finally, make sure that the radios you purchase operate in an\nunlicensed band where you are installing them, or if you must use licensed\nspectrum, that you have budget and permission to pay for the appropriate\nlicenses. 11. HARDWARE SELECTION AND CONFIGURATION 209\nProfessional lightning protection\nLightning is a natural predator of wireless equipment. A map showing the\nglobal distribution of lightning from 1995 to 2003 is shown here\nfollowing.\nFigure HW 2: Global distribution of lightning from 1995 to 2003\nThere are two different ways lightning can strike or damage equipment:\ndirect hits or induction hits.\nDirect hits happen when lightning actually hits the tower or antenna.\nInduction hits are caused when lightning strikes near the tower.\nImagine a negatively charged lightning bolt.\nSince like charges repel each other, that bolt will cause the electrons in the\ncables to move away from the strike, creating current on the lines.\nThis can be much more current than the sensitive radio equipment can\nhandle.\nEither type of strike will usually destroy unprotected equipment. 210 PLANNING AND DEPLOYMENT\nFigure HW 3: A tower with a heavy copper grounding wire.\nProtecting wireless networks from lightning is not an exact science, and\nthere is no guarantee that a lightning strike will not happen, even if every\nsingle precaution is taken. Many of the methods used will help prevent\nboth direct and induction strikes.\nWhile it is not necessary to use every single lightning protection method,\nusing more methods will help further protect the equipment.\nThe amount of lightning historically observed within a service area will be\nthe biggest guide to how much needs to be done.\nStart at the very bottom of the tower. Remember, the bottom of the tower\nis below the ground. After the tower foundation is laid, but before the\nhole is backfilled, a ring of heavy braided ground wire should have been\ninstalled with the lead extending above ground surfacing near a tower leg.\nThe wire should be American Wire Gauge (AWG) #4 or thicker.\nIn addition, a backup ground or earthing rod should be driven into the\nground, and a ground wire run from the rod to the lead from the buried\nring.\nIt is important to note that not all steel conducts electricity the same way. 11. HARDWARE SELECTION AND CONFIGURATION 211\nSome types of steel act as better electrical conductors than others, and\ndifferent surface coatings can also affect how tower steel handles electrical\ncurrent. Stainless steel is one of the worst conductors, and rust proof\ncoatings like galvanizing or paint lessen the conductivity of the steel.\nFor this reason, a braided ground wire is run from the bottom of the\ntower all the way to the top. The bottom needs to be properly attached to\nthe leads from both the ring and the backup ground rod.\nThe top of the tower should have a lightning rod attached, and the top of\nthat needs to be pointed. The finer and sharper the point, the more\neffective the rod will be.\nThe braided ground wire from the bottom needs to be terminated at the\ngrounding of the lightning rod. It is very important to be sure that the\nground wire is connected to the actual metal. Any sort of coating, such as\npaint, must be removed before the wire is attached. Once the connection\nis made, the exposed area can be repainted, covering the wire and\nconnectors if necessary to save the tower from rust and other corrosion.\nThe above solution details the installation of the basic grounding system.\nIt provides protection for the tower itself from direct hits, and installs the\nbase system to which everything else will connect.\nThe ideal protection for indirect induction lightning strikes are gas tube\narrestors at both ends of the cable.\nThese arrestors need to be grounded directly to the ground wire installed\non the tower if it is at the high end.\nThe bottom end needs to be grounded to something electrically safe, like a\nground plate or a copper pipe that is consistently full of water. It is\nimportant to make sure that the outdoor lightning arrestor is\nweatherproofed.\nMany arresters for coax cables are weatherproofed, while many arresters\nfor CAT5 cable are not. In the event that gas arrestors are not being used,\nand the cabling is coax based, then attaching one end of a wire to the\nshield of the cable and the other to the ground wire installed on the\ntowers will provide some protection.\nThis can provide a path for induction currents, and if the charge is weak\nenough, it will not affect the conductor wire of the cable. While this\nmethod is by no means as good a protection as using the gas arrestors, it is\nbetter than doing nothing at all. 212 PLANNING AND DEPLOYMENT\nAccess Point Configuration\nThis section will provide a simple procedure for the basic configuration of\nWiFi Access Points and Clients by reviewing the main settings and\nanalysing their effects on the behaviour of the network.\nIt will also suggest some practical tips and tricks and troubleshooting\nadvice.\nBefore you start\nWhen you receive some new wireless equipment take some time to get\nacquainted with its main features and make sure you:\n\u2022 Download or otherwise obtain all user\u2019s manuals and specification\nsheets available for the devices you are going to deploy.\n\u2022 If you have second-hand devices, be sure to receive full\ninformation on their current \u2013or last-known\u2013 configuration (e.g.\npassword, IP addresses, etc.)\n\u2022 You should already have a plan on hand for the network you are\ngoing to deploy (including link budget, network topology,\nchannels and IP settings).\n\u2022 Be ready to take written notes of all settings that you are going to\napply (especially passwords!)\n\u2022 Make backups of last known good configuration files.\nGetting in touch with the device\nAs a first step, it is important that you learn the meaning of all LEDs on\nthe device.\nThe figure below shows the typical front of an Access Point, with several\nLEDs lit.\nFigure HW 4: The front of a typical Access Point. 11. HARDWARE SELECTION AND CONFIGURATION 213\nLEDs typically indicate:\n\u2022 Presence of power\n\u2022 Active ports \/ traffic (yellow\/green colour)\n\u2022 Error status (red colour)\n\u2022 Received signal strength (LED bars, sometimes multicolour; some\ndevices can even be set to light each LED at specific thresholds,\ne.g. Ubiquiti)\nSometimes, different meanings are associated with the same LED, using\ndifferent colours and dynamics (e.g. LED is on\/off\/blinking at different\nspeeds).\nYou should identify the different ports and interfaces on the device:\n\u2022 Radio interfaces, sometimes called WLANs. They should have\none or more antenna connectors (or non-detachable antennas).\n\u2022 One or more Ethernet interfaces:\n\u2022 One or more ports for local network (LAN)\n\u2022 One port for uplink (also called WAN)\n\u2022 Power input (5, 6, 7.5, 12V or other, usually DC). It is really\n(really) important that the power supply matches the voltage!\nSometimes the power is provided to the device through the same\nUTP cable that carries the Ethernet data: this is called Power-\nover-Ethernet (PoE).\n\u2022 Power button (not always present).\n\u2022 Reset button (often \u201chidden\u201d in a small hole, can be pressed using\na straightened paperclip).\nThe reset button may have different effects (from a simple restart to a\nfactory full reset) if pressed briefly vs. for a longer time. It can take 30\nseconds or more to trigger a full reset.\nNOTE: to fully reset (i.e. reset to factory settings) a device that is in an\nunknown state may be a painful task!\nBe sure to keep written notes of critical parameters like the device IP\naddress and network mask, and the administrator username and password.\nThe following figure shows a common Linksys Access Point, with the\npower input, the network ports, the reset button and two antennas. 214 PLANNING AND DEPLOYMENT\nFigure HW 5: Linksys Access Point\nUser interfaces\nYou can interact (i.e. issue commands and change settings) with the Access\nPoint in several ways, depending on the hardware you are using. The\npossible ways are the following:\n\u2022 Graphical User Interface (web page)\n\u2022 Graphical User Interface (proprietary software application)\n\u2022 Command Line Interface (telnet, ssh)\n\u2022 Software interface embedded in the system (when the AP\/client is\na computer or smartphone with a display and its own OS)\nUser interfaces: GUI (web page)\nThis system is used in Linksys, Ubiquiti and most modern Aps.\nOnce you are connected to the AP, you interact with the device using a\nnormal browser.\nAdvantages: it works with most browsers and operating systems\nDisadvantages: the static interface does not reflect changes immediately;\npoor feedback; can be incompatible with some web browsers; requires a\nworking TCP\/IP configuration. Some recent implementations (e.g.\nUbiquiti, shown below) are very good and use modern dynamic web\nfeatures to provide feedback and advanced tools. 11. HARDWARE SELECTION AND CONFIGURATION 215\nFigure HW 6: Ubiquiti user interface.\nUser interfaces: GUI (software application)\nIn this case you need a special piece of software to interact with the\ndevice. This system is used in Mikrotik (called Winbox), Apple (called\nAirport Utility), Motorola (called Canopy), many old APs.\nAdvantages: usually powerful and appealing interfaces; allow batch\nconfiguration of multiple devices.\nDisadvantages: proprietary solutions; usually available for only one\noperating system; software must be installed before starting configuration.\nMikrotik Winbox, shown below, is a very powerful solution and can\nmanage large networks. 216 PLANNING AND DEPLOYMENT\nUser interfaces: Command Line Interface (sometimes called text shell)\nIn this case you connect to the device using a serial or Ethernet\nconnection, via telnet or ssh. ssh is much safer than telnet from a security\nperspective (the latter should be avoided if possible).\nConfiguration is performed with commands executed in the host\noperating system, usually a flavour of Linux or a proprietary OS, as shown\non the next page.\nThis is system is used by Mikrotik (called RouterOS), Ubiquiti (called\nAirOS), high-end APs (Cisco) and embedded PC-based Aps.\nAdvantages: very powerful as it can be scripted.\nDisadvantages: difficult to learn. 11. HARDWARE SELECTION AND CONFIGURATION 217\nFigure HW 8: Command Line Interface.\nConfigure the AP\nBefore configuring the AP, remember to:\n\u2022 Start from a known state, or reset the device to factory settings\n(always a good idea!).\n\u2022 Connecting to the device via Ethernet is usually easier than via\nwireless. Most devices with a web GUI have a default IP\nconfiguration on the network 192.168.0.0, but this is not a rule!\nRead the manual.\n\u2022 If convenient, upgrade the firmware to the latest stable version\n(but be careful!)\n\u2022 Change the default admin username and password first!\n\u2022 Change the device name with something that clearly identifies it\n(e.g. something like \u201cAP_conference_room_3\u201d or\n\u201chotspot_public_area\u201d). This will help you to recognise the AP in\nfuture when you connect to it over the network. 218 PLANNING AND DEPLOYMENT\n\u2022 Firmware upgrade is often a risky procedure, be sure to adopt all\nprecautions before attempting it - such as - connecting the device\nand the computer to a UPS, then do not perform the firmware\nupdate while doing other tasks on the computer, and check that\nyou have a valid firmware binary image, READ THE\nINSTRUCTIONS CAREFULLY! If the procedure fails, you can\nend up with an unusable device that cannot be recovered (the so-\ncalled \u201cbrick\u201d).\n\u2022 Remember to write down (and store in a safe place) all these\nsettings, especially the admin username\/password.\nConfigure the AP - IP layer\nIf you are confident with what you are doing, you can perform the IP\nconfiguration after the wireless setup to avoid the reconfiguration and\nreconnection of your PC or laptop. But in this way, if you make any\nmistake in both the wired and wireless setup, you may end up with an\nunreachable AP. We'd strongly advise that you do the critical configuration\nsteps one at a time, checking the status of the device after each step.\nRemember to write down (and store in a safe place) all IP settings!\nConfigure the Ethernet interface of the AP according to your wired\nnetwork setup:\n\u2022 IP address\/netmask\/gateway or DHCP\n\u2022 DNS address(es)\n\u2022 Double check the new settings and apply them (sometimes you\nmay have to reboot the AP)\n\u2022 Now you may need to reconfigure your PC\/laptop to match the\nnew Ethernet setup, and reconnect to the AP.\nConfigure the AP - physical layer\n\u2022 Configure the mode: master (or access point or base station). The\ndevice\u2019s mode can usually be configured as: \u201cmaster\u201d (also called\n\u201caccess point\u201d or \u201cbase station\u201d or \u201cBS\u201d), \u201cclient\u201d (also called\n\u201cmanaged\u201d or \u201cstation\u201d or \u201cclient station\u201d or \u201cCPE\u201d), \u201cmonitor\u201d,\n\u201cWDS\u201d (Wireless Distribution System), and rarely some other\nvariants. 11. HARDWARE SELECTION AND CONFIGURATION 219\n\u2022 Configure the SSID (Service Set Identifier, the name of the\nwireless network created by the AP, up to 32 characters long): it is\nbest to choose a meaningful name. Remember that \u201csecurity through\nobfuscation is not real security\u201d, so a hidden or fake\/random\nSSID does not add much security to your network.\n\u2022 Configure the wireless channel, according to the local regulations\nand the result of the site survey.\n\u2022 Do not use a channel that is already occupied by another AP or\nother sources of RF power. You should already have planned the\nchannel in advance, during the design phase. The choice of the best\nchannel is sometimes a hard task, and you may need to perform a\nsite survey with software tools (wireless sniffers) or hardware\nspectrum analysers (like the WiSpy from Metageek and the\nAirView from Ubiquiti).\n\u2022 Configure the transmit power and network speed (these values\nmay also be set to \u201cautomatic\u201d in some devices). The value of\ntransmit power is also subject to local regulation, check in\nadvance the maximum power allowed by law, and try always to\nuse the minimum value that fit your needs, in order to avoid\ninterference with other networks (yours or others).\nThe choice of network speed is limited to the values that are part of\n802.11a\/b\/g\/n standards (up to 54 Mbps), but some vendors created\nextensions to the standards (often called \u201cturbo\u201d modes) of 100 Mbps or\nhigher. These are non-standard and may not be able to interoperate with\nequipment from other vendors.\nConfiguring \u201cbackwards compatibility\u201d modes (such as supporting\n802.11b on 802.11g networks) will reduce the overall throughput\navailable to your fastest clients. The Access Point must send the preamble\nat a slower rate for 802.11b clients, and actual communications between\nthe client and the AP happen at 802.11b speeds. This takes more time,\nand slows down the otherwise faster 802.11g clients.\nConfigure the AP \u2013 security\nSecurity settings are often a hard choice, and it may be difficult to balance\ngood protection from unintentional users with easy access for authorised\nusers. 220 PLANNING AND DEPLOYMENT\nMore complex security needs will require a more complex configuration\nand additional software.\nConfigure the security features of the network:\n\u2022 No encryption (all traffic is in clear)\n\u2022 WEP (Wired Equivalent Privacy), 40 or 104 bits keys, it is flawed\nand therefore deprecated\n\u2022 WPA \/ WPA2 (WiFi Protected Access): PSK, TKIP and EAP\n\u2022 Enable or disable (hide) the SSID broadcast (\u201cbeacon\u201d). Hidden\nSSID and MAC filtering do not add much security, and are hard\nto maintain and a source of troubles for inexperienced users of the\nnetwork.\n\u2022 Enable or disable an Access Control List (based on MAC\naddresses of clients). MAC filtering is a weak security measure:\u2013 A\nmalicious client can capture packets and find out which MAC\naddresses have the right to associate\u2013 It can then change its own\nMAC address to one of the accepted ones and \u201cfool\u201d the access\npoint.\nFor more information about how to design the security of your wireless\nnetwork please read the chapter called Security in Wireless Networks.\nConfigure the AP - routing\/NAT\nAdvanced IP layer and routing configuration features are often included in\nmodern access points. This can include functionality for routing and\nNetwork Address Translation (NAT), in addition to basic bridging.\nAdvanced IP configuration includes:\n\u2022 Static routing\n\u2022 Dynamic routing\n\u2022 NAT (masquerading, port forwarding)\n\u2022 Firewalling\n\u2022 Some APs can also act as file servers and print servers (external\nHD and printers can be connected via USB) 11. HARDWARE SELECTION AND CONFIGURATION 221\nConfigure the AP \u2013 advanced\nA few more advanced settings may be available for your AP, depending on\nthe model\/vendor\/firmware\/etc.:\n\u2022 Beacon interval\n\u2022 RTS\/CTS. RTS\/CTS (ready to send, clear to send) mechanism\ncan help alleviate the problem of hidden nodes (clients that can\n\u201chear\u201d the AP but not the other clients, therefore creating\ninterferences).\n\u2022 Fragmentation. Configuration of the fragmentation can be used\nto increase performance in the case of low signal areas, those with\nmarginal coverage, or long links.\n\u2022 Interference robustness\n\u2022 Vendor extensions to the WiFi standards\n\u2022 Other settings for long distance links (10 to 100 kilometres) and\nbetter security.\nConfigure the client\nThe client side configuration is much simpler:\n\u2022 Configure the mode: client (or managed, station, client station,\nCPE)\n\u2022 Configure the SSID of the network to be joined\n\u2022 The channel, speed, and other parameters will be set automatically\nto match the AP\n\u2022 If WEP or WPA is enabled on the AP, you will have to enter the\nmatching password (key)\n\u2022 Clients may also have additional (often vendor-specific) settings.\nFor example, some clients can be configured to associate only with an\nAP with a specified MAC address. 222 PLANNING AND DEPLOYMENT\nHints - working outdoors\n\u2022 You should try to configure the devices (both APs and clients)\nwell in advance and in a comfortable place such as a laboratory.\nWorking outdoors is more difficult and may lead to mistakes\n(\u201con-site\u201d configuration = trouble).\n\u2022 If you must configure devices outdoors, be sure to have enough\nbattery charge on your laptop, to carry all the required\ninformation with you (on paper, not only in electronic format!)\nand to carry a notepad to take notes. Good documentation is\nparamount for future maintenance in the field!\nTroubleshooting\n\u2022 Organise your work in logical steps and follow them.\n\u2022 Read the manual, study the meaning of parameters and settings,\nrun tests and experiments (don\u2019t be scared!).\n\u2022 In the case of problems, do a factory reset and try again.\n\u2022 If the problem persists, try again changing one parameter\/setting\nat a time.\n\u2022 It still doesn\u2019t work? Try to search on the web for relevant\nkeywords (name of the device, etc.), search in forums and on\nmanufacturer \/ vendors websites.\n\u2022 Upgrade the firmware to the latest version.\n\u2022 If you still have problems try with a different client\/AP, to check\nif you have a hardware issue with the original one. 12. INDOOR INSTALLATION 223\n12. INDOOR INSTALLATION\nIntroduction\nPrevious editions of this book have focused on wide-area outdoor wireless\nas a means of connecting communities with each other and to the\nInternet. However, with the availability of WiFi access points for a low\nprice and the proliferation of portable devices that are WiFi capable, WiFi\nhas become the de facto standard for indoor network access in Enterprises\nand schools. This chapter introduces the main focus points in choosing\nand installing WiFi networks indoors.\nPreparations\nBefore installing a wireless LAN it is a good idea to first think things\nthrough a bit:\n\u2022 What is it that you are planning to do with the wireless network?\nIs it an addition to the wired network or a replacement for it? Are\nyou going to run applications over the network that are not delay\ntolerant or sensitive to bandwidth variations (like voice and video\nconferencing).\n\u2022 The main difference between indoor and outdoor wireless is the\nabsorption and reflection of radio waves by the building itself.\nWhat building features do you need to take into account? Do the\nwalls have metal, water or heavy concrete in them? Do windows\nhave metal in them (e.g. metal coating or metal grids)? Is the\nbuilding long and stretched or compact?\n\u2022 Do you expect users to be mainly static, or will they move a lot?\nAnd when they move, is it important to have uninterrupted\nhandover (this means, a handover so quick that you will not\nnotice the interruption of a voice call)?\n\u2022 Are there good places to hang the Access Points? Are wired sockets\nand electricity for the APs readily available? Is electricity stable? If\nnot, even indoor APs might need stable solar\/battery power\nsupplies and\/or UPS.\n\u2022 Are there sources of interference, like ad-hoc APs brought in by\nusers, bluetooth devices, microwaves? 224 PLANNING AND DEPLOYMENT\nBandwidth requirements\nStep one in designing an indoor wireless network is to determine the need\nin terms of the number of concurrent users to support, the number and\ntype of devices and the type of applications they are running. It is also\nimportant to understand the distribution of the users. Lecture halls or\nmeeting rooms have different usage patterns than corridors. A wireless\nnetwork that is hardly used and that needs to support a low number of\nusers is easy to deploy and will not run into trouble easily. The trouble\nstarts when the number of users and their use of the network increases.\nThis chapter therefore focuses on high-density wireless networks.\nTo give you an idea for the bandwidth requirement for some typical\napplications:\nweb surfing: 500 - 1000 kb\/s\naudio: 100 - 1000 kb\/s\nstreaming video: 1 - 4 Mb\/s\nfile sharing: 1 - 8 Mb\/s\ndevice backup: 10 - 50 Mb\/s\nTypical installations in an office environment are dimensioned to support\n20-30 users per cell and have about 1 access point per 250-500 square\nmetres, but as mentioned before, depending on characteristics of the\nenvironment this may not be sufficient. In a dense environment there may\nbe up to 1 device per 20 square metres. Bottom line, you need to calculate\nthe throughput needed per coverage area.\nSo if you have let's say 10 users in a 100 square metre area, of which 8 are\nsurfing the web and 2 are watching online video you will need: 8 * 1000\nkb\/s + 2 * 4000 kb\/s = 16000 kb\/s for the 100 square metre area or 160\nkb\/s per square metre.\nFrequencies and data rates\nThe 2.4 GHz and the 5 GHz solutions differ in a few key aspects. The 2.4\nGHz band has a better range and less attenuation and is supported in\nmost devices.\nThe main downside of the 2.4 GHz band is that there are only 3 non-\noverlapping channels, which severely limits the the number of access\npoints that can be placed in a certain area. 12. INDOOR INSTALLATION 225\nThis is unfortunate since making smaller cells (formed by having the APs\nbroadcast with less power) is the easiest way of creating more throughput\nper area.\nNote: sometimes 4 slightly overlapping channels are advised, but research\nshows that in fact this decreases performance. Performance in general,\ndegrades fast with overlapping channels (co- channel interference). The 5\nGHz band on the other hand has a worse range but has in most\ngeographies around 20 channels which makes it much easier to deploy\nwithout interference from adjacent channels.\nThe other important element is the choice of WiFi standard, considering\nthat average throughput in Mb\/s for the most common technologies are:\n11b: 7.2 Mb\/s\n11g: 25 Mb\/s\n11a: 25 Mb\/s\n11n: 25 - 160 Mb\/s\nIt should be noted that performance drops when, for example, both\n802.11b and 11g devices are served by the same AP. In a network where\nclient devices are using a mix of 802.11g and 11b, the AP will shift down\nto lower speeds.\n5 GHz is a preferred choice for high performance and high density\nnetworks. As you would like to limit the coverage of each AP to one small\nwell defined area anyway, signal attenuation by walls etc is an advantage\nrather than a problem.\nThe deployment of 2.4 GHz for the majority of devices, combined with 5\nGHz for the \"important devices\" is worth considering too.\nAccess Points choice and placement\nWhen it comes to choosing Access Points (APs) for indoor wireless there\nare essentially 2 architectural choices: controller based and \"fat clients\".\nFat clients are stand-alone APs that have all the intelligence on board to\nmanage a WiFi network (choosing SSIDs, encryption method,\nrouting\/switching etc.). The controller-based solution on the other hand\nhas APs that implement the minimal functionality to offer a wireless\nservice along with a central controller that is common for all APs at a\nlocation. 226 PLANNING AND DEPLOYMENT\nThe central controller also has all the intelligence and all traffic from the\nAPs directed to it.\nThe choice between one of the two architectures is a trade-off between\ncost, ease of management and scalability. In general one can say that the\nmore complex the environment and the larger the size the more attractive\nit becomes to run a controller-based solution.\nAccess Points should in general be placed in the areas with a high density\nof users, the signal will probably \"leak\" sufficiently to also serve the less\ndense areas. Unfortunately the overall performance of the system will\nmostly be determined by the clients, not the APs, so the placement of the\nAPs, while important, can only do so much for the performance of the\noverall system. Other radio sources in the WiFi bands have a very strong\ninfluence on the performance of the WiFi network, so in general, if\npossible the APs should, as much as possible, be isolated from other radio\nsources, by using walls, ceilings and people as \"shields\".\nIn order to improve performance it is possible to use external antennas.\nOmni directional antennas are the most commonly used and they provide\na coverage area roughly circular around the AP. In most indoor cases,\nhowever, APs will be installed on walls, ceilings, or columns, and\nomnidirectional antennas are a bad choice, if you look at where the radio\nwaves are going, and where the users are.\nSo for these cases in which the AP is not at the centre of the area to be\ncovered, directional antennas are an alternative. Some hotels and\nconference halls, for example, place small directional antennas at the\ncorners of large, open areas or overhead to provide a \"canopy\" or\n\"umbrella\" of signal coverage in large spaces. Keep in mind that the many\nreflections typically encountered in an indoor environment make it\ndifficult to try to fully control a specific coverage.\nAccess Points can be mounted on the ceiling, on the walls or in furniture,\neach with different characteristics. Ceiling mounting gives a good blanket\ncoverage, wall mounting often gets the APs closer to the users and APs\nunder tables or chairs or within furniture can use the natural isolation to\ncreate small cells with little interference from neighbouring APs, but there\nmight be concerns about the possibility of harmful effects from the\nradiation emitted. 12. INDOOR INSTALLATION 227\nLastly, for really demanding high performance networks, APs with smart\nadaptive antenna technology might be an option. They come at a price,\nbut offer the advantage of adapting the radio signal to the locations of\nusers dynamically - they will direct the radio waves to where they are\nneeded, at each point in time.\nSSID and Network Architecture\nIndoor networks are likely to serve many concurrent users. Larger\ncomplexes like a university campus typically consist of many buildings,\neach with their own indoor network, and outdoor networks in between.\nIt is therefore important to make a good plan for your SSIDs.\nNote that the SSID defines the broadcast domain on Layer 2 of the\nnetwork. SSID planning needs to play together with your Layer 3 network\narchitecture. If you would like users to roam seamlessly across your whole\nwireless network area, within or even beyond one building, then all APs\nshould offer the same SSID, for example \"UniversityWireless\", or\n\"eduroam\" for a university that wants to participate in the global roaming\nservice that eduroam offers.\nHowever, users who stay within one SSID will not require or request a\nnew DHCP lease, so you will have to accomodate all users within ONE\nLayer 3 subnet.\nFor a large campus, this might require a large flat subnet for all wireless\nusers.\nThis is a trade-off situation - you can either have huge subnets with\nseamless roaming, or a more manageable subnet architecture with separate\nSSIDs such as \"Library\", \"LectureHall\", \"Cafeteria\", ...\nPost Installation\nNow that the infrastructure is in place it is important to make sure that\neverything works as expected and remains like that. This can be done in\nthe form of a site survey, measuring signal strengths and throughput. But\nin the end the main reason to install a wireless network is to serve the\nusers of it, so listening to users complaints or issues is equally important.\nDemand constantly changes and so does the state-of-the- art. It is\nimportant to keep up to date with user requirements and match that to\nplanned upgrades of the technology you are deploying. 228 PLANNING AND DEPLOYMENT\n13. OUTDOOR INSTALL\nAlthough WiFi technology was designed for local area networks, its\nimpact in developing countries is more dramatic in long-distance\napplications.\nIn developed countries, fibre optic cables offering large bandwidths have\nbeen installed satisfying the communication needs of most cities. The\npenetration of optical fibre in the developing world is not nearly as great\nand nowhere near enough to cover the needs. And the cost of its\nexpansion often does not meet the ROI (Return on Investment) goals of\ntelcos within a reasonable period of time. Wireless technologies, on the\nother hand, have been much more successful in developing countries and\nthe potential for increasing the penetration using wireless networks is\nenormous.\nTelcos have installed traditional microwave radio links in most countries.\nThis is a mature technology that offers high reliability and availability\nreaching 99.999%. However, these systems cost many thousands of dollars\nand require specially trained personnel for installation.\nSatellite systems have proved well suited for broadcast traffic like TV and\ncertain other applications. However, satellite solutions are still expensive\nfor bidirectional traffic, while WiFi is quite cost effective in outdoor point\nto point networks as well as in typical access networks where a Base\nStation (BS) is serving many Clients\/CPEs (point to multipoint). In this\nchapter we will be concentrating on the outdoor long- distance point to\npoint links.\nTwo significant hurdles had to be overcome before applying WiFi to long\ndistance: Power budget limitations and timing limitations. The remaining\nlimitations for using WiFi over long distances are the requirement for the\nexistence of radio line of sight between the endpoints and the vulnerability\nto interference in the unlicensed band. The first limitation can often be\naddressed by taking advantage of the terrain elevations, or by using towers\nto overcome obstacles such as the curvature of the earth and to provide\nFresnel zone clearance. 13. OUTDOOR INSTALL 229\nFor indoor applications, line of sight is not required since the stations are\nvery close together and most obstacles can be cleared by reflections on\nwalls, ceiling, etc. But for long distance applications, line of sight is\nabsolutely critical. The second limitation is less pronounced in rural areas\nand can be alleviated by migrating to the less crowded 5 GHz band.\nThe power budget issue can be handled by using high gain antennas and\npowerful and highly sensitive radios attached directly to the antenna to\navoid RF cable loss. The timing limitation has to do with the media access\ntechniques. WiFi uses a random access method to share the\ncommunications medium. This makes it subject to collisions, which\ncannot be detected over the air, therefore the transmitter relies on\nreceiving an acknowledgment for every successfully received frame.\nIf, after a specified amount of time, called the \"ACKtimeout\", the\nacknowledge frame is not received, the transmitter will resend the frame.\nSince the transmitter will not send a new frame until the ACK for the\nprevious one has been received, the ACKtimeout must be kept short.\nThis works well in the original scenario intended for WiFi (indoor\nnetworks), in which the propagation time of 33.3 microseconds per\nkilometre is negligible, but breaks down for links over a few kilometres.\nAlthough many WiFi devices do not have provisions for modifying the\nACKtimeout, newer equipment meant for outdoor applications (or third\nparty firmware like Open WRT) will give you this possibility, often by\nmeans of a distance field in the GUI (Graphical User Interface).\nChanging this parameter will allow for a reasonable throughput, which\nwill anyway decrease proportionally to the distance. The contention\nwindow slot-time also needs to be increased to adapt to longer distances.\nOther manufacturers have chosen to move from random access to Time\nDivision Multiple Access (TDMA) instead. TDMA divides access to a given\nchannel into multiple time slots, and assigns these slots to each node on\nthe network. Each node transmits only in its assigned slot, thereby\navoiding collisions. In a point to point link this provides a great advantage\nsince ACKs are not needed because each station takes turns at transmitting\nand receiving.\nWhile this method is much more efficient, it is not compliant with the\nWiFi standard, so several manufacturers offer it as an optional proprietary\nprotocol, alongside the standard WiFi. WiMAX and proprietary protocols\n(such as Mikrotik Nstreme, or Ubiquiti Networks AirMAX) use TDMA\nto avoid these ACK timing issues. 230 PLANNING AND DEPLOYMENT\nThe 802.11 standard defines the receiver sensitivity as the received signal\nlevel required to guarantee a BER (Bit Error Rate) below 10\u22125.\nThis determines the amount of energy per bit required to overcome the\nambient noise plus the noise generated by the receiver itself. As the\nnumber of bits\/second transmitted increases, more receiver power will be\nneeded to provide the same energy per bit. Therefore the receiver\nsensitivity decreases as the transmitter rate increases, so to maintain the\nsame signal\/noise ratio as the distance increases the throughput\ndiminishes, or, alternatively, for longer distances one should choose lower\ndata rates to compensate for the reduction of the signal strength with\ndistance.\nWhat is needed for a long distance link?\nThere are four aspects that need to be considered to adapt WiFi devices to\nlong distance: increase the radio dynamic range; increase the antenna gain;\ndecrease the antenna cable loss; and make provisions for the the signal\npropagation time.\nFigure OI 1: Power in dBm vs distance in a radio link (Power budget).\nThe graph above shows the power level at each point in a wireless link.\nThe transmitter provides some amount of power. 13. OUTDOOR INSTALL 231\nA small amount is lost in attenuation between the transmitter and the\nantenna in the RF cable or waveguide. The antenna then focuses the\npower, providing a gain. At this point, the power is at the maximum\npossible value for the link. This value is called the EIRP (Equivalent\nIsotropic Radiated Power) since it corresponds to the power that a\ntransmitter would have to emit if the antenna had no gain.\nBetween the transmitting and receiving antennas there are free space and\nenvironmental losses, which increase with the distance between the link\nendpoints. The receiving antenna provides some additional gain. Then\nthere is a small amount of loss between the receiving antenna and the\nreceiving radio.\nIf the received amount of energy at the far end is greater than the receive\nsensitivity of the radio, the link is possible. Increasing the transmission\npower can lead to violations of the regulatory framework of the country.\nIncreasing the antenna gain is by far the most effective way to improve\nrange. Make sure that the radio to be employed has connectors for an\nexternal antenna (some devices have an embedded or otherwise non\nremovable antenna).\nDecreasing loss in antenna cables is still an important issue, and the most\nradical way to attain it is to place the radio outside, directly attached to\nthe antenna, employing a weatherproof box. Often this lends to powering\nthe radio using PoE (Power over Ethernet).\nImproving the receiver sensitivity implies choosing a model with better\nperformance, or settle for lower transmission speeds where sensitivity is\nhigher.\nAlthough high gain antennas can be expensive, in many countries one can\nfind satellite antennas that are no longer being used and can be modified\nfor the WiFi bands.\nIn a perfect world, we would use the highest gain antennas with the\nloudest and most sensitive radios possible. But a number of practical\nconsiderations make this impossible. Amplifiers introduce an additional\npoint of failure, in addition they might violate maximum power permitted\nby local regulations and add noise in reception, so they should be avoided. 232 PLANNING AND DEPLOYMENT\nHigh power transmitters are available from many manufacturers that offer\nup to 1 W of output power which could be used instead of amplifiers in\nthose countries where this is legal.\nIn general, it is better to use high gain antennas than high transmitter\npower. Greater antenna gain will help both in transmission and reception\nmaking a double impact in the link budget. It will also cause less\ninterference to other users and receive less interference from other users\nand limit multipath effects But a high antenna gain implies a very narrow\nbeamwidth, which means that special alignment techniques are required.\nAntenna alignment\nFor short distances, when the corresponding antenna is visible, the\nantenna alignment procedure reduces to pointing the antenna in the\ndirection of the correspondent, both in the horizontal plane (azimuth) and\nin the vertical plane (elevation). This should suffice to establish the\nconnection. Once the connection is attained a fine adjustment can be\nmade by reading the RSSL (Receiver Signal Strength Level) in the local\nradio. This value is provided by the user interface, and can also be\nobtained from programs like netstumbler. The procedure consists of\nmoving the antenna in the horizontal plane in small steps while reading\nthe RSSL. Do not touch the antenna when reading, since your body will\naffect the measurement. Once satisfied that a maximum value is obtained,\nthe procedure is repeated in the vertical plane, moving the antenna first up\nand then down until a maximum value of received power is obtained, at\nwhich point the bolts that secure the antenna are tightened. This is all that\nis needed to aim a client device at an Access Point or Base Station. If you\nhave a point to point link, the same procedure should be repeated at the\nother end of the link.\nFor long distances and when the other end of the link is not visible, some\nextra steps are required. First, the horizontal direction (bearing) to aim the\nantenna must be obtained from the coordinates of the end points. Then a\ncompass is used to determine the direction in which the antenna should\nbe aimed.\nKeep in mind that in general there is a difference between the magnetic\nbearing measured by the compass and the geographical bearing obtained\nfrom the coordinates of the end points or from a map. 13. OUTDOOR INSTALL 233\nThis difference is called the magnetic declination, it can be very significant\nin some places and must be accounted for to properly aim the antenna.\nFig. OI 2 shows the 10\u00b0 difference between the magnetic north shown by\nthe compass and the geographical or true north indicated by the brass\nplate.\nFigure OI 2: Difference between Magnetic and Geographical North at El\nBaul, Venezuela in 2006.\nKeep in mind that iron and other magnetic metals will affect the reading\nof the compass, so stay away from those when making the measurement.\nIf the antenna is to be mounted in an steel tower, it might be impossible\nto get an accurate reading near it. Instead, one must walk away a certain\ndistance, use the compass to determine the direction the antenna must be\naimed and then try to locate some easily recognisable object that can be\nused as a reference for pointing the antenna at later. Since the beamwidth\nof a highly directive antenna might be just a few degrees, after pointing with\nthe compass we need to do some fine adjustment for the proper aiming of the\nantenna by measuring the strength of the received signal.\nUnfortunately the RSSL indicated by the radio software will only work after a\nproper packet has been satisfactorily received and decoded, and this will only\nhappen when the antenna is well aimed.\nSo we need an instrument that can reveal the strength of the received\nsignal independently from the modulation that it might have. 234 PLANNING AND DEPLOYMENT\nThe instrument needed for this task is the Spectrum Analyser.\nThere are a great variety of spectrum analysers on the market, some of\nthem costing thousands of dollars, but if we are only interested in the\nWiFi bands we can make do with some inexpensive solutions like the\nfollowing:\n\"RF Explorer\" offers inexpensive devices for several frequency bands.\nThe \"RF Explorer model 2.4G\" costs 120$ from\nhttp:\/\/www.seeedstudio.com\/depot\/-p-924.html?cPath=174\nand is a stand alone unit that can measure signals from 2.4 to 2.485\nGHz, with a sensitivity of -105 dBm. It has an SMA connector for the\nantenna and therefore is well suited for antenna alignment.\n\"WiSpy\" is a spectrum analyser in a USB dongle that attaches to a laptop.\nYou will need the models with SMA RP connector, there is one for 2.4\nGHz moderately priced and another one that covers both the 2.4 and the\n5 GHz bands sold for 600$ at www.metageek.net.\n\"Ubiquiti Networks\" , www.ubnt.com, used to sell USB dongle spectrum\nanalysers for 2.4 GHz at 70$.\nUnfortunately they seem to have discontinued this product after\nincorporating the spectrum analyser capability in their M series radios.\nSo when using these radios you can take advantage of their \"airView\"\nalignment tool. In principle one of these inexpensive radios like the\n\"Bullet M\" which comes with a N Male connector can also be used to\nalign antennas for other radios in both the 2.4 and 5 GHz bands.\nUnfortunately the digitally modulated signal transmitted by WiFi radios is\nnot well suited for antenna alignment, since its power is spread over the\n20 MHz bandwidth. For antenna alignment a single frequency with a\nstable output power is required.\nThis type of signal is produced by a microwave signal generator, but they\nare quite expensive.\nThe \"RF Explorer model 2.4G\" incorporates a 2.4 GHz signal generator,\nbut the maximum output power of 1 dBm is not well suited for long\ndistance antenna pointing.Instead, we have repurposed devices called\n\"video senders\", meant for transmitting video signals, which act as\npowerful microwave single frequency signal sources when no modulation is\napplied. 13. OUTDOOR INSTALL 235\nThey are available for both the 2.4 GHz and the 5 GHz bands with\noutput power up to 33 dBm. For our purposes it is necessary to buy a\nmodel with an antenna connector, so that we can attach our own antenna.\nThere are many vendors to choose from, see for instance:\nhttp:\/\/www.lightinthebox.com\/Popular\/Wifi_Video_Transmitter.html\nAs an example of long distance link using modified WiFi devices, we can\nmention an experiment performed in April 2005 in Venezuela between\nPico del Aguila (8.83274638\u00b0 N, 70.83074570\u00b0W,4100 m elevation) and\nEl Baul (8.957667\u00b0 N, 68.297528\u00b0 W, 155 m elevation).\nUsing the Radio Mobile software, we find that the distance to El Baul is\n280 km, the azimuth is 97\u00b0, the antenna elevation angle is -2.0\u00b0, and the\nplace at which the beam is closest to the ground happens at 246 km,\nwhere it clears 1.7 times the first Fresnel zone at the 2.412 GHz\nfrequency.\nFig. OI 3 shows the output of the program:\nFigure OI 3: Profile of a 280 km path over which standard WiFi gear with\nOpenWRT firmware which allows for the ACKtimeout increase was used to\ntransfer files at about 65 kb\/s in April 2006 between Pico del Aguila and El Baul\nin Venezuela. 236 PLANNING AND DEPLOYMENT\nNotice that the earth curvature is quite apparent, and was overcome\nbecause one of the stations was at 4100 m altitude and the other at\n155 m. Frequency was 2412 MHz, output power 100 mW, antenna gain\naround 30 dBi. Streaming video was successfully transmitted despite the\nlimited bandwidth.\nA year later the experiment was repeated with the same WiFi gear but\nwith commercial 32 dBi antennas at both ends and similar results were\nobtained. Then, another type of firmware developed by the TIER group at\nUC Berkeley University that implements TDD (Time Division\nDuplexing) was tried which showed a remarkable bidirectional throughput\nof 6 Mbit\/s with standard 802.11b hardware.\nMoving the remote site to a 1400 m high hill called Platillon\n(9.88905350\u00b0N, 67.50552400\u00b0W), provided a 380 km testbed over which\nthe experiment was again successfully repeated as described in the Case\nStudies section in this book.\nThis can be illustrated by using an on-line version of Radio Mobile,\navailable at http:\/\/www.cplus.org\/rmw\/rmonline.html, which is simpler to\nuse, although it has some limitation as compared with the downloadable\nversion. One must register in the site, enter the coordinates of the points\nover which the radio link has to be established, the power values for the\nradios and the antennas gains and height, and the software will fetch the\nrelevant elevation data required to perform the simulation of the link.\nKeep in mind that only radio amateurs frequency are supported in the web\nversion, so 2.3 GHz should be used instead of 2.4 GHZ, but the results\nare close enough and where validated by the experiment on the field.\nIn Figure OI 4 we show the output of the Radio Mobile on- line for this\nexperiment that can be replicated by the reader as an exercise.\nFigure OI 4: Profile of a 380 km test at 2.4 GHz performed in April and\nAugust 2007, Venezuela. 13. OUTDOOR INSTALL 237\nNotice that the earth curvature is even more noticeable over the 380 km\npath, but the height of the end points combined with flat land in between\nallows for ample clearance of the first Fresnel zone.\nFigure OI 5 shows the numerical values of the Radio Mobile on-line\nsimulation:\nFigure OI 5: Results of the Radio Mobile on-line simulation for the 380 km\nlink between Aguila and Platillon. 238 PLANNING AND DEPLOYMENT\n14. OFF-GRID POWER\nSolar Power\nThis chapter provides an introduction to standalone photovoltaic systems.\nStandalone systems work without connection to an established power grid.\nThis chapter presents the basic concepts of the generation and storage of\nphotovoltaic solar energy. We will also provide a method for designing a\nsolar system with limited access to information and resources. This\nchapter only discusses solar systems for the direct production of electricity\n(photovoltaic solar energy). Thermal solar energy systems are beyond the\nscope of this chapter.\nSolar Energy\nA photovoltaic system is based on the ability of photovoltaic panels to\nconvert sun radiation directly into electrical energy. The total amount of\nsolar energy that lights a given area is known as irradiance (G) and it is\nmeasured in watts per square metre (W\/m2). The instantaneous values are\nnormally averaged over a period of time, so it is common to talk about\ntotal irradiance per hour, day or month. The amount of irradiance that\narrives at the surface of the Earth varies due to natural weather variations\nand depends on the location. Therefore it is necessary to work with\nstatistical data based on the \"solar history\" of a particular place. For many\nareas it can be difficult to acquire detailed information, so we will need to\nwork with approximate values in this case.\nA few organisations produce maps that include average values of daily\nglobal irradiation for different regions. These values are known as peak sun\nhours or PSHs. You can use the PSH value for your region to simplify\nyour calculations. One unit of \"peak sun hours\" corresponds to a radiation\nof 1000 Watts per square metre for the duration of an hour. If an area has\n4 PSH per day in the worst of the months, it means we can expect a daily\nirradiation of 4000 Wh\/m2. Low resolution PSH maps\/calculation tools\nare available from a number of online sources such as:\nhttp:\/\/www.wunderground.com\/calculators\/solar.html\nFor more detailed information, consult a local solar energy vendor or\nweather station.\nAirports normally record meteorological data including insolation. 14. OFF-GRID POWER 239\nWhat about wind power?\nIt is possible to use a wind generator in place of solar panels when an\nautonomous system is being designed for installation on a hill or\nmountain. To be effective, the average wind speed over the year should be\nat least 3 to 4 metres per second, and the wind generator should be 6\nmetres higher than other objects within a distance of 100 metres.\nA location far away from the coast usually lacks sufficient wind energy to\nsupport a wind powered system.\nGenerally speaking, photovoltaic systems are more reliable than wind\ngenerators, as sunlight is more available than consistent wind in most\nplaces. On the other hand, wind generators are able to charge batteries\neven at night, as long as there is sufficient wind. It is of course possible to\nuse wind in conjunction with solar power to help cover times when there\nis extended cloud cover, or when there is insufficient wind. In the\nHighlands and Islands of Scotland there is a project that uses both solar\nand wind power generation. See the following link for more information:\nhttp:\/\/www.wirelesswhitespace.org\/projects\/wind-firenewable-energy-\nbasestation.aspx\nFor most locations however, the cost of a good wind generator is not\njustified by the meagre amount of power it will add to the overall system.\nThis chapter will therefore focus on the use of solar panels for generating\nelectricity.\nPhotovoltaic system components\nA basic photovoltaic system consists of four main components: solar panel,\nbattery, regulator, and load.\nThe panel is generating electricity. The battery stores electrical energy. The\nregulator protects the battery against excessive charge and discharge. The\nload refers to any device that requires electrical power. It is important to\nremember that solar panels and batteries produce direct current (DC). If\nthe range of operational voltage of your equipment does not fit the\nvoltage supplied by your battery, it will also be necessary to include some\ntype of converter. If the equipment that you want to power uses a\ndifferent DC voltage than the one supplied by the battery, you will need\nto use a DC\/DC converter. If some of your equipment requires AC power,\nyou will need to use a DC\/AC converter, also known as an inverter. Every\nelectrical system should also incorporate various safety devices in the event\nthat something goes wrong. 240 PLANNING AND DEPLOYMENT\nThese devices include proper wiring, circuit breakers, surge protectors,\nfuses, ground rods, lighting arrestors, etc.\nThe solar panel\nThe solar panel is composed of solar cells that collect solar radiation and\ntransform it into electrical energy. This part of the system is sometimes\nreferred to as a solar module or photovoltaic generator.\nSolar panel arrays can be made by connecting a set of panels in series\nand\/or parallel in order to provide the necessary energy for a given load.\nThe electrical current supplied by a solar panel varies proportionally to the\nsolar radiation. This will vary according to climatic conditions, the hour of\nthe day, and the time of the year.\nFigure OGP 1: A solar panel\nSeveral technologies are used in the manufacture of solar cells.\nThe most common is crystalline silicon, and can be either monocrystalline\nor polycrystalline. Amorphous silicon can be cheaper but is less efficient at\nconverting solar energy to electricity. With a reduced life expectancy and\na 6 to 8% transformation efficiency, amorphous silicon is typically used\nfor low power equipment, such as portable calculators. 14. OFF-GRID POWER 241\nNew solar technologies, such as silicon ribbon and thin film photovoltaics,\nare currently under development. These technologies promise higher\nefficiencies but are not yet widely available.\nThe battery\nThe battery stores the energy produced by the panels that is not\nimmediately consumed by the load. This stored energy can then be used\nduring periods of low solar irradiation. The battery component is also\nsometimes called the accumulator. Batteries store electricity in the form of\nchemical energy. The most common type of batteries used in solar\napplications are maintenance-free lead-acid batteries, also called\nFigure OGP 2: A 200 Ah lead-acid battery. The negative terminal was\nbroken due to weight on the terminals during transportation.\nAside from storing energy, sealed lead-acid batteries also serve two\nimportant functions:\n\u2022 They are able to provide an instantaneous power superior\nto that of the array of panels. This instantaneous power is\nneeded to start some appliances, such as the motor of a\nrefrigerator or a pump.\n\u2022 They determine the operating voltage of your installation. 242 PLANNING AND DEPLOYMENT\nFor a small power installation and where space constraints are important,\nother types of batteries (such as NiCd, NiMh, or Li-ion) can be used.\nThese types of batteries need a specialised charger\/regulator and cannot\ndirectly replace lead-acid batteries.\nThe regulator\nThe regulator (or more formally, the solar power charge regulator) assures\nthat the battery is working in appropriate conditions. It avoids\novercharging or overdischarging the battery, both of which are very\ndetrimental to the life of the battery. To ensure proper charging and\ndischarging of the battery, the regulator maintains knowledge of the state\nof charge (SoC) of the battery. The SoC is estimated based on the actual\nvoltage of the battery.\nBy measuring the battery voltage and being programmed with the type of\nstorage technology used by the battery, the regulator will know the precise\npoints where the battery would be overcharged or excessively discharged.\nFigure OGP 3: A 30 Amp solar charge controller\nThe regulator can include other features that add valuable information and\nsecurity control to the equipment. These features include ammeters,\nvoltmeters, measurement of ampere-hour, timers, alarms, etc. While\nconvenient, none of these features are required for a working photovoltaic\nsystem. 14. OFF-GRID POWER 243\nThe converter\nThe electricity provided by the panel array and battery is DC at a fixed\nvoltage. The voltage provided might not match what is required by your\nload. A direct\/alternating (DC\/AC) converter, also known as inverter,\nconverts the DC current from your batteries into AC. This comes at the\nprice of losing some energy during the conversion. If necessary, you can\nalso use converters to obtain DC at voltage level other than what is\nsupplied by the batteries. DC\/DC converters also lose some energy during\nthe conversion. For optimal operation, you should design your solar-\npowered system so that the generated DC voltage matches the load.\nFigure OGP 4: An 800 Watt DC\/AC converter (power inverter)\nThe load\nThe load is the equipment that consumes the power generated by your\nenergy system.\nThe load may include wireless communications equipment, routers,\nworkstations, lamps, TV sets, VSAT modems, etc.\nAlthough it is not possible to precisely calculate the exact total\nconsumption of your equipment, it is vital to be able to make a good\nestimate.\nIn this type of system it is absolutely necessary to use efficient and low\npower equipment to avoid wasting energy. 244 PLANNING AND DEPLOYMENT\nPutting it all together\nThe complete photovoltaic system incorporates all of these components.\nThe solar panels generate power when solar energy is available.\nThe regulator ensures the most efficient operation of the panels and\nprevents damage to the batteries. The battery bank stores collected energy\nfor later use.\nConverters and inverters adapt the stored energy to match the\nrequirements of your load. Finally, the load consumes the stored energy to\ndo work.\nWhen all of the components are in balance and are properly maintained,\nthe system will support itself for years.\nFigure OGP 5: A solar installation with DC and AC loads\nWe will now examine each of the individual components of the\nphotovoltaic system in greater detail.\nThe solar panel\nAn individual solar panel is made of many solar cells.\nThe cells are electrically connected to provide a particular value of current\nand voltage.\nThe individual cells are properly encapsulated to provide isolation and\nprotection from humidity and corrosion. 14. OFF-GRID POWER 245\nThere are different types of modules available on the market, depending\non the power demands of your application. The most common modules\nare composed of 32 or 36 solar cells of crystalline silicon. These cells are\nall of equal size, wired in series, and encapsulated between glass and plastic\nmaterial, using a polymer resin (EVA) as a thermal insulator.\nThe surface area of the module is typically between 0.1 and 0.5 m2. Solar\npanels usually have two electrical contacts, one positive and one negative.\nSome panels also include extra contacts to allow the installation of bypass\ndiodes across individual cells.\nBypass diodes protect the panel against a phenomenon known as \u201chot-\nspots\u201d. A hot-spot occurs when some of the cells are in shadow while the\nrest of the panel is in full sun. Rather than producing energy, shaded cells\nbehave as a load that dissipates energy. In this situation, shaded cells can\nsee a significant increase in temperature (about 85 to 100\u00baC.)\nBypass diodes will prevent hot-spots on shaded cells, but reduce the\nmaximum voltage of the panel. They should only be used when shading is\nunavoidable. It is a much better solution to expose the entire panel to full\nsun whenever possible. 246 PLANNING AND DEPLOYMENT\nirradiance, and the voltage (V) changes with the temperature.\nThe electrical performance of a solar module is represented by the IV\ncharacteristic curve, which represents the current that is provided based on\nthe voltage generated for a certain solar radiation.\nThe curve represents all the possible values of voltage-current.\nThe curves depend on two main factors: the temperature and the solar\nradiation received by the cells.\nFor a given solar cell area, the current generated is directly proportional to\nsolar irradiance (G), while the voltage reduces slightly with an increase of\ntemperature.\nA good regulator will try to maximise the amount of energy that a panel\nprovides by tracking the point that provides maximum power (V x I). The\nmaximum power corresponds to the knee of the IV curve. 14. OFF-GRID POWER 247\nSolar Panel Parameters\nThe main parameters that characterise a photovoltaic panel are:\n1. Short Circuit Current (I ): the maximum current provided by\nSC\nthe panel when the connectors are short circuited.\n2. Open Circuit Voltage (V ): the maximum voltage that the panel\nOC\nprovides when the terminals are not connected to any load (an\nopen circuit). This value is normally 22 V for panels that are\ngoing to work in 12 V systems, and is directly proportional to the\nnumber of cells connected in series.\n3. Maximum Power Point (P ): the point where the power\nmax\nsupplied by the panel is at maximum, where P = I x V .\nmax max max\nThe maximum power point of a panel is measured in Watts (W) or peak\nWatts (W ). It is important not to forget that in normal conditions the\np\npanel will not work at peak conditions, as the voltage of operation is fixed\nby the load or the regulator. Typical values of V and I should be a bit\nmax max\nsmaller than the I and V .\nSC OC\n1. Fill Factor (FF): the relation between the maximum power that\nthe panel can actually provide and the product I . V . This\nSC OC\ngives you an idea of the quality of the panel because it is an\nindication of the type of IV characteristic curve. The closer FF is\nto 1, the more power a panel can provide. Common values\nusually are between 0.7 and 0.8.\n2. Efficiency (\u03b7): the ratio between the maximum electrical power\nthat the panel can give to the load and the power of the solar\nradiation (p) incident on the panel. This is normally around 10-\nl\n12%, depending on the type of cells (monocrystalline,\npolycrystalline, amorphous or thin film).\nConsidering the definitions of point of maximum power and the fill factor\nwe see that:\n\u03b7 = P \/ P = FF . I . V \/ P\nmax L SC OC L\nThe values of I , V , I and V are provided by the manufacturer\nSC OC Pmax Pmax\nand refer to standard conditions of measurement with irradiance G =\n1000 W\/m2, at sea-level, for a temperature of cells of T = 25\u00baC.\nc 248 PLANNING AND DEPLOYMENT\nThe panel parameter values change for other conditions of irradiance and\ntemperature. Manufacturers will sometimes include graphs or tables with\nvalues for conditions different from the standard. You should check the\nperformance values at the panel temperatures that are likely to match your\nparticular installation.\nBe aware that two panels can have the same W but very different\np\nbehaviour in different operating conditions. When acquiring a panel, it is\nimportant to verify, if possible, that their parameters (at least, I and\nSC\nV ) match the values promised by the manufacturer.\nOC\nPanel parameters for system sizing\nTo calculate the number of panels required to cover a given load, you just\nneed to know the current and voltage at the point of maximum power:\nI and V .\nPmax Pmax\nYou should always be aware that the panel is not going to perform under\nperfect conditions as the load or regulation system is not always going to\nwork at the point of maximum power of the panel. You should assume a\nloss of efficiency of 5% in your calculations to compensate for this.\nInterconnection of panels\nA solar panel array is a collection of solar panels that are electrically\ninterconnected and installed on some type of support structure. Using a\nsolar panel array allows you to generate greater voltage and current than is\npossible with a single solar panel. The panels are interconnected in such a\nway that the voltage generated is close to (but greater than) the level of\nvoltage of the batteries, and that the current generated is sufficient to feed\nthe equipment and to charge the batteries.\nConnecting solar panels in series increases the generated voltage.\nConnecting panels in parallel increases the current.\nThe number of panels used should be increased until the amount of power\ngenerated slightly exceeds the demands of your load.\nIt is very important that all of the panels in your array are as identical as\npossible. In an array, you should use panels of the same brand and\ncharacteristics because any difference in their operating conditions will\nhave a big impact on the health and performance of your system. 14. OFF-GRID POWER 249\nEven panels that have identical performance ratings will usually display\nsome variance in their characteristics due to manufacturing processes.\nThe actual operating characteristics of two panels from the same\nmanufacturer can vary by as much as \u00b110%.\nWhenever possible, it is a good idea to test the real-world performance of\nindividual panels to verify their operating characteristics before assembling\nthem into an array.\nFigure OGP 8: Interconnection of panels in parallel. The voltage remains\nconstant while the current duplicates. (Photo: Fantsuam Foundation, Nigeria)\nHow to choose a good panel\nOne obvious metric to use when shopping for solar panels is to compare\nthe ratio of the nominal peak power (W ) to the price. This will give you a\np\nrough idea of the cost per Watt for different panels. But there are a\nnumber of other considerations to keep in mind as well.\nIf you are going to install solar panels in geographical areas where soiling\n(from dust, sand, or grit) will likely be a problem, consider purchasing\npanels with a low affinity for soil retention. 250 PLANNING AND DEPLOYMENT\nThese panels are made of materials that increase the likelihood that the\npanel will be automatically cleaned by wind and rain.\nAlways check the mechanical construction of each panel. Verify that the\nglass is hardened and the aluminum frame is robust and well built. The\nsolar cells inside the panel can last for more than 20 years, but they are\nvery fragile and the panel must protect them from mechanical hazards.\nLook for the manufacturer's quality guarantee in terms of expected power\noutput and mechanical construction.\nFinally, be sure that the manufacturer provides not only the nominal peak\npower of the panel (W ) but also the variation of the power with\np\nirradiation and temperature. This is particularly important when panels are\nused in arrays, as variations in the operating parameters can have a big\nimpact on the quality of power generated and the useful lifetime of the\npanels.\nThe battery\nThe battery \u201chosts\u201d a certain reversible chemical reaction that stores\nelectrical energy that can later be retrieved when needed. Electrical energy\nis transformed into chemical energy when the battery is being charged,\nand the reverse happens when the battery is discharged. A battery is\nformed by a set of elements or cells arranged in series. Lead-acid batteries\nconsist of two submerged lead electrodes in an electrolytic solution of\nwater and sulphuric acid. A potential difference of about 2 volts takes\nplace between the electrodes, depending on the instantaneous value of the\ncharge state of the battery.\nThe most common batteries in photovoltaic solar applications have a\nnominal voltage of 12 or 24 volts. A 12 V battery therefore contains 6\ncells in series.\nThe battery serves two important purposes in a photovoltaic system: to\nprovide electrical energy to the system when energy is not supplied by the\narray of solar panels, and to store excess energy generated by the panels\nwhenever that energy exceeds the load. The battery experiences a cyclical\nprocess of charging and discharging, depending on the presence or absence\nof sunlight.\nDuring the hours that there is sun, the array of panels produces electrical\nenergy. The energy that is not consumed immediately is used to charge the\nbattery. 14. OFF-GRID POWER 251\nDuring the hours of absence of sun, any demand of electrical energy is\nsupplied by the battery, thereby discharging it.\nThese cycles of charge and discharge occur whenever the energy produced\nby the panels does not match the energy required to support the load.\nWhen there is sufficient sun and the load is light, the batteries will charge.\nObviously, the batteries will discharge at night whenever any amount of\npower is required. The batteries will also discharge when the irradiance is\ninsufficient to cover the requirements of the load (due to the natural\nvariation of climatological conditions, clouds, dust, etc.)\nIf the battery does not store enough energy to meet the demand during\nperiods without sun, the system will be exhausted and will be unavailable\nfor consumption. On the other hand, oversizing the system (by adding far\ntoo many panels and batteries) is expensive and inefficient. When\ndesigning a stand-alone system we need to reach a compromise between\nthe cost of components and the availability of power from the system.\nOne way to do this is to estimate the required number of days of\nautonomy. In the case of a telecommunications system, the number of\ndays of autonomy depends on its critical function within your network\ndesign. If the equipment is going to serve as a repeater and is part of the\nbackbone of your network, you will likely want to design your\nphotovoltaic system with an autonomy of up to 5-7 days.\nOn the other hand, if the solar system is responsible for a providing\nenergy to client equipment you can probably reduce number of days of\nautonomy to two or three. In areas with low irradiance, this value may\nneed to be increased even more. In any case, you will always have to find\nthe proper balance between cost and reliability.\nTypes of batteries\nMany different battery technologies exist, and are intended for use in a\nvariety of different applications. The most suitable type for photovoltaic\napplications is the stationary battery, designed to have a fixed location and\nfor scenarios where the power consumption is more or less irregular.\n\"Stationary\" batteries can accommodate deep discharge cycles, but they\nare not designed to produce high currents in brief periods of time.\nStationary batteries can use an electrolyte that is alkaline (such as Nickel-\nCadmium) or acidic (such as Lead-Acid). 252 PLANNING AND DEPLOYMENT\nStationary batteries based on Nickel-Cadmium are recommended for their\nhigh reliability and resistance whenever possible.\nUnfortunately, they tend to be much more expensive and difficult to\nobtain than sealed lead-acid batteries.\nIn many cases when it is difficult to find local, good and cheap stationary\nbatteries (importing batteries is not cheap), you will be forced to use\nbatteries targeted to the automobile market.\nUsing car batteries\nAutomobile batteries are not well suited for photovoltaic applications as\nthey are designed to provide a substantial current for just few seconds\n(when starting then engine) rather than sustaining a low current for long\nperiod of time. This design characteristic of car batteries (also called\ntraction batteries) results in a shortened effective life when used in\nphotovoltaic systems. Traction batteries can be used in small applications\nwhere low cost is the most important consideration, or when other\nbatteries are not available.\nTraction batteries are designed for vehicles and electric wheelbarrows.\nThey are cheaper than stationary batteries and can serve in a photovoltaic\ninstallation, although they require very frequent maintenance. These\nbatteries should never be deeply discharged, because doing so will greatly\nreduce their ability to hold a charge. A truck battery should not be\ndischarged to more than 70% of its total capacity. This means that you\ncan only use a maximum of 30% of a lead-acid battery's nominal capacity\nbefore it must be recharged.\nYou can extend the life of a lead-acid battery by using distilled water. By\nusing a densimeter or hydrometer, you can measure the density of the\nbattery's electrolyte. A typical battery has specific gravity of 1.28.\nAdding distilled water and lowering the density to 1.2 can help reduce the\nanode's corrosion, at a cost of reducing the overall capacity of the battery.\nIf you adjust the density of battery electrolyte, you must use distilled\nwater, as tap water or well water will permanently damage the battery.\nStates of charge\nThere are two special states of charge that can take place during the cyclic\ncharge and discharge of the battery. They should both be avoided in order\nto preserve the useful life of the battery. 14. OFF-GRID POWER 253\n1. 1. Overcharge\nOvercharge takes place when the battery arrives at the limit of its capacity.\nIf energy is applied to a battery beyond its point of maximum charge, the\nelectrolyte begins to break down.\nThis produces bubbles of oxygen and hydrogen, in a process is known as\ngasification. This results in a loss of water, oxidation on the positive\nelectrode, and in extreme cases, a danger of explosion.\nOn the other hand, the presence of gas avoids the stratification of the\nacid. After several continuous cycles of charge and discharge, the acid\ntends to concentrate itself at the bottom of the battery thereby reducing\nthe effective capacity. The process of gasification agitates the electrolyte\nand avoids stratification.\nAgain, it is necessary to find a compromise between the advantages\n(avoiding electrolyte stratification) and the disadvantages (losing water and\nproduction of hydrogen). One solution is to allow a slight overcharge\ncondition every so often. One typical method is to allow a voltage of 2.35\nto 2.4 Volts for each element of the battery every few days, at 25\u00baC. The\nregulator should ensure a periodic and controlled overcharges.\n2. Overdischarge\nIn the same way that there is a upper limit, there is also a lower limit to a\nbattery's state of charge. Discharging beyond that limit will result in\ndeterioration of the battery. When the effective battery supply is\nexhausted, the regulator prevents any more energy from being extracted\nfrom the battery. When the voltage of the battery reaches the minimum\nlimit of 1.85 Volts per cell at 25\u00b0C, the regulator disconnects the load\nfrom the battery.\nIf the discharge of the battery is very deep and the battery remains\ndischarged for a long time, three effects take place: the formation of\ncrystallised sulphate on the battery plates, the loosening of the active\nmaterial on the battery plate, and plate buckling. The process of forming\nstable sulphate crystals is called hard sulphation. This is particularly\nnegative as it generates big crystals that do not take part in any chemical\nreaction and can make your battery unusable. 254 PLANNING AND DEPLOYMENT\nBattery Parameters\nThe main parameters that characterise a battery are:\nNominal Voltage, V : the most common value being 12 V.\nNBat\nNominal Capacity, C : the maximum amount of energy that\nNBat\ncan be extracted from a fully charged battery. It is expressed in Ampere-\nhours (Ah) or Watt-hours (Wh).\nThe amount of energy that can be obtained from a battery depends on the\ntime in which the extraction process takes place. Discharging a battery\nover a long period will yield more energy compared to discharging the\nsame battery over a short period. The capacity of a battery is therefore\nspecified at different discharging times. For photovoltaic applications, this\ntime should be longer than 100 hours (C100).\nMaximum Depth of Discharge, DoD : The depth of discharge\nmax\nis the amount of energy extracted from a battery in a single\ndischarge cycle, expressed as a percentage. The life expectancy of a battery\ndepends on how deeply it is discharged in each cycle. The manufacturer\nshould provide graphs that relate the number of charge-discharge cycles to\nthe life of the battery. As a general rule you should avoid discharging a\ndeep cycle battery beyond 50%. Traction batteries should only be\ndischarged by as little as 30%.\nUseful Capacity, C : It is the real (as in usable) capacity of a\nUBat\nbattery. It is equal to the product of the nominal capacity and the\nmaximum DoD. For example, a stationary battery of nominal capacity\n(C100) of 120 Ah and depth of discharge of 70% has a useful capacity of\n(120 x 0.7) = 84 Ah.\nMeasuring the state of charge of the battery\nA sealed lead-acid battery of 12 V provides different voltages depending\non its state of charge. When the battery is fully charged in an open\ncircuit, the output voltage is about 12.8 V.\nThe output voltage lowers quickly to 12.6 V when loads are attached. As\nthe battery is providing constant current during operation, the battery\nvoltage reduces linearly from 12.6 to 11.6 V depending on the state of\ncharge. 14. OFF-GRID POWER 255\nA sealed lead- acid batteries provides 95% of its energy within this voltage\nrange. If we make the broad assumption that a fully loaded battery has a\nvoltage of 12.6 V when \"full\" and 11.6 V when \"empty\", we can estimate\nthat a battery has discharged 70% when it reaches a voltage of 11.9 V.\nThese values are only a rough approximation since they depend on the life\nand quality of the battery, the temperature, etc.\nState of Charge 12V Battery Voltage Volts per Cell\n100% 12.7 2.12\n90% 12.5 2.08\n80% 12.42 2.07\n70% 12.32 2.05\n60% 12.2 2.03\n50% 12.06 2.01\n40% 11.9 1.98\n30% 11.75 1.96\n20% 11.58 1.93\n10% 11.31 1.89\nAccording to this table, and considering that a truck battery should not be\ndischarged more than 20% to 30%, we can determine that the useful\ncapacity of a 170 Ah truck battery is 34 Ah (20%) to 51 Ah (30%). Using\nthe same table, we find that we should program the regulator to prevent\nthe battery from discharging below 12.3 V.\nBattery and regulator protection\nThermomagnetic circuit breakers or one time fuses must be used to\nprotect the batteries and the installation from short circuit and\nmalfunctions. There are two types of fuses: slow blow, and quick blow.\nSlow blow fuses should be used with inductive or capacitive loads where a\nhigh current can occur at power up. Slow blow fuses will allow a higher\ncurrent than their rating to pass for a short time. Quick blow fuses will\nimmediately blow if the current flowing through them is higher than their\nrating. 256 PLANNING AND DEPLOYMENT\nThe regulator is connected to the battery and the loads, so two different\nkinds of protection need to be considered.\nOne fuse should be placed between the battery and the regulator, to\nprotect the battery from short-circuit in case of regulator failure.\nA second fuse is needed to protect the regulator from excessive load\ncurrent.\nThis second fuse is normally integrated into the regulator itself.\nFigure OGP 9: A battery bank of 3600 Ah, currents reach levels of 45 A\nduring charging\nEvery fuse is rated with a maximum current and a maximum usable\nvoltage. The maximum current of the fuse should be 20% bigger than the\nmaximum current expected. Even if the batteries carry a low voltage, a\nshort circuit can lead to a very high current which can easily reach several\nhundred amperes.\nLarge currents can cause fire, damage the equipment and batteries, and\npossibly cause electric shock to a human body. If a fuse breaks, never\nreplace a fuse with a wire or a higher rated fuse. First determine the cause\nof the problem, then replace the fuse with another one which has the\nsame characteristics. 14. OFF-GRID POWER 257\nTemperature effects\nThe ambient temperature has several important effects on the\ncharacteristics of a battery:\n\u2022 The nominal capacity of a battery (that the manufacturer usually\ngives for 25\u00b0C) increases with temperature at the rate of about\n1%\/\u00b0C. But if the temperature is too high, the chemical reaction\nthat takes place in the battery accelerates, which can cause the\nsame type of oxidation that takes place during overcharging. This\nwill obviously reduce the life expectancy of a battery. This\nproblem can be compensated partially in car batteries by using a\nlow density of dissolution (a specific gravity of 1.25 when the\nbattery is totally charged).\n\u2022 As the temperature is reduced, the useful life of the battery\nincreases. But if the temperature is too low, you run the the risk\nof freezing the electrolyte. The freezing temperature depends on\nthe density of the solution, which is also related to the state of\ncharge of the battery. The lower the density, the greater the risk of\nfreezing. In areas of low temperatures, you should avoid deeply\ndischarging the batteries (that is, DoDmax is effectively reduced.)\n\u2022 The temperature also changes the relation between voltage and\ncharge. It is preferable to use a regulator which adjusts the low\nvoltage disconnect and reconnect parameters according to\ntemperature. The temperature sensor of the regulator should be\nfixed to the battery using tape or some other simple method.\n\u2022 In hot areas it is important to keep the batteries as cool as\npossible. The batteries must be stored in a shaded area and never\nget direct sunlight. It's also desirable to place the batteries on a\nsmall support to allow air to flow under them, thus increase the\ncooling.\nHow to choose a good battery\nChoosing a good battery can be very challenging.\nHigh capacity batteries are heavy, bulky and expensive to import. 258 PLANNING AND DEPLOYMENT\nA 200 Ah battery weighs around 50 kg (120 pounds) and it cannot be\ntransported as hand luggage.\nIf you want long-life (as in > 5 years) and maintenance free batteries be\nready to pay the price.\nA good battery should always come with its technical specifications,\nincluding the capacity at different discharge rates (C20, C100), operating\ntemperature, cut-off voltage points, and requirements for chargers.\nThe batteries must be free of cracks, liquid spillage or any sign of damage,\nand battery terminals should be free of corrosion.\nAs laboratory tests are necessary to obtain complete data about real\ncapacity and aging, expect lots of low quality batteries (including fakes) in\nthe local markets. A typical price (not including transport and import tax)\nis $3-4 USD per Ah for 12 V lead-acid batteries.\nLife expectancy versus number of cycles\nBatteries are the only component of a solar system that should be\namortised over a short period and regularly replaced.\nYou can increase the useful lifetime of a battery by reducing the depth of\ndischarge per cycle. Even deep cycle batteries will have an increased\nbattery life if the number of deep discharge (>30%) cycles is reduced.\nIf you completely discharge the battery every day, you will typically need\nto change it after less than one year. If you use only 1\/3 of the capacity\nthe battery, it can last more than 3 years. It can be cheaper to buy a\nbattery with 3 times the capacity than to change the battery every year.\nThe charge regulator\nThe charge regulator is also known as a charge controller, a voltage\nregulator, a charge-discharge controller or a charge-discharge and load\ncontroller. The regulator sits between the array of panels, the batteries, and\nyour equipment or loads.\nRemember that the voltage of a battery, although always close to 2 V per\ncell, varies according to its state of charge. By monitoring the voltage of\nthe battery, the regulator prevents overcharging or overdischarging.\nRegulators used in solar applications should be connected in series: they\ndisconnect the array of panels from the battery to avoid overcharging, and\nthey disconnect the battery from the load to avoid overdischarging. 14. OFF-GRID POWER 259\nThe connection and disconnection is done by means of switches which\ncan be of two types: electromechanical (relays) or solid state (bipolar\ntransistor, MOSFET). Regulators should never be connected in parallel.\nIn order to protect the battery from gasification, the switch opens the\ncharging circuit when the voltage in the battery reaches its high voltage\ndisconnect (HVD) or cut-off set point. The low voltage disconnect (LVD)\nprevents the battery from overdischarging by disconnecting or shedding\nthe load. To prevent continuous connections and disconnections the\nregulator will not connect back the loads until the battery reaches a low\nreconnect voltage (LRV).\nTypical values for a 12 V lead-acid battery are:\nVoltage Point Voltage\nLVD 11.5\nLRV 12.6\nConstant Voltage Regulated 14.3\nEqualisation 14.6\nHVD 15.5\nThe most modern regulators are also able to automatically disconnect the\npanels during the night to avoid discharging of the battery.\nThey can also periodically overcharge the battery to improve its life, and\nthey may use a mechanism known as pulse width modulation (PWM) to\nprevent excessive gassing.\nAs the peak power operating point of the array of panels will vary with\ntemperature and solar illumination, new regulators are capable of\nconstantly tracking the maximum point of power of the solar array. This\nfeature is known as maximum power point tracking (MPPT).\nRegulator Parameters\nWhen selecting a regulator for your system, you should at least know the\noperating voltage and the maximum current that the regulator can handle.\nThe operating voltage will be 12, 24, or 48 V. The maximum current must\nbe 20% bigger than the current provided by the array of panels connected\nto the regulator. 260 PLANNING AND DEPLOYMENT\nOther features and data of interest include:\n\u2022 Specific values for LVD, LRV and HVD.\n\u2022 Support for temperature compensation. The voltage that indicates\nthe state of charge of the battery varies with temperature. For that\nreason some regulators are able to measure the battery\ntemperature and correct the different cut-off and reconnection\nvalues.\n\u2022 Instrumentation and gauges. The most common instruments\nmeasure the voltage of the panels and batteries, the state of charge\n(SoC) or Depth of Discharge (DoD). Some regulators include\nspecial alarms to indicate that the panels or loads have been\ndisconnected, LVD or HVD has been reached, etc.\nConverters\nThe regulator provides DC power at a specific voltage.\nConverters and inverters are used to adjust the voltage to match the\nrequirements of your load.\nDC\/DC Converters\nDC\/DC converters transform a continuous voltage to another continuous\nvoltage of a different value. There are two conversion methods which can\nbe used to adapt the voltage from the batteries: linear conversion and\nswitching conversion.Linear conversion lowers the voltage from the\nbatteries by converting excess energy to heat. This method is very simple\nbut is obviously inefficient. Switching conversion generally uses a magnetic\ncomponent to temporarily store the energy and transform it to another\nvoltage. The resulting voltage can be greater, less than, or the inverse\n(negative) of the input voltage. The efficiency of a linear regulator\ndecreases as the difference between the input voltage and the output\nvoltage increases. For example, if we want to convert from 12 V to 6 V,\nthe linear regulator will have an efficiency of only 50%.\nA standard switching regulator has an efficiency of at least 80%.\nDC\/AC Converter or Inverter\nInverters are used when your equipment requires AC power. Inverters\nchop and invert the DC current to generate a square wave that is later\nfiltered to approximate a sine wave and eliminate undesired harmonics. 14. OFF-GRID POWER 261\nVery few inverters actually supply a pure sine wave as output. Most models\navailable on the market produce what is known as \"modified sine wave\",\nas their voltage output is not a pure sinusoid. When it comes to efficiency,\nmodified sine wave inverters perform better than pure sinusoidal inverters.\nBe aware that not all the equipment will accept a modified sine wave as\nvoltage input. Most commonly, some laser printers will not work with a\nmodified sine wave inverter. Motors will work, but they may consume\nmore power than if they are fed with a pure sine wave. In addition, DC\npower supplies tend to warm up more, and audio amplifiers can emit a\nbuzzing sound.\nAside from the type of waveform, some important features of inverters\ninclude:\nReliability in the presence of surges. Inverters have two power\nratings: one for continuous power, and a higher rating for peak power.\nThey are capable of providing the peak power for a very short amount of\ntime, as when starting a motor. The inverter should also be able to safely\ninterrupt itself (with a circuit breaker or fuse) in the event of a short\ncircuit, or if the requested power is too high.\nConversion efficiency. Inverters are most efficient when providing\n50% to 90% of their continuous power rating.\nYou should select an inverter that most closely matches your load\nrequirements.\nThe manufacturer usually provides the performance of the inverter at 70%\nof its nominal power.\nBattery charging. Many inverters also incorporate the inverse\nfunction: the possibility of charging batteries in the presence of an\nalternative source of current (grid, generator, etc). This type of inverter is\nknown as a charger\/inverter.\nAutomatic fall-over. Some inverters can switch automatically\nbetween different sources of power (grid, generator, solar) depending on\nwhat is available.\nWhen using telecommunication equipment, it is best to avoid the use of\nDC\/AC converters and feed them directly from a DC source. Most\ncommunications equipment can accept a wide range of input voltage. 262 PLANNING AND DEPLOYMENT\nEquipment or load\nIt should be obvious that as power requirements increase, the expense of\nthe photovoltaic system also increases. It is therefore critical to match the\nsize of the system as closely as possible to the expected load.\nWhen designing the system you must first make a realistic estimate of the\nmaximum consumption.\nOnce the installation is in place, the established maximum consumption\nmust be respected in order to avoid frequent power failures.\nHome Appliances\nThe use of photovoltaic solar energy is not recommended for heat-exchange\napplications (electrical heating, refrigerators, toasters, etc.).Whenever possible,\nenergy should be used sparingly using low power appliances.\nHere are some points to keep in mind when choosing appropriate\nequipment for use with a solar system:\n\u2022 The photovoltaic solar energy is suitable for illumination.\nIn this case, the use of halogen light bulbs or fluorescent\nlamps is mandatory. Although these lamps are more\nexpensive, they have much better energy efficiency than\nincandescent light bulbs. LED lamps are also a good\nchoice as they are very efficient and are fed with DC.\n\u2022 It is possible to use photovoltaic power for appliances that\nrequire low and constant consumption (as in a typical\ncase, the TV). Smaller televisions use less power than\nlarger televisions. Also consider that a black-and-white\nTV consumes about half the power of a colour TV.\n\u2022 Photovoltaic solar energy is not recommended for any\napplication that transforms energy into heat (thermal\nenergy). Use solar heating or butane as an alternative.\n\u2022 Conventional automatic washing machines will work, but\nyou should avoid the use of any washing programs that\ninclude centrifugal water heating.\n\u2022 If you must use a refrigerators, it should consume as little\npower as possible. There are specialised refrigerators that\nwork on DC, although their consumption can be quite\nhigh (around 1000 Wh\/day). 14. OFF-GRID POWER 263\nThe estimation of total consumption is a fundamental step in sizing your\nsolar system. Here is a table that gives you a general idea of the power\nconsumption that you can expect from different appliances.\nEquipment Consumption (Watts)\nPortable Computer 30-50\nLow Power Lamp 6-10\nRouter with one radio 4-10\nVSAT modem 15-30\nPC without LCD 20-30\nPC with LCD 200-300\n16 port Network switch 6-8\nWireless telecommunications equipment\nSaving power by choosing the right gear saves a lot of money and trouble.\nFor example, a long distance link doesn't necessarily need a strong\namplifier that draws a lot of power.\nA Wi-Fi card with good receiver sensitivity and a Fresnel zone that is at\nleast 60% clear will work better than an amplifier, and save power\nconsumption as well.\nA well known saying of radio amateurs applies here, too: the best amplifier\nis a good antenna. Further measures to reduce power consumption include\nthrottling the CPU speed, reducing transmit power to the minimum value\nthat is necessary to provide a stable link, increasing the length of beacon\nintervals, and switching the system off during times it is not needed.\nMost autonomous solar systems work at 12 or 24 volts. Preferably, a\nwireless device that runs on DC voltage should be used, operating at the\n12 Volts that most lead acid batteries provide.\nTransforming the voltage provided by the battery to AC or using a voltage\nat the input of the access point different from the voltage of the battery\nwill cause unnecessary energy loss. A router or access point that accepts 8-\n20 Volts DC is perfect.\nMost cheap Access Points have a switched mode voltage regulator inside\nand will work through such a voltage range without modification or\nbecoming hot (even if the device was shipped with a 5 or 12 Volt power\nsupply). 264 PLANNING AND DEPLOYMENT\nWARNING: Operating your Access Point with a power supply other than\nthe one provided by your manufacturer will certainly void any warranty,\nand may cause damage to your equipment. While the following technique\nwill typically work as described, remember that should you attempt it, you\ndo so at your own risk.\nOpen your Access Point and look near the DC input for two relatively big\ncapacitors and an inductor (a ferrite toroid with copper wire wrapped\naround it). If they are present then the device has a switched mode input,\nand the maximum input voltage should be somewhat below the voltage\nprinted on the capacitors. Usually the rating of these capacitors is 16 or 25\nvolts.\nBe aware that an unregulated power supply has a ripple and may feed a\nmuch higher voltage into your Access Point than the typical voltage\nprinted on it may suggest. So, connecting an unregulated power supply\nwith 24 Volts to a device with 25 Volt-capacitors is not a good idea.\nOf course, opening your device will void any existing warranty. Do not try\nto operate an Access Point at higher voltage if it doesn't have a switched\nmode regulator. It will get hot, malfunction, or burn.\nEquipment based on traditional Intel x86 CPUs are power hungry in\ncomparison with RISC-based architectures as ARM or MIPS.\nOne of the boards with lowest power consumptions is the Soekris platform\nthat uses an AMD ElanSC520 processor. Another alternative to AMD\n(ElanSC or Geode SC1100) is the use of equipment with MIPS\nprocessors. MIPS processors have a better performance than an AMD\nGeode at the price of consuming between 20-30% of more energy.\nThe amount of power required by wireless equipment depends not only\non the architecture but on the number of network interfaces, radios, type\nof memory\/storage and traffic.\nAs a general rule, a wireless board of low consumption consumes 2 to 3\nW, and a 200 mW radio card consumes as much as 3 W. High power\ncards (such as the 400 mW Ubiquiti) consume around 6 W. A repeating\nstation with two radios can range between 8 and 10 W.\nAlthough the standard IEEE 802.11 incorporates a power saving mode\n(PS) mechanism, its benefit is not as good as you might hope. The main\nmechanism for energy saving is to allow stations to periodically put their\nwireless cards to \"sleep\" by means of a timing circuit. 14. OFF-GRID POWER 265\nWhen the wireless card wakes up it verifies if a beacon exists, indicating\npending traffic. The energy saving therefore only takes place on the client\nside, as the access point always needs to remain awake to send beacons\nand store traffic for the clients. Power saving mode may be incompatible\nbetween implementations from different manufacturers, which can cause\nunstable wireless connections. It is nearly always best to leave power saving\nmode disabled on all equipment, as the difficulties created will likely\noutweigh the meagre amount of saved power.\nSelecting the voltage\nMost low power stand-alone systems use 12 V battery power as that is the\nmost common operational voltage in sealed lead-acid batteries.\nWhen designing a wireless communication system you need to take into\nconsideration the most efficient voltage of operation of your equipment.\nWhile the input voltage can accept a wide range of values, you need to\nensure that the overall power consumption of the system is minimal.\nWiring\nAn important component of the installation is the wiring, as proper\nwiring will ensure efficient energy transfer. Some good practices that you\nshould consider include:\n\u2022 Use a screw to fasten the cable to the battery terminal.\nLoose connections will waste power.\n\u2022 Spread Vaseline or mineral jelly on the battery terminals.\nCorroded connections have an increased resistance,\nresulting in loss.\nWire size is normally given in American Wire Gauge (AWG).\nDuring your calculations you will need to convert between AWG and\nmm2 to estimate cable resistance. For example, an AWG #6 cable has a\ndiameter of 4.11 mm and can handle up to 55 A.\nA conversion chart, including an estimate of resistance and current\ncarrying capacity, is available in Appendix D: Cables Sizes. Keep in mind\nthat the current carrying capacity can also vary depending on the type of\ninsulation and application. When in doubt, consult the manufacturer for\nmore information. 266 PLANNING AND DEPLOYMENT\nOrientation of the panels\nMost of the energy coming from the sun arrives in a straight line. The\nsolar module will capture more energy if it is \u201cfacing\u201d the sun,\nperpendicular to the straight line between the position of the installation\nand the sun. Of course, the sun's position is constantly changing relative\nto the earth, so we need to find an optimal position for our panels. The\norientation of the panels is determined by two angles, the azimuth a and\nthe inclination or elevation \u00df. The azimuth is the angle that measures the\ndeviation with respect to the south in the northern hemisphere, and with\nrespect to the north in the southern hemisphere. The inclination is the\nangle formed by the surface of the module and the horizontal plane.\nAzimuth\nYou should have the module turned towards the terrestrial equator (facing\nsouth in the northern hemisphere, and north in the southern) so that\nduring the day the panel catches the greatest possible amount of radiation\n(a = 0o). It is very important that no part of the panels are ever in shade!\nStudy the elements that surround the panel array (trees, buildings, walls,\nother panels, etc.) to be sure that they will not cast a shadow on the panels\nat any time of the day or year. It is acceptable to turn the panels\n\u00b120\u00ba towards the east or the west if needed (a = \u00b120\u00ba).\nInclination\nOnce you have fixed the azimuth, the parameter that is key in our\ncalculations is the inclination of the panel, which we will express as the\nangle beta (\u00df). The maximum height that the sun reaches every day will\nvary, with the maximum on the day of the summer solstice and the\nminimum on the day of the winter solstice.\nIdeally, the panels should track this variation, but this is usually not\npossible for cost reasons. In installations with telecommunications\nequipment it is normal to install the panels at a fixed inclination. In most\ntelecommunications scenarios the energy demands of the system are\nconstant throughout the year. Providing for sufficient power during the\n\"worst month\" will work well for the rest of the year.\nThe value of \u00df should maximise the ratio between the offer and the\ndemand for energy. 14. OFF-GRID POWER 267\nFor installations with consistent (or nearly consistent) consumption\nthroughout the year, it is preferable to optimise the installation to capture\nthe maximum radiation during \"the winter\" months.\nYou should use the absolute value of the latitude of the place (angle F)\nincreased by 10\u00b0 (\u00df = | F | + 10 \u00b0).\nFor installations with less consumption during the winter, the value of the\nlatitude of the place can be used as the solar panel inclination. This way\nthe system is optimised for the months of spring and autumn (\u00df = | F |).\nFor installations that are only used during summer, you should use the\nabsolute value of the latitude of the place (angle F) decreased by\n10\u00b0 (\u00df = | F | - 10\u00b0).\nThe inclination of the panel should never be less than 15\u00b0 to avoid the\naccumulation of dust and\/or humidity on the panel. In areas where snow\nand ice occur, it is very important to protect the panels and to incline\nthem at an angle of 65\u00b0 or greater.\nIf there is a considerable increase in consumption during the summer, you\nmight consider arranging for two fixed inclinations, one position for the\nmonths of summer and another for the months of winter.\nThis would require special support structures and a regular schedule for\nchanging the position of the panels.\nHow to size your photovoltaic system\nWhen choosing equipment to meet your power needs, you will need to\ndetermine the following, at a minimum:\n\u2022 The number and type of solar panels required to capture enough\nsolar energy to support your load.\n\u2022 The minimum capacity of the battery. The battery will need to\nstore enough energy to provide power at night and through days\nwith little sun, and will determine your number of days of\nautonomy.\n\u2022 The characteristics of all other components (the regulator, wiring,\netc.) needed to support the amount of power generated and\nstored. 268 PLANNING AND DEPLOYMENT\nSystem sizing calculations are important, because unless the system\ncomponents are balanced, energy (and ultimately, money) is wasted. For\nexample, if we install more solar panels to produce more energy, the\nbatteries should have enough capacity to store the additional energy\nproduced. If the bank of batteries is too small and the load is not using\nthe energy as it is generated, then energy must be thrown away. A\nregulator of a smaller amperage than needed, or one single cable that is\ntoo small, can be a cause of failure (or even fire) and render the\ninstallation unusable.\nNever forget that the ability of the photovoltaic energy to produce and\nstore electrical energy is limited. Accidentally leaving on a light bulb\nduring the day can easily drain your reserves before nighttime, at which\npoint no additional power will be available.\nThe availability of \"fuel\" for photovoltaic systems (i.e. solar radiation) can\nbe difficult to predict. In fact, it is never possible to be absolutely sure that\na standalone system is going to be able to provide the necessary energy at\nany particular moment. Solar systems are designed for a certain\nconsumption, and if the user exceeds the planned limits the provision of\nenergy will fail. The design method that we propose consists of considering\nthe energy requirements, and based on them to calculate a system that\nworks for the maximum amount of time so it is as reliable as possible.\nOf course, if more panels and batteries are installed, more energy will be\nable to be collected and stored.\nThis increase of reliability will also have an increase in cost.\nIn some photovoltaic installations (such as the provision of energy for\ntelecommunications equipment on a network backbone) the reliability\nfactor is more important that the cost.\nIn a client installation, low cost is likely to be the most important factor.\nFinding a balance between cost and reliability is not a easy task, but\nwhatever your situation, you should be able to determine what it is\nexpected from your design choices, and at what price.\nThe method we will use for sizing the system is known as the method of\nthe worst month. We simply calculate the dimensions of the standalone\nsystem so it will work in the month in which the demand for energy is\ngreatest with respect to the available solar energy. It is the worst month of\nthe year, as this month will have the largest ratio of demanded energy to\navailable energy. 14. OFF-GRID POWER 269\nUsing this method, reliability is taken into consideration by fixing the\nmaximum number of days that the system can work without receiving\nsolar radiation (that is, when all consumption is made solely at the\nexpense of the energy stored in the battery.) This is known as the\nmaximum number of days of autonomy (N), and can be thought of as the\nnumber of consecutive cloudy days when the panels do not collect any\nsignificant amount of energy. When choosing N, it is necessary to know the\nclimatology of the place, as well as the economic and social relevance of the\ninstallation.\nWill it be used to illuminate houses, a hospital, a factory, for a radio link, or\nfor some other application? Remember that as N increases, so does the\ninvestment in equipment and maintenance.\nIt is also important to evaluate all possible logistics costs of equipment\nreplacement.\nIt is not the same to change a discharged battery from an installation in\nthe middle of a city versus one at the top of a telecommunication tower\nthat is several hours or days of walking distance. Fixing the value of N is\nnot an easy task as there are many factors involved, and many of them\ncannot be evaluated easily. Your experience will play an important role in\nthis part of the system sizing. One commonly used value for critical\ntelecommunications equipment is N = 5, whereas for low cost client\nequipment it is possible to reduce the autonomy to N = 3.\nIn Appendix E: Solar Dimensioning, we have included several tables that\nwill facilitate the collection of required data for sizing the system. The rest\nof this chapter will explain in detail what information you need to collect\nand explain how to use the method of the \"worst month\".\nData to collect\nLatitude of the installation. Remember to use a positive sign in the\nnorthern hemisphere and negative in the south.\nSolar radiation data. For the method of the \"worst month\" it is enough to\nknow just twelve values, one for every month. The twelve numbers are the\nmonthly average values of daily global irradiation on the horizontal plane,\nG (0), in kWh\/m2 per day. The monthly value is the sum of the values of\ndm\nglobal irradiation for every day of the month, divided by the number of\ndays of the month. 270 PLANNING AND DEPLOYMENT\nIf you have the data in Joules (J), you can apply the following conversion:\n1 J = 2.78 \u00d7 10-7 kWh\nThe irradiation data G (0) of many places of the world is gathered in\ndm\ntables and databases.\nYou should check for this information from a weather station close to your\nimplementation site, but do not be surprised if you cannot find the data\nin electronic format.\nIt is a good idea to ask companies that install photovoltaic systems in the\nregion, as their experience can be of great value.\nDo not confuse \"sun hours\" with the number of \"peak sun hours\".\nThe number of peak sun hours has nothing to do with the number of\nhours without clouds, but refers to the amount of daily irradiation.\nA day of 5 hours of sun without clouds does not necessarily have all those\nhours with the sun at its zenith.\nA peak sun hour is a normalised value of solar radiation of 1000 W\/m2 at\n25degC. So when we refer to 5 peak sun hours, this implies a daily solar\nradiation of 5000 W\/m2.\nElectrical characteristics of system components\nThe electrical characteristics of the components of your system should be\nprovided by the manufacturer. It is advisable to make your our own\nmeasurements to check for any deviation from the nominal values.\nUnfortunately, deviation from promised values can be large and should be\nexpected.\nThese are the minimum values that you need to gather before starting your\nsystem sizing:\nPanels\nYou need to know the voltage V and the current I at the point of\nPmax Pmax\nmaximum power in standard conditions.\nBatteries\nNominal capacity (for 100 hours discharge) C , operational voltage\nNBat\nV , and either the maximum depth of discharge DoD or useful\nNBat max\ncapacity C .\nUBat 14. OFF-GRID POWER 271\nYou also need to know the type of battery that you plan to use, whether\nsealed lead-acid, gel, AGM, modified traction etc.\nThe type of battery is important when deciding the cut-off points in the\nregulator.\nRegulator\nYou need to know the nominal voltage V , and the maximum\nNReg\noperational current I .\nmaxReg\nDC\/AC Converter\/Inverter\nIf you are going to use a converter, you need to know the nominal voltage\nV , instantaneous power P and performance at 70% of maximum\nNConv IConv\nload H .\n70\nEquipment or load\nIt is necessary to know the nominal voltage V and the nominal power\nNC\nof operation PC for every piece of equipment powered by the system.\nIn order to know the total energy that our installation is going to\nconsume, it is also very important to consider the average time each load\nwill be used.\nIs it constant? Or will it be used daily, weekly, monthly or annually?\nConsider any changes in the usage that might impact the amount of\nenergy needed (seasonal usage, training or school periods, etc.).\nOther variables\nAside from the electrical characteristics of the components and load, it is\nnecessary to decide on two more pieces of information before being able to\nsize a photovoltaic system.\nThese two decisions are the required number of days of autonomy and the\noperational voltage of the system.\nN, number of days of autonomy\nYou need to decide on a value for N that will balance meteorological\nconditions with the type of installation and overall costs. It is impossible\nto give a concrete value of N that is valid for every installation, but the\nnext table gives some recommended values.\nTake these values as a rough approximation, and consult with an\nexperienced designer to reach a final decision. 272 PLANNING AND DEPLOYMENT\nAvailable Sunlight Domestic Installation Critical Installation\nVery Cloudy 5 10\nVariable 4 8\nSunny 3 6\nV , nominal voltage of the installation\nN\nThe components of your system need to be chosen to operate at a\nnominal voltage V . This voltage is usually 12 or 24 Volts for small\nN\nsystems, and if the total power of consumption surpasses 3 kW, the\nvoltage will be 48 V. The selection of V is not arbitrary, and depends on\nN\nthe availability of equipment. If the equipment allows it, try to fix the\nnominal voltage to 12 or 24 V. Many wireless communications boards\naccept a wide range of input voltage and can be used without a converter.\nIf you need to power several types of equipment that work at different\nnominal voltages, calculate the voltage that minimises the overall power\nconsumption including the losses for power conversion in DC\/DC and\nDC\/AC converters.\nProcedure of calculation\nThere are three main steps that need to be followed to calculate the proper\nsize of a system:\n1. Calculate the available solar energy (the offer). Based on statistical\ndata of solar radiation, and the orientation and optimal inclination of\nthe solar panels, we can calculate the solar energy available.\nThe estimation of solar energy available is done in monthly intervals,\nreducing the statistical data to 12 values. This estimation is a good\ncompromise between precision and simplicity.\n2. Estimate the required electrical energy (the demand). Record the\npower consumption characteristics of the equipment chosen as well as\nestimated usage.\nThen calculate the electrical energy required on a monthly basis. You\nshould consider the expected fluctuations of usage due to the\nvariations between winter and summer, the rainy period \/ dry season,\nschool \/ vacation periods, etc. The result will be 12 values of energy\ndemand, one for each month of the year. 14. OFF-GRID POWER 273\n3. Calculate the ideal system size (the result).\nWith the data from the \u201cworst month\u201d, when the relation between the\nsolar demanded energy and the energy available is greatest, we\ncalculate:\n\u2022 The current that the array of panels needs to provide,\nwhich will determine the minimum number of panels.\n\u2022 The necessary energy storage capacity to cover the\nminimum number of days of autonomy, which will\ndetermine the required number of batteries.\n\u2022 The required electrical characteristics of the regulator.\n\u2022 The length and the necessary sections of cables for the\nelectrical connections.\nRequired current in the worst month\nFor each month you need to calculate the value of I , which is the\nm\nmaximum daily current that an array of panels operating at nominal\nvoltage of V needs to provide, in a day with a irradiation of G for\nN dm\nmonth \"m\", for panels with an inclination of \u00df degrees.\nThe I (WORST MONTH) will be the largest value of I , and the system\nm m\nsizing is based on the data of that worst month.\nThe calculations of G (\u00df) for a certain place can be made based on\ndm\nG (0) using computer software such as PVSYST\ndm\n(http:\/\/www.pvsyst.com\/) or PVSOL (http:\/\/www.solardesign.co.uk\/).\nDue to losses in the regulator and batteries, and due to the fact that the\npanels do not always work at the point of maximum power, the required\ncurrent I is calculated as:\nmMAX\nI = 1.21 I (WORST MONTH)\nmMAX m\nOnce you have determined the worst month, the value of I , and the\nmMAX\ntotal energy that you require E (WORST MONTH) you can proceed\nTOTAL\nto the final calculations. E is the sum of all DC and AC loads, in\nTOTAL\nWatts. To calculate E see Appendix E: Solar Dimensioning.\nTOTAL\nNumber of panels\nBy combining solar panels in series and parallel, we can obtain the desired\nvoltage and current. 274 PLANNING AND DEPLOYMENT\nWhen panels are connected in series, the total voltage is equal to the sum\nof the individual voltages of each module, while the current remains\nunchanged. When connecting panels in parallel, the currents are summed\ntogether while the voltage remains unchanged.\nIt is very important, to use panels of nearly identical characteristics when\nbuilding an array.\nYou should try to acquire panels with V a bit bigger than the nominal\nPmax\nvoltage of the system (12, 24 or 48 V).\nRemember that you need to provide a few volts more than the nominal\nvoltage of the battery in order to charge it. If it is not possible to find a\nsingle panel that satisfies your requirements, you need to connect several\npanels in series to reach your desired voltage.\nThe number of panels in series N is equal to the nominal voltage of the\nps\nsystem divided by the voltage of a single panel, rounded up to the nearest\ninteger.\nN = V \/ V\nps N Pmax\nIn order to calculate the number of panels in parallel (N ), you need to\npp\ndivide the I by the current of a single panel at the point of maximum\nmMAX\npower I , rounded up to the nearest integer.\npmax\nN = I \/ I\npp mMAX Pmax\nThe total number of panels is the result of multiplying the number of\npanels in series (to set the voltage) by the number of panels in parallel (to\nset the current).\nN = N * N\nTOTAL ps pp\nCapacity of the battery or accumulator\nThe battery determines the overall voltage of the system and needs to have\nenough capacity to provide energy to the load when there is not enough\nsolar radiation.\nTo estimate the capacity of our battery, we first calculate the required\nenergy capacity of our system (necessary capacity, CNEC). 14. OFF-GRID POWER 275\nThe necessary capacity depends on the energy available during the \"worst\nmonth\" and the desired number of days of autonomy (N).\nC (Ah)= E (WORST MONTH)(Wh) \/ V (V) * N\nNEC TOTAL N\nThe nominal capacity of the battery C needs to be bigger than the\nNOM\nC as we cannot fully discharge a battery.\nNEC\nTo calculate the size of the battery we need to consider the maximum\ndepth of discharge (DoD) that the battery allows:\nC (Ah) = C (Ah) \/ DoD\nNOM NEC MAX\nIn order to calculate the number of batteries in series (N ), we divide the\nbs\nnominal voltage of our installation (V ) by the nominal voltage of a single\nN\nbattery (V ):\nNBat\nN = V \/ V\nbs N NBat\nRegulator\nOne important warning: always use regulators in series, never in parallel.\nIf your regulator does not support the current required by your system,\nyou will need to buy a new regulator with a larger working current.\nFor security reasons, a regulator needs to be able to operate with a current\nI at least 20% greater than the maximum intensity that is provided by\nmaxReg\nthe array of panels:\nI = 1.2 N I\nmaxReg pp PMax\nDC\/AC Inverter\nThe total energy needed for the AC equipment is calculated including all\nthe losses that are introduced by the DC\/AC converter or inverter.\nWhen choosing an inverter, keep in mind that the performance of the\ninverter varies according to the amount of requested power.\nAn inverter has better performance characteristics when operating close to\nits rated power.\nUsing a 1500 Watt inverter to power a 25 Watt load is extremely\ninefficient. 276 PLANNING AND DEPLOYMENT\nIn order to avoid this wasted energy, it is important to consider not the\npeak power of all your equipment, but the peak power of the equipment\nthat is expected to operate simultaneously.\nCables\nOnce you know the numbers of panels and batteries, and type of\nregulators and inverters that you want to use, it is necessary to calculate\nthe length and the thickness of the cables needed to connect the\ncomponents together.\nThe length depends on the location of your the installation. You should\ntry to minimise the length of the cables between the regulator, panels, and\nbatteries. Using short cables will minimise lost power and cable costs.\nThe thickness chosen is based on the length of the cable and the\nmaximum current it must carry.\nThe goal is to minimise voltage drops.\nIn order to calculate the thickness S of the cable it is necessary to know:\n\u2022 the maximum current I that is going to circulate in the\nMC\ncable. In the case of the panel-battery subsystem, it is\nI calculated for every month. In the battery-load\nmMAX\nsubsystem it depends on the way that the loads are\nconnected;\n\u2022 the voltage drop (V-V ) that we consider acceptable in\na b\nthe cable. The voltage drop that results from adding all\npossible individual drops is expressed as a percent of the\nnominal voltage of the installation.\nTypical maximum values are:\nComponent Voltage Drop (%of V )\nN\nPanel Array -> Battery 1,00%\nBattery -> Converter 1,00%\nMain Line 3,00%\nMain Line (Illumination) 3,00%\nMain Line (Equipment) 5,00% 14. OFF-GRID POWER 277\nTypical acceptable voltage drops in cables\nThe section of the cable is determined by Ohm's Law:\nS(mm2) = r(\u2126mm2\/m)L(m) I (A)\/ (V-V )(V)\nmMAX a b\nwhere S is the section, r is resistivity (intrinsic property of the material: for\ncopper, 0.01286 \u2126mm2\/m), and L the length.\nS is chosen taking into consideration the cables available in the market.\nYou should choose the immediately superior section to the one that is\nobtained from the formula. For security reasons there are some minimum\nvalues, for the cable that connects the panels and battery, this is a\nminimum of 6 mm2. For the other sections, the minimum is 4 mm2.\nCost of a solar installation\nWhile solar energy itself is free, the equipment needed to turn it into\nuseful electric energy is not.\nYou not only need to buy equipment to transform the solar energy in\nelectricity and store it for use, but you must also replace and maintain\nvarious components of the system.\nThe problem of equipment replacement is often overlooked, and a solar\nsystem is sometimes implemented without a proper maintenance plan.\nIn order to calculate the real cost of your installation, we include an\nillustrative example.\nThe first thing to do it is to calculate the initial investment costs.\nDescription Number Unit Cost Subtotal\n60W Solar Panel 4 $300 $1,200\n(about $4\/W)\n30A Regulator 1 $100 $100\nWiring (metres) 25 $1\/metre $25z\n50 Ah Deep Cycle\nBatteries 6 $150 $900\nTotal $2,225 278 PLANNING AND DEPLOYMENT\nThe calculation of the investment cost is relatively easy once the system\nhas been dimensioned.\nYou just need to add the price for each piece equipment and the labour\ncost to install and wire the equipment together.\nFor simplicity, we do not include the costs of transport and installation\nbut you should not overlook them.\nTo figure out how much a system will really cost to operate we must\nestimate how long each part will last and how often you must replace it.\nIn accounting terminology this is known as amortisation.\nOur new table will look like this:\nDescription Number Unit Subtotal Lifetime(yrs) Yearly\nCost Cost\n60W Solar 4 $300 $1,200 20 $60\nPanel\n30A Regulator 1 $100 $100 5 $20\nWiring (metres) 25 $1\/ $25 10 $2.50\nmetre\n50Ah Deep 6 $150 $900 5 $180\ncycle batteries\nTotal $2,225 Annual Cost $262.50\nAs you see, once the first investment has been done, an annual cost of\n$262.50 is expected.\nThe annual cost is an estimation of the required capital per year to replace\nthe system components once they reach the end of their useful life. MAINTENANCE, MONITORING\nAND SUSTAINABILITY 280 MAINTENANCE, MONITORING AND SUSTAINABILITY\n15. MAINTENANCE AND\nTROUBLESHOOTING\nIntroduction\nHow you establish the support infrastructure for your network is as\nimportant as what type of equipment you use. Unlike wired connections,\nproblems with a wireless network are often invisible, and can require more\nskill and more time to diagnose and remedy. Interference, wind, and new\nphysical obstructions can cause a long-running network to fail. This\nchapter details a series of strategies to help you build a team that can\nsupport your network effectively.\nWe also describe some standard troubleshooting techniques that have\nproven successful in solving problems in networks in general.\nBuilding your team\nEvery village, company or family has individuals who are intrigued by\ntechnology.\nThey are the ones found splicing the television cable, re- wiring a broken\ntelevision or welding a new piece to a bicycle. These people will take\ninterest in your network and want to learn as much about it as possible.\nThough these people are invaluable resources, you must avoid imparting\nall of the specialised knowledge of wireless networking to only one person.\nIf your only specialist loses interest or finds better paying work somewhere\nelse, they take the knowledge with them when they go.\nThere may also be many ambitious young adults who will be interested\nand have the time to listen, help, and learn about the network.\nAgain, they are very helpful and will learn quickly, but the project team\nmust focus their attention on those who are best placed to support the\nnetwork in the coming months and years.\nYoung adults and teenagers will go off to university or find employment\ntaking their knowledge and skills about the network with them.\nThese youngsters may also have little influence in the community, where\nan older individual is likely to be more well-known and less impulsive\nregarding making decisions that affect the network as a whole. 15. MAINTENANCE AND TROUBLESHOOTING 281\nEven though these individuals might have less time to learn and might\nappear to be less interested, their involvement and proper education about\nthe system can be critical.\nTherefore, a key strategy in building a support team is to balance and to\ndistribute the knowledge among those that are best placed to support the\nnetwork for the long term.\nYou should involve young people, but alongside them involve a mix of\nmore mature contributors. Find people who are committed to the\ncommunity, who have roots in the community, who are motivated to learn\nand teach. A complementary strategy is to divide up the duties and\nfunctions, and to document all methodology and procedures. In this way,\npeople can be trained easily, and substituted with little effort.\nOn one project the training team selected a bright young university\ngraduate who had returned to his village. He was very motivated and\nlearned quickly. Soon he was an expert in IT and networking skills as well\nas the local network. He was able to deal with many different problems,\nfrom fixing a PC to rewiring Ethernet cable. Unfortunately, two months\nafter the project launch he was offered a government job and left the\ncommunity.\nEven a better salary could not keep him, since the prospect of a stable\ngovernment job was too appealing. All of the knowledge about the\nnetwork and how to support it left with him. The training team had to\nreturn and begin the training again, this time with local people who were\nknown to be remaining in the village. Although this retraining took much\nlonger, the community could be assured that the knowledge and skills\nwould remain in the village for a longer time.\nIt is often best to find a local partner organisation or a local manager, and\nwork with them to find the right technical team. Values, history, local\npolitics, and many other factors will be important to them, while\nremaining completely unfathomable to people who are not from that\ncommunity. The best approach is to coach your local partner, providing\nthem with sound criteria, make sure that they understand that criteria,\nand set firm boundaries. Such boundaries should include rules about\nnepotism and patronage, considering, of course, your own local situation.\nIt may be impossible to say that you cannot hire kin, but it is best to\nprovide a means of checks and balances.\nWhere a candidate is kin, there should be clear criteria and a second\nauthority in deciding upon their candidacy. 282 MAINTENANCE, MONITORING AND SUSTAINABILITY\nIt is also important that the local partner is given authority and is not\nundermined by the project organisers, thus compromising their ability to\nmanage. They will be best able to judge who will work best with them.\nIf they are well educated in this process, then your requirements should be\nsatisfied. Troubleshooting and support of technology is an abstract art.\nThe first time you look at an abstract painting, it may just look to you like\na bunch of random paint splatters. After reflecting on the composition for\na time, you may come to appreciate the work as a whole, and the\n\u201cinvisible\u201d coherence becomes very real.\nThe neophyte looking at a wireless network may see the antennas and\nwires and computers, but it can take a while for them to appreciate the\npoint of the \u201cinvisible\u201d network. In rural areas, it can often take a huge\nleap of understanding before locals will appreciate an invisible network\nthat is simply dropped into their village. Therefore, a phased approach is\nneeded to ease people into supporting technology systems. Again, the best\nmethod is involvement.\nOnce the participants are chosen and committed to the project, involve\nthem as much as possible. Let them \"drive\". Give them the cable crimper\nor keyboard and show them how to do the work. Even if you do not have\ntime to explain every detail and even if it will take longer, they need to be\ninvolved physically and see not only what has been done, but how much\nwork was done.\nThe scientific method is taught in many schools and universities.\nMany people learn about it by the time they reach high-school science\nclass. Simply put, answers are achieved and problems solved by taking a\nset of possibilities, then slowly eliminating them through binary tests until\nyou are left with one or only a few possibilities.\nWith those possibilities in mind, you complete the experiment.\nYou then test to see if the experiment yields something similar to the\nexpected result. If it did not, you re-calculate your expected result and try\nagain. A young person you might be thinking of employing in your\nproject may have been introduced to the concept, but likely will not have\nhad the opportunity to troubleshoot complex problems.\nEven if they are familiar with the scientific method, they might not think\nto apply it to resolving real problems. This method is very effective,\nalthough time consuming. It can be sped up by making logical\nassumptions. For example, if a long-running access point suddenly stops\nworking after a storm, you might suspect a power supply related problem\nand thus skip most of the procedure. 15. MAINTENANCE AND TROUBLESHOOTING 283\nPeople charged with supporting technology should be taught how to\ntroubleshoot using this method, as there will be times when the problem is\nneither known nor evident. Simple decision trees or flow charts can be\nmade that test variables, and then elimination of the variables to isolate the\nproblem can be suggested.\nOf course, these charts should not be followed blindly.\nIt is often easier to teach this method using a non technological problem\nfirst. For example, have your student develop a problem resolution\nprocedure on something simple and familiar, like a battery powered\ntelevision. Start by sabotaging the television. Give them a battery that is\nnot charged. Disconnect the aerial. Insert a broken fuse. Test the student,\nmaking it clear that each problem will show specific symptoms, and point\nthe way as to how to proceed. Once they have fixed the television, have\nthem apply this procedure to a more complicated problem. In a network,\nyou can change an IP address, switch or damage cables, use the wrong\nSSID, or orient the antenna in the wrong direction. It is important that\nthey develop a methodology and procedure to resolve these problems.\nProper troubleshooting techniques\nNo troubleshooting methodology can completely cover all problems you\nwill encounter when working with wireless networks. But often, problems\ncome down to one of a few common mistakes. Here are a few simple\npoints to keep in mind that can get your troubleshooting effort working\nin the right direction.\n\u2022 Don't panic. If you are troubleshooting a system, it means that it\nwas working at one time, probably very recently. Before jumping\nin and making changes, survey the scene and assess exactly what is\nbroken. If you have historical logs or statistics to work from, all\nthe better. If others were using it before it started having\nproblems, ask them to help you by having them tell you what was\nhappening before it stopped working. Be thorough, but don't\nmake it sound like you are accusing them of breaking it.\nThey may have important information that will help you fix\nthings and you want them to be on your side. Be sure to collect\ninformation first, so you can make an informed decision before\nmaking changes. 284 MAINTENANCE, MONITORING AND SUSTAINABILITY\n\u2022 Make a backup. This applies before you notice problems, as well\nas after. If you make a complicated software change to a system,\nhaving a backup means that you can quickly restore it to the\nprevious settings and start again. When troubleshooting very\ncomplex problems, having a configuration that \u201csort-of\u201d works\ncan be much better than having a mess that doesnt work at all\n(and that you cant easily restore from memory).\nEven in a broken configuration, make a backup copy of the parts\nof the system you will be changing before you try to make\nsignificant changes. If your changes result in an even worse state\nthan when you first started working on it, you will at least have a\nknown situation to go back to.\n\u2022 Is it plugged in? This step is often overlooked until many other\navenues are explored. Plugs can be accidentally (or intentionally)\nunplugged very easily. Is the lead connected to a good power\nsource? Is the other end connected to your device? Is the power\nlight on? It may sound silly, but you will feel even sillier if you\nspend a lot of time checking out an antenna feed line only to\nrealise that the AP was unplugged the entire time. Trust me, it\nhappens more often than most of us would care to admit.\n\u2022 What was the last thing changed? If you are the only person with\naccess to the system, what is the last change you made? If others\nhave access to it, what is the last change they made and when?\nWhen was the last time the system worked? Often, system\nchanges have unintended consequences that may not be\nimmediately noticed. Roll back that change and see what effect it\nhas on the problem.\n\u2022 Look at date\/timestamps on files. Every file on a modern\ncomputer system has a date & time associated with it showing\nwhen it was created or last changed. On a properly running\nsystem, most of the system files will have date\/timestamps from\nmonths or even years ago. If the system or network was running\nfine until an hour or so ago, files which have a timestamp within\nthe past few minutes to an hour ago could provide clues about\nwhat changed. 15. MAINTENANCE AND TROUBLESHOOTING 285\n\u2022 The known good. This idea applies to hardware, as well as\nsoftware. A known good is any component that you can replace in\na complex system to verify that its counterpart is in good, working\ncondition. For example, you may carry a tested Ethernet cable in\na tool kit. If you suspect problems with a cable in the field, you\ncan easily swap out the suspect cable with the known good and\nsee if things improve. This is much faster and less error-prone\nthan re-crimping a cable, and immediately tells you if the change\nfixes the problem. Likewise, you may also pack a backup battery,\nantenna cable, or a CD-ROM with a known good configuration\nfor the system. When fixing complicated problems, saving your\nwork at a given point lets you return to it as a known good, even\nif the problem is not yet completely solved.\n\u2022 Determine what still works. This will help you \"put a fence\naround the problem\". While complex systems like a wireless\nnetwork can be made up of many different components, it is\nlikely that the problem is only with a very small number of them.\nIf, for example, somebody in a lab complains they can't access the\nInternet, check to see if others in the same lab are experiencing\nthe same problem. Is there connectivity in another lab or\nelsewhere in the building? If the problem is just with one user or\nwithin one room, you would want to concentrate your efforts on\nthe equipment in just that one space. If the outage were more\nwidespread, perhaps looking at the equipment where your outside\nconnections come in is more appropriate.\n\u2022 Do no harm. If you don't fully understand how a system works,\ndon't be afraid to call in an expert. If you are not sure if a\nparticular change will damage another part of the system, then\neither find someone with more experience to help you or devise a\nway to test your change without doing damage. Putting a penny\nin place of a fuse may solve the immediate problem, but it may\nalso burn down the building.\nYour troubleshooting team will need to have good troubleshooting skills,\nbut may not be competent enough to configure a router from scratch or\ncrimp a piece of LMR-400. 286 MAINTENANCE, MONITORING AND SUSTAINABILITY\nIt is often much more efficient to have a number of backup components\non-hand, and train your team to be able to swap out the entire broken\npart. This could mean having an access point or router pre-configured and\nsitting in a locked cabinet, plainly labelled and stored with backup cables\nand power supplies. Your team can swap out the failed component, and\neither send the broken part to an expert for repair, or arrange to have\nanother backup sent in.\nAssuming that the backups are kept secure and are replaced when used,\nthis can save a lot of time for everyone.\nCommon network problems\nNow we will take a look at some common network problems that you are\nalmost certain to face.\nOften, connectivity problems come from failed components, adverse\nweather, or simple misconfiguration.\nOnce your network is connected to the Internet or opened up to the\ngeneral public, considerable threats will come from the network users\nthemselves.\nThese threats can range from the benign to the outright malevolent, but\nall will have impact on your network if it is not properly configured. This\nsection looks at some common problems found once your network is in\nuse.\nLocally hosted websites\nIf a university hosts its website locally, visitors to the website from outside\nthe campus and the rest of the world will compete with the university's\nstaff for Internet bandwidth.\nThis includes automated access from search engines that periodically\nspider your entire site.\nOne solution to this problem is to use split DNS and mirroring.\nThe university mirrors a copy of its websites to a server at, say, a\nEuropean hosting company, and uses split DNS to direct all users from\noutside the university network to the mirror site, while users on the\nuniversity network access the same site locally. 15. MAINTENANCE AND TROUBLESHOOTING 287\nFigure MT 1: In Example 1, all website traffic coming from the Internet must\ntraverse the VSAT. In Example 2, the public web site is hosted on a fast European\nservice, while a copy is kept on an internal server for very fast local access. This\nimproves the VSAT connection and reduces load times for web site users.\nOpen proxies\nA proxy server should be configured to accept only connections from the\nuniversity network, not from the rest of the Internet.\nThis is because people elsewhere will connect and use open proxies for a\nvariety of reasons, such as to avoid paying for international bandwidth.\nThe way to configure this depends on the proxy server you are using. For\nexample, you can specify the IP address range of the campus network in\nyour squid.conf file as the only network that can use Squid.\nAlternatively, if your proxy server lies behind a border firewall, you can\nconfigure the firewall to only allow internal hosts to connect to the proxy\nport. 288 MAINTENANCE, MONITORING AND SUSTAINABILITY\nOpen relay hosts\nAn incorrectly configured mail server will be found by unscrupulous\npeople on the Internet, and be used as a relay host to send bulk email and\nspam.\nThey do this to hide the true source of the spam, and avoid getting\ncaught. To test for an open relay host, the following test should be carried\nout on your mail server (or on the SMTP server that acts as a relay host\non the perimeter of the campus network). Use telnet to open a connection\nto port 25 of the server in question.\ntelnet mail.uzz.ac.zz 25\nThen, if an interactive command-line conversation can take place (for\nexample, as follows), the server is an open relay host:\nMAIL FROM: spammer@waste.com\n250 OK - mail from\nRCPT TO: innocent@university.ac.zz\n250 OK - rcpt to spammer@waste.com\nInstead, the reply after the first MAIL FROM should be something like:\n550 Relaying is prohibited.\nAn online tester is available at sites such as\nhttp:\/\/www.mailradar.com\/openrelay\/ or http:\/\/www.checkor.com\/\nSince bulk emailers have automated methods to find such open relay\nhosts, an institution that does not protect its mail systems is almost\nguaranteed to be found and abused.\nConfiguring the mail server not to be an open relay consists of specifying\nthe networks and hosts that are allowed to relay mail through them in the\nMTA (eg., Sendmail, Postfix, Exim, or Exchange).\nThis will likely be the IP address range of the campus network. 15. MAINTENANCE AND TROUBLESHOOTING 289\nPeer-to-peer networking\nBandwidth abuse through peer-to-peer (P2P) file-sharing programs can be\nprevented in the following way.\nMake it impossible to install new programs on campus computers. By not\ngiving regular users administrative access to PC workstations, it is possible\nto prevent the installation of bandwidth hungry applications. Many\ninstitutions also standardise on a desktop build, where they install the\nrequired operating system on one PC. They then install all the necessary\napplications on it, and configure these in an optimal way. The PC is also\nconfigured in a way that prevents users from installing new applications. A\ndisk image of this PC is then cloned to all other PCs using software such\nas Partition Image (see http:\/\/www.partimage.org\/) or Drive Image Pro\n(see http:\/\/www.powerquest.com\/).\nFrom time to time, users may succeed in installing new software or\notherwise damaging the software on the computer (causing it to hang\noften, for example). When this happens, an administrator can simply put\nthe disk image back, causing the operating system and all software on the\ncomputer to be exactly as specified.\nPrograms that install themselves (from the Internet)\nThere are programs that automatically install themselves and then keep on\nusing bandwidth.\nSome programs are spyware, which keep sending information about a\nuser's browsing habits to a company somewhere on the Internet.\nThese programs are preventable to some extent by user education and\nlocking down PCs to prevent administrative access for normal users. In\nother cases, there are software solutions to find and remove these problem\nprograms, such as Spychecker (http:\/\/www.spychecker.com\/).\nWindows updates\nMicrosoft Windows operating systems assume that a computer with a\nLAN connection has a good link to the Internet, and automatically\ndownloads security patches, bug fixes and feature enhancements from the\nMicrosoft Web site. This can consume massive amounts of bandwidth on\nan expensive Internet link. 290 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThe two possible approaches to this problem are:\n\u2022 Disable Windows updates on all workstation PCs. The security\nupdates are very important for servers, but whether workstations\nin a protected private network such as a campus network need\nthem is debatable.\n\u2022 Install a Software Update Server. This is a free program from\nMicrosoft that enables you to download all the updates from\nMicrosoft overnight on to a local server and distribute the updates\nto client workstations from there. In this way, Windows updates\nneed not use any bandwidth on the Internet link during the day.\nUnfortunately, all client PCs need to be configured to use the\nSoftware Update Server for this to have an effect.\nIf you have a flexible DNS server, you can also configure it to\nanswer requests for windowsupdate.microsoft.com and direct the\nupdater to your update server. This is only a good option for large\nnetworks, but can save untold amounts of Internet bandwidth.\nPrograms that assume a high bandwidth link\nIn addition to Windows updates, many other programs and services\nassume that bandwidth is not a problem, and therefore consume\nbandwidth for reasons the user might not predict. For example, anti-virus\npackages (such as Norton AntiVirus) periodically update themselves\nautomatically and directly from the Internet. It is better if these updates\nare distributed from a local server.\nOther programs, such as the RealNetworks video player, automatically\ndownload updates and advertisements, as well as upload usage patterns\nback to a site on the Internet. Innocuous looking applets (like\nKonfabulator and Dashboard widgets) continually poll Internet hosts for\nupdated information. These can be low bandwidth requests (like weather\nor news updates), or very high bandwidth requests (such as webcams).\nThese applications may need to be throttled or blocked altogether.\nThe latest versions of Windows and Mac OS X also have a time\nsynchronisation service. This keeps the computer clock accurate by\nconnecting to time servers on the Internet. It is more efficient to install a\nlocal time server and distribute accurate time from there, rather than to\ntie up the Internet link with these requests. 15. MAINTENANCE AND TROUBLESHOOTING 291\nWorms and viruses\nWorms and viruses can generate enormous amounts of traffic. It is\ntherefore essential that anti-virus protection is installed on all PCs.\nFurthermore, user education about executing attachments and responding\nto unsolicited email is essential. In fact, it should be a policy that no\nworkstation or server should run unused services.\nA PC should not have shares unless it is a file server; and a server should\nnot run unnecessary services either.\nFor example, Windows and Unix servers typically run a web server service\nby default. This should be disabled if that server has a different function;\nthe fewer services a computer runs, the less there is to exploit.\nEmail forwarding loops\nOccasionally, a single user making a mistake can cause a problem. For\nexample, a user whose university account is configured to forward all mail\nto her Yahoo account.\nThe user goes on holiday. All emails sent to her in her absence are still\nforwarded to her Yahoo account, which can grow to only 2 MB.\nWhen the Yahoo account becomes full, it starts bouncing the emails back\nto the university account, which immediately forwards it back to the\nYahoo account.\nAn email loop is formed that might send hundreds of thousands of emails\nback and forth, generating massive traffic and crashing mail servers.\nThere are features of mail server programs that can recognise loops. These\nshould be turned on by default.\nAdministrators must also take care that they do not turn this feature off by\nmistake, or install an SMTP forwarder that modifies mail headers in such\na way that the mail server does not recognise the mail loop.\nLarge downloads\nA user may start several simultaneous downloads, or download large files\nsuch as 650MB ISO images.\nIn this way, a single user can use up most of the bandwidth.\nThe solutions to this kind of problem lie in training, offline downloading,\nand monitoring. 292 MAINTENANCE, MONITORING AND SUSTAINABILITY\nOffline downloading can be implemented in at least two ways:\n\u2022 At the University of Moratuwa, a system was implemented using\nURL redirection. Users accessing ftp:\/\/ URLs are served a\ndirectory listing in which each file has two links: one for normal\ndownloading, and the other for offline downloading. If the offline\nlink is selected, the specified file is queued for later download and\nthe user notified by email when the download is complete. The\nsystem keeps a cache of recently downloaded files, and retrieves\nsuch files immediately when requested again. The download queue\nis sorted by file size. Therefore, small files are downloaded first. As\nsome bandwidth is allocated to this system even during peak\nhours, users requesting small files may receive them within\nminutes, sometimes even faster than an online download.\n\u2022 Another approach would be to create a web interface where users\nenter the URL of the file they want to download. This is then\ndownloaded overnight using a cron job or scheduled task. This\nsystem would only work for users who are not impatient, and are\nfamiliar with what file sizes would be problematic for download\nduring the working day.\nSending large files\nWhen users need to transfer large files to collaborators elsewhere on the\nInternet, they should be shown how to schedule the upload. In Windows,\nan upload to a remote FTP server can be done using an FTP script file,\nwhich is a text file containing FTP commands.\nUsers sending each other files\nUsers often need to send each other large files. It is a waste of bandwidth\nto send these via the Internet if the recipient is local. A file share should\nbe created on the local Windows\/Samba\/Mac web server, where a\nuser can put the large file for others to access.\nAlternatively, a web front-end can be used for a local web server to accept\na large file and place it in a download area. After uploading it to the web\nserver, the user receives a URL for the file.\nHe can then give that URL to his local or international collaborators, and\nwhen they access that URL they can download it. 15. MAINTENANCE AND TROUBLESHOOTING 293\nThis is what the University of Bristol has done with their FLUFF system.\nThe University offers a facility for the upload of large files (FLUFF)\navailable from http:\/\/www.bris.ac.uk\/it-services\/applications\/fluff\/\nThere are also tools like SparkleShare (http:\/\/sparkleshare.org\/) and LipSync\n(https:\/\/github.com\/philcryer\/lipsync) which are Open Source packages that\nyou can install and set up yourself to do much the same thing.\nThere are also new online free services such as Google Drive which can be\nsetup for file sharing and common editing.\nConsider using rsync (http:\/\/rsync.samba.org\/) for those users who need to\nsend each other the same\/similar large files on a regular basis.\nThe Rsync protocol is a synchronisation rather than a straightforward file\ntransfer protocol.\nRather than simply sending a file from start to end, it checks with an rsync\nserver on the destination host to see if the file being sent already exists.\nIf it does, both sides compare their copies and the sender transmits over\nonly the differences to the destination.\nFor example, if a 10 MB database of research data only has 23 KB of new\ndata vs. the last version, only the 23 KB of changes will be transmitted.\nRsync can also use the SSH protocol, providing a secure transport layer for\nsync actions.\nTrouble tracking and reporting\nTroubleshooting is only one half of the task of problem-solving on a\nwireless network.\nOnce a problem has been diagnosed and fixed, it needs to be documented\nin a permanent way so that others who work on the network either now or\nin the future, will be able to learn from the incident.\nKeeping a record of problems and incidents that occur is also a good way to\ntrack and fix long-term problems that may occur, say, once every few\nmonths but follow a definite pattern.\nYou can also reduce the complexity and frustration of troubleshooting a\nproblem if you keep a log of every change made to the network. 294 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThe Logbook is where you and your team write down every change made to\na system, along with the date and time the change was made. For example:\n23 July 10:15AM Changed default route on host alpha from 123.45.67.89 to\n123.56.78.1 because upstream ISP moved our gateway.\nAs your network grows, consider installing a trouble-tracking system like\nJIRA or Bugzilla to help better keep track of who is working on what\nproblem and what happened during that work. This provides a history of\nwhat was worked on and how it was fixed and also provides an orderly\nmethod for assigning tasks and helping to prevent things like two people\nstepping on each other's work while they both try to fix the same problem.\nTrouble-ticketing systems are a subject that would fill an entire separate\nbook, so we will only mention them briefly here to make you aware of\nthem. They can also be quite complex to set up, so for simple networks, a\nlogbook will do. 16. NETWORK MONITORING 295\n16. NETWORK MONITORING\nIntroduction\nNetwork monitoring is the use of logging and analysis tools to accurately\ndetermine traffic flows, utilisation, and other performance indicators on a\nnetwork. Good monitoring tools give you both hard numbers and graphical\naggregate representations of the state of the network. This helps you to\nvisualise precisely what is happening, so you know where adjustments may\nbe needed.\nThese tools can help you answer critical questions, such as:\n\u2022 What are the most popular services used on the network?\n\u2022 Who are the heaviest network users?\n\u2022 What other wireless channels are in use in my area?\n\u2022 Are users installing wireless access points on my private wired\nnetwork?\n\u2022 At what time of the day is the network most utilised?\n\u2022 What sites do your users frequent?\n\u2022 Is the amount of inbound or outbound traffic close to the available\nnetwork capacity?\n\u2022 Are there indications of an unusual network situation that is\nconsuming bandwidth or causing other problems?\n\u2022 Is our Internet Service Provider (ISP) providing the level of service\nthat we are paying for?\nThis should be answered in terms of available bandwidth, packet loss,\nlatency, and overall availability.\nAnd perhaps the most important question of all:\n\u2022 Do the observed traffic patterns fit our expectations?\nMonitoring and metrics tools are vitally important programs to have on\nhand to check on the health of your network and diagnose\/troubleshoot\nproblems. 296 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThroughout previous chapters in this book we've mentioned or given brief\nexamples of using certain tools for specific tasks like configuration and\nsetup, troubleshooting, gathering statistics and metrics data about the\nhealth of your network, etc. This section discusses some of these tools in a\nmore detailed manner. It should be noted that this is by no means an\nexhaustive list of all the tools available for wired and wireless networks.\nIt is also important to realise that diagnostic and monitoring tools change\njust like all other software and hardware does. Staying up to date on the\nlatest versions, bugs in existing versions, new tools in the field, etc. can be\nan almost full-time job in itself.\nFor this book, where we've found that a certain tool is no longer being\nactively maintained between the previous edition and this one, we have left\nit out of this text. The tools discussed in this section are all being currently\ndeveloped as of this writing, but it is left as an exercise to the reader to\ndetermine if a particular tool is suitable for their situation.\nNetwork monitoring example\nLet's look at how a typical system administrator can make good use of\nnetwork monitoring tools.\nAn effective network monitoring example\nFor the purposes of example, let's assume that we are in charge of a network\nthat has been running for three months. It consists of 50 computers and\nthree servers: email, web, and proxy servers.\nWhile initially things are going well, users begin to complain of slow\nnetwork speeds and an increase in spam emails.\nAs time goes on, computer performance slows to a crawl (even when not\nusing the network), causing considerable frustration in your users.\nWith frequent complaints and very low computer usage, the Board is\nquestioning the need for so much network hardware.\nThe Board also wants evidence that the bandwidth they are paying for is\nactually being used.\nAs the network administrator, you are on the receiving end of these\ncomplaints. 16. NETWORK MONITORING 297\nHow can you diagnose the sudden drop in network and computer\nperformance and also justify the network hardware and bandwidth costs?\nMonitoring the LAN (local traffic)\nTo get an idea of exactly what is causing the slow down, you should begin\nby looking at traffic on the local LAN. There are several advantages to\nmonitoring local traffic:\n1. Troubleshooting is greatly simplified. Viruses can be detected and\neliminated.\n2. Malicious users can be detected and dealt with.\n3. Network hardware and resources can be justified with real statistics.\nAssume that all of the switches support the Simple Network Management\nProtocol (SNMP). SNMP is an application-layer protocol designed to\nfacilitate the exchange of management information between network\ndevices.\nBy assigning an IP address to each switch, you are able to monitor all the\ninterfaces on that switch, observing the entire network from a single point.\nThis is much easier than enabling SNMP on all computers in a network.\nBy using a free tool such as MRTG, http:\/\/oss.oetiker.ch\/mrtg\/, you can\nmonitor each port on the switch and present data graphically, as an\naggregate average over time.\nThe graphs are accessible from the web, so you are able to view the graphs\nfrom any machine at anytime.\nWith MRTG monitoring in place, it becomes obvious that the internal\nLAN is swamped with far more traffic than the Internet connection can\nsupport, even when the lab is unoccupied. This is a pretty clear indication\nthat some of the computers are infested with a network virus.\nAfter installing good anti-virus and anti-spyware software on all of the\nmachines, the internal LAN traffic settles down to expected levels.\nThe machines run much more quickly, spam emails are reduced, and the\nusers' morale quickly improves. 298 MAINTENANCE, MONITORING AND SUSTAINABILITY\nMonitoring the WAN (external traffic)\nIn addition to watching the traffic on the internal LAN, you need to\ndemonstrate that the bandwidth the organisation is paying for is actually\nwhat they are getting from their ISP.\nYou can achieve this by monitoring external traffic.\nExternal traffic is generally classified as anything sent over a Wide Area\nNetwork (WAN). Anything received from (or sent to) a network other than\nyour internal LAN also qualifies as external traffic.\nThe advantages of monitoring external traffic include:\nInternet bandwidth costs are justified by showing actual usage, and whether\nthat usage agrees with your ISP's bandwidth charges.\nFuture capacity needs are estimated by watching usage trends and\npredicting likely growth patterns. Intruders from the Internet are detected\nand filtered before they can cause problems.\nMonitoring this traffic is easily done with the use of MRTG on an SNMP\nenabled device, such as a router. If your router does not support SNMP,\nthen you can add a switch between your router and your ISP connection,\nand monitor the port traffic just as you would with an internal LAN.\nDetecting network outages\nWith monitoring tools in place, you now have an accurate measurement of\nhow much bandwidth the organisation is using.\nThis measurement should agree with your ISP's bandwidth charges.\nIt can also indicate the actual throughput of your connection if you are\nusing close to your available capacity at peak times.\nA \"flat top\" graph is a fairly clear indication that you are operating at full\ncapacity.\nThe following figure NM 1 shows flat tops in peak outbound traffic in the\nmiddle of every day except Sunday.\nIt is clear that your current Internet connection is overutilised at peak\ntimes, causing network lag.\nAfter presenting this information to the Board, you can make a plan for\nfurther optimising your existing connection (by upgrading your proxy\nserver and using other techniques in this book) and estimate how soon you\nwill need to upgrade your connection to keep up with the demand. 16. NETWORK MONITORING 299\nThis is also an excellent time to review your operational policy with the\nBoard, and discuss ways to bring actual usage in line with that policy.\nFigure NM 1: A graph with a \"flat top\" is one indication of overutilisation.\nLater in the week, you receive an emergency phone call in the evening.\nApparently, no one in the lab can browse the web or send email. You rush\nto the lab and hastily reboot the proxy server, with no results. Browsing and\nemail are still broken. You then reboot the router, but there is still no\nsuccess. You continue eliminating the possible fault areas one by one until\nyou realise that the network switch is off - a loose power cable is to blame.\nAfter applying power, the network comes to life again.\nHow can you troubleshoot such an outage without such time consuming\ntrial and error? Is it possible to be notified of outages as they occur, rather\nthan waiting for a user to complain?\nOne way to do this is to use a program such as Nagios\n(http:\/\/www.nagios.org\/) that continually polls network devices and notifies\nyou of outages. Nagios will report on the availability of various machines\nand services, and will alert you to machines that have gone down. In\naddition to displaying the network status graphically on a web page, it will\nsend notifications via SMS or email, alerting you immediately when\nproblems arise. 300 MAINTENANCE, MONITORING AND SUSTAINABILITY\nWith good monitoring tools in place, you will be able to justify the cost of\nequipment and bandwidth by effectively demonstrating how it is being used\nby the organisation.\nYou are notified automatically when problems arise, and you have historical\nstatistics of how the network devices are performing. You can check the\ncurrent performance against this history to find unusual behaviour, and\nhead off problems before they become critical. When problems do come\nup, it is simple to determine the source and nature of the problem. Your job\nis easier, the Board is satisfied, and your users are much happier.\nMonitoring your network\nManaging a network without monitoring is similar to driving a vehicle\nwithout a speedometer or a fuel gauge.\nHow do you know how fast you are going? Is the car consuming fuel as\nefficiently as promised by the dealers? If you do an engine overhaul several\nmonths later, is the car any faster or more efficient than it was before?\nSimilarly, how can you pay for an electricity or water bill without seeing\nyour monthly usage from a meter?\nYou must have an account of your network bandwidth utilisation in order\nto justify the cost of services and hardware purchases, and to account for\nusage trends.\nThere are several benefits to implementing a good monitoring system for\nyour network:\n\u2022 Network budget and resources are justified. Good monitoring tools\ncan demonstrate without a doubt that the network infrastructure\n(bandwidth, hardware, and software) is suitable and able to handle\nthe requirements of network users.\n\u2022 Network intruders are detected and filtered. By watching your\nnetwork traffic, you can detect attackers and prevent access to\ncritical internal servers and services.\n\u2022 Network viruses are easily detected. You can be alerted to the\npresence of network viruses, and take appropriate action before\nthey consume Internet bandwidth and destabilise your network. 16. NETWORK MONITORING 301\n\u2022 Troubleshooting of network problems is greatly simplified. Rather\nthan attempting \"trial and error\" to debug network problems, you\ncan be instantly notified of specific problems. Some kinds of\nproblems can even be repaired automatically.\n\u2022 Network performance can be highly optimised. Without effective\nmonitoring, it is impossible to fine tune your devices and protocols\nto achieve the best possible performance.\n\u2022 Capacity planning is much easier. With solid historical\nperformance records, you do not have to \"guess\" how much\nbandwidth you will need as your network grows.\n\u2022 Proper network usage can be enforced. When bandwidth is a scarce\nresource, the only way to be fair to all users is to ensure that the\nnetwork is being used for its intended purpose.\nFortunately, network monitoring does not need to be an expensive\nundertaking. There are many freely available open source tools that will\nshow you exactly what is happening on your network in considerable detail.\nThis section will help you identify many invaluable tools and how best to\nuse them.\nThe dedicated monitoring server\nWhile monitoring services can be added to an existing network server, it is\noften desirable to dedicate one machine (or more, if necessary) to network\nmonitoring. Some applications (such as ntop http:\/\/www.ntop.org\/) require\nconsiderable resources to run, particularly on a busy network.\nBut most logging and monitoring programs have modest RAM and storage\nrequirements, typically with little CPU power required. Since open source\noperating systems (such as Linux or BSD) make very efficient use of\nhardware resources, this makes it possible to build a very capable\nmonitoring server from recycled PC parts. There is usually no need to\npurchase a brand new server to relegate to monitoring duties.\nThe exception to this rule is in very large installations.\nIf your network includes more than a few hundred nodes, or if you\nconsume more than 50 Mbps of Internet bandwidth, you will likely need to\nsplit up monitoring duties between a few dedicated machines. 302 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThis depends largely on exactly what you want to monitor. If you are\nattempting to account for all services accessed per MAC address, this will\nconsume considerably more resources than simply measuring network flows\non a switch port. But for the majority of installations, a single dedicated\nmonitoring machine is usually enough.While consolidating monitoring\nservices to a single machine will streamline administration and upgrades, it\ncan also ensure better ongoing monitoring.For example, if you install\nmonitoring services on a web server, and that web server develops problems,\nthen your network may not be monitored until the problem is resolved. To\na network administrator, the data collected about network performance is\nnearly as important as the network itself. Your monitoring should be robust\nand protected from service outages as well as possible. Without network\nstatistics, you are effectively blind to problems with the network.\nWhere does the server fit in your network?\nIf you are only interested in collecting network flow statistics from a router,\nyou can do this from just about anywhere on the LAN.\nThis provides simple feedback about utilisation, but cannot give\nyou comprehensive details about usage patterns.\nFigure NM 2 below shows a typical MRTG graph generated from\nthe Internet router. While the inbound and outbound utilisation\nare clear, there is no detail about which computers, users, or\nprotocols are using bandwidth.\nFigure NM 2: Polling the edge router can show you the overall network\nutilisation, but you cannot break the data down further into machines,\nservices, and users. 16. NETWORK MONITORING 303\nFor more detail, the dedicated monitoring server must have access to\neverything that needs to be watched.\nTypically, this means it must have access to the entire network.\nTo monitor a WAN connection, such as the Internet link to your ISP, the\nmonitoring server must be able to see the traffic passing through the edge\nrouter. To monitor a LAN, the monitoring server is typically connected to\na monitor port on the switch. If multiple switches are used in an\ninstallation, the monitoring server may need a connection to all of them.\nThat connection can either be a physical cable, or if your network\nswitches support it, a VLAN specifically configured for monitoring traffic.\nFigure NM 3: Use the monitor port on your switch to observe traffic crossing\nall of the network ports.\nIf monitor port functionality is not available on your switch, the\nmonitoring server may be installed between your internal LAN and the\nInternet. While this will work, it introduces a single point of failure for\nthe network, as the network will fail if the monitoring server develops a\nproblem. It is also a potential performance bottleneck, if the server cannot\nkeep up with the demands of the network. 304 MAINTENANCE, MONITORING AND SUSTAINABILITY\nFigure NM 4: By inserting a network monitor between the LAN and your\nInternet connection, you can observe all network traffic.\nA better solution is to use a simple network hub (not a switch) which\nconnects the monitoring machine to the internal LAN, external router,\nand the monitoring machine.\nWhile this does still introduce an additional point of failure to the\nnetwork (since the entire network will be unreachable if the hub dies),\nhubs are generally considered to be much more reliable than routers.\nThey are also very easily replaced should they fail. 16. NETWORK MONITORING 305\nFigure NM 5: If your switch does not provide monitor port functionality, you\ncan insert a network hub between your Internet router and the LAN, and\nconnect the monitoring server to the hub.\nOnce your monitoring server is in place, you are ready to start collecting\ndata.\nWhat to monitor\nIt is possible to plot just about any network event and watch its value on a\ngraph over time.\nSince every network is slightly different, you will have to decide what\ninformation is important in order to gauge the performance of your\nnetwork.\nHere are some important indicators that many network administrators\nwill typically track. 306 MAINTENANCE, MONITORING AND SUSTAINABILITY\nWireless statistics\n\u2022 Received signal and noise from all backbone nodes\n\u2022 Number of associated stations\n\u2022 Detected adjacent networks and channels\n\u2022 Excessive retransmissions\n\u2022 Radio data rate, if using automatic rate scaling\nSwitch statistics\n\u2022 Bandwidth usage per switch port\n\u2022 Bandwidth usage broken down by protocol\n\u2022 Bandwidth usage broken down by MAC address\n\u2022 Broadcasts as a percentage of total packets\n\u2022 Packet loss and error rate\nInternet statistics\n\u2022 Internet bandwidth use by host and protocol\n\u2022 Proxy server cache hits\n\u2022 Top 100 sites accessed\n\u2022 DNS requests\n\u2022 Number of inbound emails \/ spam emails \/ email bounces\n\u2022 Outbound email queue size\n\u2022 Availability of critical services (web servers, email servers, etc.).\n\u2022 Ping times and packet loss rates to your ISP\n\u2022 Status of backups\nSystem health statistics\n\u2022 Memory usage\n\u2022 Swap file usage\n\u2022 Process count \/ zombie processes\n\u2022 System load\n\u2022 Uninterruptible Power Supply (UPS) voltage and load\n\u2022 Temperature, fan speed, and system voltages\n\u2022 Disk SMART status\n\u2022 RAID array status\nYou should use this list as a suggestion of where to begin. As your\nnetwork matures, you will likely find new key indicators of network\nperformance, and you should of course track those as well. 16. NETWORK MONITORING 307\nThere are many freely available tools that will show you as much detail as\nyou like about what is happening on your network.\nYou should consider monitoring the availability of any resource where\nunavailability would adversely affect your network users.\nDon't forget to monitor the monitoring machine itself, for example its\nCPU usage and disk space, in order to receive advance warning if it\nbecomes overloaded or faulty. A monitoring machine that is low on\nresources can affect your ability to monitor the network effectively.\nTypes of monitoring tools\nWe will now look at several different classes of monitoring tools.\n1. Network detection tools listen for the beacons sent by wireless access\npoints, and display information such as the network name, received\nsignal strength, and channel.\n2. Spot check tools are designed for troubleshooting and normally run\ninteractively for short periods of time. A program such as ping may be\nconsidered an active spot check tool, since it generates traffic by polling\na particular machine.\n3. Passive spot check tools include protocol analysers, which inspect every\npacket on the network and provide complete detail about any network\nconversation (including source and destination addresses, protocol\ninformation, and even application data).\n4. Trending tools perform unattended monitoring over long periods, and\ntypically plot the results on a graph.\n5. Throughput testing tools tell you the actual bandwidth available\nbetween two points on a network.\n6. Realtime monitoring tools perform similar monitoring, but notify\nadministrators immediately if they detect a problem. Intrusion\ndetection tools watch for undesirable or unexpected network traffic,\nand take appropriate action (typically denying access and\/or\nnotifying a network administrator). 308 MAINTENANCE, MONITORING AND SUSTAINABILITY\nNetwork detection\nThe simplest wireless monitoring tools simply provide a list of available\nnetworks, along with basic information (such as signal strength and channel).\nThey let you quickly detect nearby networks and determine if they are in\nrange or are causing interference.\nThe built-in client.\nAll modern operating systems provide built-in support for wireless\nnetworking. This typically includes the ability to scan for available\nnetworks, allowing the user to choose a network from a list. While\nvirtually all wireless devices are guaranteed to have a simple scanning\nutility, functionality can vary widely between implementations. These tools\nare typically only useful for configuring a computer in a home or office\nsetting.\nThey tend to provide little information apart from network names and the\navailable signal to the access point currently in use.\nNetstumbler\n(http:\/\/www.wirelessdefence.org\/Contents\/NetstumblerMain.htm). This is\nthe most popular tool for detecting wireless networks using Microsoft\nWindows. It supports a variety of wireless cards, and is very easy to use. It\nwill detect open and encrypted networks, but cannot detect \u201cclosed\u201d\nwireless networks. It also features a signal\/noise meter that plots radio\nreceiver data as a graph over time. It also integrates with a variety of GPS\ndevices, for logging precise location and signal strength information.\nThis makes Netstumbler a handy tool to have for an informal site survey.\nMacstumbler (http:\/\/www.macstumbler.com\/). While not directly related to\nthe Netstumbler, Macstumbler provides much of the same functionality but\nfor the Mac OS X platform. It works with all Apple Airport cards.\nSpot check tools\nWhat do you do when the network breaks? If you can\u2019t access a web page\nor email server, and clicking the reload button doesn\u2019t fix the problem,\nthen you\u2019ll need to be able to isolate the exact location of the problem.\nThese tools will help you to determine just where a connection problem\nexists. 16. NETWORK MONITORING 309\nThis section is simply an introduction to commonly used troubleshooting\ntools.\nFor more discussion of common network problems and how to diagnose\nthem, see the chapter called Maintenance and Troubleshooting.\nping\nJust about every operating system (including Windows, Mac OS X, and of\ncourse Linux and BSD) includes a version of the ping utility. It uses\nICMP packets to attempt to contact a specified host, and tells you how\nlong it takes to get a response.\nKnowing what to ping is just as important as knowing how to ping. If\nyou find that you cannot connect to a particular service in your web\nbrowser (say, http:\/\/yahoo.com\/), you could try to ping it:\n$ ping yahoo.com\nPING yahoo.com (66.94.234.13): 56 data bytes\n64 bytes from 66.94.234.13: icmp_seq=0 ttl=57 time=29.375 ms\n64 bytes from 66.94.234.13: icmp_seq=1 ttl=56 time=35.467 ms\n64 bytes from 66.94.234.13: icmp_seq=2 ttl=56 time=34.158 ms\n^C\n--- yahoo.com ping statistics ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min\/avg\/max\/stddev = 29.375\/33.000\/35.467\/2.618 ms\nHit control-C when you are finished collecting data.\nIf packets take a long time to come back, there may be network\ncongestion.\nIf return ping packets have an unusually low Time To Live (TTL), you\nmay have routing problems between your machine and the remote end.\nBut what if the ping doesn\u2019t return any data at all?\nIf you are pinging a name instead of an IP address, you may be running\ninto DNS problems. 310 MAINTENANCE, MONITORING AND SUSTAINABILITY\nTry pinging an IP address on the Internet. If you can\u2019t reach it, it\u2019s a good\nidea to see if you can ping your default router:\n$ ping 69.90.235.230\nPING 69.90.235.230 (69.90.235.230): 56 data bytes\n64 bytes from 69.90.235.230: icmp_seq=0 ttl=126 time=12.991 ms\n64 bytes from 69.90.235.230: icmp_seq=1 ttl=126 time=14.869 ms\n64 bytes from 69.90.235.230: icmp_seq=2 ttl=126 time=13.897 ms\n^C\n--- 216.231.38.1 ping statistics ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min\/avg\/max\/stddev = 12.991\/13.919\/14.869\/0.767 ms\nIf you can\u2019t ping your default router, then chances are you won\u2019t be able to\nget to the Internet either. If you can\u2019t even ping other IP addresses on your\nlocal LAN, then it\u2019s time to check your connection. If you\u2019re using\nEthernet, is it plugged in? If you\u2019re using wireless, are you connected to the\nproper wireless network, and is it in range?\nWhile it is generally accurate to assume that a machine that does not\nrespond to a ping is likely to be down or cut off from the network this is\nnot always 100% the case.\nParticularly on a WAN or the Internet itself, it is also possible that some\nrouter\/firewall between you and the target host(even the target itself) is\nblocking pings. If you find a machine is not responding to pings, try\nanother well-known service like ssh or http.\nIf you can reach the target through either of these services then you know\nthe machine is up and simply blocking pings. It is also worth noting that\ndifferent systems treat ping differently. The classic UNIX ping utility sends\nan ICMP ECHO protocol packet to the target host. Some network\ndevices will respond to a ping automatically regardless of whether ICMP\nis being blocked further up the protocol stack.\nThis can also be misleading because it can indicate a host is up when\nactually all that's really going on is that the NIC (Network Interface Card) 16. NETWORK MONITORING 311\nis powered and the machine itself is not actually up and running. As we\nstated above, it's always good to check connectivity with multiple\nmethods. Network debugging with ping is a bit of an art, but it is useful\nto learn. Since you will likely find ping on just about any machine you\nwill work on, it\u2019s a good idea to learn how to use it well.\ntraceroute and mtr\nhttp:\/\/www.bitwizard.nl\/mtr\/\nAs with ping, traceroute is found on most operating systems (it\u2019s called\ntracert in some versions of Microsoft Windows). By running traceroute,\nyou can find the location of problems between your computer and any\npoint on the Internet:\n$ traceroute -n google.com\ntraceroute to google.com (72.14.207.99), 64 hops max, 40 byte packets\n1 10.15.6.1 4.322 ms 1.763 ms 1.731 ms\n2 216.231.38.1 36.187 ms 14.648 ms 13.561 ms\n3 69.17.83.233 14.197 ms 13.256 ms 13.267 ms\n4 69.17.83.150 32.478 ms 29.545 ms 27.494 ms\n5 198.32.176.31 40.788 ms 28.160 ms 28.115 ms\n6 66.249.94.14 28.601 ms 29.913 ms 28.811 ms\n7 172.16.236.8 2328.809 ms 2528.944 ms 2428.719 ms\n8 * * *\nThe -n switch tells traceroute not to bother resolving names in DNS, and\nmakes the trace run more quickly. You can see that at hop seven, the\nround trip time shoots up to more than two seconds, while packets seem\nto be discarded at hop eight.\nThis might indicate a problem at that point in the network.\nIf this part of the network is in your control, it might be worth starting\nyour troubleshooting effort there. 312 MAINTENANCE, MONITORING AND SUSTAINABILITY\nMy TraceRoute (mtr) is a handy program that combines ping and\ntraceroute into a single tool. By running mtr, you can get an ongoing\naverage of latency and packet loss to a single host, instead of the\nmomentary snapshot that ping and traceroute provide.\nMy traceroute [v0.69]\ntesla.rob.swn (0.0.0.0) (tos=0x0 psize=64 bitpat Sun Jan 8 20:01:26 2006)\nKeys: Help Display mode Restart statistics Order of fields quit\nPackets Pings\nHost Loss% Snt Last Avg Best Wrst StDev\n1. gremlin.rob.swn 0.0% 4 1.9 2.0 1.7 2.6 0.4\n2. er1.sea1.speakeasy.net 0.0% 4 15.5 14.0 12.7 15.5 1.3\n3. 220.ge-0-1-0.cr2.sea1. 0.0% 4 11.0 11.7 10.7 14.0 1.6\nSpeakeasy.net\n4. fe-0-3-0.cr2.sfo1. 0.0% 4 36.0 34.7 28.7 38.1 4.1\nspeakeasy.net\n5. bas1-m.pao.yahoo.com 0.0% 4 27.9 29.6 27.9 33.0 2.4\n6. so-1-1-0.pat1.dce. 0.0% 4 89.7 91.0 89.7 93.0 1.4\nyahoo.com\n7. ae1.p400.msr1.dcn. 0.0% 4 91.2 93.1 90.8 99.2 4.1\nyahoo.com\n8. ge5-2.bas1-m.dcn. 0.0% 4 89.3 91.0 89.3 93.4 1.9\nyahoo.com\n9.w2.rc.vip.dcn.yahoo.com 0.0% 3 91.2 93.1 90.8 99.2 4.1\nThe data will be continuously updated and averaged over time.\nAs with ping, you should hit control-C when you are finished looking at\nthe data. Note that you must have root privileges to run mtr.\nWhile these tools will not reveal precisely what is wrong with the network,\nthey can give you enough information to know where to continue\ntroubleshooting. 16. NETWORK MONITORING 313\nProtocol analysers\nNetwork protocol analysers provide a great deal of detail about\ninformation flowing through a network, by allowing you to inspect\nindividual packets. For wired networks, you can inspect packets at the\ndata-link layer or above. For wireless networks, you can inspect\ninformation all the way down to individual 802.11 frames. Here are\nseveral popular (and free) network protocol analysers:\nKismet\nhttp:\/\/www.kismetwireless.net\/\nKismet is a powerful wireless protocol analyser for many platforms\nincluding Linux, Mac OS X, and even the embedded OpenWRT Linux\ndistribution. It works with any wireless card that supports passive monitor\nmode. In addition to basic network detection, Kismet will passively log all\n802.11 frames to disk or to the network in standard PCAP format, for\nlater analysis with tools like Wireshark. Kismet also features associated\nclient information, AP hardware fingerprinting, Netstumbler detection,\nand GPS integration. Since it is a passive network monitor, it can even\ndetect \u201cclosed\u201d wireless networks by analysing traffic sent by wireless\nclients. You can run Kismet on several machines at once, and have them\nall report over the network back to a central user interface. This allows for\nwireless monitoring over a large area, such as a university or corporate\ncampus. Since Kismet uses the radio card's passive monitor mode, it does\nall of this without transmitting any data.\nKismet is an invaluable tool for diagnosing wireless network problems.\nKisMAC\nhttp:\/\/kismac-ng.org\nExclusively for the Mac OS X platform, KisMAC does much of what\nKismet can do, but with a slick Mac OS X graphical interface. It is a\npassive scanner that will log data to disk in PCAP format compatible with\nWireshark. It supports passive scanning with AirportExtreme cards as well\nas a variety of USB wireless adapters.\ntcpdump\nhttp:\/\/www.tcpdump.org\/\ntcpdump is a command-line tool for monitoring network traffic. 314 MAINTENANCE, MONITORING AND SUSTAINABILITY\nIt does not have all the bells and whistles of wireshark but it does use\nfewer resources. Tcpdump can capture and display all network protocol\ninformation down to the link layer. It can show all of the packet headers\nand data received, or just the packets that match particular criteria.\nPackets captured with tcpdump can be loaded into wireshark for visual\nanalysis and further diagnostics. This is very useful if you wish to monitor\nan interface on a remote system and bring the file back to your local\nmachine for analysis. The tcpdump tool is available as a standard tool in\nUnix derivatives (Linux, BSD, and Mac OS X). There is also a Windows\nport called WinDump available at http:\/\/www.winpcap.org\/windump\/\nWireshark\nhttp:\/\/www.wireshark.org\/\nFormerly known as Ethereal, Wireshark is a free network protocol analyser\nfor Unix and Windows.\nFigure NM 6: Wireshark (formerly Ethereal) is a powerful network protocol\nanalyser that can show you as much detail as you like about any packet.\nWireshark allows you to examine data from a live network or from a\ncapture file on disk, and interactively browse and sort the captured data.\nBoth summary and detailed information is available for each packet,\nincluding the full header and data portions. 16. NETWORK MONITORING 315\nWireshark has several powerful features, including a rich display filter\nlanguage and the ability to view the reconstructed stream of a TCP\nsession.\nIt can be daunting to use for first time users or those that are not familiar\nwith the OSI layers.\nIt is typically used to isolate and analyse specific traffic to or from an IP\naddress, but it can be also used as a general purpose fault finding tool. For\nexample, a machine infected with a network worm or virus can be\nidentified by looking for the machine that is sending out the same sort of\nTCP\/IP packets to large groups of IP addresses.\nTrending tools\nTrending tools are used to see how your network is used over a long\nperiod of time. They work by periodically monitoring your network\nactivity, and displaying a summary in a human-readable form (such as a\ngraph). Trending tools collect data as well as analyse and report on it.\nBelow are some examples of trending tools. Some of them need to be used\nin conjunction with each other, as they are not stand-alone programs.\nMRTG\nhttp:\/\/oss.oetiker.ch\/mrtg\/\nThe Multi Router Traffic Grapher (MRTG) monitors the traffic load on\nnetwork links using SNMP. MRTG generates graphs that provide a visual\nrepresentation of inbound and outbound traffic. These are typically\ndisplayed on a web page.\nMRTG can be a little confusing to set up, especially if you are not familiar\nwith SNMP. But once it is installed, MRTG requires virtually no\nmaintenance, unless you change something on the system that is being\nmonitored (such as its IP address). 316 MAINTENANCE, MONITORING AND SUSTAINABILITY\ngrapher.\nRRDtool\nRRD is short for Round Robin Database. RRD is a database that stores\ninformation in a very compact way that does not expand over time.\nRRDtool refers to a suite of tools that allow you to create and modify\nRRD databases, as well as generate useful graphs to present the data.\nIt is used to keep track of time-series data (such as network bandwidth,\nmachine room temperature, or server load average) and can display that\ndata as an average over time.\nNote that RRDtool itself does not contact network devices to retrieve\ndata. It is merely a database manipulation tool.\nYou can use a simple wrapper script (typically in shell or Perl) to do that\nwork for you. RRDtool is also used by many full featured front-ends that\npresent you with a friendly web interface for configuration and display.\nRRD graphs give you more control over display options and the number\nof items available on a graph as compared to MRTG.\nFigure NM 8: RRDtool gives you a lot of flexibility in how your collected\nnetwork data may be displayed. 16. NETWORK MONITORING 317\nRRDtool is included in virtually all modern Linux distributions, and can\nbe downloaded from http:\/\/oss.oetiker.ch\/rrdtool\/\nntop\nFor historical traffic analysis and usage, you will certainly want to\ninvestigate ntop.\nThis program builds a detailed real-time report of observed network\ntraffic, displayed in your web browser. It integrates with rrdtool, and\nmakes graphs and charts visually depicting how the network is being used.\nOn very busy networks, ntop can use a lot of CPU and disk space, but it\ngives you extensive insight into how your network is being used. It runs on\nLinux, BSD, Mac OS X, and Windows.\nSome of its more useful features include:\nTraffic display can be sorted by various criteria (source, destination,\nprotocol, MAC address, etc.).\nTraffic statistics grouped by protocol and port number.\nAn IP traffic matrix which shows connections between machines Network\nflows for routers or switches that support the NetFlow protocol Host\noperating system identification, P2P traffic, identification, numerous\ngraphical charts, Perl, PHP, and Python API.\nntop is available from http:\/\/www.ntop.org\/ and is available for most\noperating systems.\nIt is often included in many of the popular Linux distributions, including\nRedHat, Debian, and Ubuntu.\nWhile it can be left running to collect historical data, ntop can be fairly\nCPU intensive, depending on the amount of traffic observed.\nIf you are going to run it for long periods you should monitor the CPU\nutilisation of the monitoring machine. 318 MAINTENANCE, MONITORING AND SUSTAINABILITY\nFigure NM 9: ntop displays a wealth of information about how your network\nis utilised by various clients and servers.\nThe main disadvantage of ntop is that it does not provide instantaneous\ninformation, only long-term totals and averages.\nThis can make it difficult to use to diagnose a problem that starts\nsuddenly.\nCacti\nhttp:\/\/www.cacti.net\/\nCacti is a front-end for RRDtool. It stores all of the necessary information\nto create graphs in a MySQL database. The front-end is written in PHP.\nCacti does the work of maintaining graphs, data sources, and handles the\nactual data gathering.\nThere is support for SNMP devices, and custom scripts can easily be\nwritten to poll virtually any conceivable network event. 16. NETWORK MONITORING 319\nFigure NM 10: Cacti can manage the polling of your network devices, and\ncan build very complex and informative visualisations of network behaviour.\nCacti can be somewhat confusing to configure, but once you work\nthrough the documentation and examples, it can yield very impressive\ngraphs.\nThere are hundreds of templates for various systems available on the cacti\nwebsite, and the code is under rapid development.\nNetFlow\nNetFlow is a protocol for collecting IP traffic information invented by\nCisco. From the Cisco website:\nCisco IOS NetFlow efficiently provides a key set of services for IP\napplications, including network traffic accounting, usage-based network\nbilling, network planning, security, Denial of Service monitoring\ncapabilities, and network monitoring.\nNetFlow provides valuable information about network users and\napplications, peak usage times, and traffic routing. 320 MAINTENANCE, MONITORING AND SUSTAINABILITY\nCisco routers can generate NetFlow information which is available from\nthe router in the form of UDP packets. NetFlow is also less CPU-\nintensive on Cisco routers than using SNMP. It also provides more\ngranular information than SNMP, letting you get a more detailed picture\nof port and protocol usage.This information is collected by a NetFlow\ncollector that stores and presents the data as an aggregate over time.\nBy analysing flow data, one can build a picture of traffic flow and traffic\nvolume in a network or on a connection. There are several commercial\nand free NetFlow collectors available. Ntop is one free tool that can act as\na NetFlow collector and probe. Another is Flowc (see below). It can also\nbe desirable to use Netflow as a spot check tool, by just looking at a quick\nsnapshot of data during a network crisis. Think of NetFlow as an\nalternative to SNMP for Cisco devices. For more information about\nNetFlow, see http:\/\/en.wikipedia.org\/wiki\/Netflow .\nFlowc\nhttp:\/\/netacad.kiev.ua\/flowc\/. Flowc is an open source NetFlow collector\n(see NetFlow above). It is lightweight and easy to configure. Flowc uses a\nMySQL database to store aggregated traffic information. Therefore, it is\npossible to generate your own reports from the data using SQL, or use the\nincluded report generators. The built-in report generators produce reports\nin HTML, plain text or a graphical format.\nFigure NM 11: A typical flow chart generated by Flowc.\nThe large gap in data probably indicates a network outage. Trending tools\ntypically will not notify you of outages, but merely log the occurrence. 16. NETWORK MONITORING 321\nTo be notified when network problems occur, use a realtime monitoring\ntool such as Nagios.\nSmokePing\nhttp:\/\/oss.oetiker.ch\/smokeping\/. SmokePing is a deluxe latency\nmeasurement tool written in Perl.\nIt can measure, store and display latency, latency distribution and packet\nloss all on a single graph.\nSmokePing uses the RRDtool for data storage, and can draw very\ninformative graphs that present up to the minute information on the state\nof your network connection.\nIt is very useful to run SmokePing on a host with good connectivity to\nyour entire network. Over time, trends are revealed that can point to all\nsorts of network problems.\nCombined with MRTG or Cacti, you can observe the effect that network\ncongestion has on packet loss and latency.\nSmokePing can optionally send alerts when certain conditions are met,\nsuch as when excessive packet loss is seen on a link for an extended period\nof time. An example of SmokePing in action is shown in Figure NM 12.\nFigure NM 12: SmokePing can simultaneously display packet loss and latency\nspreads in a single graph. 322 MAINTENANCE, MONITORING AND SUSTAINABILITY\nEtherApe\nhttp:\/\/etherape.sourceforge.net\/\nEtherApe displays a graphical representation of network traffic. Hosts and\nlinks change size depending on the amount of traffic sent and received.\nThe colours change to represent the protocol most used. As with wireshark\nand tcpdump, data can be captured \"off the wire\" from a live network\nconnection or read from a tcpdump capture file. EtherApe doesn't show\nquite as much detail as ntop, but its resource requirements are much lighter.\niptraf\nhttp:\/\/iptraf.seul.org\/\nIPTraf is a lightweight but powerful LAN monitor. It has an ncurses\ninterface and runs in a command shell. IPTraf takes a moment to measure\nobserved traffic, and then displays various network statistics including\nTCP and UDP connections, ICMP and OSPF information, traffic flows,\nIP checksum errors, and more. It is a simple to use program that uses\nminimal system resources. While it does not keep historical data, it is very\nuseful for displaying an instantaneous usage report.\nFigure NM 13: iptraf's statistical breakdown of traffic by port. 16. NETWORK MONITORING 323\nArgus\nhttp:\/\/qosient.com\/argus\/.\nArgus stands for Audit Record Generation and Utilisation System. Argus\nis also the name of the mythological Greek god who had hundreds of eyes.\nFrom the Argus website:\nArgus generates flow statistics such as connectivity, capacity, demand, loss,\ndelay, and jitter on a per transaction basis. Argus can be used to analyse\nand report on the contents of packet capture files or it can run as a\ncontinuous monitor, examining data from a live interface; generating an\naudit log of all the network activity seen in the packet stream.\nArgus can be deployed to monitor individual end-systems, or an entire\nenterprises network activity. As a continuous monitor, Argus provides\nboth push and pull data handling models, to allow flexible strategies for\ncollecting network audit data. Argus data clients support a range of\noperations, such as sorting, aggregation, archival and reporting. Argus\nconsists of two parts: a master collector that reads packets from a network\ndevice, and a client that connects to the master and displays the usage\nstatistics. Argus runs on BSD, Linux, and most other UNIX systems.\nNeTraMet\nhttp:\/\/www.caida.org\/tools\/measurement\/netramet\/\nNeTraMet is another popular flow analysis tool. Like Argus,\nNeTraMet consists of two parts: a collector that gathers statistics via\nSNMP, and a manager that specifies which flows should be watched.\nFlows are specified using a simple programming language that defines the\naddresses used on either end, and can include Ethernet, IP, protocol\ninformation, or other identifiers. NeTraMet runs on DOS and most\nUNIX systems, including Linux and BSD.\nThroughput testing\nHow fast can the network go?\nWhat is the actual usable capacity of a particular network link?\nYou can get a very good estimate of your throughput capacity by flooding\nthe link with traffic and measuring how long it takes to transfer the data. 324 MAINTENANCE, MONITORING AND SUSTAINABILITY\nalways give you an accurate picture of network performance.\nWhile there are web pages available that will perform a \u201cspeed test\u201d in your\nbrowser (such as http:\/\/www.dslreports.com\/stest or http:\/\/speedtest.net\/),\nthese tests are increasingly inaccurate as you get further from the testing\nsource. Even worse, they do not allow you to test the speed of a given link,\nbut only the speed of your link to a particular site on the Internet.\nHere are a few tools that will allow you to perform throughput testing on\nyour own networks.\nttcp\nNow a standard part of most Unix-like systems, ttcp is a simple network\nperformance testing tool.\nOne instance is run on either side of the link you want to test.\nThe first node runs in receive mode, and the other transmits:\nnode_a$ ttcp -r -s\nnode_b$ ttcp -t -s node_a\nttcp-t: buflen=8192, nbuf=2048, align=16384\/0, port=5001 tcp -> node_a\nttcp-t: socket\nttcp-t: connect\nttcp-t: 16777216 bytes in 249.14 real seconds = 65.76 KB\/sec +++ 16. NETWORK MONITORING 325\nttcp-t: 2048 I\/O calls, msec\/call = 124.57, calls\/sec = 8.22\nttcp-t: 0.0user 0.2sys 4:09real 0% 0i+0d 0maxrss 0+0pf 7533+0csw\nAfter collecting data in one direction, you should reverse the transmit and\nreceive partners to test the link in the other direction. It can test UDP as\nwell as TCP streams, and can alter various TCP parameters and buffer\nlengths to give the network a good workout. It can even use a user-\nsupplied data stream instead of sending random data. Remember that the\nspeed readout is in kilobytes, not kilobits. Multiply the result by 8 to find\nthe speed in kilobits per second. The only real disadvantage to ttcp is that\nit hasn\u2019t been developed in years. Fortunately, the code has been released\nin the public domain and is freely available. Like ping and traceroute, ttcp\nis found as a standard tool on many systems.\niperf\nhttp:\/\/iperf.sourceforge.net\/. Much like ttcp, iperf is a command line tool\nfor estimating the throughput of a network connection. It supports many\nof the same features as ttcp, but uses a \u201cclient\u201d and \u201cserver\u201d model instead\nof a \u201creceive\u201d and \u201ctransmit\u201d pair.\nTo run iperf, launch a server on one side and a client on the other:\nnode_a$ iperf -s\nnode_b$ iperf -c node_a\n------------------------------------------------------------\nClient connecting to node_a, TCP port 5001\nTCP window size: 16.0 KByte (default)\n------------------------------------------------------------\n[ 5] local 10.15.6.1 port 1212 connected with 10.15.6.23 port 5001\n[ ID] Interval Transfer Bandwidth\n[ 5] 0.0-11.3 sec 768 KBytes 558 Kbits\/sec\nThe server side will continue to listen and accept client connections on\nport 5001 until you hit control-C to kill it. This can make it handy when\nrunning multiple test runs from a variety of locations.\nThe biggest difference between ttcp and iperf is that iperf is under active\ndevelopment, and has many new features (including IPv6 support). This\nmakes it a good choice as a performance tool when building new\nnetworks. 326 MAINTENANCE, MONITORING AND SUSTAINABILITY\nbing\nhttp:\/\/fgouget.free.fr\/bing\/indx-en.shtml\nRather than flood a connection with data and see how long the transfer\ntakes to complete, bing attempts to estimate the available throughput of a\npoint-to-point connection by analysing round trip times for various sized\nICMP packets. While it is not always as accurate as a flood test, it can\nprovide a good estimate without transmitting a large number of bytes.\nSince bing works using standard ICMP echo requests, it can estimate\navailable bandwidth without the need to run a special client on the other\nend, and can even attempt to estimate the throughput of links outside\nyour network. Since it uses relatively little bandwidth, bing can give you a\nrough idea of network performance without running up the charges that a\nflood test would certainly incur.\nRealtime tools and intrusion detection\nIt is desirable to find out when people are trying to break into your\nnetwork, or when some part of the network has failed.\nBecause no system administrator can be monitoring a network all the\ntime, there are programs that constantly monitor the status of the network\nand can send alerts when notable events occur.\nThe following are some open source tools that can help perform this task.\nSnort\nSnort (http:\/\/www.snort.org\/) is a packet sniffer and logger which can be\nused as a lightweight network intrusion detection system.\nIt features rule-based logging and can perform protocol analysis, content\nsearching, and packet matching.\nIt can be used to detect a variety of attacks and probes, such as stealth\nport scans, CGI attacks, SMB probes, OS fingerprinting attempts, and\nmany other kinds of anomalous traffic patterns.\nSnort has a real-time alert capability that can notify administrators about\nproblems as they occur with a variety of methods.\nInstalling and running Snort is not trivial, and depending on the amount\nof network traffic, will likely require a dedicated monitoring machine with\nconsiderable resources. 16. NETWORK MONITORING 327\nFortunately, Snort is very well documented and has a strong user\ncommunity.\nBy implementing a comprehensive Snort rule set, you can identify\nunexpected behaviour that would otherwise mysteriously eat up your\nInternet bandwidth.\nSee http:\/\/snort.org\/docs\/ for an extensive list of installation and\nconfiguration resources.\nApache: mod_security\nModSecurity (http:\/\/www.modsecurity.org\/) is an open source intrusion\ndetection and prevention engine for web applications.\nThis kind of security tool is also known as a web application firewall.\nModSecurity increases web application security by protecting web\napplications from known and unknown attacks.\nIt can be used on its own, or as a module in the Apache web server\n(http:\/\/www.apache.org\/).\nThere are several sources for updated mod_security rules that help protect\nagainst the latest security exploits.\nOne excellent resource is GotRoot, which maintains a huge and\nfrequently updated repository of rules:\nhttp:\/\/www.atomicorp.com\/wiki\/index.php\/Atomic_ModSecurity_Rules\nWeb application security is important in defending against attacks on your\nweb server, which could result in the theft of valuable or personal data, or\nin the server being used to launch attacks or send spam to other Internet\nusers. As well as being damaging to the Internet as a whole, such\nintrusions can seriously reduce your available bandwidth.\nNagios\nNagios (http:\/\/nagios.org\/) is a program that monitors hosts and services\non your network, notifying you immediately when problems arise.\nIt can send notifications via email, SMS, or by running a script, and will\nsend notifications to the relevant person or group depending on the nature\nof the problem. Nagios runs on Linux or BSD, and provides a web\ninterface to show up-to-the-minute system status. Nagios is extensible,\nand can monitor the status of virtually any network event. It performs\nchecks by running small scripts at regular intervals, and checks the results\nagainst an expected response. 328 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThis can yield much more sophisticated checks than a simple network\nprobe. For example, ping may tell you that a machine is up, and nmap\nmay report that a TCP port responds to requests, but Nagios can actually\nretrieve a web page or make a database request, and verify that the\nresponse is not an error.\nFigure NM 15: Nagios keeps you informed the moment a network fault or\nservice outage occurs.\nNagios can even notify you when bandwidth usage, packet loss, machine\nroom temperature, or other network health indicator crosses a particular\nthreshold.\nThis can give you advance warning of network problems, often allowing\nyou to respond to the problem before users have a chance to complain.\nZabbix\nZabbix (http:\/\/www.zabbix.org\/) is an open source realtime monitoring\ntool that is something of a hybrid between Cacti and Nagios. It uses a\nSQL database for data storage, has its own graph rendering package, and\nperforms all of the functions you would expect from a modern realtime\nmonitor (such as SNMP polling and instant notification of error\nconditions). Zabbix is released under the GNU General Public License. 16. NETWORK MONITORING 329\nOther useful tools\nThere are thousands of free network monitoring tools that fill very\nspecialised needs. Here are a few of our favourites that don't quite fit into\nthe above categories.\nngrep\nNgrep provides most of GNU grep's pattern matching features, but\napplies them to network traffic. It currently recognises IPv4 and IPv6,\nTCP, UDP, ICMP, IGMP, PPP, SLIP, FDDI, Token Ring, and much\nmore. As it makes extensive use of regular expression matches, it is a tool\nsuited to advanced users or those that have a good knowledge of regular\nexpressions. You don't necessarily need to be a regex expert to be able to\nmake basic use of ngrep. For example, to view all packets that contain the\nstring GET (presumably HTTP requests), try this:\n# ngrep -q GET\nPattern matches can be constrained further to match particular protocols,\nports, or other criteria using BPF filters. This is the filter language used by\ncommon packet sniffing tools, such as tcpdump and snoop. To view GET\nor POST strings sent to destination port 80, use this command line:\n# ngrep -q 'GET|POST' port 80\nBy using ngrep creatively, you can detect anything from virus activity to\nspam email. You can download ngrep at http:\/\/ngrep.sourceforge.net\/.\nnmap\/Zenmap\nnmap is a network diagnostic tool for showing the state and availability of\nnetwork ports on a network interface. A common use is to scan a network\nhost on a TCP\/IP network for what ports are open, thereby allowing one to\ncreate a \"map\" of the network services that the machine provides. The nmap\ntool does this by sending specially crafted packets to a target network host\nand noticing the response(s). For example, a web server with an open port 80\nbut no running web server will respond differently to an nmap probe than\none that not only has the port open but is running httpd.\nSimilarly, you will get a different response to a port that is simply shut off\nvs. one that is open on a host but blocked by a firewall. 330 MAINTENANCE, MONITORING AND SUSTAINABILITY\nOver time, nmap has evolved from being a simple port-scanner to\nsomething that can detect OS versions, network drivers, the type of NIC\nhardware being used by an interface, driver versions, etc. In addition to\nscanning individual machines, it can also scan entire networks of hosts.\nThis does mean that nmap is potentially also useful by malicious network\nusers as a way to \"scope out\" a system before attacking it. Like many\ndiagnostic tools, nmap can be used for good or ill and network\nadministrators would do well to be aware of both sides. The nmap tool is\nreleased under the GPL license and the latest version can be found at\nhttp:\/\/www.nmap.org.\nZenmap\nZenmap is a cross-platform GUI for nmap which runs under Linux,\nWindows, Mac OS X, BSD, etc. and can be downloaded from the\nnmap.org site as well.\nnetcat\nSomewhat between nmap and tcpdump, netcat is another diagnostic tool\nfor poking and prodding at ports and connections on a network. It takes\nits name from the UNIX cat(1) utility, which simply reads out whatever\nfile you ask it to. Similarly, netcat reads and writes data across any\narbitrary TCP or UDP port. The netcat utility is not a packet analyser but\nworks on the data(payload) contained in the packets.\nFor example, here is how to run a very simple 1-line, 1-time web server\nwith netcat:\n{ echo -ne \"HTTP\/1.0 200 OK\\r\\n\\r\\n\"; cat some.file; } | nc -l 8080\nThe file some.file will be sent to the first host that connects to port 8080\non the system running netcat.\nThe -l command tells netcat to \"listen\" on port 8080 and wait until it gets\na connection.\nOnce it does, it stops blocking, reads the data off the pipe and sends it to\nthe client connected on port 8080. Some other good examples of netcat\nusage can be found in the Wikipedia entry for netcat:\nhttps:\/\/secure.wikimedia.org\/wikipedia\/en\/wiki\/Netcat#Examples\nYou can download the latest version of netcat from\nhttp:\/\/nc110.sourceforge.net\/\nIt is available under a Permissive Free Software License. 16. NETWORK MONITORING 331\nWhat is normal?\nIf you are looking for a definitive answer as to what your traffic patterns\nshould look like, you are going to be disappointed. There is no absolute\nright answer to this question, but given some work you can determine\nwhat is normal for your network. While every environment is different,\nsome of the factors that can influence the appearance of your traffic\npatterns are:\n\u2022 The capacity of your Internet connection\n\u2022 The number of users that have access to the network\n\u2022 The social policy (byte charging, quotas, honour system, etc.).\n\u2022 The number, types, and level of services offered\n\u2022 The health of the network (presence of viruses, excessive\nbroadcasts, routing loops, open email relays, denial of service\nattacks, etc.).\n\u2022 The competence of your computer users\n\u2022 The location and configuration of control structures (firewalls,\nproxy servers, caches, and so on)\nThis is not a definitive list, but should give you an idea of how a wide\nrange of factors can affect your bandwidth patterns.\nWith this in mind, let's look at the topic of baselines.\nEstablishing a baseline\nSince every environment is different, you need to determine for yourself\nwhat your traffic patterns look like under normal situations. This is useful\nbecause it allows you to identify changes over time, either sudden or\ngradual. These changes may in turn indicate a problem, or a potential\nfuture problem, with your network.\nFor example, suppose that your network grinds to a halt, and you are not\nsure of the cause. Fortunately, you have decided to keep a graph of\nbroadcasts as a percentage of the overall network traffic. If this graph\nshows a sudden increase in the amount of broadcast traffic, it may mean\nthat your network has been infected with a virus.\nWithout an idea of what is \"normal\" for your network (a baseline), you\nwould not be able to see that the number of broadcasts had increased, 332 MAINTENANCE, MONITORING AND SUSTAINABILITY\nonly that it was relatively high, which may not indicate a problem.\nBaseline graphs and figures are also useful when analysing the effects of\nchanges made to the network. It is often very useful to experiment with\nsuch changes by trying different possible values. Knowing what the\nbaseline looks like will show you whether your changes have improved\nmatters, or made them worse.\nFigure NM 16: By collecting data over a long period of time, you can predict\nthe growth of your network and make changes before problems develop.\nIn Figure NM 16, we can see the effect of the implementation of delay\npools on Internet utilisation around the period of May.\nIf we did not keep a graph of the line utilisation, we would never know\nwhat the effect of the change over the long term was.\nWhen watching a total traffic graph after making changes, don't assume\nthat just because the graph does not change radically that your efforts were\nwasted. You might have removed frivolous usage from your line only to\nhave it replaced by genuine legitimate traffic.\nYou could then combine this baseline with others, say the top 100 sites\naccessed or the average utilisation by your top twenty users, to determine if\nhabits have simply changed. As we will see later, MRTG, RRDtool, and Cacti\nare excellent tools you can use to keep a baseline.\nFigure NM 17: The traffic trend at Aidworld logged over a single day. 16. NETWORK MONITORING 333\nFigure NM 17 shows traffic on an Aidworld firewall over a period of 24\nhours. There is nothing apparently wrong with this graph, but users were\ncomplaining about slow Internet access.\nFigure NM 18 shows that the upload bandwidth use (blue) was higher\nduring working hours on the last day than on previous days. A period of\nheavy upload usage started every morning at 03:00, and was normally\nfinished by 09:00, but on the last day it was still running at 16:30. Further\ninvestigation revealed a problem with the backup software, which ran at\n03:00 every day.\nFigure NM 18: The same network logged over an entire week reveals a\nproblem with backups, which caused unexpected congestion for network users.\nFigure NM 19 shows measurements of latency on the same connection as\nmeasured by the program called SmokePing. The position of the dots\nshows the average latency, while the grey smoke indicates the distribution\nof latency (jitter). The colour of the dots indicates the number of lost\npackets. This graph over a period of four hours does not help to identify\nwhether there are any problems on the network.\nFigure NM 19: Four hours of jitter and packet loss. 334 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThe next graph (Figure NM 20) shows the same data over a period of 16\nhours. This indicates that the values in the graph above are close to the\nnormal level (baseline), but that there were significant increases in latency\nat several times during the early morning, up to 30 times the baseline\nvalue.\nThis indicates that additional monitoring should be performed during\nthese periods to establish the cause of the high latency to avoid problems\nsuch as the backup not completing in the future.\nFigure NM 20: A higher spread of jitter is revealed in the 16 hour log.\nFigure NM 21 shows that Tuesday was significantly worse than Sunday or\nMonday for latency, especially during the early morning period.\nThis might indicate that something has changed on the network.\nrepetition of increased latency and packet loss in the early morning hours. 16. NETWORK MONITORING 335\nHow do I interpret the traffic graph?\nIn a basic network flow graph (such as that generated by the network\nmonitor tool MRTG), the green area indicates inbound traffic, while the\nblue line indicates outbound traffic. Inbound traffic is traffic that\noriginates from another network (typically the Internet) and is addressed\nto a computer inside your network. Outbound traffic is traffic that\noriginates from your network, and is addressed to a computer somewhere\non the Internet. Depending on what sort of network environment you\nhave, the graph will help you understand how your network is actually\nbeing used. For example, monitoring of servers usually reveals larger\namounts of outbound traffic as the servers respond to requests (such as\nsending mail or serving web pages), while monitoring client machines\nmight reveal higher amounts of inbound traffic to the machines as they\nreceive data from the servers.\nFigure NM 22: The classic network flow graph. The green area represents\ninbound traffic, while the blue line represents outbound traffic. The repeating\narcs of outbound traffic show when the nightly backups have run.\nTraffic patterns will vary with what you are monitoring.\nA router will normally show more incoming traffic than outgoing traffic as\nusers download data from the Internet.\nAn excess of outbound traffic that is not transmitted by your network\nservers may indicate a peer-to-peer client, unauthorised server, or even a\nvirus on one or more of your clients.\nThere are no set metrics that indicate what outgoing traffic to incoming\ntraffic should look like.\nIt is up to you to establish a baseline to understand what normal network\ntraffic patterns look like on your network. 336 MAINTENANCE, MONITORING AND SUSTAINABILITY\nDetecting network overload\nFigure NM 23 shows traffic on an overloaded Internet connection.\nFigure NM 23: Flat-topped graphs indicate overloading of available\nbandwidth.\nThe most apparent sign of overloading is the flat tops on outbound traffic\nduring the middle of every day.\nFlat tops may indicate overloading, even if they are well below the\nmaximum theoretical capacity of the link.\nIn this case it may indicate that you are not getting as much bandwidth\nfrom your service provider as you expect.\nMeasuring 95th percentile\nThe 95th percentile is a widely used mathematical calculation to evaluate\nregular and sustained utilisation of a network pipe.\nIts value shows the highest consumption of traffic for a given period.\nCalculating the 95th percentile means that 95% of the time the usage is\nbelow a certain amount, and 5% of the time usage is above that amount.\nThe 95th percentile is a good guideline to show bandwidth that is actually\nused at least 95% of the time. 16. NETWORK MONITORING 337\nFigure NM 24: The horizontal line shows the 95th percentile amount.\nMRTG and Cacti will calculate the 95th percentile for you.\nThis is a sample graph of a 960 kbps connection. The 95th percentile\ncame to 945 kbps after discarding the highest 5% of traffic.\nMonitoring RAM and CPU usage\nBy definition, servers provide critical services that should always be\navailable.\nServers receive and respond to client machine requests, providing access to\nservices that are the whole point of having a network in the first place.\nTherefore, servers must have sufficient hardware capabilities to\naccommodate the work load.\nThis means they must have adequate RAM, storage, and processing power\nto accommodate the number of client requests.\nOtherwise, the server will take longer to respond, or in the worst case,\nmay be incapable of responding at all. Since hardware resources are finite,\nit is important to keep track of how system resources are being used.\nIf a core server (such as a proxy server or email server) is overwhelmed by\nrequests, access times become slow. 338 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThis is often perceived by users as a network problem. There are several\nprograms that can be used to monitor resources on a server. The simplest\nmethod on a Windows machine is to access the Task Manager using the\nCtrl Alt + Del keys, and then click on the Performance tab. On a Linux\nor BSD box, you can type top in a terminal window. To keep historical\nlogs of such performance, MRTG or RRDtool can also be used.\nFigure NM 25: RRDtool can show arbitrary data, such as memory and CPU\nusage, expressed as an average over time.\nMail servers require adequate space, as some people may prefer to leave\ntheir email messages on the server for long periods of time.\nThe messages can accumulate and fill the hard disk, especially if quotas are\nnot in use.\nIf the disk or partition used for mail storage fills up, the mail server\ncannot receive mail. If that disk is also used by the system, all kinds of\nsystem problems may occur as the operating system runs out of swap\nspace and temporary storage.\nFile servers need to be monitored, even if they have large disks.\nUsers will find a way to fill any size disk more quickly than you might\nthink. 16. NETWORK MONITORING 339\nDisk usage can be enforced through the use of quotas, or by simply\nmonitoring usage and telling people when they are using too much.\nNagios can notify you when disk usage, CPU utilisation, or other system\nresources cross a critical threshold.\nIf a machine becomes unresponsive or slow, and measurements show that\na system resource is being heavily used, this may be an indication that an\nupgrade is required. If processor usage constantly exceeds 60% of the\ntotal, it may be time to upgrade the processor. Slow speeds could also be\nas a result of insufficient RAM. Be sure to check the overall usage of CPU,\nRAM, and disk space before deciding to upgrade a particular component.\nA simple way to check whether a machine has insufficient RAM is to look\nat the hard disk light.\nWhen the light is on constantly, it usually means that the machine is\nconstantly swapping large amounts of data to and from the disk.\nThis is known as thrashing, and is extremely bad for performance.\nIt can usually be fixed by investigating which process is using the most\nRAM, and killing or reconfiguring that process. Failing that, the system\nneeds more RAM. You should always determine whether it is more cost\neffective to upgrade an individual component or purchase a whole new\nmachine. Some computers are difficult or impossible to upgrade, and it\noften costs more to replace individual components than to replace the\nentire system. Since the availability of parts and systems varies widely\naround the world, be sure to weigh the cost of parts vs. whole systems,\nincluding shipping and taxes, when determining the cost of upgrading.\nSummary\nIn summary in this chapter we've tried to give you an insight into how to\nmonitor your network and computing resources cost effectively and\nefficiently. We've introduced many of our favourite tools to assist you.\nMany of them are tried and tested by many network operators.\nHopefully you have understood the importance of monitoring to enable\nyou to both justify upgrades when necessary to those funding the\nupgrades, plus minimise the impact of problems as they occur.\nThe end result is keeping your network and computing resources healthy\nand keeping all of your users happy with the service you are providing\nthem. 340 MAINTENANCE, MONITORING AND SUSTAINABILITY\n17. ECONOMIC SUSTAINABILITY\nIntroduction\nAchieving long-term sustainability is perhaps the most difficult goal when\ndesigning and operating wireless networks. The prohibitive cost of Internet\nconnectivity in many countries, particularly those who are heavily\nregulated by the government, imposes a substantial operating expense that\nmakes these networks sensitive to economic fluctuations and necessitates\ninnovation to attain viability.\nSubstantial progress in the use of wireless networks for rural\ncommunications has been accomplished over the past few years, due in\nlarge part to technological breakthroughs.\nLong-distance links have been constructed, high bandwidth designs are\npossible and secure means to access networks are available. In contrast,\nthere have been fewer successes with the development of sustainable\nbusiness models for wireless networks, particularly for remote areas.\nBased on experiences and observations of existing networks, as well as\nknowledge from entrepreneurial development best practices, this chapter\nwill focus on documenting methods for building sustainable wireless\nnetworks.\nIn the past decade, there has been tremendous growth in Internet access\nacross the world. Most cities now have wireless or DSL networks and fibre\noptic connections to the Internet, which is a substantial improvement.\nNevertheless, outside urban areas, Internet access is still a formidable\nchallenge. There is little wired infrastructure beyond principal cities in\nmany countries. Therefore, wireless remains one of the few choices for\nproviding affordable Internet access.\nThere are now proven models for rural access using wireless. This book\nwas written for those wishing to connect their communities.\nThe models described here are smaller in scale and use affordable designs. 17. ECONOMIC SUSTAINABILITY 341\nOur aim is to provide examples of how wireless networks can be designed\nto expand sustainable access where large telecommunications operators\nhave not yet installed their networks into areas that would otherwise not\nbe economically feasible by traditional models.\nTwo common misconceptions must be dispelled. First, many people\nassume that there is one preferred business model that will work in every\ncommunity, and the key to success is to find that one \u201ceureka\u201d solution.\nIn practice, this is not the case. Each community, town or village is\ndifferent. There is no prescribed model that meets the needs of all areas.\nDespite the fact that some places may be similar in economic terms, the\ncharacteristics of a sustainable business model vary from community to\ncommunity.\nAlthough one model may work in one village, another village nearby may\nnot possess the same necessary qualities for this model to be sustainable.\nIn this circumstance, other innovative models must be customised to fit\nthe context of this particular community.\nAnother misconception is that sustainability has the same definition for all\npeople. Although this term generally means that a system is built to persist\nindefinitely, this chapter focuses more on the discussion of the economic\nconditions (financial and managerial) than other aspects of sustainability.\nAlso, instead of the horizon being indeterminate, it centres on a time\nperiod of five years \u2013 the period in which these ICT infrastructure and\nwireless technologies are expected to be useful.\nThus, the term sustainability will be used to encapsulate a system designed\nto persist for approximately five years. As we explained earlier in the book,\nwireless networks in local communities often stimulate the growth of\nconnectivity and usage, and the installation of fibre begins to become a\nreality.\nSo creating a sustainable model for your wireless network may lead to\ngrowth of other networks and installation of longer term greater\nbandwidth fibre links.\nWireless will then likely continue to co-habit alongside fibre in your\nnetwork as it grows in size and reach. 342 MAINTENANCE, MONITORING AND SUSTAINABILITY\nWhen determining and implementing the best model for a wireless\nnetwork, several key factors will help to ensure its success.\nThis chapter is not meant to be a guide for managing sustainable wireless\nnetworks.\nRather, this is a \u201chow-to\u201d guide seeking to present an approach that will\nenable you to find the model that best fits your situation.\nThe tools and information contained within this chapter will help people\nstarting wireless networks to ask the right questions and gather the\nnecessary data to define the most appropriate components of their model.\nKeep in mind that determining the best model is not a sequential process\nwhere each step is followed until completion.\nIn fact, the process is ongoing and iterative.\nAll of the steps are integrally connected to each other, and often you will\nrevisit steps several times as you progress.\nCreate a mission statement\nWhat do you want to accomplish by setting up your network?\nIt seems like a simple question. However, many wireless networks are\ninstalled without a clear vision of what they are doing and what they hope\nto accomplish in the future. The first step involves documenting this\nvision with the input of your entire team or staff.\n\u2022 What is the purpose of the wireless network?\n\u2022 Who does the network seek to serve?\n\u2022 What does the network do to address the community\u2019s\nneeds and to create value?\n\u2022 What are the principles that guide the network?\nA good mission statement expresses the purpose of your network in a\nconcise, meaningful way while articulating your values and services.\nAbove all, your mission provides a vision of the aspirations for your\nwireless network. 17. ECONOMIC SUSTAINABILITY 343\nIt is important that every team member working to build the wireless\nnetwork is included in the process of developing your mission, which\nhelps create further buy-in. It will garner support and commitment not\nonly from your staff, but also from customers, partners and donors, which\nwill further your overall objectives.\nIn the dynamic world of technology, the needs of customers and the best\nway to satisfy those needs change rapidly; therefore, the development of\nyour mission is an ongoing process.\nAfter defining the initial mission with your team, you must conduct\nresearch to determine whether this first conception is aligned with the\nrealities of your environment. Based on an analysis of the external\nenvironment and your internal competencies, you must constantly modify\nthe mission throughout the life-cycle of the wireless network.\nEvaluate the demand for potential offerings\nThe next step in deriving your business model involves assessing the\ncommunity\u2019s demand for the network\u2019s products and services. First,\nidentify the individuals, groups and organisations in the community that\nhave a need for information and would benefit from the wireless network\u2019s\nofferings. Potential users could consist of a wide variety of individuals and\norganisations that include, but are not limited to:\n\u2022 Farmers\u2019 associations and cooperatives\n\u2022 Women\u2019s groups\n\u2022 Schools and universities\n\u2022 Businesses and local entrepreneurs\n\u2022 Health clinics and hospitals\n\u2022 Religious groups\n\u2022 International and local non-governmental organizations (NGOs)\nLocal and national government agencies\n\u2022 Radio stations\n\u2022 Organisations in the tourist industry\nOnce you establish a list of all the potential user groups of the network,\nyou must determine their needs for access to information and\ncommunication. Often, people confuse services with needs. 344 MAINTENANCE, MONITORING AND SUSTAINABILITY\nA farmer may need to gather information on market prices and climatic\nconditions to improve his crop yield and sales. Perhaps the way in which\nhe gets this information is through the Internet; however, the farmer could\nalso receive this information through SMS over a mobile phone or\nthrough Voice over Internet Protocol (VoIP). It is important to\ndifferentiate between needs and services because there may be various\nways to satisfy the farmer\u2019s needs. Your wireless network should look for\nthe best way to fulfill the farmer\u2019s needs, thereby creating value at the\nlowest cost for the user.\nWhen assessing the needs of the community, it is important to figure out\nwhere the network can bring the most value to its users.\nFor instance, in the small town of Douentza, Mali, a telecentre manager\nevaluated the potential benefits of establishing a wireless network through\ndiscussions with several local organisations. He interviewed one local\nNGO that discussed its need to send monthly reports to its headquarters\noffice in Bamako. At that time, there was no Internet access in Douentza.\nIn order to email a copy of the report, the NGO sent one of its employees\nto Mopti once a month, resulting in transportation and lodging costs, as\nwell as the opportunity cost of having the employee out of the office for\nseveral days each month.\nWhen the telecentre manager calculated the total monthly costs incurred\nby the NGO, he was able to demonstrate the value of an Internet\nconnection through cost savings to the organisation.\nAssistance from key partners may also be necessary to secure sustainability\nfor your wireless network. During this phase, you should connect with\npotential partners and explore mutually beneficial collaborations.\nYou can evaluate the demand in your community by contacting your\npotential customers and asking questions directly or through surveys, focus\ngroups, interviews or town hall meetings. Conducting research through a\nreview of statistical documentation, industry reports, censuses, magazines,\nnewspapers and other secondary data sources will also help to give you a\nbetter picture of your local environment.\nThe goal of this data collection is to obtain a thorough understanding of\nthe demand for information and communication in your community so\nthat the network being created responds to those needs.\nOften, wireless networks that do not succeed forget this key step.\nYour entire network should be based on the demand in the community.\nIf you set up a wireless network in which the community does not find\nvalue or cannot afford its services, it will ultimately fail. 17. ECONOMIC SUSTAINABILITY 345\nEstablish appropriate incentives\nOften, there is little economic incentive for subsistence-based economic\nparticipants to access the Internet.\nIn addition, the cost of acquiring a computer or mobile smart phone,\nlearning to use it, and getting an Internet connection far outweighs the\neconomic returns that it can provide.\nThere has recently been some development of applications that address\nthis lack of incentive, such as market information systems, quality\nstandards imposed by importing countries, and commodities exchanges.\nInternet access becomes an obvious advantage in situations where knowing\nthe day-to-day prices of products can make a significant difference in\nincome. Establishing appropriate economic incentives is paramount to the\nsuccess of the network. The network must provide economic value to its\nusers in a way that outweighs its costs, or it must be cheap enough that its\ncosts are marginal and affordable to its users. It is crucial to design a\nnetwork with viable economic uses and with costs that are less than the\neconomic value provided by it.\nAdditionally, to create a proper incentive structure, you must involve the\ncommunity in the creation of the network from the beginning of the\nproject, making sure that this initiative is organic and not imposed from\nthe outside.\nTo begin, you should try to answer the following questions:\n1. What economic value can this network generate for the local\neconomy and for whom?\n2. How much perceivable economic value can be generated?\n3. Can present impediments be overcome to allow the achievement of\nthese economic returns?\nBy answering these questions, the network will be able to clearly articulate\nits value proposition for its users. For example, \u201cBy using this network you\ncan improve your margins on commodity sales by 2%,\u201d or \u201cInternet access\nwill allow you to save $X in phone charges and transportation costs per\nmonth.\u201d You must figure out how your network can improve efficiencies,\nreduce costs, or increase revenues for these customers.\nFor example, if providing market information for the local maize industry,\nthe network should be located near to where farmers bring their crop for\nsale to merchants. 346 MAINTENANCE, MONITORING AND SUSTAINABILITY\nYour network would then likely need to tie-into market information\nsystems, providing daily price sheets ($1 each), or terminals to sellers and\nmerchants ($2\/hr). Your network might also provide the means for farmers\nto read about new techniques and to buy new products. You might also\nprovide wireless connections to merchants and rent them thin-client\nterminals for Internet access.\nIf the market was small, you might be able to reduce costs by limiting\naccess to images and other bandwidth intensive services. Again, knowing\nhow much value your network will create for these merchants will allow\nyou to gauge how much they will be able to afford for your services.\nResearch the regulatory environment for wireless\nThe regulatory environment for wireless networks also affects the type of\nbusiness model that can be implemented.\nFirst, research whether any organisation has the right to use 2.4 GHz\nfrequencies without a license.\nIn most situations, 2.4 GHz is free to use worldwide; however, some\ncountries restrict who can operate a network or require expensive licenses\nto do so.\nSo although wireless networks might be legal in a country, the operator of\na network might have to acquire a license to use 2.4 GHz frequencies,\nwhich renders this usage prohibitive for anyone other than established\nInternet Service Providers who have sufficient cash flow to pay the license\nfees. This restriction makes it difficult for small communities to share a\nwireless network with other potentially interested parties or organisations.\nOther countries are more permissive with no such restrictions on wireless\nnetworks, so the possibility to share Internet connectivity in small\ncommunities is a viable solution.\nThe lesson is to do your research at the onset, ensuring your network will\ncomply with the laws of the country and local community. Some project\nmanagers have been forced to shut down their wireless networks simply\nbecause they were unknowingly breaking the law.\nYou should also check into the legality of Voice over Internet Protocol\n(VoIP) services.\nIn some countries there are complicated rules surrounding VoIP. The rules\nfor VoIP services and VoIP gateways vary a lot so please check in your\nown country what is legally allowed. You can start by checking wikipedia -\nhttp:\/\/en.wikipedia.org\/wiki\/Voice_over_IP 17. ECONOMIC SUSTAINABILITY 347\nAnalyse the competition\nThe next phase in the evaluation of your community involves an analysis\nof the wireless network\u2019s competition. Competitors include organisations\nthat provide similar products and services (e.g., another wireless Internet\nService provider or WISP), organisations viewed as substitutes or\nalternatives to the products and services your network provides (e.g., a\ncybercaf\u00e9), and organisations defined as new entrants to the wireless\nmarket.\nOnce you have identified your competitors, you should research them\nthoroughly. You can obtain information about your competitors through\nthe Internet, telephone calls, their advertisements and marketing materials,\nsurveys of their customers and visits to their site. Create a file for each\ncompetitor. The competitive information you gather can include a list of\nservices (including price and quality information), their target clients,\ncustomer service techniques, reputation, marketing, etc.\nBe sure to collect anything that will help you determine how to position\nyour network in the community.\nIt is important to evaluate your competition for many reasons. First, it\nhelps you determine the level of market saturation. Knowing what already\nexists will allow you to determine how your network can contribute value\nto the community. In addition, analysing the competition can stimulate\ninnovative ideas for your service offerings. Is there something that you can\ndo better than the competitors to make your services more effectively fit\nthe needs of the community?\nFinally, by analysing your competitors from the customers\u2019 point of view\nand understanding their strengths and weaknesses, you can determine your\ncompetitive advantages in the community.\nCompetitive advantages are those which cannot be easily replicated by the\ncompetition.\nFor example, a wireless network that can exclusively offer a faster Internet\nconnection than a competitor is a competitive advantage.\nDetermine initial and recurring costs and pricing\nWhen you are planning to set up and operate your wireless network, you\nmust determine the resources needed to start your project and the\nrecurring operating costs. Start-up costs include everything you must\npurchase to start your wireless network. 348 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThese expenses can range from the initial investment you make in\nhardware, access to towers and so on plus equipment for access points,\nhubs, switches, cables, solar equipment, UPS, etc. to the costs to register\nyour organisation as a legal entity.\nRecurring costs are what you must pay to continue to operate your\nwireless network, including the cost of Internet access, telephones, loans,\nelectricity, salaries, office rental fees, equipment maintenance and repairs,\nand regular investments to replace malfunctioning or obsolete equipment.\nEvery piece of equipment will eventually break down or become outdated\nat some point, and you should set aside extra money for this purpose.\nAn advisable and very common method to deal with this is to take the\nprice of the device and divide it by the period of time you estimate that it\nwill last.\nThis process is called depreciation. Here is an example. An average\ncomputer is supposed to last for two to five years. If the initial cost to\npurchase the computer was $1,000 USD, and you will be able to use the\ncomputer for five years, your annual depreciation will be $200 USD. In\nother words, you will lose $16.67 USD every month so that you can\neventually replace this computer. To make your project sustainable, it is of\nfundamental importance that you save the money to compensate for the\ndepreciation of equipment each month.\nKeep these savings until you finally have to spend them for equipment\nreplacement. Some countries have tax laws that determine the period of\ndepreciation for different types of devices.\nIn any case, you should try to be very realistic about the life-cycle of all\nthe implemented gear and plan for their depreciation carefully.\nIt is important to research all your start-up costs in advance, and make\nrealistic estimations of your recurring expenses.\nIt is always better to over-budget for expenses than to under-budget.\nWith every wireless project, there are always unforeseen costs, especially\nduring the first year of operations as you learn how to better manage your\nnetwork. Following, is a non-exhaustive list of categories of costs that\nyou should include, both in start-up phase and for your recurring costs,\njust to give you an idea of how to get started on calculating your costs:- 17. ECONOMIC SUSTAINABILITY 349\nCategories of Costs\nLabour costs -\n\u2022 Check ups (analyses) and consultancies\n\u2022 Development costs for programming, testing, integration etc.\n\u2022 Installation costs\n\u2022 Recruiting costs\n\u2022 Training costs (introduction and on-going)\n\u2022 Handling costs \/ salaries for employees or freelancers, including\nyourself\n\u2022 Equipment maintenance staff costs\n\u2022 Software support staff costs\n\u2022 Security personnel\nNon-labour costs -\n\u2022 Acquisition and production costs (for hardware like PCs, VSAT,\nradio link equipment and software)\n\u2022 Ancillary equipment (e.g., switches, cables and cabling, generator,\nUPS, etc.)\n\u2022 Data protection and security\n\u2022 Start-up inventory (chairs, tables, lighting, curtains, tiles and\ncarpeting)\n\u2022 Premises costs (new building, modification, air conditioning,\nelectrical wiring and boxes, security grills)\n\u2022 Legal costs, such as business registration\n\u2022 Initial license costs (VSAT)\n\u2022 Initial marketing costs (flyers, stickers, posters, opening party)\n\u2022 Operating costs for hardware and operating systems (Internet\naccess, telephone, etc.)\n\u2022 Rent or leasing rates (for tower space for example)\n\u2022 Depreciation of hardware and equipment\n\u2022 License fees\n\u2022 Consumables and office supplies (e.g., data media, paper, binds,\nclips)\n\u2022 Operational costs to maintain data protection and security 350 MAINTENANCE, MONITORING AND SUSTAINABILITY\n\u2022 Insurance premiums\n\u2022 Costs for energy and to ensure power supply\n\u2022 Loan payments, capital costs for paying back your setup costs\n\u2022 Costs for advertising\n\u2022 Local fees\n\u2022 Legal and accounting services\nTo improve your chances of sustainability, it is generally best to maintain\nthe lowest cost structure for your network.\nIn other words, keep your expenses as low as possible.\nTake time to thoroughly research all of your suppliers, particularly the\nISPs, and shop around for the best deals on quality service. Once again, be\ncertain that what you purchase from suppliers corresponds with the\ndemand in the community.\nBefore installing an expensive VSAT, ensure there is a sufficient number of\nindividuals and organisations in your community willing and able to pay\nfor using it.\nDepending upon demand for information access and ability to pay, an\nalternative method of connectivity may be more appropriate. Do not be\nafraid to think outside the box and be creative when determining the best\nsolution.\nKeeping your costs down should not be at the cost of quality. Because\nlow-quality equipment is more likely to malfunction, you could be\nspending more on maintenance in the long run.\nThe amount of money you will spend to maintain your ICT infrastructure\nis hard to guess. The larger and more complicated your infrastructure\nbecomes, the more financial and labour resources you must allocate for its\nmaintenance.\nMany times this relation is not linear but exponential. If you have a\nquality problem with your equipment once it is rolled out, it can cost you\nan enormous amount of money to fix it. Concurrently, your sales will\ndecrease because the equipment is not up and running.\nThere is an interesting example of a major wireless Internet Service\nProvider (WISP) who had more than 3,000 access points in operation for\na while. However, the WISP never managed to break-even because it had\nto spend too much money to maintain all the access points. 17. ECONOMIC SUSTAINABILITY 351\nIn addition, the company underestimated the short life-cycle of such\ndevices. ICT hardware tends to get cheaper and better as time goes on. As\nsoon as the company had invested time and money to install the version\nof expensive first generation 802.11b access points, the new \u201cg\u201d standard\nwas created.\nNew competitors designed better and cheaper access points and offered\nfaster Internet access for less money. Finally the first WISP was forced to\nclose down the company, although it was initially the market leader.\nKeep in mind the rapid advancement and changes in technology and\nthink about how and when it may be time for you to reinvest in newer\nand cheaper (or better) devices to keep your infrastructure competitive\nand up-to-date. As mentioned before, it is highly important that you save\nenough to be able to do so, when necessary.\nOnce you have identified and mapped out your costs, you should also\ndetermine what and how to charge for your services. This is a complicated\nand time-consuming process to do correctly. These key tips will assist\nwhen making pricing decisions:\n\u2022 Calculate the prices you charge so that you cover all costs to\nprovide the service, including all recurring expenses\n\u2022 Examine the prices of your competitors.\n\u2022 Evaluate what your customers are willing and able to pay for your\nservices, and make sure your prices correspond with these\nIt is absolutely essential to make a financial plan before you start to find\nout if your project can be sustainable.\nSecure the financing\nOnce you have determined your initial and recurring costs and created\nyour financial plan, you know how much financing you will need to run a\nsuccessful wireless network.\nThe next step is to research and secure the appropriate amount of money\nto start up and run your wireless network.\nThe most traditional method of receiving funding for wireless networks is\nthrough grants given by donors. A donor typically will contribute funding\nand other types of donations to an organisation or consortium of\norganisations to help them manage projects or support causes.\nBecause this funding is provided in the form of grants or other donations, 352 MAINTENANCE, MONITORING AND SUSTAINABILITY\nit is not expected to be repaid by the organisations implementing the\nwireless projects or by the project\u2019s beneficiaries.\nSuch donors include large international organisations like the United\nNations (UN) and various specialised UN agencies like the United\nNations Development Program (UNDP) and United Nations\nEducational, Scientific and Cultural Organization (UNESCO).\nGovernment agencies that specialise in international development, such as\nthe United States Agency for International Development (USAID), the\nUnited Kingdom\u2019s Department for International Development (DFID),\nand the Canadian International Development Agency (CIDA), are also\nconsidered donors. Large foundations like the Gates Foundation and the\nSoros Foundation and private commercial companies are other types of\ndonors.\nTypically, receiving funding involves a competitive or a non-competitive\nprocess. The non-competitive process is more infrequent, so we will focus\non the competitive process at a very high level. Most donors have\ncomplicated procedures surrounding the distribution of funding. During\nthe competitive bid process, the donor creates a request for proposal\n(RFP) or a request for application (RFA), which solicits various non-\ngovernmental organisations, private companies and their partners to\nsubmit proposals outlining their plans for projects within the constraints\nof the donors\u2019 objectives and guidelines.\nIn response to this RFP or RFA, NGOs and other organisations compete\nthrough the submittal of their proposals, which are then evaluated by the\ndonors based on specific established criteria. Finally, the donor\norganisation selects the most appropriate and highest ranking proposal to\nfund the project.\nSometimes donors also supply funding to support an organisation\u2019s\noperations, but this type of funding is more unusual than the competitive\nbid process for a specific project.\nAnother way of accessing the necessary funds to start and maintain a\nwireless network is through microfinance, or the provision of loans,\nsavings and other basic financial services to the world\u2019s poorest people.\nPioneered in the 1970\u2019s by organisations like ACCION International and\nGrameen Bank, microcredit, a type of microfinance, enables entrepreneurs\nto receive loans in small amounts of money to start up small enterprises. 17. ECONOMIC SUSTAINABILITY 353\nDespite the fact that often individuals lack many of the traditional\nqualifications needed to obtain loans like verifiable credit, collateral or\nsteady employment, microcredit programs have been highly successful in\nmany countries.\nTypically, the process involves an individual or a group completing and\nsubmitting a loan application in the hopes of receiving a loan, and the\nlender, the individual or organisation that provides the loan, giving money\non condition that it is returned with interest.\nThe use of microcredit to fund wireless networks does pose one constraint.\nUsually, microcredit involves very small sums of money. Unfortunately,\nbecause a large amount of capital is needed to purchase the initial\nequipment for wireless network set up, sometimes a microcredit loan is\nnot sufficient.\nHowever, there have been many successful applications of microcredit that\nhave brought technology to communities. An example includes the story\nof village phone operators. These entrepreneurs use their microcredit loans\nto purchase mobile phones and phone credits.\nThey then rent the use of their mobile phones to community members on\na per-call basis and earn enough money to repay their debt and make a\nprofit for themselves and their families.\nAnother mechanism for getting funding to start a wireless network is\nangel funding. Angel investors are normally wealthy individuals that\nprovide capital for business start-up in exchange for a high rate of return\non their investment.\nBecause the ventures in which they invest are start ups and, therefore,\noften high risk, angel investors tend to expect different things in addition\nto their return.\nMany expect a Board position and maybe a role in the organisation.\nSome angels want to have a stake in the company, while others prefer\nshares in the company that can be easily redeemable at face value, thus\nproviding a clear exit for the investor.\nTo protect their investments, angels frequently ask the businesses not to\nmake certain key decisions without their approval. Because of the high\nrisk involved in developing markets, it is often challenging to find angel\ninvestors to help setup a wireless network, but not impossible.\nThe best way to find potential investors is through your social network\nand through research online. 354 MAINTENANCE, MONITORING AND SUSTAINABILITY\nEvaluate the strengths and weaknesses of the internal\nsituation\nA network is only as good as the people who work and operate it.\nThe team you put in place can mean the difference between success and\nfailure.\nThat is why it is important to reflect on your team\u2019s qualifications and\nskills, including those of staff and volunteers, in comparison to the\ncompetencies needed for a wireless project.\nFirst, make a list of all the competencies needed to run a wireless project\nsuccessfully. Capacity areas should include technology, human resources,\naccounting, marketing, sales, negotiation, legal, and operations, among\nothers. Afterwards, identify local resources to fulfill these skills. Map your\nteam\u2019s skill sets to the competencies needed, and identify key gaps. One\ntool often used to assist with this self-evaluation is an analysis of\nstrengths, weaknesses, opportunities and threats, called SWOT.\nTo conduct this analysis, specify your internal strengths and weaknesses,\nand elaborate upon the external opportunities and threats in your\ncommunity. It is important to be realistic and honest about what you do\nwell and what you are lacking.\nBe sure to distinguish between where your organisation is at the beginning\nof this endeavour from where it could be in the future. Your strengths and\nweaknesses allow you to evaluate your capacities internally and better\nunderstand what your organisation can do, as well as its limits.\nBy understanding your strengths and weaknesses and comparing them to\nthose of your competitors, you can determine your competitive advantages\nin the market. You can also note the areas where you can improve.\nOpportunities and threats are external, which enable you to analyse real\nworld conditions and how these conditions influence your network.\nThe diagram on the next page will help you in creating your own\nSWOT analysis for your organisation.\nBe sure to respond to the questions asked and list your strengths,\nweaknesses, opportunities and threats in the spaces designated. 17. ECONOMIC SUSTAINABILITY 355\nStrengths Weaknesses\nWhat do you do well? What could you improve?\nWhat unique resources can you draw Where do you have fewer resources\non? What do others see as your than others?\nstrengths? What are others likely to see as\nweaknesses?\nOpportunities Threats\nWhat good opportunities are open to What trends could harm you? What is\nyou? What trends could you take your competition doing?\nadvantage of? How can you turn your What threats do your weaknesses\nstrengths into opportunities? expose you to?\nPutting it all together\nOnce you have gathered all of the information, you are ready to put\neverything together and decide upon the best model for the wireless\nnetwork in your community. Based on the results of your external and\ninternal analyses, you must refine your mission and service offerings. All\nof the factors that you researched in the preceding steps come into play\nwhen determining your overall strategy. It is essential to employ a model\nthat capitalises on opportunities and works within the constraints of the\nlocal environment.\nTo do this, you must often find innovative solutions to attain\nsustainability. By exploring several examples and discussing the\ncomponents of the models implemented in those instances, you will better\nunderstand how to arrive at an appropriate model.\nIn the distant jungles of the Democratic Republic of Congo, there is a\nrural hospital in a village called Vanga in the province of Bandundu. It is\nso remote that patients travel for weeks to get there often through a\ncombination of travel by foot and by river.\nThis village, founded by Baptist missionaries in 1904, has served as a\nhospital for many years.\nAlthough it is extremely remote, it is renowned for being an excellent\nfacility and has had the support of German and American missionaries\nwho have kept this facility in operation.\nIn 2004, a project sponsored by USAID established a telecentre in this\nvillage to help improve education in this isolated community; this\nInternet facility was also heavily used by the educated class in the\ncommunity \u2013 the hospital's staff. 356 MAINTENANCE, MONITORING AND SUSTAINABILITY\nThe centre had been a great boon to the community, offering access to the\nworld's knowledge and even providing consultation with distant\ncolleagues in Switzerland, France and Canada.\nThe centre required near total subsidisation to operate and cover its costs,\nand funding was to end by 2006.\nAlthough the centre added great value to the community, it did have some\nshortcomings, primarily technical, economic, and political issues that\nlimited its sustainability.\nA study was commissioned to consider options for its future.\nAfter reviewing the centre\u2019s cost structure, it was determined that it needed\nto cut its costs and look for new ways to increase its revenues.\nThe largest expenses were electricity and Internet access; therefore, creative\nmodels needed to be constructed to reduce the telecentre\u2019s costs and\nprovide access in a way that was sustainable.\nFigure ES 1: Shared Internet over wireless 17. ECONOMIC SUSTAINABILITY 357\nIn this instance, a traditional VSAT had been used for connectivity.\nHowever, there was a unique way of accommodating local community\ngroups\u2019 limited ability to pay for Internet services. Various organisations in\nthe community shared this Internet access through a local wireless\nnetwork; this meant that they also shared the costs associated with the\nVSAT connection and local wireless network. This model led to greater\nsustainability for everyone. In Vanga, several organisations, including a\nhospital, a pharmacy, several missionary groups, a community resource\ncentre, and some non-profit organisations, had a need for Internet access\nand the means to pay for it. This arrangement enabled the network of\norganisations to have a higher quality connection at a lower cost.\nAdditionally, one organisation in the village had the capacity and\nwillingness to manage several aspects of the network\u2019s operations,\nincluding the billing and payment collection, technical maintenance and\ngeneral business operations of the entire network.\nTherefore, this model worked well in Vanga because it had been tailored\nto meet community demand and leverage local economic resources.\nFigure ES 2: DakNet's roaming access point\nAnother example of a model adapted to fit the local context is that of\nFirst Mile Solutions\u2019 DakNet. This model has been deployed in villages in\nIndia, Cambodia, Rwanda, and Paraguay. By taking into account the\nlimited buying power of villagers, this model addresses their\ncommunication needs in an innovative way.\nIn the DakNet model, there is a franchise that exists in the country, and\nlocal entrepreneurs are recruited and trained to operate kiosks equipped\nwith Wi-Fi antennas. 358 MAINTENANCE, MONITORING AND SUSTAINABILITY\nUsing pre-paid cards, villagers are able to asynchronously send and receive\nemails, texts, and voice mails, conduct web searches, and participate in e-\ncommerce. Afterwards, these communications are stored in the local\nkiosk\u2019s server. When a bus or motorcycle with a mobile access point drives\npast a kiosk, the vehicle automatically receives the kiosk\u2019s stored data and\ndelivers any incoming data. Once the vehicle reaches a hub with Internet\nconnectivity, it processes all requests, relaying emails, messages, and shared\nfiles. DakNet integrates both mobile access and franchise models to bring\nvalue to people in remote villages. For such a model to be sustainable,\nseveral key conditions need to be present.\nFirst, a franchise organisation must exist to provide financial and\ninstitutional support, including an initial investment, working capital for\ncertain recurring costs, advice on start-up practices, management training,\nstandardised processes, reporting mechanisms, and marketing tools.\nAdditionally, this model requires a highly motivated and dynamic\nindividual in the village, with the appropriate skills to manage a business\nand willingness to accept certain requirements of the franchise\norganisation. Because these entrepreneurs are often asked to commit their\nown resources to the start-up costs, they need to have sufficient access to\nfinancial resources.\nFinally, to ensure this model will sustain itself, there should be sufficient\ndemand for information and communication and few competitors in the\ncommunity.\nConclusion\nNo single business model will enable wireless networks to be sustainable\nin all environments; different models must be used and adapted as the\ncircumstances dictate. Every community has unique characteristics, and\nsufficient analysis must be conducted at the onset of a project to\ndetermine the most appropriate model. This analysis should consider\nseveral key factors in the local environment, including community\ndemand, competition, costs, economic resources, etc. Although\nappropriate planning and execution will maximise the chances of making\nyour network sustainable, there are no guarantees of success. However, by\nusing the methods detailed in this chapter, you will help to ensure that\nyour network brings value to the community in a way that corresponds\nwith the users\u2019 needs. "}